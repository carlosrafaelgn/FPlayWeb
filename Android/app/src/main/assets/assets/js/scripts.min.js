'use strict';var $jscomp=$jscomp||{};$jscomp.scope={};$jscomp.arrayIteratorImpl=function(a){var b=0;return function(){return b<a.length?{done:!1,value:a[b++]}:{done:!0}}};$jscomp.arrayIterator=function(a){return{next:$jscomp.arrayIteratorImpl(a)}};$jscomp.ASSUME_ES5=!1;$jscomp.ASSUME_NO_NATIVE_MAP=!1;$jscomp.ASSUME_NO_NATIVE_SET=!1;$jscomp.SIMPLE_FROUND_POLYFILL=!1;$jscomp.ISOLATE_POLYFILLS=!1;$jscomp.FORCE_POLYFILL_PROMISE=!1;$jscomp.FORCE_POLYFILL_PROMISE_WHEN_NO_UNHANDLED_REJECTION=!1;
$jscomp.defineProperty=$jscomp.ASSUME_ES5||"function"==typeof Object.defineProperties?Object.defineProperty:function(a,b,c){if(a==Array.prototype||a==Object.prototype)return a;a[b]=c.value;return a};$jscomp.getGlobal=function(a){a=["object"==typeof globalThis&&globalThis,a,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof global&&global];for(var b=0;b<a.length;++b){var c=a[b];if(c&&c.Math==Math)return c}throw Error("Cannot find global object");};$jscomp.global=$jscomp.getGlobal(this);
$jscomp.IS_SYMBOL_NATIVE="function"===typeof Symbol&&"symbol"===typeof Symbol("x");$jscomp.TRUST_ES6_POLYFILLS=!$jscomp.ISOLATE_POLYFILLS||$jscomp.IS_SYMBOL_NATIVE;$jscomp.polyfills={};$jscomp.propertyToPolyfillSymbol={};$jscomp.POLYFILL_PREFIX="$jscp$";var $jscomp$lookupPolyfilledValue=function(a,b){var c=$jscomp.propertyToPolyfillSymbol[b];if(null==c)return a[b];c=a[c];return void 0!==c?c:a[b]};
$jscomp.polyfill=function(a,b,c,d){b&&($jscomp.ISOLATE_POLYFILLS?$jscomp.polyfillIsolated(a,b,c,d):$jscomp.polyfillUnisolated(a,b,c,d))};$jscomp.polyfillUnisolated=function(a,b,c,d){c=$jscomp.global;a=a.split(".");for(d=0;d<a.length-1;d++){var e=a[d];if(!(e in c))return;c=c[e]}a=a[a.length-1];d=c[a];b=b(d);b!=d&&null!=b&&$jscomp.defineProperty(c,a,{configurable:!0,writable:!0,value:b})};
$jscomp.polyfillIsolated=function(a,b,c,d){var e=a.split(".");a=1===e.length;d=e[0];d=!a&&d in $jscomp.polyfills?$jscomp.polyfills:$jscomp.global;for(var f=0;f<e.length-1;f++){var g=e[f];if(!(g in d))return;d=d[g]}e=e[e.length-1];c=$jscomp.IS_SYMBOL_NATIVE&&"es6"===c?d[e]:null;b=b(c);null!=b&&(a?$jscomp.defineProperty($jscomp.polyfills,e,{configurable:!0,writable:!0,value:b}):b!==c&&(void 0===$jscomp.propertyToPolyfillSymbol[e]&&(c=1E9*Math.random()>>>0,$jscomp.propertyToPolyfillSymbol[e]=$jscomp.IS_SYMBOL_NATIVE?
$jscomp.global.Symbol(e):$jscomp.POLYFILL_PREFIX+c+"$"+e),$jscomp.defineProperty(d,$jscomp.propertyToPolyfillSymbol[e],{configurable:!0,writable:!0,value:b})))};$jscomp.initSymbol=function(){};$jscomp.iteratorPrototype=function(a){a={next:a};a[Symbol.iterator]=function(){return this};return a};
$jscomp.iteratorFromArray=function(a,b){a instanceof String&&(a+="");var c=0,d=!1,e={next:function(){if(!d&&c<a.length){var f=c++;return{value:b(f,a[f]),done:!1}}d=!0;return{done:!0,value:void 0}}};e[Symbol.iterator]=function(){return e};return e};$jscomp.polyfill("Array.prototype.values",function(a){return a?a:function(){return $jscomp.iteratorFromArray(this,function(b,c){return c})}},"es8","es3");
$jscomp.checkStringArgs=function(a,b,c){if(null==a)throw new TypeError("The 'this' value for String.prototype."+c+" must not be null or undefined");if(b instanceof RegExp)throw new TypeError("First argument to String.prototype."+c+" must not be a regular expression");return a+""};$jscomp.stringPadding=function(a,b){a=void 0!==a?String(a):" ";return 0<b&&a?a.repeat(Math.ceil(b/a.length)).substring(0,b):""};
$jscomp.polyfill("String.prototype.padEnd",function(a){return a?a:function(b,c){var d=$jscomp.checkStringArgs(this,null,"padStart");return d+$jscomp.stringPadding(c,b-d.length)}},"es8","es3");
var __awaiter=this&&this.__awaiter||function(a,b,c,d){function e(f){return f instanceof c?f:new c(function(g){g(f)})}return new (c||(c=Promise))(function(f,g){function h(l){try{m(d.next(l))}catch(n){g(n)}}function k(l){try{m(d["throw"](l))}catch(n){g(n)}}function m(l){l.done?f(l.value):e(l.value).then(h,k)}m((d=d.apply(a,b||[])).next())})},__asyncValues=this&&this.__asyncValues||function(a){function b(f){e[f]=a[f]&&function(g){return new Promise(function(h,k){g=a[f](g);c(h,k,g.done,g.value)})}}function c(f,
g,h,k){Promise.resolve(k).then(function(m){f({value:m,done:h})},g)}if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var d=a[Symbol.asyncIterator],e;return d?d.call(a):(a="function"===typeof __values?__values(a):a[Symbol.iterator](),e={},b("next"),b("throw"),b("return"),e[Symbol.asyncIterator]=function(){return this},e)};
class Icon{static init(){const a=document.getElementsByTagName("i");if(a)for(let b=a.length-1;0<=b;b--)Icon.prepare(a[b])}static prepare(a){if(!a)return null;const b=a.className;let c;if(b&&0<=(c=b.indexOf("icon-"))&&a.parentNode){const d=b.indexOf(" ",c);return Icon.create(d>c?b.substring(c,d):b.substring(c),d>c?b.substring(0,c)+b.substring(d+1):b.substring(0,c),null,null,a)}return null}static createHTML(a,b,c,d){return`<i class="icon ${b?"large":""} ${c||""}" ${d?"id="+d:""}><svg aria-hidden="true"><use href="#${a}" /></svg></i>`}static create(a,
b,c,d,e){const f=e||document.createElement("i"),g=document.createElementNS("http://www.w3.org/2000/svg","svg"),h=document.createElementNS("http://www.w3.org/2000/svg","use");g.setAttribute("aria-hidden","true");h.setAttribute("href","#"+a);g.appendChild(h);c&&f.setAttribute("id",c);f.className=b?"icon "+b:"icon";e&&!d&&(d=e.getAttribute("data-title"),e.removeAttribute("data-title"));d?f.appendChild(Strings.createSrOnlyText(d)):f.setAttribute("aria-hidden","true");f.appendChild(g);return f}static createLarge(a,
b,c,d){return Icon.create(a,b?b+" large":"large",c,d)}}Icon.baseSizePX=12;
class Strings{static toFixed(a,b){return a.toFixed(b)}static init(){Strings.comparer="Intl"in window&&Intl.Collator?(new Intl.Collator(void 0,{usage:"sort",sensitivity:"variant",numeric:!0})).compare:function(b,c){return b.localeCompare(c)};const a=App.hostInterface&&App.hostInterface.getBrowserLanguage()||navigator.userLanguage||navigator.language;a&&0===a.toLowerCase().indexOf("pt")&&(Strings.language="pt-br",document.documentElement.setAttribute("lang","pt-br"),Strings.decimalSeparator=",",Strings.oppositeDecimalSeparator=
".",Strings.About="Sobre",Strings.Edit="Edit",Strings.Delete="Excluir",Strings.DeleteSongs="Excluir m\u00fasicas",Strings.DeleteAllSongs="Excluir todas",Strings.Enable="Ativar",Strings.Disable="Desativar",Strings.Enabled="Ativado",Strings.Disabled="Desativado",Strings.Selected="Selecionado",Strings.AdvancedFilter="Filtro avan\u00e7ado",Strings.TraditionalFilter="Filtro tradicional",Strings.Missing="Faltando",Strings.MissingSongError="A m\u00fasica est\u00e1 faltando! \ud83d\ude22 Por favor, apenas adicione novamente a m\u00fasica antes de tocar. Quando voc\u00ea adiciona uma m\u00fasica que est\u00e1 faltando, ela fica na mesma posi\u00e7\u00e3o dentro da playlist! \ud83d\ude0a",
Strings.FileNotFoundOrNoPermissionError="O arquivo da m\u00fasica n\u00e3o foi encontrado ou n\u00e3o foi dada permiss\u00e3o de acesso a ele! \ud83d\ude22",Strings.NothingSelected="Nada foi selecionado! \ud83d\ude05",Strings.Cancel="Cancelar",Strings.Clear="Limpar",Strings.Back="Voltar",Strings.Close="Fechar",Strings.Refresh="Recarregar",Strings.Exit="Sair",Strings.Done="Conclu\u00eddo",Strings.Up="Acima",Strings.All="Tudo",Strings.Storage="Armazenamento",Strings.Previous="Anterior",Strings.Play=
"Tocar",Strings.Pause="Pausar",Strings.PlayPause="Tocar / Pausar",Strings.Stop="Parar",Strings.Next="Pr\u00f3xima",Strings.Seek="Buscar",Strings.Path="Caminho",Strings.PathLabel="Caminho: ",Strings.Title="T\u00edtulo",Strings.TitleLabel="T\u00edtulo: ",Strings.CurrentTitleLabel="T\u00edtulo atual: ",Strings.Album="\u00c1lbum",Strings.AlbumLabel="\u00c1lbum: ",Strings.CurrentAlbumLabel="\u00c1lbum atual: ",Strings.Artist="Artista",Strings.ArtistLabel="Artista: ",Strings.CurrentArtistLabel="Artista atual: ",
Strings.Duration="Dura\u00e7\u00e3o",Strings.DurationLabel="Dura\u00e7\u00e3o: ",Strings.Track="Faixa",Strings.TrackLabel="Faixa: ",Strings.Year="Ano",Strings.YearLabel="Ano: ",Strings.SampleRate="Taxa de amostragem",Strings.SampleRateLabel="Taxa de amostragem: ",Strings.Channels="Canais",Strings.ChannelsLabel="Canais: ",Strings.ShowInfo="Exibir informa\u00e7\u00f5es",Strings.SongInfo="Informa\u00e7\u00f5es da m\u00fasica",Strings.NoSongPlaying="Nenhuma m\u00fasica tocando! \ud83d\ude05",Strings.Playlist=
"Playlist",Strings.FileList="Lista de arquivos",Strings.CurrentPathLabel="Caminho atual: ",Strings.Loading="Carregando",Strings.LoadingLabel="Carregando\u2026 ",Strings.LoadingCurrentPathLabel="Carregando camino atual: ",Strings.Folder="Pasta",Strings.FolderLabel="Pasta: ",Strings.LeftAbbrev="E",Strings.RightAbbrev="D",Strings.DownMixToMono="Fazer down-mix para mono",Strings.UnknownError="Algo saiu errado durante a reprodu\u00e7\u00e3o. \ud83d\ude22",Strings.Add="Adicionar",Strings.AddFiles="Adicionar arquivos",
Strings.AddSongs="Adicionar m\u00fasicas",Strings.AddFolders="Adicionar pastas",Strings.AddMoreFolders="Adicionar mais pastas\u2026",Strings.ShowEffects="Exibir efeitos",Strings.ShowPlaylist="Exibir playlist",Strings.UpdateAvailable="Atualiza\u00e7\u00e3o dispon\u00edvel!",Strings.PleaseRefresh="Por favor, recarregue a p\u00e1gina para atualizar a aplica\u00e7\u00e3o. \ud83d\ude0a",Strings.AboutHTML='<p>FPlay Web \u00e9 um player de \u00e1udio experimental. \ud83d\ude0a</p>\n<p>Para mais informa\u00e7\u00f5es sobre o projeto, seu c\u00f3digo-fonte e depend\u00eancias, confira seu reposit\u00f3rio em <a target="_blank" href="https://github.com/carlosrafaelgn/FPlayWeb">github.com/carlosrafaelgn/FPlayWeb</a>.</p>\n<p>Este projeto \u00e9 licenciado sob a <a target="_blank" href="https://github.com/carlosrafaelgn/FPlayWeb/blob/master/LICENSE">MIT License</a>.</p>',
Strings.DeleteModeHTML="Clique as m\u00fasicas para exclu\u00ed-las.");Strings.translateChildren(document.body)}static translate(a){const b=Strings[a];return void 0!==b?b:a}static translateChildren(a){a=a.childNodes;for(let d=a.length-1;0<=d;d--){const e=a[d];if(!e.tagName)continue;e.childNodes&&e.childNodes.length&&Strings.translateChildren(e);let f;(f=e.getAttribute("title"))&&e.setAttribute("title",Strings.translate(f));if(f=e.getAttribute("data-string")){e.removeAttribute("data-string");var b=
0;do{let g=f.indexOf(";",b);g<b&&(g=f.length);var c=f.indexOf("|",b);0>c||c>=g?e.appendChild(document.createTextNode(Strings.translate(f))):(b=f.substring(b,c),c=f.substring(c+1,g),e.setAttribute(b,Strings.translate(c)));b=g+1}while(b<f.length)}}}static changeText(a,b){if(a){null===b&&(b="");var c=a.lastChild;c?c.nodeValue=b:a.appendChild(document.createTextNode(b))}}static createSrOnlyText(a){const b=document.createElement("span");b.className="sr-only";Strings.changeText(b,a);return b}static htmlEncode(a){return a?
a.replace(Strings.regExpAmp,"&amp;").replace(Strings.regExpLT,"&lt;").replace(Strings.regExpGT,"&gt;"):""}static htmlEncodeValue(a){return a?a.replace(Strings.regExpAmp,"&amp;").replace(Strings.regExpLT,"&lt;").replace(Strings.regExpGT,"&gt;").replace(Strings.regExpQuot,"&#34;").replace(Strings.regExpApos,"&#39;").replace(Strings.regExpGrave,"&#96;"):""}}Strings.regExpAmp=/&/g;Strings.regExpLT=/</g;Strings.regExpGT=/>/g;Strings.regExpQuot=/"/g;Strings.regExpApos=/'/g;Strings.regExpGrave=/`/g;
Strings.language="en";Strings.decimalSeparator=".";Strings.oppositeDecimalSeparator=",";Strings.Oops="Oops\u2026";Strings.AppName="FPlay";Strings.Menu="Menu";Strings.About="About";Strings.Edit="Edit";Strings.Delete="Delete";Strings.DeleteSongs="Delete songs";Strings.DeleteAllSongs="Delete all";Strings.Enable="Enable";Strings.Disable="Disable";Strings.Enabled="Enabled";Strings.Disabled="Disabled";Strings.Selected="Selected";Strings.AdvancedFilter="Advanced filter";Strings.TraditionalFilter="Traditional filter";
Strings.Missing="Missing";Strings.MissingSongError="The song is missing! \ud83d\ude22 Please, just add it again before playing it. When you add a missing song, it keeps its position in the playlist! \ud83d\ude0a";Strings.FileNotFoundOrNoPermissionError="The song's file could not be found or the permission to access it was not granted! \ud83d\ude22";Strings.NothingSelected="Nothing selected! \ud83d\ude05";Strings.OK="OK";Strings.Cancel="Cancel";Strings.Clear="Clear";Strings.Back="Back";
Strings.Close="Close";Strings.Refresh="Refresh";Strings.Exit="Exit";Strings.Done="Done";Strings.Up="Up";Strings.All="All";Strings.Storage="Storage";Strings.Previous="Previous";Strings.Play="Play";Strings.Pause="Pause";Strings.PlayPause="Play / Pause";Strings.Stop="Stop";Strings.Next="Next";Strings.Seek="Seek";Strings.Path="Path";Strings.PathLabel="Path: ";Strings.Title="Title";Strings.TitleLabel="Title: ";Strings.CurrentTitleLabel="Current title: ";Strings.Album="Album";Strings.AlbumLabel="Album: ";
Strings.CurrentAlbumLabel="Current album: ";Strings.Artist="Artist";Strings.ArtistLabel="Artist: ";Strings.CurrentArtistLabel="Current artist: ";Strings.Duration="Duration";Strings.DurationLabel="Duration: ";Strings.Track="Track";Strings.TrackLabel="Track: ";Strings.Year="Year";Strings.YearLabel="Year: ";Strings.SampleRate="Sample rate";Strings.SampleRateLabel="Sample rate: ";Strings.Channels="Channels";Strings.ChannelsLabel="Channels: ";Strings.ShowInfo="Show information";Strings.SongInfo="Song information";
Strings.NoSongPlaying="No song playing! \ud83d\ude05";Strings.Playlist="Playlist";Strings.FileList="File list";Strings.CurrentPathLabel="Current path: ";Strings.Loading="Loading";Strings.LoadingLabel="Loading\u2026 ";Strings.LoadingCurrentPathLabel="Loading current path: ";Strings.Folder="Folder";Strings.FolderLabel="Folder: ";Strings.LeftAbbrev="L";Strings.RightAbbrev="R";Strings.Volume="Volume";Strings.Panning="Panning";Strings.DownMixToMono="Down-mix to mono";Strings.UnknownError="Something went wrong during playback. \ud83d\ude22";
Strings.Add="Add";Strings.AddFiles="Add files";Strings.AddSongs="Add songs";Strings.AddFolders="Add folders";Strings.AddMoreFolders="Add more folders\u2026";Strings.ShowEffects="Show effects";Strings.ShowPlaylist="Show playlist";Strings.UpdateAvailable="Update available!";Strings.PleaseRefresh="Please, refresh the page to update the app. \ud83d\ude0a";Strings.AboutHTML='<p>FPlay Web is an experimental audio player. \ud83d\ude0a</p>\n<p>For more information about the project, its source code and dependencies, check out its repository at <a target="_blank" href="https://github.com/carlosrafaelgn/FPlayWeb">github.com/carlosrafaelgn/FPlayWeb</a>.</p>\n<p>This project is licensed under the <a target="_blank" href="https://github.com/carlosrafaelgn/FPlayWeb/blob/master/LICENSE">MIT License</a>.</p>';
Strings.DeleteModeHTML="Click songs to delete them.";class DelayControl{static delayShortCB(a){return setTimeout(a,DelayControl.shortDelayMS)}static delayFadeCB(a){return setTimeout(a,DelayControl.fadeDelayMS)}static delayShort(){return new Promise(function(a){setTimeout(a,DelayControl.shortDelayMS)})}static delayFade(){return new Promise(function(a){setTimeout(a,DelayControl.fadeDelayMS)})}}DelayControl.shortDelayMS=50;DelayControl.fadeDelayMS=350;
class FileUtils{static isTypeSupported(a){const b=a.lastIndexOf(".");if(0>b)return!1;a=a.substring(b);return FileUtils.supportedExtensions[a]||FileUtils.supportedExtensions[a.toLowerCase()]||!1}static urlOrPathToURL(a){return!a||a.startsWith(FileUtils.httpURLPrefix)||a.startsWith(FileUtils.fileURLPrefix)||a.startsWith(FileUtils.localURLPrefix)?a:FileUtils.pathToURL(a)}static pathToURL(a){return encodeURI(47===a.charCodeAt(0)?FileUtils.fileURLPrefix+a:FileUtils.fileURLPrefixWindows+a.replace(FileUtils.regExpSepWindows,
"/")).replace(FileUtils.regExpHash,"%23")}static nameFromLinuxPath(a){if(!a)return a;let b=a.lastIndexOf("/");return 0<=b?a.substring(b+1):a}}FileUtils.separator="\u0004";FileUtils.httpURLPrefix="http";FileUtils.fileURLPrefix="file://";FileUtils.localURLPrefix="local://";FileUtils.fileURLPrefixWindows="file:///";FileUtils.regExpSepWindows=/\\/g;FileUtils.regExpHash=/#/g;FileUtils.supportedExtensions={".aac":!0,".flac":!0,".mp3":!0,".ogg":!0,".wav":!0};
FileUtils.concatenatedSupportedExtensions=function(){let a="";for(let b in FileUtils.supportedExtensions)a=a?a+","+b:b;return a}();
class DataReader{constructor(a){this.arrayBuffer=a;this.dataView=new DataView(a);this.textDecoder=new TextDecoder("utf-8",{ignoreBOM:!0});this._position=0;this.length=a.byteLength}get position(){return this._position}get available(){return this.length-this._position}destroy(){zeroObject(this)}readInt8(){return this.dataView.getInt8(this._position++)}readUint8(){return this.dataView.getUint8(this._position++)}readInt16(){const a=this.dataView.getInt16(this._position,!0);this._position+=2;return a}readUint16(){const a=
this.dataView.getUint16(this._position,!0);this._position+=2;return a}readInt32(){const a=this.dataView.getInt32(this._position,!0);this._position+=4;return a}readFloat32(){const a=this.dataView.getFloat32(this._position,!0);this._position+=4;return a}readFloat64(){const a=this.dataView.getFloat64(this._position,!0);this._position+=8;return a}readString(){const a=this.dataView.getUint16(this._position,!0);this._position+=2;return a?this.textDecoder.decode(this.arrayBuffer.slice(this._position,this._position+=
a)):""}}
class DataWriter{constructor(a){this._capacity=a&&0<a?a:16384;this.arrayBuffer=new ArrayBuffer(this._capacity);this.dataView=new DataView(this.arrayBuffer);this.textEncoder=new TextEncoder;this._length=0}get trimmedArrayBuffer(){return this.arrayBuffer.slice(0,this._length)}get length(){return this._length}get capacity(){return this._capacity}destroy(){zeroObject(this)}ensureCapacity(a){a=this._length+a;a<=this._capacity||(a=new ArrayBuffer(a+(a>>2)),(new Uint8Array(a)).set(new Uint8Array(this.arrayBuffer)),this.arrayBuffer=
a,this.dataView=new DataView(this.arrayBuffer),this._capacity=a.byteLength)}writeInt8(a){this.ensureCapacity(1);this.dataView.setInt8(this._length++,a);return this}writeUint8(a){this.ensureCapacity(1);this.dataView.setUint8(this._length++,a);return this}writeInt16(a){this.ensureCapacity(2);this.dataView.setInt16(this._length,a,!0);this._length+=2;return this}writeUint16(a){this.ensureCapacity(2);this.dataView.setUint16(this._length,a,!0);this._length+=2;return this}writeInt32(a){this.ensureCapacity(4);
this.dataView.setInt32(this._length,a,!0);this._length+=4;return this}writeFloat32(a){this.ensureCapacity(4);this.dataView.setFloat32(this._length,a,!0);this._length+=4;return this}writeFloat64(a){this.ensureCapacity(8);this.dataView.setFloat64(this._length,a,!0);this._length+=8;return this}writeString(a){if(!a)return this.writeInt16(0);this.ensureCapacity(2+6*a.length);a=this.textEncoder.encodeInto(a,new Uint8Array(this.arrayBuffer,this._length+2));if(!a.written)throw Error("String encoding error");
if(65535<a.written)throw Error("String too large");this.dataView.setUint16(this._length,a.written,!0);this._length+=2+a.written;return this}}var MetadataFlags;(function(a){a[a.Seekable=1]="Seekable"})(MetadataFlags||(MetadataFlags={}));class BufferedReader{constructor(a){this.totalLength=a}}BufferedReader.minBufferLength=65536;
class BufferedFileReader extends BufferedReader{constructor(a,b){super(a.size);if(b.length<BufferedReader.minBufferLength)throw Error("Buffer length too small: "+b.length);this.file=a;this.buffer=b;this._bufferAvailable=this.bufferPosition=this.position=0;this._eof=!1}get bufferAvailable(){return this._bufferAvailable}get bufferLength(){return this.buffer.length}get readPosition(){return this.position-this._bufferAvailable}get eof(){return this._eof}seekTo(a){if(0>a)throw Error("Invalid position");
this._bufferAvailable=this.bufferPosition=0;a>=this.totalLength?(this.position=this.totalLength,this._eof=!0):(this.position=a,this._eof=!1)}skip(a){0>=a||(a>=this._bufferAvailable?(a-=this._bufferAvailable,this.position+=a,this.position>=this.totalLength&&(this.position=this.totalLength,this._eof=!0),this._bufferAvailable=this.bufferPosition=0):(this.bufferPosition+=a,this._bufferAvailable-=a))}fillBuffer(a){if(0>=a)a=this.buffer.length;else if(0>a||a>this.buffer.length)throw Error("Invalid length");
const b=this._bufferAvailable;if(a<=b||this._eof)return null;a=this.buffer.length;b&&this.bufferPosition&&(this.buffer.copyWithin(0,this.bufferPosition,this.bufferPosition+b),this.bufferPosition=0);a-=b;return new Promise((c,d)=>{this.file.slice(this.position,this.position+a).arrayBuffer().then(e=>{e.byteLength?(this.position+=e.byteLength,this.position>=this.totalLength&&(this.position=this.totalLength,this._eof=!0),this._bufferAvailable+=e.byteLength):this._eof=!0;this.buffer.set(new Uint8Array(e),
b);c()},d)})}readByte(){if(!this._bufferAvailable)return-1;this._bufferAvailable--;return this.buffer[this.bufferPosition++]}readUInt32BE(){if(4>this._bufferAvailable)return null;this._bufferAvailable-=4;return this.buffer[this.bufferPosition++]<<24|this.buffer[this.bufferPosition++]<<16|this.buffer[this.bufferPosition++]<<8|this.buffer[this.bufferPosition++]}readUInt32LE(){if(4>this._bufferAvailable)return null;this._bufferAvailable-=4;return this.buffer[this.bufferPosition++]|this.buffer[this.bufferPosition++]<<
8|this.buffer[this.bufferPosition++]<<16|this.buffer[this.bufferPosition++]<<24}readUInt16BE(){if(2>this._bufferAvailable)return null;this._bufferAvailable-=2;return this.buffer[this.bufferPosition++]<<8|this.buffer[this.bufferPosition++]}readUInt16LE(){if(2>this._bufferAvailable)return null;this._bufferAvailable-=2;return this.buffer[this.bufferPosition++]|this.buffer[this.bufferPosition++]<<8}read(a,b,c){if(0>c)throw Error("Invalid length");const d=this._bufferAvailable;if(c<=d)return a.set(this.buffer.subarray(this.bufferPosition,
this.bufferPosition+=c),b),this._bufferAvailable-=c,this._bufferAvailable||(this.bufferPosition=0),c;let e=0;d&&(a.set(this.buffer.subarray(this.bufferPosition,this.bufferPosition+d),b),e+=d,b+=d,c-=d,this._bufferAvailable=this.bufferPosition=0);return this._eof?e:new Promise((f,g)=>{this.file.slice(this.position,this.position+c).arrayBuffer().then(h=>{h.byteLength?(this.position+=h.byteLength,this.position>=this.totalLength&&(this.position=this.totalLength,this._eof=!0)):this._eof=!0;a.set(new Uint8Array(h),
b);f(h.byteLength+e)},g)})}}
class MetadataExtractor{static extractRIFF(a,b,c){return __awaiter(this,void 0,void 0,function*(){if(44>b.totalLength)return null;var d=b.readUInt32LE();if(null===d||b.totalLength<8+d)return null;var e=d;let f=!1,g=!1,h=d=0,k=0;a:for(;0<e;){var m=!1,l=0,n=void 0;switch(b.readUInt32BE()){case null:break a;case 1463899717:m=!0;e-=4;break;case 1279873876:l=b.readUInt32LE();if(null===l)break a;e-=8;if(0>l||l>e)break a;break;case 1768174368:l=b.readUInt32LE();if(null===l)break a;e-=8;if(0>l||l>e)break a;
(n=b.fillBuffer(1024))&&(yield n);if(4<l){m=b.readByte();var q=b.readByte();n=b.readByte();if(null===m||null===q||null===n)break a;e-=3;l-=3;if(73===m||68===q||51===n)if(d=b.totalLength-e,f&&g){d=-1;break a}}b.skip(l);(n=b.fillBuffer(1024))&&(yield n);continue;default:l=b.readUInt32LE();if(null===l)break a;e-=8;if(0>l||l>e)break a;b.skip(l);(n=b.fillBuffer(1024))&&(yield n);continue}for((n=b.fillBuffer(1024))&&(yield n);m&&(!f||!g)||0<l;){var p=b.readUInt32BE();q=0;if(null===p)break a;e-=4;l-=4;if(1229866575!==
p){q=b.readUInt32LE();if(null===q||0>q||q>e||!m&&q>l)break a;e-=4;l-=4}1684108385!==p&&(n=b.fillBuffer(Math.min(264,8+q)))&&(yield n);switch(p){case 1718449184:if(!m)break;n=b.readUInt16LE();p=b.readUInt16LE();var r=b.readUInt32LE(),t=b.readUInt32LE();const u=b.readUInt16LE(),y=b.readUInt16LE();q-=16;e-=16;l-=16;if(null===n||null===p||null===r||null===t||null===u||null===y)break a;f=!0;k||(k=t);a.sampleRate=r;a.channels=p;break;case 1684108385:m&&(g=!0,h||(h=q));break;case 1229866575:function x(v){b.read(c,
0,v);return MetadataExtractor.finishReadingV2Frame(0,v,c)}for(;0<l;){if(4>l){b.skip(l);(n=b.fillBuffer(8))&&(yield n);break}(n=b.fillBuffer(8))&&(yield n);p=b.readUInt32BE();e-=4;l-=4;if(null===p)break a;r=b.readUInt32LE();e-=4;l-=4;if(null===r||0>r||r>l)b.skip(l),e-=l,l=0;else if(1>=r)b.skip(r),e-=r,l-=r;else{t=Math.min(257,r)-1;(n=b.fillBuffer(t))&&(yield n);switch(p){case 1229865293:a.title=x(t);break;case 1230000708:a.album=x(t);break;case 1229017684:a.artist=x(t);break;case 1229148740:a.year=
parseInt(x(t))||0;break;case 1230262859:a.track=parseInt(x(t))||0;break;default:t=0}b.skip(r-t);e-=r;l-=r}}}0<q&&(b.skip(q),e-=q,l-=q);e&&(n=b.fillBuffer(8))&&(yield n)}}return f&&g?(d&&(0<d&&b.seekTo(d),(e=b.fillBuffer(1024))&&(yield e)),a.lengthMS=Math.floor(1E3*h/k),[a,!!d]):null})}static finishReadingV2Frame(a,b,c){let d=0;var e=b-1;a:for(;0<b;)switch(c[d]){case 0:case 9:case 10:case 11:case 12:case 13:case 32:case 133:case 160:b--;d++;break;default:break a}a:for(;0<b;)switch(c[e]){case 0:case 9:case 10:case 11:case 12:case 13:case 32:case 133:case 160:b--;
e--;break;default:break a}e=null;switch(a){case 1:case 2:if(b&1&&d+b<c.length&&b++,2<=b&&1===a&&(254===c[d]&&255===c[d+1]?(a=2,d+=2,b-=2):255===c[d]&&254===c[d+1]&&(d+=2,b-=2),!b))return null}switch(a){case 0:e=MetadataExtractor.textDecoderIso88591.decode(c.subarray(d,d+b));break;case 1:e=MetadataExtractor.textDecoderUtf16.decode(c.subarray(d,d+b));break;case 2:e=MetadataExtractor.textDecoderUtf16be.decode(c.subarray(d,d+b));break;case 3:e=MetadataExtractor.textDecoderUtf8.decode(c.subarray(d,d+b))}return e&&
e.length?e:null}static readV2Frame(a,b,c){if(2>b)return a.skip(b),null;const d=a.readByte();b--;if(0>d||3<d)return a.skip(b),null;let e=c[0];b>e.length&&(e=new Uint8Array(b+16),c[0]=e);a=a.read(e,0,b);return"number"===typeof a?MetadataExtractor.finishReadingV2Frame(d,a,e):a.then(function(f){return MetadataExtractor.finishReadingV2Frame(d,f,e)})}static extractID3v1(a,b,c,d){return __awaiter(this,void 0,void 0,function*(){try{b.seekTo(b.totalLength-128);const g=b.read(d,0,128);"number"!==typeof g&&
(yield g);if(84==d[0]&&65==d[1]&&71==d[2]){var e;if(!(c&MetadataExtractor.TITLE_B)){var f=3;for(e=0;30>e&&d[f];)e++,f++;e&&(a.title=MetadataExtractor.textDecoderIso88591.decode(d.subarray(3,3+e)))}if(!(c&MetadataExtractor.ARTIST_B)){f=33;for(e=0;30>e&&d[f];)e++,f++;e&&(a.artist=MetadataExtractor.textDecoderIso88591.decode(d.subarray(33,33+e)))}if(!(c&MetadataExtractor.ALBUM_B)){f=63;for(e=0;30>e&&d[f];)e++,f++;e&&(a.album=MetadataExtractor.textDecoderIso88591.decode(d.subarray(63,63+e)))}if(!(c&MetadataExtractor.YEAR_B)){f=
93;for(e=0;4>e&&d[f];)e++,f++;e&&(a.year=parseInt(MetadataExtractor.textDecoderIso88591.decode(d.subarray(93,93+e))))}c&MetadataExtractor.TRACK_B||d[125]||!d[126]||(a.track=d[126]&255)}}catch(g){}})}static extractSampleRateAndChannels(a,b,c,d){return __awaiter(this,void 0,void 0,function*(){try{b.seekTo(c);var e=b.fillBuffer(4);e&&(yield e);var f=b.readUInt32BE();if(d){if(f&&4095===(f>>20&4095)&&(e=f>>10&15,!(13<=e))){switch(e){case 0:a.sampleRate=96E3;break;case 1:a.sampleRate=88200;break;case 2:a.sampleRate=
64E3;break;case 3:a.sampleRate=48E3;break;case 4:a.sampleRate=44100;break;case 5:a.sampleRate=32E3;break;case 6:a.sampleRate=24E3;break;case 7:a.sampleRate=22050;break;case 8:a.sampleRate=16E3;break;case 9:a.sampleRate=12E3;break;case 10:a.sampleRate=11025;break;case 11:a.sampleRate=8E3;break;default:a.sampleRate=7350}f=f>>6&7;switch(f){case 0:a.channels=2;break;case 7:a.channels=8;break;default:a.channels=f}}}else if(f&&2047===(f>>21&2047)&&(e=f>>19&3,1!==e)){var g=f>>10&3;if(3!==g){switch(e){case 0:switch(g){case 0:a.sampleRate=
11025;break;case 1:a.sampleRate=12E3;break;case 2:a.sampleRate=8E3}break;case 2:switch(g){case 0:a.sampleRate=22050;break;case 1:a.sampleRate=24E3;break;case 2:a.sampleRate=16E3}break;case 3:switch(g){case 0:a.sampleRate=44100;break;case 1:a.sampleRate=48E3;break;case 2:a.sampleRate=32E3}}a.channels=3===(f>>6&3)?1:2}}}catch(h){}})}static extractID3v2Andv1(a,b,c,d,e){return __awaiter(this,void 0,void 0,function*(){const f=MetadataExtractor.createBasicMetadata(a);f.url?f.url.startsWith(FileUtils.localURLPrefix)&&
(f.file=a):(f.file=a,f.fileSize=a.size,f.fileName=a.name);let g=0;var h=b.readByte()<<24|b.readByte()<<16|b.readByte()<<8;if(1229206272!==h)if(h|=b.readByte(),1380533830===h){e=!1;h=yield MetadataExtractor.extractRIFF(f,b,c[0]);if(!h)return null;if(!h[1])return f;f.lengthMS&&(g|=MetadataExtractor.LENGTH_B)}else return e&&(yield MetadataExtractor.extractSampleRateAndChannels(f,b,0,d)),yield MetadataExtractor.extractID3v1(f,b,0,c[0]),f;var k=b.readByte(),m=b.readByte();h=b.readByte();var l=b.readByte();
const n=b.readByte(),q=b.readByte(),p=b.readByte();h=(h&16?10:0)+(p&127|(q&127)<<7|(n&127)<<14|(l&127)<<21);l=10+h;if(2<(k&255)||m){for(;0<h&&g!==MetadataExtractor.ALL_B;){(k=b.fillBuffer(1024))&&(yield k);m=b.readUInt32BE();k=b.readUInt32BE();b.skip(2);if(!m||0>=k||k>h)break;switch(m){case 1414091826:g&MetadataExtractor.TITLE_B?b.skip(k):(m=MetadataExtractor.readV2Frame(b,k,c),f.title=m&&m.then?yield m:m,f.title&&(g|=MetadataExtractor.TITLE_B));break;case 1414546737:g&MetadataExtractor.ARTIST_B?
b.skip(k):(m=MetadataExtractor.readV2Frame(b,k,c),f.artist=m&&m.then?yield m:m,f.artist&&(g|=MetadataExtractor.ARTIST_B));break;case 1413565506:g&MetadataExtractor.ALBUM_B?b.skip(k):(m=MetadataExtractor.readV2Frame(b,k,c),f.album=m&&m.then?yield m:m,f.album&&(g|=MetadataExtractor.ALBUM_B));break;case 1414677323:g&MetadataExtractor.TRACK_B?b.skip(k):(m=MetadataExtractor.readV2Frame(b,k,c),f.track=m&&m.then?parseInt(yield m):parseInt(m),f.track?g|=MetadataExtractor.TRACK_B:f.track=0);break;case 1414284622:g&
MetadataExtractor.LENGTH_B?b.skip(k):(m=MetadataExtractor.readV2Frame(b,k,c),f.lengthMS=m&&m.then?parseInt(yield m):parseInt(m),f.lengthMS?g|=MetadataExtractor.LENGTH_B:f.lengthMS=0);break;case 1415136594:case 1413763651:g&MetadataExtractor.YEAR_B?b.skip(k):(m=MetadataExtractor.readV2Frame(b,k,c),f.year=m&&m.then?parseInt(yield m):parseInt(m),f.year?g|=MetadataExtractor.YEAR_B:f.year=0);break;default:b.skip(k)}h-=10+k}e&&(yield MetadataExtractor.extractSampleRateAndChannels(f,b,l,d));(g&MetadataExtractor.ALL_BUT_LENGTH_B)!==
MetadataExtractor.ALL_BUT_LENGTH_B&&(yield MetadataExtractor.extractID3v1(f,b,g,c[0]))}return f})}static createBasicMetadata(a){return{url:FileUtils.urlOrPathToURL(a["data-path"])||"",flags:MetadataFlags.Seekable}}static extract(a,b,c){return __awaiter(this,void 0,void 0,function*(){if(!a)return null;b||(b=new Uint8Array(BufferedReader.minBufferLength));c||(c=[new Uint8Array(256)]);let d=!1;if(!a.name.endsWith(".mp3")&&!(d=a.name.endsWith(".aac"))&&!a.name.endsWith(".wav")){if(a.name.endsWith(".flac"))return FLACMetadataExtractor.extract(a,
b,c);if(a.name.endsWith(".ogg"))return OggMetadataExtractor.extract(a,b,c);const e=a.name.toLowerCase();if(!e.endsWith(".mp3")&&!(d=e.endsWith(".aac"))&&!e.endsWith(".wav"))return e.endsWith(".flac")?FLACMetadataExtractor.extract(a,b,c):e.endsWith(".ogg")?OggMetadataExtractor.extract(a,b,c):null}try{const e=new BufferedFileReader(a,b);yield e.fillBuffer(-1);return yield MetadataExtractor.extractID3v2Andv1(a,e,c,d,!0)}catch(e){return null}})}}MetadataExtractor.ALL_B=63;
MetadataExtractor.ALL_BUT_LENGTH_B=31;MetadataExtractor.TITLE_B=1;MetadataExtractor.ARTIST_B=2;MetadataExtractor.ALBUM_B=4;MetadataExtractor.TRACK_B=8;MetadataExtractor.YEAR_B=16;MetadataExtractor.LENGTH_B=32;MetadataExtractor.textDecoderIso88591=new TextDecoder("iso-8859-1");MetadataExtractor.textDecoderUtf16=new TextDecoder("utf-16");MetadataExtractor.textDecoderUtf16be=new TextDecoder("utf-16be");MetadataExtractor.textDecoderUtf8=new TextDecoder("utf-8");
class VorbisCommentExtractor extends MetadataExtractor{static extractVorbisComment(a,b,c,d){return __awaiter(this,void 0,void 0,function*(){var e=c.fillBuffer(1024);e&&(yield e);e=c.readUInt32LE();a-=4;if(!e||e>a)return!1;c.skip(e);a-=e;if(!a)return!0;(e=c.fillBuffer(1024))&&(yield e);let f=c.readUInt32LE();a-=4;if(null===f||0>a||f>a)return!1;let g=null,h=null,k=null;for(;0<f;){f--;(e=c.fillBuffer(4))&&(yield e);const m=c.readUInt32LE();a-=4;if(null===m||0>a||m>a)return!1;const l=Math.min(2048,m);
let n=d[0];n.length<l&&(n=new Uint8Array(l),d[0]=n);(e=c.fillBuffer(l+4))&&(yield e);c.read(n,0,l);m>l&&c.skip(m-l);a-=m;try{let q;for(q=0;q<l;q++)if(61===n[q]){if(q&&q<l-1){let p;switch(MetadataExtractor.textDecoderUtf8.decode(n.subarray(0,q)).normalize().trim().toUpperCase()){case "TITLE":if(p=MetadataExtractor.textDecoderUtf8.decode(n.subarray(q+1,l)).normalize().trim())b.title=p;break;case "ARTIST":if(p=MetadataExtractor.textDecoderUtf8.decode(n.subarray(q+1,l)).normalize().trim())b.artist=b.artist?
b.artist+(", "+p):p;break;case "PERFORMER":if(p=MetadataExtractor.textDecoderUtf8.decode(n.subarray(q+1,l)).normalize().trim())g=p;break;case "ALBUMARTIST":if(p=MetadataExtractor.textDecoderUtf8.decode(n.subarray(q+1,l)).normalize().trim())h=p;break;case "COMPOSER":if(p=MetadataExtractor.textDecoderUtf8.decode(n.subarray(q+1,l)).normalize().trim())k=p;break;case "ALBUM":if(p=MetadataExtractor.textDecoderUtf8.decode(n.subarray(q+1,l)).normalize().trim())b.album=p;break;case "TRACKNUMBER":if(p=MetadataExtractor.textDecoderUtf8.decode(n.subarray(q+
1,l)).normalize().trim())b.track=parseInt(p)||0;break;case "DATE":if(p=MetadataExtractor.textDecoderUtf8.decode(n.subarray(q+1,l)).normalize().trim())b.year=parseInt(p)||0}}break}}catch(q){}}b.artist||(g?b.artist=g:h?b.artist=h:k&&(b.artist=k));return!0})}}
class FLACMetadataExtractor extends VorbisCommentExtractor{static readHeaderAndStreamInfo(a,b,c){if(1716281667!==b.readUInt32BE())return 0;var d=b.readUInt32BE();if(!d)return 0;c=d&2147483648;if(34!==(d&2147483647))return 0;b.skip(10);d=b.readUInt32BE();let e=b.readUInt32BE();if(!d||null===e)return 0;b.skip(16);e+=4294967296*(d&15);d>>=4;b=(d&31)+1;d>>=5;const f=(d&7)+1;d>>=3;if(4>b||!d)return 0;e&&(a.lengthMS=Math.floor(1E3*e/d));a.sampleRate=d;a.channels=f;return c?-1:1}static readMetadataBlock(a,
b,c){return __awaiter(this,void 0,void 0,function*(){var d=b.fillBuffer(4);d&&(yield d);d=b.readUInt32BE();if(!d)return 0;const e=d&2147483648;d&=2147483647;const f=d>>24;d&=16777215;if(127===f||d+b.readPosition>b.totalLength)return 0;if(4===f)return(yield VorbisCommentExtractor.extractVorbisComment(d,a,b,c))?-1:0;b.skip(d);return e?-1:1})}static extract(a,b,c){return __awaiter(this,void 0,void 0,function*(){try{const d=new BufferedFileReader(a,b);yield d.fillBuffer(-1);const e=MetadataExtractor.createBasicMetadata(a);
let f=FLACMetadataExtractor.readHeaderAndStreamInfo(e,d,c[0]);if(!f)return null;if(0>f)return e;do if(f=yield FLACMetadataExtractor.readMetadataBlock(e,d,c),!f)return null;while(0<f);return e}catch(d){return null}})}}
class OggBufferedReader extends BufferedFileReader{constructor(a,b){super(a,b);this.additionalSkipLength=this.currentPageLength=0}readPageLength(){if(super.bufferAvailable<OggBufferedReader.basicPageStructureLength||1332176723!==super.readUInt32BE())return-1;super.skip(22);let a=super.readByte();if(super.bufferAvailable<a)return-1;if(!a)return 0;let b=0;for(;0<a--;)b+=super.readByte();return b}findInitialVorbisCommentPage(a){const b=Object.create(null,{fillBuffer:{get:()=>super.fillBuffer},bufferAvailable:{get:()=>
super.bufferAvailable},readByte:{get:()=>super.readByte},readUInt32BE:{get:()=>super.readUInt32BE},readUInt16BE:{get:()=>super.readUInt16BE},skip:{get:()=>super.skip},readUInt32LE:{get:()=>super.readUInt32LE}});return __awaiter(this,void 0,void 0,function*(){debugger;for(;;){var c=b.fillBuffer.call(this,OggBufferedReader.maximumOggPageHeaderLength+OggBufferedReader.vorbisIdentifierLength);c&&(yield c);c=this.readPageLength();if(0>c)return!1;if(c)if(c>OggBufferedReader.vorbisIdentifierLength){if(b.bufferAvailable<
OggBufferedReader.vorbisIdentifierLength)return!1;var d=b.readByte.call(this);if(0>d)return!1;var e=void 0;switch(d){case 1:d=b.readUInt32BE.call(this);e=b.readUInt16BE.call(this);if(1987015266===d&&26995===e){this.currentPageLength=c-7;(d=this.fillBuffer(9))&&(yield d);b.skip.call(this,4);d=b.readByte.call(this);e=b.readUInt32LE.call(this);if(0>d||!e)return!1;a.channels=d;a.sampleRate=e;this.currentPageLength=c-16;b.skip.call(this,c-16);continue}b.skip.call(this,c-7);break;case 3:d=b.readUInt32BE.call(this);
e=b.readUInt16BE.call(this);if(1987015266===d&&26995===e)return this.currentPageLength=c-7,(c=this.fillBuffer(this.currentPageLength))&&(yield c),!0;b.skip.call(this,c-7);break;default:b.skip.call(this,c-1)}}else b.skip.call(this,c)}})}seekTo(a){throw Error("Unsupported operation");}skip(a){if(!(0>=a)){if(0<this.additionalSkipLength)this.additionalSkipLength+=a;else{if(a<=this.currentPageLength){this.currentPageLength-=a;super.skip(a);return}this.additionalSkipLength=a-this.currentPageLength;super.skip(this.currentPageLength);
this.currentPageLength=0}for(;super.bufferAvailable>OggBufferedReader.maximumOggPageHeaderLength;){this.currentPageLength=this.readPageLength();if(0>this.currentPageLength){super.skip(super.totalLength);break}if(this.currentPageLength){if(this.additionalSkipLength<=this.currentPageLength){this.currentPageLength-=this.additionalSkipLength;super.skip(this.additionalSkipLength);this.additionalSkipLength=0;break}this.additionalSkipLength-=this.currentPageLength;super.skip(this.currentPageLength);this.currentPageLength=
0}}}}skipAdditionalSkipLength(){const a=Object.create(null,{fillBuffer:{get:()=>super.fillBuffer},skip:{get:()=>super.skip}});return __awaiter(this,void 0,void 0,function*(){for(;0<this.additionalSkipLength;){let b=a.fillBuffer.call(this,OggBufferedReader.maximumOggPageHeaderLength+OggBufferedReader.maximumOggPageHeaderLength+4);b&&(yield b);if(!this.currentPageLength&&!this.readNextPageLength()){this.additionalSkipLength=0;break}if(this.additionalSkipLength<=this.currentPageLength){this.currentPageLength-=
this.additionalSkipLength;a.skip.call(this,this.additionalSkipLength);this.additionalSkipLength=0;(b=a.fillBuffer.call(this,OggBufferedReader.maximumOggPageHeaderLength+OggBufferedReader.maximumOggPageHeaderLength+4))&&(yield b);break}this.additionalSkipLength-=this.currentPageLength;a.skip.call(this,this.currentPageLength);this.currentPageLength=0}})}readNextPageLength(){for(;super.bufferAvailable>OggBufferedReader.maximumOggPageHeaderLength;){this.currentPageLength=this.readPageLength();if(0>this.currentPageLength){super.skip(super.totalLength);
break}if(this.currentPageLength){if(!super.bufferAvailable)break;return!0}}return!1}fillBuffer(a){if(0<this.additionalSkipLength)return this.skipAdditionalSkipLength().then(()=>this.fillBuffer(a));const b=super.fillBuffer(Math.min(a+OggBufferedReader.maximumOggPageHeaderLength+OggBufferedReader.maximumOggPageHeaderLength+4,super.bufferLength));if(b)return b.then(()=>this.fillBuffer(a));this.currentPageLength||this.readNextPageLength();return null}readByte(){if(!this.currentPageLength&&!this.readNextPageLength())return-1;
this.currentPageLength--;return super.readByte()}readUInt32BE(){if(4<=this.currentPageLength)return this.currentPageLength-=4,super.readUInt32BE();const a=this.readByte(),b=this.readByte(),c=this.readByte(),d=this.readByte();return 0>a||0>b||0>c||0>d?null:a<<24|b<<16|c<<8|d}readUInt32LE(){if(4<=this.currentPageLength)return this.currentPageLength-=4,super.readUInt32LE();const a=this.readByte(),b=this.readByte(),c=this.readByte(),d=this.readByte();return 0>a||0>b||0>c||0>d?null:a|b<<8|c<<16|d<<24}readUInt16BE(){if(2<=
this.currentPageLength)return this.currentPageLength-=2,super.readUInt16BE();const a=this.readByte(),b=this.readByte();return 0>a||0>b?null:a<<8|b}readUInt16LE(){if(2<=this.currentPageLength)return this.currentPageLength-=2,super.readUInt16LE();const a=this.readByte(),b=this.readByte();return 0>a||0>b?null:a|b<<8}readAsync(a,b,c,d,e){const f=Object.create(null,{eof:{get:()=>super.eof},fillBuffer:{get:()=>super.fillBuffer},read:{get:()=>super.read}});return __awaiter(this,void 0,void 0,function*(){if("number"!==
typeof a&&(a=yield a,0>=a))return e;d-=a;this.currentPageLength-=a;c+=a;for(e+=a;0<d&&!f.eof;){if(!this.currentPageLength&&(this.bufferAvailable<OggBufferedReader.maximumOggPageHeaderLength&&(yield f.fillBuffer.call(this,OggBufferedReader.maximumOggPageHeaderLength+OggBufferedReader.maximumOggPageHeaderLength+4)),!this.readNextPageLength()))return e;a=f.read.call(this,b,c,Math.min(d,this.currentPageLength));"number"!==typeof a&&(a=yield a);if(0>=a)break;d-=a;this.currentPageLength-=a;c+=a;e+=a}this.currentPageLength||
(this.bufferAvailable<OggBufferedReader.maximumOggPageHeaderLength&&(yield f.fillBuffer.call(this,OggBufferedReader.maximumOggPageHeaderLength+OggBufferedReader.maximumOggPageHeaderLength+4)),this.readNextPageLength());return e})}read(a,b,c){if(0<this.additionalSkipLength)return this.skipAdditionalSkipLength().then(()=>this.read(a,b,c));let d=0;for(;0<c&&!super.eof;){if(!this.currentPageLength){if(this.bufferAvailable<OggBufferedReader.maximumOggPageHeaderLength)return this.readAsync(0,a,b,c,d);if(!this.readNextPageLength())return d}const e=
super.read(a,b,Math.min(c,this.currentPageLength));if("number"!==typeof e)return this.readAsync(e,a,b,c,d);if(0>=e)break;c-=e;this.currentPageLength-=e;b+=e;d+=e}!this.currentPageLength&&this.bufferAvailable>OggBufferedReader.maximumOggPageHeaderLength&&this.readNextPageLength();return d}}OggBufferedReader.basicPageStructureLength=27;OggBufferedReader.maximumOggPageHeaderLength=OggBufferedReader.basicPageStructureLength+255;OggBufferedReader.vorbisIdentifierLength=7;
class OggMetadataExtractor extends VorbisCommentExtractor{static extract(a,b,c){return __awaiter(this,void 0,void 0,function*(){try{const d=new OggBufferedReader(a,b),e=MetadataExtractor.createBasicMetadata(a);return(yield d.findInitialVorbisCommentPage(e))?(yield VorbisCommentExtractor.extractVorbisComment(d.totalLength-d.readPosition,e,d,c))?e:null:null}catch(d){return null}})}}
class Formatter{static formatTimeMS(a){if(0>a)return Formatter.none;a=a/1E3|0;let b=(a/60|0)+":";a%=60;10>a&&(b+="0");return b+a}static formatTimeS(a){if(0>a)return Formatter.none;let b=(a/60|0)+":";a%=60;10>a&&(b+="0");return b+a}static formatDB(a){return 0>a?Strings.toFixed(a,1):0===a?"-"+Strings.toFixed(a,1):"+"+Strings.toFixed(a,1)}}Formatter.zero="0:00";Formatter.none="-";Formatter.noneInt=-1;
class ListAdapter{constructor(a,b){this.list=a;this.control=b||null;a.adapter=this}destroy(){const a=this.list,b=this.control;a&&(zeroObject(this),a.adapter=null,b&&(b.adapter=null))}cleared(){this.control&&this.control.notifyCleared()}itemsChanged(a){this.control&&(this.control.notifyCleared(),this.control.notifyItemsAdded(0,a-1))}itemsAdded(a,b){this.control&&this.control.notifyItemsAdded(a,b)}itemsRemoved(a,b){this.control&&this.control.notifyItemsRemoved(a,b)}currentItemChanged(a,b){this.control&&
this.control.notifyCurrentItemChanged(a,b)}}
class List{constructor(a,b){this.items=a||[];this._currentIndex=void 0===b?-1:b;this._adapter=null;this.modified=!1;this.items.length?(0>this._currentIndex?this._currentIndex=-1:this._currentIndex>=this.items.length&&(this._currentIndex=this.items.length-1),this._currentItem=0<=this._currentIndex?this.items[this._currentIndex]:null):(this._currentIndex=-1,this._currentItem=null)}destroy(){if(this.items){this.items.fill(null);var a=this._adapter;zeroObject(this);a&&a.destroy()}}get adapter(){return this._adapter}set adapter(a){this.items&&
this._adapter!==a&&(this._adapter&&this._adapter.destroy(),this._adapter=a)}get length(){return this.items?this.items.length:0}get currentIndex(){return this._currentItem?this._currentIndex:-1}set currentIndex(a){a>=this.items.length&&(a=this.items.length-1);0>a&&(a=0);const b=a<this.items.length?this.items[a]:null,c=this._currentIndex,d=this._currentItem;this._currentIndex=b?a:-1;if(c!==a||d!==b)this.modified=!0,this._currentItem=b,this._adapter&&this._adapter.currentItemChanged(d?c:-1,this._currentIndex)}get currentItem(){return this._currentItem}item(a){return this.items[a]}estimateSerializedLength(){const a=
this.items;if(!(a&&a[0]&&"estimateSerializedLength"in a[0]))return 0;let b=0;for(let c=a.length-1;0<=c;c--)b+=a[c].estimateSerializedLength();return b+128}get version(){return 0}serializeExtraProperties(a,b){return a}serializeExtraPropertiesWeb(a){return a}serialize(a){a||(a=new DataWriter(this.estimateSerializedLength()));const b=this.items,c=b&&b[0]&&"serialize"in b[0]?b.length:0;a.writeUint8(this.version).writeInt32(c).writeInt32(this._currentIndex);this.serializeExtraProperties(a,c);for(let d=
0;d<c;d++)b[d].serialize(a);return a}serializeWeb(){const a=this.items,b=a&&a[0]&&"serializeWeb"in a[0]?a.length:0,c=Array(b);for(let d=0;d<b;d++)c[d]=a[d].serializeWeb();return this.serializeExtraPropertiesWeb({currentIndex:this._currentIndex,items:c})}moveCurrentToPrevious(){this.currentIndex=this._currentItem?0>=this._currentIndex?this.items.length-1:this._currentIndex-1:this._currentIndex;return this._currentIndex}moveCurrentToNext(){this.currentIndex=this._currentItem?this._currentIndex>=this.items.length-
1?0:this._currentIndex+1:this._currentIndex;return this._currentIndex}clear(){const a=this._currentIndex,b=this._currentItem;this.items&&this.items.fill(null);this.modified=!0;this.items=[];this._currentIndex=-1;this._currentItem=null;this._adapter&&(this._adapter.cleared(),b&&this._adapter.currentItemChanged(a,-1))}changeItems(a){a&&a.length?(this.items&&this.items.fill(null),this.modified=!0,this.items=a.slice(),this._currentIndex=-1,this._currentItem=null,this._adapter&&this._adapter.itemsChanged(a.length)):
this.clear()}addItem(a,b){if(!this.items||!a)return-1;void 0===b||0>b||b>=this.items.length?(b=this.items.length,this.items.push(a)):this.items.splice(b,0,a);this.modified=!0;this._adapter&&this._adapter.itemsAdded(b,b);0<=this._currentIndex&&b<=this._currentIndex&&this._currentIndex++;return b}addItems(a,b){if(!this.items||!a||!a.length)return-1;void 0===b||0>b||b>=this.items.length?(b=this.items.length,this.items.push(...a)):this.items.splice(b,0,...a);this.modified=!0;this._adapter&&this._adapter.itemsAdded(b,
b+a.length-1);0<=this._currentIndex&&b<=this._currentIndex&&(this._currentIndex+=a.length);return b}removeItems(a,b){if(!this.items||0>a||a>=this.items.length)return 0;void 0===b||b>=this.items.length?b=this.items.length-1:b<a&&(b=a);const c=b-a+1;this.items.splice(a,c);this.modified=!0;0<=this._currentIndex&&(b<this._currentIndex?this._currentIndex-=c:a<=this._currentIndex&&this._currentItem&&(this._currentItem=null,this._adapter&&this._adapter.currentItemChanged(this._currentIndex,-1)));this._adapter&&
this._adapter.itemsRemoved(a,b);return c}}
class FileSystemAPI{static isSupported(){return"FileSystemHandle"in window&&"showDirectoryPicker"in window}static openDatabase(a,b){return new Promise(function(c,d){function e(g,h){if(f)try{f.close()}catch(k){}h?d(h):c(g)}let f=null;try{const g=indexedDB.open(FileSystemAPI.dbName);g.onupgradeneeded=function(){g.result.createObjectStore(FileSystemAPI.dbStoreName)};g.onsuccess=function(){f=g.result;try{b(f,f.transaction(FileSystemAPI.dbStoreName,a).objectStore(FileSystemAPI.dbStoreName),e)}catch(h){e(null,
h)}};g.onerror=function(){e(null,g.error)}}catch(g){e(null,g)}})}static init(){return FileSystemAPI.openDatabase("readonly",function(a,b,c){const d=b.openCursor();d.onsuccess=function(){const e=d.result;if(e){var f=e.key.toString(),g=e.value;f&&g&&(FileSystemAPI.roots.push([f,g]),FileSystemAPI.directoryHandles.set(f,g));e.continue()}else{const h=Strings.comparer;FileSystemAPI.roots.sort(function(k,m){return h(k[0],m[0])});c()}};d.onerror=function(){c(null,d.error)}})}static addNewRoot(){return __awaiter(this,
void 0,void 0,function*(){try{const a=yield window.showDirectoryPicker();if(a)return yield FileSystemAPI.addRoot(a),!0}catch(a){}return!1})}static addRoot(a){return a?FileSystemAPI.openDatabase("readwrite",function(b,c,d){c.put(a,a.name);const e=c.transaction;e.onabort=function(){d()};e.oncomplete=function(){const f=FileSystemAPI.roots,g=a.name;let h=!1;for(let k=f.length-1;0<=k;k--)if(f[k][0]===g){f[k][1]=a;h=!0;break}if(!h){const k=Strings.comparer;f.push([g,a]);f.sort(function(m,l){return k(m[0],
l[0])})}FileSystemAPI.directoryHandles.set(g,a);d()};e.onerror=function(){d(null,e.error)}}):Promise.resolve()}static removeRoot(a){return a?FileSystemAPI.openDatabase("readwrite",function(b,c,d){c.delete(a);const e=c.transaction;e.onabort=function(){d()};e.oncomplete=function(){const f=FileSystemAPI.roots;for(let g=f.length-1;0<=g;g--)if(f[g][0]===a){f.splice(g,1);break}d(!0)};e.onerror=function(){d(null,e.error)}}):Promise.resolve(!1)}static getRootHandles(){const a=FileSystemAPI.roots,b=Array(a.length);
for(let c=a.length-1;0<=c;c--)b[c]=a[c][1];return b}static checkRootPermission(a){return __awaiter(this,void 0,void 0,function*(){if(!a)return 0;var b=a.indexOf("/");0<b&&(a=a.substring(0,b));b=FileSystemAPI.directoryHandles.get(a);if(!b)return 0;try{const c={mode:"read"};switch(yield b.queryPermission(c)){case "granted":return 1;case "prompt":return"granted"===(yield b.requestPermission(c))?-1:0;default:return 0}}catch(c){return 0}})}static getDirectoryHandle(a,b){return __awaiter(this,void 0,void 0,
function*(){let c=FileSystemAPI.directoryHandles.get(a);if(c)return c;try{const d=a.lastIndexOf("/");if(0>=d||d>=a.length-1)return null;c=b||(yield FileSystemAPI.getDirectoryHandle(a.substring(0,d)));if(!c)return null;c=yield c.getDirectoryHandle(a.substring(d+1));if(!c)return null;FileSystemAPI.directoryHandles.set(a,c);return c}catch(d){return 0>(yield FileSystemAPI.checkRootPermission(a))?FileSystemAPI.getDirectoryHandle(a):null}})}static getFile(a,b){return __awaiter(this,void 0,void 0,function*(){try{if(b)return b.getFile();
const c=a.lastIndexOf("/");if(0>=c||c>=a.length-1)return null;const d=yield FileSystemAPI.getDirectoryHandle(a.substring(0,c));if(!d)return null;const e=yield d.getFileHandle(a.substring(c+1));return e?e.getFile():null}catch(c){return 0>(yield FileSystemAPI.checkRootPermission(a))?FileSystemAPI.getFile(a,b):null}})}static enumerate(a,b){var c,d;return __awaiter(this,void 0,void 0,function*(){try{const g=b||(yield FileSystemAPI.getDirectoryHandle(a));if(!g)return null;const h=[];try{for(var e=__asyncValues(g.values()),
f;f=yield e.next(),!f.done;){const k=f.value;("file"!==k.kind||FileUtils.isTypeSupported(k.name))&&h.push(k)}}catch(k){c={error:k}}finally{try{f&&!f.done&&(d=e.return)&&(yield d.call(e))}finally{if(c)throw c.error;}}return h}catch(g){return 0>(yield FileSystemAPI.checkRootPermission(a))?FileSystemAPI.enumerate(a,b):null}})}}FileSystemAPI.dbName="fplay";FileSystemAPI.dbStoreName="fplay-roots";FileSystemAPI.roots=[];FileSystemAPI.directoryHandles=new Map;
class FilePickerFileSystemAPIProvider{constructor(){this.version=0}editableRoots(){return!0}addNewRoot(){return FileSystemAPI.addNewRoot()}removeRoot(a){return FileSystemAPI.removeRoot(a.name)}getDirectoryFiles(a,b,c,d){return __awaiter(this,void 0,void 0,function*(){const e=yield FileSystemAPI.enumerate(c,d);if(e&&a===this.version){var f=Strings.comparer;e.sort(function(h,k){return h.kind===k.kind?f(h.name,k.name):"file"===h.kind?1:-1});c.endsWith("/")||(c+="/");for(let h=0;h<e.length&&a===this.version;h++){var g=
e[h];const k=c+g.name;if("file"===g.kind){if(g=yield FileSystemAPI.getFile(k,e[h]))g["data-path"]=FileUtils.localURLPrefix+k,b.push(g)}else yield this.getDirectoryFiles(a,b,k,g)}}})}getFiles(a,b){return __awaiter(this,void 0,void 0,function*(){this.cancel();const c=[],d=this.version;if(a)for(var e=0;e<a.length&&d===this.version;e++)yield this.getDirectoryFiles(d,c,a[e].path,a[e].handle);if(b)for(e=0;e<b.length&&d===this.version;e++){const f=b[e].path,g=yield FileSystemAPI.getFile(f,b[e].handle);g&&
(g["data-path"]=FileUtils.localURLPrefix+f,c.push(g))}return c})}navigate(a){return __awaiter(this,void 0,void 0,function*(){this.cancel();if(!a){var b=FileSystemAPI.getRootHandles(),c=Array(b.length);for(var d=b.length-1;0<=d;d--)c[d]={name:b[d].name,dir:1,path:b[d].name,root:!0,deletable:!0,handle:b[d]};return c}c=this.version;b=yield FileSystemAPI.enumerate(a);if(!b||!b.length||c!==this.version)return null;a.endsWith("/")||(a+="/");c=Array(b.length);for(d=b.length-1;0<=d;d--)c[d]={name:b[d].name,
dir:"file"===b[d].kind?0:1,path:a+b[d].name,handle:b[d]};const e=Strings.comparer;c.sort(function(f,g){return f.dir===g.dir?e(f.name,g.name):g.dir-f.dir});return c})}cancel(){this.version++}destroy(){this.cancel()}}
class FilePickerAndroidProvider{constructor(){this.enumerationVersion=this.version=0}static callbackPermission(a){FilePickerAndroidProvider.permissionGranted=!!a;FilePickerAndroidProvider.callbackPermissionResolve&&(FilePickerAndroidProvider.callbackPermissionResolve(FilePickerAndroidProvider.permissionGranted),FilePickerAndroidProvider.callbackPermissionResolve=null)}static callbackClickDone(){FilePickerAndroidProvider.callbackClickDoneResolve&&(FilePickerAndroidProvider.callbackClickDoneResolve(),
FilePickerAndroidProvider.callbackClickDoneResolve=null)}static checkPermission(){FilePickerAndroidProvider.callbackPermissionResolve&&(FilePickerAndroidProvider.callbackPermissionResolve(!1),FilePickerAndroidProvider.callbackPermissionResolve=null);return App.hostInterface?App.hostInterface.checkFilePermission()?(FilePickerAndroidProvider.permissionGranted=!0,Promise.resolve(!0)):new Promise(function(a){App.hostInterface?(FilePickerAndroidProvider.callbackPermissionResolve=a,App.hostInterface.requestFilePermission()):
a(!1)}):Promise.resolve(!1)}editableRoots(){return!1}addNewRoot(){return Promise.resolve(!1)}removeRoot(a){return Promise.resolve(!1)}enumerate(a){this.enumerationVersion++;FilePickerAndroidProvider.callback&&(FilePickerAndroidProvider.callback(0,null),FilePickerAndroidProvider.callback=null);return new Promise(b=>{if(!App.hostInterface)return null;FilePickerAndroidProvider.callback=(c,d)=>{c!==this.enumerationVersion?b(null):(FilePickerAndroidProvider.callback=null,b(d))};App.hostInterface.enumerateFiles(this.enumerationVersion,
a)})}getDirectoryFiles(a,b,c){return __awaiter(this,void 0,void 0,function*(){const d=yield this.enumerate(c);if(d&&a===this.version){var e=Strings.comparer;d.sort(function(f,g){const h=47===f.charCodeAt(0),k=47===g.charCodeAt(0);return h===k?e(f,g):h?1:-1});for(let f=0;f<d.length&&a===this.version;f++){const g=d[f];47===g.charCodeAt(0)?b.push(g):yield this.getDirectoryFiles(a,b,g)}}})}getFiles(a,b){return __awaiter(this,void 0,void 0,function*(){this.cancel();const c=[];var d=this.version,e=new Promise(function(g){FilePickerAndroidProvider.callbackClickDoneResolve=
g}),f=App.showOpenDialogWeb(!1,!0);yield e;if(!App.hostInterface||d!==this.version)return null;if(a)for(e=0;e<a.length&&d===this.version;e++)yield this.getDirectoryFiles(d,c,a[e].path);if(b&&d===this.version)for(e=0;e<b.length;e++)c.push(b[e].path);if(!App.hostInterface||!c.length)return null;for(e=c.length-1;0<=e;e--)c[e]=FileUtils.pathToURL(c[e]);App.hostInterface.setFileURLs(c);f=yield f;if(!f||f.length!==c.length||d!==this.version)return null;for(d=c.length-1;0<=d;d--)f[d]["data-path"]=c[d];return f})}navigate(a){return __awaiter(this,
void 0,void 0,function*(){this.cancel();var b=this.version;if(!FilePickerAndroidProvider.permissionGranted&&!(yield FilePickerAndroidProvider.checkPermission())||b!==this.version)return null;const c=yield this.enumerate(a);if(!c||!c.length||b!==this.version)return null;b=Array(c.length);if(a)for(var d=b.length-1;0<=d;d--){var e=c[d];b[d]={name:FileUtils.nameFromLinuxPath(e),dir:47===e.charCodeAt(0)?0:1,path:e}}else for(d=b.length-1;0<=d;d--){e=c[d];const g=e.indexOf(FileUtils.separator);b[d]={name:0<
g?e.substring(0,g):Formatter.none,dir:1,path:0<g?e.substring(g+1):e,root:!0}}const f=Strings.comparer;b.sort(function(g,h){return g.dir===h.dir?f(g.name,h.name):h.dir-g.dir});return b})}cancel(){this.version++;this.enumerationVersion++;FilePickerAndroidProvider.callbackClickDone()}destroy(){this.cancel();App.hostInterface&&App.hostInterface.cancelFileEnumeration(this.enumerationVersion)}}FilePickerAndroidProvider.callback=null;FilePickerAndroidProvider.callbackPermissionResolve=null;
FilePickerAndroidProvider.callbackClickDoneResolve=null;FilePickerAndroidProvider.permissionGranted=!1;
class Song{constructor(a,b,c,d,e,f,g,h,k,m,l,n){if("string"!==typeof a){n=a;a=n.url;b=n.flags;c=n.title;d=n.artist;e=n.album;f=n.track;g=n.lengthMS;h=n.year;k=n.sampleRate;m=n.channels;if(n.file){if(!a||a.startsWith(FileUtils.localURLPrefix))this.file=n.file;c||(c=n.file.name.lastIndexOf("."),c=0<c?n.file.name.substring(0,c):n.file.name)}l=n.fileName;n=n.fileSize}this.id=++Song.lastId;this.url=a;this.flags=b||0;this.isHttp=Song.isPathHttp(this.url);c||(a=decodeURI(a),b=a.lastIndexOf("/"),c=0<=b?a.substring(b+
1):a,this.isHttp||(b=c.lastIndexOf("."),0<b&&(c=c.substring(0,b))));this.title=c||Formatter.none;this.artist=d||Formatter.none;this.album=e||Formatter.none;this.track=f&&0<f?f:Formatter.noneInt;this.lengthMS=g&&0<g?g:Formatter.noneInt;this.year=h&&0<h?h:Formatter.noneInt;this.sampleRate=k&&0<k?k:Formatter.noneInt;this.channels=m&&0<m?m:Formatter.noneInt;this.length=Formatter.formatTimeMS(this.lengthMS);this.fileName=l||null;this.fileSize=n||0}static isPathHttp(a){return a.startsWith("http:")||a.startsWith("https:")||
a.startsWith("icy:")}static deserialize(a){a.readUint8();return new Song(a.readString(),a.readInt32(),a.readString(),a.readString(),a.readString(),a.readInt16(),a.readInt32(),a.readInt16(),a.readInt32(),a.readInt8(),a.readString(),a.readInt32())}get isSeekable(){return this.flags&MetadataFlags.Seekable?!0:!1}estimateSerializedLength(){return(this.url.length+this.title.length+this.artist.length+this.album.length+(this.fileName?this.fileName.length:0)<<1)+17}serialize(a){return a.writeUint8(0).writeString(this.url).writeInt32(this.flags).writeString(this.title).writeString(this.artist).writeString(this.album).writeInt16(this.track).writeInt32(this.lengthMS).writeInt16(this.year).writeInt32(this.sampleRate).writeInt8(this.channels).writeString(this.fileName||
null).writeInt32(this.fileSize||0)}serializeWeb(){return{url:this.url,flags:this.flags,title:this.title,artist:this.artist,album:this.album,track:this.track,lengthMS:this.lengthMS,year:this.year,sampleRate:this.sampleRate,channels:this.channels,fileName:this.fileName,fileSize:this.fileSize}}}Song.lastId=0;
class PlaylistAdapter extends ListAdapter{constructor(a){super(a)}get itemHeight(){return AppUI.playlistItemSizePX}createEmptyElement(a){const b=document.createElement("div");b.className=a+" playlist-item";a=document.createElement("span");a.className="playlist-item-row1";a.appendChild(Icon.create("icon-title","playlist-item-icon pink margin",null,Strings.TitleLabel));a.appendChild(document.createTextNode(Formatter.none));b.appendChild(a);a=document.createElement("span");a.className="playlist-item-s-row1";
a.appendChild(Strings.createSrOnlyText(Strings.DurationLabel));a.appendChild(document.createTextNode(Formatter.none));b.appendChild(a);a=document.createElement("span");a.className="playlist-item-row2";a.appendChild(Icon.create("icon-artist","playlist-item-icon orange margin",null,Strings.ArtistLabel));a.appendChild(document.createTextNode(Formatter.none));b.appendChild(a);a=document.createElement("span");a.className="playlist-item-row3";a.appendChild(Icon.create("icon-album","playlist-item-icon green margin",
null,Strings.AlbumLabel));a.appendChild(document.createTextNode(Formatter.none));b.appendChild(a);a=document.createElement("span");a.className="playlist-item-s-row3";a.setAttribute("aria-hidden","true");a.appendChild(document.createTextNode(Formatter.none));b.appendChild(a);return b}prepareElement(a,b,c,d){d=d.childNodes;d[0].childNodes[1].nodeValue=a.title;d[1].childNodes[1].nodeValue=a.length;d[2].childNodes[1].nodeValue=a.artist;d[3].childNodes[1].nodeValue=a.album;d[4].firstChild.nodeValue=a.url||
a.file?`${b+1} / ${c}`:`(${Strings.Missing}) ${b+1} / ${c}`}prepareElementIndexOrLengthChanged(a,b,c,d){d.childNodes[8].firstChild.nodeValue=a.url||a.file?`${b+1} / ${c}`:`(${Strings.Missing}) ${b+1} / ${c}`}}
class Playlist extends List{constructor(a,b,c,d){super(a,b);this._currentIndexResumeTimeS=c||0;this.missingSongs=d||null;this.onsonglengthchange=null}static deserialize(a){a.readUint8();const b=a.readInt32(),c=a.readInt32(),d=a.readInt32(),e=Array(b);for(let f=0;f<b;f++)e[f]=Song.deserialize(a);return new Playlist(e,c,d)}static deserializeWeb(a){try{const b=JSON.parse(a);if(!b||!b.items||!Array.isArray(b.items))return null;const c=b.items,d=c.length,e=Array(d),f=new Map;for(a=0;a<d;a++){const g=new Song(c[a]);
e[a]=g;!g.url&&g.fileName&&f.set(g.fileName+g.fileSize,g)}return new Playlist(e,b.currentIndex||0,b.currentIndexResumeTimeS||0,f.size?f:null)}catch(b){return null}}get currentIndexResumeTimeS(){return this._currentIndexResumeTimeS}set currentIndexResumeTimeS(a){if(!this.currentItem||!a||0>a)a=0;this._currentIndexResumeTimeS!==a&&(this.modified=!0,this._currentIndexResumeTimeS=a)}serializeExtraProperties(a,b){a.writeInt32(b?this._currentIndexResumeTimeS:0);return a}serializeExtraPropertiesWeb(a){a.currentIndexResumeTimeS=
this._currentIndexResumeTimeS;return a}findIndexById(a){const b=this.items;for(let c=b.length-1;0<=c;c--)if(b[c].id===a)return c;return-1}updateSongLength(a,b){if(0>=b||isNaN(b)||!isFinite(b)){if(0>a.lengthMS)return!1;b=-1}else if(b=1E3*b|0,0<=a.lengthMS&&(a.lengthMS|0)===b)return!1;this.modified=!0;a.lengthMS=b;a.length=Formatter.formatTimeMS(b);if(this.onsonglengthchange)this.onsonglengthchange(a);return!0}clear(){this.missingSongs&&(this.missingSongs.clear(),this.missingSongs=null);super.clear()}changeItems(a){this.missingSongs&&
(this.missingSongs.clear(),this.missingSongs=null);super.changeItems(a)}removeItems(a,b){if(this.missingSongs&&this.items&&0<=a&&a<this.items.length){const c=this.missingSongs,d=this.items;void 0===b||b>=d.length?b=d.length-1:b<a&&(b=a);for(let e=a;e<=b;e++){const f=d[e];if(!f.url&&!f.file&&f.fileName&&(c.delete(f.fileName+f.fileSize),!c.size)){this.missingSongs=null;break}}}return super.removeItems(a,b)}addSong(a,b){const c=Object.create(null,{addItem:{get:()=>super.addItem}});return __awaiter(this,
void 0,void 0,function*(){let d=0;if("string"!==typeof a){var e=a.fileURL;d=a.fileSize}else e=a;if(!FileUtils.isTypeSupported(e))return!1;e=yield App.extractMetadata(e,d);if(!e)return!1;c.addItem.call(this,new Song(e),b);return!0})}addSongWeb(a,b,c,d){const e=Object.create(null,{addItem:{get:()=>super.addItem}});return __awaiter(this,void 0,void 0,function*(){if(!FileUtils.isTypeSupported(a.name))return!1;if(this.missingSongs){var f=a.name+a.size;const g=this.missingSongs.get(f);if(g)return g.file=
a,this.missingSongs.delete(f),this.missingSongs.size||(this.missingSongs=null),!0}f=yield MetadataExtractor.extract(a,b,c);if(!f)return!1;e.addItem.call(this,new Song(f),d);return!0})}}
class PointerHandler{constructor(a,b=null,c=null,d=null,e=!0,f=null){this.documentTarget=document.documentElement||document.body;this.element=a;this.downCallback=b;this.moveCallback=c;this.upCallback=d;this.boundExtraTouchStart=null;"onpointerdown"in a?(this.documentDownEvent="pointerdown",this.documentMoveEvent="pointermove",this.documentUpEvent="pointerup",this.documentCancelEvent="pointercancel",this.boundDocumentDown=this.pointerDown.bind(this),this.boundDocumentUp=this.pointerUp.bind(this),this.boundDocumentMove=
this.pointerMove.bind(this),"ontouchstart"in a&&(this.boundExtraTouchStart=this.extraTouchStart.bind(this))):"ontouchstart"in a?(this.documentDownEvent="touchstart",this.documentMoveEvent="touchmove",this.documentUpEvent="touchend",this.documentCancelEvent="touchcancel",this.boundDocumentDown=this.touchStart.bind(this),this.boundDocumentUp=this.touchEnd.bind(this),this.boundDocumentMove=this.touchMove.bind(this)):(this.documentDownEvent="mousedown",this.documentMoveEvent="mousemove",this.documentUpEvent=
"mouseup",this.documentCancelEvent=null,this.boundDocumentDown=this.mouseDown.bind(this),this.boundDocumentUp=this.mouseUp.bind(this),this.boundDocumentMove=this.mouseMove.bind(this));this.lazy=e;this.outsidePointerHandler=f;this.boundExtraTouchStart&&a.addEventListener("touchstart",this.boundExtraTouchStart);a.addEventListener(this.documentDownEvent,this.boundDocumentDown);e||this.addSecondaryHandlers();this._captured=!1;this.pointerId=-1}destroy(){this.element&&(this.boundExtraTouchStart&&this.element.removeEventListener("touchstart",
this.boundExtraTouchStart),this.boundDocumentDown&&this.element.removeEventListener(this.documentDownEvent,this.boundDocumentDown));this.removeSecondaryHandlers();this.mouseUp({});zeroObject(this)}get captured(){return this._captured}addSecondaryHandlers(){this.documentTarget&&(this.documentTarget.addEventListener(this.documentMoveEvent,this.boundDocumentMove,{capture:!0,passive:!1}),this.documentTarget.addEventListener(this.documentUpEvent,this.boundDocumentUp,!0),this.documentCancelEvent&&this.documentTarget.addEventListener(this.documentCancelEvent,
this.boundDocumentUp,!0))}removeSecondaryHandlers(){this.documentTarget&&(this.boundDocumentUp&&(this.documentTarget.removeEventListener(this.documentUpEvent,this.boundDocumentUp,!0),this.documentCancelEvent&&this.documentTarget.removeEventListener(this.documentCancelEvent,this.boundDocumentUp,!0)),this.boundDocumentMove&&this.documentTarget.removeEventListener(this.documentMoveEvent,this.boundDocumentMove,!0))}extraTouchStart(a){if(a.target===this.element||this.outsidePointerHandler&&this.outsidePointerHandler(a))return cancelEvent(a)}pointerDown(a){if(0<=
this.pointerId&&"mouse"!==a.pointerType)return cancelEvent(a);const b=this.mouseDown(a);this._captured&&(this.pointerId=a.pointerId);return b}pointerMove(a){if(this._captured&&a.pointerId===this.pointerId)return this.mouseMove(a)}pointerUp(a){if(this._captured&&a.pointerId===this.pointerId)return this.pointerId=-1,this.mouseUp(a)}touchStart(a){if(!(1<a.touches.length))return 0<=this.pointerId&&this.touchEnd(a),this.pointerId=1,a.clientX=a.touches[0].clientX,a.clientY=a.touches[0].clientY,a=this.mouseDown(a),
void 0===a&&(this.pointerId=-1),a}touchMove(a){if(this._captured&&!(1<a.touches.length))return a.clientX=a.touches[0].clientX,a.clientY=a.touches[0].clientY,this.mouseMove(a)}touchEnd(a){if(this._captured&&!(0>this.pointerId))return this.pointerId=-1,this.mouseUp(a)}mouseDown(a){this.mouseUp(a);if(!a.button&&(!a.target||a.target===this.element||this.outsidePointerHandler&&this.outsidePointerHandler(a))){if(this.downCallback&&!this.downCallback(a))return cancelEvent(a);this._captured=!0;this.lazy&&
this.addSecondaryHandlers();return cancelEvent(a)}}mouseMove(a){if(this._captured)return this.moveCallback&&this.moveCallback(a),cancelEvent(a)}mouseUp(a){if(this._captured)return this._captured=!1,this.lazy&&this.removeSecondaryHandlers(),this.upCallback&&this.upCallback(a),cancelEvent(a)}}
class GraphicalFilterEditorStrings{static toFixed(a,b){return a.toFixed(b)}static init(a){a&&0===a.toLowerCase().indexOf("pt")&&(GraphicalFilterEditorStrings.Minus0="-0,00",GraphicalFilterEditorStrings.Curve="Curva: ",GraphicalFilterEditorStrings.Frequency="Frequ\u00eancia: ",GraphicalFilterEditorStrings.SameCurve="Mesma curva para ambos canais",GraphicalFilterEditorStrings.UseLeftCurve="Usar curva da esquerda",GraphicalFilterEditorStrings.UseRightCurve="Usar curva da direita",GraphicalFilterEditorStrings.OneForEach=
"Uma curva por canal",GraphicalFilterEditorStrings.ShowLeftCurve="Exibir curva da esquerda",GraphicalFilterEditorStrings.ShowRightCurve="Exibir curva da direita",GraphicalFilterEditorStrings.ResetCurve="Zerar curva",GraphicalFilterEditorStrings.EditMode="Modo de edi\u00e7\u00e3o",GraphicalFilterEditorStrings.Regular="Normal",GraphicalFilterEditorStrings.Zones="Zonas",GraphicalFilterEditorStrings.SmoothNarrow="Suave (estreito)",GraphicalFilterEditorStrings.SmoothWide="Suave (largo)",GraphicalFilterEditorStrings.PeakingEq=
'Filtro "Peaking" de 10 Bandas',GraphicalFilterEditorStrings.ShelfEq='Filtro "Low Shelf" de 7 Bandas',GraphicalFilterEditorStrings.NormalizeCurves="Normalizar curvas",GraphicalFilterEditorStrings.ShowZones="Exibir zonas",GraphicalFilterEditorStrings.ShowActualResponse="Exibir resposta real",GraphicalFilterEditorStrings.toFixed=function(b,c){return b.toFixed(c).replace(".",",")})}}GraphicalFilterEditorStrings.Minus0="-0.00";GraphicalFilterEditorStrings.Cursor="Cursor: ";
GraphicalFilterEditorStrings.Curve="Curve: ";GraphicalFilterEditorStrings.Frequency="Frequency: ";GraphicalFilterEditorStrings.SameCurve="Same curve for both channels";GraphicalFilterEditorStrings.UseLeftCurve="Use left curve";GraphicalFilterEditorStrings.UseRightCurve="Use right curve";GraphicalFilterEditorStrings.OneForEach="One curve for each channel";GraphicalFilterEditorStrings.ShowLeftCurve="Show left curve";GraphicalFilterEditorStrings.ShowRightCurve="Show right curve";
GraphicalFilterEditorStrings.ResetCurve="Reset curve";GraphicalFilterEditorStrings.EditMode="Edit mode";GraphicalFilterEditorStrings.Regular="Regular";GraphicalFilterEditorStrings.Zones="Zones";GraphicalFilterEditorStrings.SmoothNarrow="Smooth (narrow)";GraphicalFilterEditorStrings.SmoothWide="Smooth (wide)";GraphicalFilterEditorStrings.PeakingEq="10-band Peaking Filter";GraphicalFilterEditorStrings.ShelfEq="7-band Low Shelf Filter";GraphicalFilterEditorStrings.NormalizeCurves="Normalize curves";
GraphicalFilterEditorStrings.ShowZones="Show zones";GraphicalFilterEditorStrings.ShowActualResponse="Show actual response";GraphicalFilterEditorStrings.MinusInfinity="-Inf.";var GraphicalFilterEditorIIRType;(function(a){a[a.None=0]="None";a[a.Peaking=1]="Peaking";a[a.Shelf=2]="Shelf"})(GraphicalFilterEditorIIRType||(GraphicalFilterEditorIIRType={}));
class Filter{constructor(a){this.source=null;this.filterChangedCallback=a}connectSourceAndDestination(a,b){a=this.connectSourceToInput(a);return this.connectOutputToDestination(b)&&a}disconnectSourceAndDestination(){const a=this.disconnectSourceFromInput();return this.disconnectOutputFromDestination()&&a}disconnectSourceFromInput(){return this.source?(this.source.disconnect(),this.source=null,!0):!1}connectSourceToInput(a){this.disconnectSourceFromInput();if(this.source=a){a.disconnect();const b=
this.inputNode;if(b)return a.connect(b,0,0),!0}return!1}connectOutputToDestination(a){const b=this.outputNode;return b?(b.disconnect(),a&&b.connect(a,0,0),!0):!1}disconnectOutputFromDestination(){const a=this.outputNode;return a?(a.disconnect(),!0):!1}destroy(){this.disconnectSourceFromInput();this.disconnectOutputFromDestination()}}
class GraphicalFilterEditor extends Filter{constructor(a,b,c,d){super(c);if(8>a||a&a-1)throw"Sorry, class available only for fft sizes that are a power of 2 >= 8! :(";this.filterLength=a;this._sampleRate=b.sampleRate?b.sampleRate:44100;this._isNormalized=!1;this._iirType=(this.iirSupported="createBiquadFilter"in b&&"createIIRFilter"in b)&&d||GraphicalFilterEditorIIRType.None;this.binCount=(a>>>1)+1;this.filterKernel=b.createBuffer(2,a,this._sampleRate);this.audioContext=b;this.editorPtr=cLib._graphicalFilterEditorAlloc(this.filterLength,
this._sampleRate);a=cLib.HEAP8.buffer;this.filterKernelBuffer=new Float32Array(a,cLib._graphicalFilterEditorGetFilterKernelBuffer(this.editorPtr),GraphicalFilterEditor.maximumFilterLength);this.channelCurves=[new Int32Array(a,cLib._graphicalFilterEditorGetChannelCurve(this.editorPtr,0),GraphicalFilterEditor.visibleBinCount),new Int32Array(a,cLib._graphicalFilterEditorGetChannelCurve(this.editorPtr,1),GraphicalFilterEditor.visibleBinCount)];this.actualChannelCurve=new Int32Array(a,cLib._graphicalFilterEditorGetActualChannelCurve(this.editorPtr),
GraphicalFilterEditor.visibleBinCount);this.visibleFrequencies=new Float64Array(a,cLib._graphicalFilterEditorGetVisibleFrequencies(this.editorPtr),GraphicalFilterEditor.visibleBinCount);this.equivalentZones=new Int32Array(a,cLib._graphicalFilterEditorGetEquivalentZones(this.editorPtr),GraphicalFilterEditor.equivalentZoneCount);this.equivalentZonesFrequencyCount=new Int32Array(a,cLib._graphicalFilterEditorGetEquivalentZonesFrequencyCount(this.editorPtr),GraphicalFilterEditor.equivalentZoneCount+1);
this.curveSnapshot=this.biquadFilterActualPhase=this.biquadFilterActualMag=this.biquadFilterActualAccum=this.biquadFilterActualFrequencies=this.biquadFilterActualGains=this.biquadFilterGains=this.biquadFilterOutput=this.biquadFilterInput=this.biquadFilters=this._convolver=null;this.updateFilter(0,!0,!0);this.updateActualChannelCurve(0);this.updateBuffer();this.filterChangedCallback=c}static encodeCurve(a){const b=GraphicalFilterEditor.minimumChannelValueY,c=GraphicalFilterEditor.validYRangeHeight,
d=a.length,e=Array(d<<1);let f=0;for(let g=0;g<d;g++){let h=a[g];h=h>b?0:c-h;254>=h?e[f++]=h:(e[f++]=255,e[f++]=h-254)}e.splice(f);return btoa(String.fromCharCode(...e))}static decodeCurve(a){if(!a||a.length<4*GraphicalFilterEditor.visibleBinCount/3)return null;try{a=atob(a)}catch(f){return null}if(a.length<GraphicalFilterEditor.visibleBinCount)return null;const b=GraphicalFilterEditor.validYRangeHeight,c=a.length,d=Array(GraphicalFilterEditor.visibleBinCount);let e=0;for(let f=0;f<c;f++){const g=
a.charCodeAt(f);254>=g?d[e++]=b-g:f<c-1&&(f++,d[e++]=b-(a.charCodeAt(f)+254))}return d}get sampleRate(){return this._sampleRate}get isNormalized(){return this._isNormalized}get iirType(){return this._iirType}get convolver(){return this._convolver}get inputNode(){return this.biquadFilterInput||this._convolver}get outputNode(){return this.biquadFilterOutput||this._convolver}destroy(){this.editorPtr&&(super.destroy(),cLib._graphicalFilterEditorFree(this.editorPtr),zeroObject(this))}clampX(a){return 0>=
a?0:a>=GraphicalFilterEditor.visibleBinCount?GraphicalFilterEditor.visibleBinCount-1:a}clampY(a){return a<=GraphicalFilterEditor.maximumChannelValueY?GraphicalFilterEditor.maximumChannelValueY:a>GraphicalFilterEditor.minimumChannelValueY?GraphicalFilterEditor.validYRangeHeight+1:a}dBToMagnitude(a){return Math.pow(10,a/20)}yToDB(a){return a<=GraphicalFilterEditor.maximumChannelValueY?40:a>GraphicalFilterEditor.minimumChannelValueY?-Infinity:lerp(GraphicalFilterEditor.maximumChannelValueY,40,GraphicalFilterEditor.minimumChannelValueY,
-40,a)}yToMagnitude(a){return a<=GraphicalFilterEditor.maximumChannelValueY?100:a>GraphicalFilterEditor.minimumChannelValueY?0:Math.exp(lerp(GraphicalFilterEditor.maximumChannelValueY,2,GraphicalFilterEditor.minimumChannelValueY,-2,a)*Math.LN10)}magnitudeToY(a){return 100<=a?GraphicalFilterEditor.maximumChannelValueY:.009>a?GraphicalFilterEditor.validYRangeHeight+1:Math.round(GraphicalFilterEditor.zeroChannelValueY-GraphicalFilterEditor.zeroChannelValueY*Math.log(a)/Math.LN10*.5-.4)}visibleBinToZoneIndex(a){if(a>=
GraphicalFilterEditor.visibleBinCount-1)return this.equivalentZones.length-1;if(0<a){const b=this.equivalentZonesFrequencyCount;for(let c=b.length-1;0<=c;c--)if(a>=b[c])return c}return 0}visibleBinToFrequency(a,b){const c=this.equivalentZones,d=this.visibleFrequencies;var e=GraphicalFilterEditor.visibleBinCount;if(a>=e-1)return b?[d[e-1],c[c.length-1]]:d[e-1];if(0<a)if(b){e=this.equivalentZonesFrequencyCount;for(let f=e.length-1;0<=f;f--)if(a>=e[f])return[d[a],c[f]]}else return d[a];return b?[d[0],
c[0]]:d[0]}getZoneY(a,b){0>b?b=0:b>=this.equivalentZones.length&&(b=this.equivalentZones.length-1);return this.channelCurves[a][this.equivalentZonesFrequencyCount[b]]}changeZoneY(a,b,c){b=this.visibleBinToZoneIndex(b);const d=this.equivalentZonesFrequencyCount[b+1];c=this.clampY(c);a=this.channelCurves[a];for(b=this.equivalentZonesFrequencyCount[b];b<d;b++)a[b]=c}changeZoneYByIndex(a,b,c){0>b?b=0:b>=this.equivalentZones.length&&(b=this.equivalentZones.length-1);const d=this.equivalentZonesFrequencyCount[b+
1];c=this.clampY(c);a=this.channelCurves[a];for(b=this.equivalentZonesFrequencyCount[b];b<d;b++)a[b]=c}changeShelfZoneYByRegularIndex(a,b,c){switch(b){case 0:case 1:this.changeZoneYByIndex(a,0,c);this.changeZoneYByIndex(a,1,c);break;case 4:case 5:this.changeZoneYByIndex(a,4,c);this.changeZoneYByIndex(a,5,c);break;case 6:case 7:this.changeZoneYByIndex(a,6,c);this.changeZoneYByIndex(a,7,c);break;default:this.changeZoneYByIndex(a,b,c)}}getShelfZoneY(a,b){0>b?b=0:b>=GraphicalFilterEditor.shelfEquivalentZoneCount&&
(b=GraphicalFilterEditor.shelfEquivalentZoneCount-1);return this.channelCurves[a][this.equivalentZonesFrequencyCount[GraphicalFilterEditor.shelfEquivalentZones[b]]]}changeShelfZoneY(a,b,c){this.changeShelfZoneYByRegularIndex(a,this.visibleBinToZoneIndex(b),c)}changeShelfZoneYByIndex(a,b,c){0>b?b=0:b>=GraphicalFilterEditor.shelfEquivalentZoneCount&&(b=GraphicalFilterEditor.shelfEquivalentZoneCount-1);this.changeShelfZoneYByRegularIndex(a,GraphicalFilterEditor.shelfEquivalentZones[b],c)}startSmoothEdition(a){this.curveSnapshot||
(this.curveSnapshot=new Int32Array(GraphicalFilterEditor.visibleBinCount));this.curveSnapshot.set(this.channelCurves[a])}changeSmoothY(a,b,c,d){var e=this.curveSnapshot;if(e){var f=GraphicalFilterEditor.visibleBinCount;c=this.clampY(c);a=this.channelCurves[a];a.set(e);d>>=1;for(let g=b-d,h=Math.min(b,f),k=Math.max(0,g);k<h;k++)e=512*smoothStep(g,b,k)|0,a[k]=this.clampY(Math.round((c*e+a[k]*(512-e))/512));for(let g=b+d,h=Math.min(g,f),k=Math.max(0,b);k<h;k++)d=512*smoothStep(g,b,k)|0,a[k]=this.clampY(Math.round((c*
d+a[k]*(512-d))/512))}}updateBuffer(){const a=this._convolver;this._convolver||(this._convolver=this.audioContext.createConvolver(),this._convolver.normalize=!1);try{this._convolver.buffer=this.filterKernel}catch(b){this._convolver=this.audioContext.createConvolver(),this._convolver.normalize=!1,this._convolver.buffer=this.filterKernel}a!==this._convolver&&this.filterChangedCallback&&this.filterChangedCallback()}copyToChannel(a,b){if(this.filterKernel.copyToChannel)this.filterKernel.copyToChannel(a,
b);else{b=this.filterKernel.getChannelData(b);for(let c=this.filterLength-1;0<=c;c--)b[c]=a[c]}}copyFromChannel(a,b){if(this.filterKernel.copyToChannel)this.filterKernel.copyFromChannel(a,b);else{b=this.filterKernel.getChannelData(b);for(let c=this.filterLength-1;0<=c;c--)a[c]=b[c]}}copyFilter(a,b){this.copyToChannel(this.filterKernel.getChannelData(a),b);this.updateBuffer()}updateFilter(a,b,c){switch(this._iirType){case GraphicalFilterEditorIIRType.Peaking:this.updatePeakingEq(a);return;case GraphicalFilterEditorIIRType.Shelf:this.updateShelfEq(a);
return}cLib._graphicalFilterEditorUpdateFilter(this.editorPtr,a,this._isNormalized);this.copyToChannel(this.filterKernelBuffer,a);b?this.copyFilter(a,1-a):c?this.updateFilter(1-a,!1,!1):this.updateBuffer()}updateActualChannelCurve(a){this._iirType?this.updateActualChannelCurveIIR():(this.copyFromChannel(this.filterKernelBuffer,a),cLib._graphicalFilterEditorUpdateActualChannelCurve(this.editorPtr,a))}updatePeakingEq(a){var b=this.audioContext;const c=this.channelCurves[a],d=this.equivalentZones,e=
this.equivalentZonesFrequencyCount;a=GraphicalFilterEditor.equivalentZoneCount;let f=this.biquadFilters,g=this.biquadFilterGains,h=!1;if(!f||!g){h=!0;f=Array(a);g=Array(a);const l=Array(a);var k=.5*Math.log(2),m=this.audioContext.sampleRate;const n=2*Math.PI;for(let q=a-1;0<=q;q--){const p=n*d[q]/m;l[q]=1/(2*Math.sinh(p/Math.sin(p)*k))}for(k=a-1;0<=k;k--)m=b.createBiquadFilter(),m.type="peaking",m.frequency.value=d[k],m.Q.value=l[k],f[k]=m,k<a-1&&f[k+1].connect(f[k]);this.biquadFilters=f;this.biquadFilterInput=
f[a-1];this.biquadFilterOutput=f[0]}for(b=a-1;0<=b;b--)g[b]=Math.max(-40,this.yToDB(c[e[b]]));for(b=a-1;0<=b;b--)f[b].gain.value=g[b]+(b<a-1?-.15*g[b+1]:0)+(0<b?-.15*g[b-1]:0);h&&this.filterChangedCallback&&this.filterChangedCallback()}updateShelfEq(a){var b=this.audioContext,c=this.channelCurves[a],d=this.equivalentZonesFrequencyCount,e=GraphicalFilterEditor.shelfEquivalentZoneCount,f=GraphicalFilterEditor.shelfEquivalentZones;a=this.biquadFilters;let g=this.biquadFilterGains,h=this.biquadFilterActualGains;
a&&g&&h||(a=Array(e),g=Array(e),h=Array(e),this.biquadFilters=a,this.biquadFilterGains=g,this.biquadFilterActualGains=h,a[e-1]=b.createGain(),this.biquadFilterInput=a[e-1]);for(b=e-1;0<=b;b--)g[b]=Math.max(-40,this.yToDB(c[d[f[b]]]));--e;b=0;c=!1;d=a[e];d.gain.value=this.dBToMagnitude(g[e]);for(--e;0<=e;e--)f=b+(g[e]-g[e+1]),-22>f?(b=f+22,f=-22):22<f?(b=f-22,f=22):b=0,h[e]!==f?(c=!0,h[e]=f,a[e]&&a[e].disconnect(),d.disconnect(),f?(a[e]=this.createIIRFilter(e,f),d.connect(a[e]),d=a[e]):a[e]=null):
a[e]&&(c&&(c=!1,d.connect(a[e])),d=a[e]);this.biquadFilterOutput!==d&&(this.biquadFilterOutput=d,this.filterChangedCallback&&this.filterChangedCallback())}createIIRFilter(a,b){const c=this.audioContext;var d=c.sampleRate;switch(a){case 0:a=92.75;break;case 1:a=187.5;break;case 2:a=375;break;case 3:a=1500;break;case 4:a=6E3;break;default:a=12E3}b=Math.pow(10,b/40);a=6.283185307179586*a/d;d=Math.cos(a);a=1*Math.sqrt(b)*Math.sin(a)*Math.sqrt(-.5*(b+1/b)+2);return c.createIIRFilter([b*(b+1-(b-1)*d+a),
2*b*(b-1-(b+1)*d),b*(b+1-(b-1)*d-a)],[b+1+(b-1)*d+a,-2*(b-1+(b+1)*d),b+1+(b-1)*d-a])}updateActualChannelCurveIIR(){var a=this.biquadFilters;if(a){var b=this.biquadFilterActualFrequencies,c=this.biquadFilterActualAccum,d=this.biquadFilterActualMag,e=this.biquadFilterActualPhase;if(!(b&&c&&d&&e)){e=this.visibleFrequencies;b=new Float32Array(e.length);for(c=e.length-1;0<=c;c--)b[c]=e[c];c=new Float32Array(e.length);d=new Float32Array(e.length);e=new Float32Array(e.length);this.biquadFilterActualFrequencies=
b;this.biquadFilterActualAccum=c;this.biquadFilterActualMag=d;this.biquadFilterActualPhase=e}var f=b.length;if(this._iirType===GraphicalFilterEditorIIRType.Shelf)c.fill(a[a.length-1].gain.value);else{a[a.length-1].getFrequencyResponse(b,c,e);for(var g=f-1,h=1;0<=g&&isNaN(h=c[g]);)g--;for(g++;g<f;)c[g++]=h}for(g=a.length-2;0<=g;g--)if(a[g]){a[g].getFrequencyResponse(b,d,e);for(let k=0,m=0;k<f;k++)h=d[k],isNaN(h)||(m=h),c[k]*=m}a=this.actualChannelCurve;b=this.magnitudeToY;for(d=a.length-1;0<=d;d--)a[d]=
b(c[d])}}changeFilterLength(a,b,c){return this.filterLength!==a?(this.filterLength=a,this.binCount=(a>>>1)+1,this.filterKernel=this.audioContext.createBuffer(2,a,this._sampleRate),cLib._graphicalFilterEditorChangeFilterLength(this.editorPtr,a),this.updateFilter(b,c,!0),!0):!1}changeSampleRate(a,b,c){return this._sampleRate!==a?(this._sampleRate=a,this.filterKernel=this.audioContext.createBuffer(2,this.filterLength,a),this.updateFilter(b,c,!0),!0):!1}changeIsNormalized(a,b,c){return!this._isNormalized!==
!a?(this._isNormalized=!!a,this.updateFilter(b,c,!0),!0):!1}changeIIRType(a,b,c){if(this._iirType!==a&&this.iirSupported){this._iirType=a;this.disconnectOutputFromDestination();this._convolver=null;if(a=this.biquadFilters){for(let d=a.length-1;0<=d;d--)a[d]&&a[d].disconnect();a.fill(null);this.biquadFilters=null}this.biquadFilterActualPhase=this.biquadFilterActualMag=this.biquadFilterActualAccum=this.biquadFilterActualFrequencies=this.biquadFilterGains=this.biquadFilterOutput=this.biquadFilterInput=
null;this.updateFilter(b,c,!0);return!0}return!1}changeAudioContext(a,b,c){if(this.audioContext!==a){this.disconnectOutputFromDestination();this._convolver=null;const d=this.biquadFilters;if(d){for(let e=d.length-1;0<=e;e--)d[e]&&d[e].disconnect();d.fill(null);this.biquadFilters=null}this.biquadFilterActualPhase=this.biquadFilterActualMag=this.biquadFilterActualAccum=this.biquadFilterActualFrequencies=this.biquadFilterGains=this.biquadFilterOutput=this.biquadFilterInput=null;this.audioContext=a;this._sampleRate=
a.sampleRate?a.sampleRate:44100;this.filterKernel=a.createBuffer(2,this.filterLength,this._sampleRate);this.updateFilter(b,c,!0);this.updateBuffer();return!0}return!1}}GraphicalFilterEditor.visibleBinCount=500;GraphicalFilterEditor.validYRangeHeight=321;GraphicalFilterEditor.zeroChannelValueY=GraphicalFilterEditor.validYRangeHeight>>>1;GraphicalFilterEditor.maximumChannelValue=GraphicalFilterEditor.zeroChannelValueY;GraphicalFilterEditor.minimumChannelValue=-GraphicalFilterEditor.zeroChannelValueY;
GraphicalFilterEditor.minusInfiniteChannelValue=GraphicalFilterEditor.minimumChannelValue-1;GraphicalFilterEditor.maximumChannelValueY=0;GraphicalFilterEditor.minimumChannelValueY=GraphicalFilterEditor.validYRangeHeight-1;GraphicalFilterEditor.maximumFilterLength=8192;GraphicalFilterEditor.equivalentZoneCount=10;GraphicalFilterEditor.shelfEquivalentZoneCount=7;GraphicalFilterEditor.shelfEquivalentZones=[0,2,3,4,6,8,9];
class GraphicalFilterEditorRenderer{constructor(a,b,c){this.element=a;this.leftMargin=b;this.editor=c}destroy(){zeroObject(this)}}
class GraphicalFilterEditorCanvasRenderer extends GraphicalFilterEditorRenderer{constructor(a){super(document.createElement("canvas"),Math.abs(GraphicalFilterEditorControl.controlWidth-GraphicalFilterEditor.visibleBinCount)>>1,a);this.element.className="GECV";this.pixelRatio=1;this.rangeImage=this.ctx=null;this.scaleChanged()}scaleChanged(){var a=this.element,b=this.editor;if(a&&b){var c=GraphicalFilterEditorControl.controlWidth,d=GraphicalFilterEditorControl.controlHeight,e=1<devicePixelRatio?devicePixelRatio:
1,f=b.scale,g=f*e;a.width=c*g|0;a.height=d*g|0;b.element.style.width=(c*f|0)+"px";a.style.width=(c*f|0)+"px";a.style.height=(d*f|0)+"px";b=this.element.getContext("2d",{alpha:!1});if(!b)throw Error("Null canvas context");a=b.createLinearGradient(0,0,1,a.height);a.addColorStop(0,"#ff0000");a.addColorStop(.1875,"#ffff00");a.addColorStop(.39453125,"#00ff00");a.addColorStop(.60546875,"#00ffff");a.addColorStop(.796875,"#0000ff");a.addColorStop(1,"#ff00ff");this.pixelRatio=e;this.ctx=b;this.rangeImage=
a}}drawCurve(a,b,c){const d=this.ctx;if(d){var e=1<devicePixelRatio?devicePixelRatio:1;e!==this.pixelRatio&&(this.scaleChanged(),e=this.pixelRatio);var f=this.editor,g=f.filter;e*=f.scale;var h=this.element;f=this.leftMargin;var k=h.width,m=h.height,l=Math.round(8*e),n=Math.round(4*e),q=(k/l|0)+1,p=GraphicalFilterEditor.maximumChannelValueY*e|0,r=1>e?e:e|0;h=.5*r;d.fillStyle="#303030";d.fillRect(0,0,k,m);d.lineWidth=r;d.strokeStyle="#5a5a5a";d.beginPath();r=k+(n>>1);var t=(GraphicalFilterEditor.zeroChannelValueY*
e|0)+h;d.moveTo(r,t);for(let u=q-1;0<=u;u--)d.lineTo(r-n,t),r-=l,d.moveTo(r,t);d.stroke();d.beginPath();r=k+(n>>1);t=(GraphicalFilterEditor.validYRangeHeight*e|0)+h;d.moveTo(r,t);for(k=q-1;0<=k;k--)d.lineTo(r-n,t),r-=l,d.moveTo(r,t);d.stroke();if(a)for(a=g.equivalentZonesFrequencyCount.length-2;0<a;a--){r=((g.equivalentZonesFrequencyCount[a]+f)*e|0)+h;t=p;d.beginPath();for(d.moveTo(r,t);t<m;)d.lineTo(r,t+n),t+=l,d.moveTo(r,t);d.stroke()}r=1>e?2*e:2*e|0;h=.5*r;d.lineWidth=r;a=GraphicalFilterEditor.visibleBinCount-
1;for(m=b?1:0;0<=m;m--){l=m||!b?g.channelCurves[c]:g.actualChannelCurve;d.strokeStyle=m?"#707070":this.rangeImage;d.beginPath();d.moveTo(f*e|0,l[0]*e+h);for(r=1;r<a;r++)d.lineTo((f+r)*e|0,l[r]*e+h);d.lineTo((f+r+1)*e|0,l[r]*e+h);d.stroke()}}}}
class GraphicalFilterEditorSVGRenderer extends GraphicalFilterEditorRenderer{constructor(a){super(document.createElement("div"),Math.abs(GraphicalFilterEditorControl.controlWidth-GraphicalFilterEditor.visibleBinCount)>>1,a);this.element.className="GECV";this.element.style.overflow="hidden";this.element.style.backgroundColor="#303030";this.element.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="1" height="1" viewBox="0 0 1 1" version="1.1" style="transform-origin: top left; pointer-events: none;">\n\t\t\t<defs>\n\t\t\t\t<linearGradient id="editorSVGLinearGradient" x1="0" y1="0" x2="0" y2="1" gradientUnits="userSpaceOnUse">\n\t\t\t\t\t<stop offset="0" stop-color="#ff0000" />\n\t\t\t\t\t<stop offset="0.1875" stop-color="#ffff00" />\n\t\t\t\t\t<stop offset="0.39453125" stop-color="#00ff00" />\n\t\t\t\t\t<stop offset="0.60546875" stop-color="#00ffff" />\n\t\t\t\t\t<stop offset="0.796875" stop-color="#0000ff" />\n\t\t\t\t\t<stop offset="1" stop-color="#ff00ff" />\n\t\t\t\t</linearGradient>\n\t\t\t</defs>\n\t\t\t<line x1="0" y1="0" x2="1" y2="0" stroke="#5a5a5a" stroke-width="1px" stroke-dasharray="4" />\n\t\t\t<line x1="0" y1="0" x2="1" y2="0" stroke="#5a5a5a" stroke-width="1px" stroke-dasharray="4" />\n\t\t\t<g style="display:none">\n\t\t\t\t<line x1="0" y1="0" x2="0" y2="1" stroke="#5a5a5a" stroke-width="1px" stroke-dasharray="4" />\n\t\t\t\t<line x1="0" y1="0" x2="0" y2="1" stroke="#5a5a5a" stroke-width="1px" stroke-dasharray="4" />\n\t\t\t\t<line x1="0" y1="0" x2="0" y2="1" stroke="#5a5a5a" stroke-width="1px" stroke-dasharray="4" />\n\t\t\t\t<line x1="0" y1="0" x2="0" y2="1" stroke="#5a5a5a" stroke-width="1px" stroke-dasharray="4" />\n\t\t\t\t<line x1="0" y1="0" x2="0" y2="1" stroke="#5a5a5a" stroke-width="1px" stroke-dasharray="4" />\n\t\t\t\t<line x1="0" y1="0" x2="0" y2="1" stroke="#5a5a5a" stroke-width="1px" stroke-dasharray="4" />\n\t\t\t\t<line x1="0" y1="0" x2="0" y2="1" stroke="#5a5a5a" stroke-width="1px" stroke-dasharray="4" />\n\t\t\t\t<line x1="0" y1="0" x2="0" y2="1" stroke="#5a5a5a" stroke-width="1px" stroke-dasharray="4" />\n\t\t\t\t<line x1="0" y1="0" x2="0" y2="1" stroke="#5a5a5a" stroke-width="1px" stroke-dasharray="4" />\n\t\t\t</g>\n\t\t\t<path style="fill:none;stroke:#707070;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter" d="M 0,0 1,0" />\n\t\t\t<path style="fill:none;stroke:url(#editorSVGLinearGradient);stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter" d="M 0,0 1,0" />\n\t\t</svg>';
this.pixelRatio=1;this.showZones=!1;this.isActualChannelCurveNeeded=!0;this.svg=a=this.element.firstChild;this.svgGradient=a.getElementsByTagName("linearGradient")[0];this.svgZones=a.getElementsByTagName("g")[0];var b=a.getElementsByTagName("path");this.svgGrayCurve=b[0];this.svgCurve=b[1];a=a.getElementsByTagName("line");this.svgLines=Array(a.length);for(b=a.length-1;0<=b;b--)this.svgLines[b]=a[b];this.scaleChanged()}scaleChanged(){const a=this.element,b=this.editor;var c=b.filter;const d=this.svg;
if(a&&b&&c&&d){var e=GraphicalFilterEditorControl.controlWidth,f=GraphicalFilterEditorControl.controlHeight,g=1<devicePixelRatio?devicePixelRatio:1,h=b.scale,k=h*g,m=this.leftMargin,l=this.svgLines,n=1>k?k:k|0,q=.5*n,p=(e*k|0).toString(),r=(f*k|0).toString();d.setAttribute("width",p);d.setAttribute("height",r);d.setAttribute("viewBox",`0 0 ${p} ${r}`);d.style.transform=1===g?"":"scale("+1/g+")";this.svgGradient.setAttribute("y2",r);b.element.style.width=(e*h|0)+"px";a.style.width=(e*h|0)+"px";a.style.height=
(f*h|0)+"px";l[0].setAttribute("x2",p);l[1].setAttribute("x2",p);for(p=l.length-1;2<=p;p--)l[p].setAttribute("y2",r);r=((GraphicalFilterEditor.zeroChannelValueY*k|0)+q).toString();l[0].setAttribute("y1",r);l[0].setAttribute("y2",r);r=((GraphicalFilterEditor.validYRangeHeight*k|0)+q).toString();l[1].setAttribute("y1",r);l[1].setAttribute("y2",r);for(r=c.equivalentZonesFrequencyCount.length-2;0<r;r--)p=(((c.equivalentZonesFrequencyCount[r]+m)*k|0)+q).toString(),l[r+1].setAttribute("x1",p),l[r+1].setAttribute("x2",
p);p=n.toString()+"px";r=(4*k|0).toString();for(c=l.length-1;0<=c;c--)l[c].setAttribute("stroke-width",p),l[c].setAttribute("stroke-dasharray",r);p=(1>k?2*k:2*k|0).toString()+"px";this.svgGrayCurve.style.strokeWidth=p;this.svgCurve.style.strokeWidth=p;this.pixelRatio=g}}drawCurve(a,b,c){var d=1<devicePixelRatio?devicePixelRatio:1;d!==this.pixelRatio&&(this.scaleChanged(),d=this.pixelRatio);this.showZones!==a&&(this.showZones=a,this.svgZones.style.display=a?"":"none");var e=this.editor;a=e.filter;
d*=e.scale;e=.5*(1>d?2*d:2*d|0);const f=this.leftMargin,g=GraphicalFilterEditor.visibleBinCount;for(let h=b?1:0;0<=h;h--){const k=h||!b?a.channelCurves[c]:a.actualChannelCurve,m=h?this.svgGrayCurve:this.svgCurve;let l=1,n=0,q=k[0],p="M "+(f*d|0)+","+(q*d+e);for(;l<g;l++)k[l]!==q&&(l>n+1&&1<l&&(p+=" "+((f+l-1)*d|0)+","+(k[l-1]*d+e)),n=l,q=k[l],p+=" "+((f+n)*d|0)+","+(q*d+e));p+=" "+((f+l)*d|0)+","+(k[l-1]*d+e);m.setAttribute("d",p)}this.isActualChannelCurveNeeded!==b&&(this.isActualChannelCurveNeeded=
b,this.svgGrayCurve.style.display=b?"":"none")}}
class GraphicalFilterEditorControl{constructor(a,b,c,d,e,f){this._showZones=!1;this._editMode=GraphicalFilterEditorControl.editModeRegular;this._isActualChannelCurveNeeded=!0;this._currentChannelIndex=0;this.isSameFilterLR=!0;this.drawOffsetY=this.drawOffsetX=this.lastDrawY=this.lastDrawX=this.drawingMode=0;if(8>b||b&b-1)throw"Sorry, class available only for fft sizes that are a power of 2 >= 8! :(";this.filter=new GraphicalFilterEditor(b,c,d);b=function(){const h=document.createElement("div");h.className=
"GEMNUSEP";return h};c=function(h){const k=document.createElement("div");k.className="GEMNULBL";k.appendChild(document.createTextNode(h));return k};d=function(h,k,m,l,n,q){const p=document.createElement("div");p.className=q?"GEMNUIT GECLK "+q:"GEMNUIT GECLK";if(k)if(f&&(l&&f.radioHTML||!l&&f.checkHTML))p.innerHTML=l?f.radioHTML:f.checkHTML,k=p.firstChild,k.style.marginRight=l?f.radioMargin||"2px":f.checkMargin||"2px",m||(k.style.visibility="hidden");else{k=document.createElement("span");q=l?"\u25cf ":
"\u25a0 ";let r=null;if(f){let t=!1;l?f.radioCharacter&&(t=!0,q=f.radioCharacter,r=f.radioMargin||"2px"):f.checkCharacter&&(t=!0,q=f.checkCharacter,r=f.checkMargin||"2px");t&&(f.checkFontFamily&&(k.style.fontFamily=f.checkFontFamily),f.checkFontSize&&(k.style.fontSize=f.checkFontSize))}r&&(k.style.marginRight=r);k.appendChild(document.createTextNode(q));m||(k.style.visibility="hidden");p.appendChild(k)}p.appendChild(document.createTextNode(h));n&&(p.onclick=n);return p};this.element=a;a.className=
"GE";a.setAttribute("aria-hidden","true");this.boundMouseMove=this.mouseMove.bind(this);this._fontSize=null;f&&f.fontSize&&(this.fontSize=f.fontSize);this._lineHeight=null;f&&f.lineHeight&&(this.lineHeight=f.lineHeight);this._scale=0;this.scale=f&&f.scale&&0<f.scale?f.scale:1;this.renderer=f&&f.svgRenderer?new GraphicalFilterEditorSVGRenderer(this):new GraphicalFilterEditorCanvasRenderer(this);this.renderer.element.addEventListener("mousemove",this.boundMouseMove);this.renderer.element.oncontextmenu=
cancelEvent;a.appendChild(this.renderer.element);this.pointerHandler=new PointerHandler(this.renderer.element,this.mouseDown.bind(this),this.mouseMove.bind(this),this.mouseUp.bind(this));a.oncontextmenu=cancelEvent;var g=document.createElement("div");g.className="GELBL";g.style.width="9em";g.appendChild(document.createTextNode(GraphicalFilterEditorStrings.Cursor));g.appendChild(this.lblCursor=document.createElement("span"));g.appendChild(document.createTextNode(" dB"));this.lblCursor.appendChild(document.createTextNode(GraphicalFilterEditorStrings.Minus0));
a.appendChild(g);g=document.createElement("div");g.className="GELBL";g.style.width="9em";g.appendChild(document.createTextNode(GraphicalFilterEditorStrings.Curve));g.appendChild(this.lblCurve=document.createElement("span"));g.appendChild(document.createTextNode(" dB"));this.lblCurve.appendChild(document.createTextNode(GraphicalFilterEditorStrings.Minus0));a.appendChild(g);g=document.createElement("div");g.className="GELBL";g.appendChild(document.createTextNode(GraphicalFilterEditorStrings.Frequency));
g.appendChild(this.lblFrequency=document.createElement("span"));this.lblFrequency.appendChild(document.createTextNode("0 Hz (31 Hz)"));a.appendChild(g);this.btnMnu=document.createElement("div");this.btnMnu.className="GEBTN GECLK";this.openMenuElement=null;this.openMenuCharacter="\u25b2";this.closeMenuElement=null;this.closeMenuCharacter="\u25bc";f&&(g=!1,f.openMenuHTML&&f.closeMenuHTML?(g=!0,this.btnMnu.innerHTML=f.openMenuHTML+f.closeMenuHTML,this.openMenuElement=this.btnMnu.childNodes[0],this.closeMenuElement=
this.btnMnu.childNodes[1],this.closeMenuElement.style.display="none"):f.openMenuCharacter?(g=!0,this.openMenuCharacter=f.openMenuCharacter,this.closeMenuCharacter=f.closeMenuCharacter||this.openMenuCharacter):f.closeMenuCharacter&&(g=!0,this.closeMenuCharacter=this.openMenuCharacter=f.closeMenuCharacter),g&&(f.menuFontFamily&&(this.btnMnu.style.fontFamily=f.menuFontFamily),f.menuFontSize&&(this.btnMnu.style.fontSize=f.menuFontSize),f.menuWidth&&(this.btnMnu.style.width=f.menuWidth),f.menuPadding&&
(this.btnMnu.style.padding=f.menuPadding)));this.openMenuElement||this.btnMnu.appendChild(document.createTextNode(this.openMenuCharacter));this.btnMnu.onclick=this.btnMnu_Click.bind(this);a.appendChild(this.btnMnu);this.mnu=document.createElement("div");this.mnu.className="GEMNU";this.mnu.style.display="none";g=document.createElement("div");g.className="GEMNUH GEFILTER";g.appendChild(c(GraphicalFilterEditorStrings.SameCurve));g.appendChild(this.mnuChBL=d(GraphicalFilterEditorStrings.UseLeftCurve,
!0,!0,!0,this.mnuChB_Click.bind(this,0)));g.appendChild(this.mnuChBR=d(GraphicalFilterEditorStrings.UseRightCurve,!0,!1,!0,this.mnuChB_Click.bind(this,1)));g.appendChild(b());g.appendChild(c(GraphicalFilterEditorStrings.OneForEach));g.appendChild(this.mnuChL=d(GraphicalFilterEditorStrings.ShowLeftCurve,!0,!1,!0,this.mnuChLR_Click.bind(this,0)));g.appendChild(this.mnuChR=d(GraphicalFilterEditorStrings.ShowRightCurve,!0,!1,!0,this.mnuChLR_Click.bind(this,1)));this.mnu.appendChild(g);g=document.createElement("div");
g.className="GEMNUH GEMNUSEPH";g.appendChild(d(GraphicalFilterEditorStrings.ResetCurve,!1,!1,!1,this.mnuResetCurve_Click.bind(this)));g.appendChild(b());g.appendChild(c(GraphicalFilterEditorStrings.EditMode));g.appendChild(this.mnuEditRegular=d(GraphicalFilterEditorStrings.Regular,!0,!0,!0,this.mnuEditRegular_Click.bind(this)));g.appendChild(this.mnuEditZones=d(GraphicalFilterEditorStrings.Zones,!0,!1,!0,this.mnuEditZones_Click.bind(this)));g.appendChild(this.mnuEditSmoothNarrow=d(GraphicalFilterEditorStrings.SmoothNarrow,
!0,!1,!0,this.mnuEditSmoothNarrow_Click.bind(this)));g.appendChild(this.mnuEditSmoothWide=d(GraphicalFilterEditorStrings.SmoothWide,!0,!1,!0,this.mnuEditSmoothWide_Click.bind(this)));g.appendChild(this.mnuEditPeakingEq=d(GraphicalFilterEditorStrings.PeakingEq,!0,!1,!0,this.mnuEditPeakingEq_Click.bind(this)));if(f&&f.hideEditModePeakingEq||!this.filter.iirSupported)this.mnuEditPeakingEq.style.display="none";g.appendChild(this.mnuEditShelfEq=d(GraphicalFilterEditorStrings.ShelfEq,!0,!1,!0,this.mnuEditShelfEq_Click.bind(this)));
if(f&&f.hideEditModeShelfEq||!this.filter.iirSupported)this.mnuEditShelfEq.style.display="none";g.appendChild(b());g.appendChild(this.mnuNormalizeCurves=d(GraphicalFilterEditorStrings.NormalizeCurves,!0,!1,!1,this.mnuNormalizeCurves_Click.bind(this),"GEFILTER"));g.appendChild(this.mnuShowZones=d(GraphicalFilterEditorStrings.ShowZones,!0,!1,!1,this.mnuShowZones_Click.bind(this)));g.appendChild(this.mnuShowActual=d(GraphicalFilterEditorStrings.ShowActualResponse,!0,!0,!1,this.mnuShowActual_Click.bind(this)));
this.mnu.appendChild(g);a.appendChild(this.mnu);e&&this.loadSettings(e);this.drawCurve()}destroy(){this.filter&&this.filter.destroy();this.pointerHandler&&this.pointerHandler.destroy();this.renderer&&this.renderer.destroy();zeroObject(this)}loadSettings(a){if(a){var b=this.filter;if(!1===a.showZones||!0===a.showZones)this._showZones=a.showZones;a.editMode&&a.editMode>=GraphicalFilterEditorControl.editModeFirst&&a.editMode<=GraphicalFilterEditorControl.editModeLast&&(b.iirSupported||a.editMode!==GraphicalFilterEditorControl.editModePeakingEq&&
a.editMode!==GraphicalFilterEditorControl.editModeShelfEq)&&(this._editMode=a.editMode);if(!1===a.isActualChannelCurveNeeded||!0===a.isActualChannelCurveNeeded)this._isActualChannelCurveNeeded=a.isActualChannelCurveNeeded;if(0===a.currentChannelIndex||1===a.currentChannelIndex)this._currentChannelIndex=a.currentChannelIndex;if(!1===a.isSameFilterLR||!0===a.isSameFilterLR)this.isSameFilterLR=a.isSameFilterLR;var c=GraphicalFilterEditor.decodeCurve(a.leftCurve),d=GraphicalFilterEditor.decodeCurve(a.rightCurve);
c&&!d?d=c:d&&!c&&(c=d);if(c){var e=b.channelCurves[0];for(let f=GraphicalFilterEditor.visibleBinCount-1;0<=f;f--)e[f]=b.clampY(c[f])}if(d)for(c=b.channelCurves[1],e=GraphicalFilterEditor.visibleBinCount-1;0<=e;e--)c[e]=b.clampY(d[e]);this.isSameFilterLR?(this.checkMenu(this.mnuChBL,0===this._currentChannelIndex),this.checkMenu(this.mnuChL,!1),this.checkMenu(this.mnuChBR,1===this._currentChannelIndex),this.checkMenu(this.mnuChR,!1)):(this.checkMenu(this.mnuChBL,!1),this.checkMenu(this.mnuChL,0===this._currentChannelIndex),
this.checkMenu(this.mnuChBR,!1),this.checkMenu(this.mnuChR,1===this._currentChannelIndex));a=!1===a.isNormalized||!0===a.isNormalized?a.isNormalized:b.isNormalized;a===b.isNormalized?b.updateFilter(this._currentChannelIndex,this.isSameFilterLR,!0):b.changeIsNormalized(a,this._currentChannelIndex,this.isSameFilterLR);this._isActualChannelCurveNeeded&&this.filter.updateActualChannelCurve(this._currentChannelIndex);this.checkMenu(this.mnuShowZones,this._showZones);this.editMode=this._editMode;this.checkMenu(this.mnuNormalizeCurves,
this.filter.isNormalized);this.checkMenu(this.mnuShowActual,this._isActualChannelCurveNeeded);this.drawCurve()}}saveSettings(){return{showZones:this._showZones,editMode:this._editMode,isActualChannelCurveNeeded:this._isActualChannelCurveNeeded,currentChannelIndex:this._currentChannelIndex,isSameFilterLR:this.isSameFilterLR,isNormalized:this.filter.isNormalized,leftCurve:GraphicalFilterEditor.encodeCurve(this.filter.channelCurves[0]),rightCurve:GraphicalFilterEditor.encodeCurve(this.filter.channelCurves[1])}}get scale(){return this._scale}set scale(a){0>=
a||this._scale===a||!this.element||(this._scale=a,this._fontSize||(this.element.style.fontSize=12*a+"px"),this._lineHeight||(this.element.style.lineHeight=16*a+"px"),this.renderer&&(this.renderer.scaleChanged(),this.drawCurve()))}get fontSize(){return this._fontSize}set fontSize(a){this._fontSize!==a&&this.element&&(this._fontSize=a,this.element.style.fontSize=a||12*this._scale+"px")}get lineHeight(){return this._lineHeight}set lineHeight(a){this._lineHeight!==a&&this.element&&(this._lineHeight=a,
this.element.style.lineHeight=a||16*this._scale+"px")}get showZones(){return this._showZones}set showZones(a){this._showZones=a;this.checkMenu(this.mnuShowZones,a);this.drawCurve()}get editMode(){return this._editMode}set editMode(a){if(!(a<GraphicalFilterEditorControl.editModeFirst||a>GraphicalFilterEditorControl.editModeLast)&&(this.filter.iirSupported||a!==GraphicalFilterEditorControl.editModePeakingEq&&a!==GraphicalFilterEditorControl.editModeShelfEq)){this._editMode=a;this.checkMenu(this.mnuEditRegular,
a===GraphicalFilterEditorControl.editModeRegular);this.checkMenu(this.mnuEditZones,a===GraphicalFilterEditorControl.editModeZones);this.checkMenu(this.mnuEditSmoothNarrow,a===GraphicalFilterEditorControl.editModeSmoothNarrow);this.checkMenu(this.mnuEditSmoothWide,a===GraphicalFilterEditorControl.editModeSmoothWide);this.checkMenu(this.mnuEditPeakingEq,a===GraphicalFilterEditorControl.editModePeakingEq);this.checkMenu(this.mnuEditShelfEq,a===GraphicalFilterEditorControl.editModeShelfEq);var b=GraphicalFilterEditorIIRType.None;
switch(a){case GraphicalFilterEditorControl.editModePeakingEq:b=GraphicalFilterEditorIIRType.Peaking;break;case GraphicalFilterEditorControl.editModeShelfEq:b=GraphicalFilterEditorIIRType.Shelf}this.filter.iirType!==b&&(this.mnu.className=b?"GEMNU GEEQ":"GEMNU",this.filter.changeIIRType(b,this._currentChannelIndex,this.isSameFilterLR),this._isActualChannelCurveNeeded&&(this.filter.updateActualChannelCurve(this._currentChannelIndex),this.drawCurve()))}}get isActualChannelCurveNeeded(){return this._isActualChannelCurveNeeded}set isActualChannelCurveNeeded(a){this._isActualChannelCurveNeeded=
a;this.checkMenu(this.mnuShowActual,a);a&&this.filter.updateActualChannelCurve(this._currentChannelIndex);this.drawCurve()}get currentChannelIndex(){return this._currentChannelIndex}get isNormalized(){return this.filter.isNormalized}set isNormalized(a){this.filter.changeIsNormalized(a,this._currentChannelIndex,this.isSameFilterLR);this.checkMenu(this.mnuNormalizeCurves,a);this._isActualChannelCurveNeeded&&(this.filter.updateActualChannelCurve(this._currentChannelIndex),this.drawCurve())}static formatDB(a){return-40>
a?GraphicalFilterEditorStrings.MinusInfinity:0>a?GraphicalFilterEditorStrings.toFixed(a,2):0===a?GraphicalFilterEditorStrings.Minus0:"+"+GraphicalFilterEditorStrings.toFixed(a,2)}static formatFrequency(a){return a[0].toFixed(0)+" Hz ("+(1E3>a[1]?a[1]+" Hz":a[1]/1E3+" kHz")+")"}static setFirstNodeText(a,b){a.firstChild&&(a.firstChild.nodeValue=b)}btnMnu_Click(a){a.button||("none"===this.mnu.style.display?(this.mnu.style.bottom=this.btnMnu.clientHeight+"px",this.mnu.style.display="inline-block",this.openMenuElement&&
this.closeMenuElement?(this.openMenuElement.style.display="none",this.closeMenuElement.style.display=""):GraphicalFilterEditorControl.setFirstNodeText(this.btnMnu,this.closeMenuCharacter)):(this.mnu.style.display="none",this.openMenuElement&&this.closeMenuElement?(this.closeMenuElement.style.display="none",this.openMenuElement.style.display=""):GraphicalFilterEditorControl.setFirstNodeText(this.btnMnu,this.openMenuCharacter)));return!0}checkMenu(a,b){a.firstChild.style.visibility=b?"visible":"hidden";
return b}mnuChB_Click(a,b){b.button||this.isSameFilterLR&&this._currentChannelIndex===a||(this.isSameFilterLR?(this._currentChannelIndex=a,this.filter.updateFilter(a,!0,!0),this._isActualChannelCurveNeeded&&this.filter.updateActualChannelCurve(a),this.drawCurve()):(this.isSameFilterLR=!0,this.filter.copyFilter(a,1-a),this._currentChannelIndex!==a&&(this._currentChannelIndex=a,this._isActualChannelCurveNeeded&&this.filter.updateActualChannelCurve(a),this.drawCurve())),this.checkMenu(this.mnuChBL,0===
a),this.checkMenu(this.mnuChL,!1),this.checkMenu(this.mnuChBR,1===a),this.checkMenu(this.mnuChR,!1));return this.btnMnu_Click(b)}mnuChLR_Click(a,b){b.button||!this.isSameFilterLR&&this._currentChannelIndex===a||(this.isSameFilterLR&&(this.isSameFilterLR=!1,this.filter.updateFilter(1-this._currentChannelIndex,!1,!1)),this._currentChannelIndex!==a&&(this._currentChannelIndex=a,this._isActualChannelCurveNeeded&&this.filter.updateActualChannelCurve(a),this.drawCurve()),this.checkMenu(this.mnuChBL,!1),
this.checkMenu(this.mnuChL,0===a),this.checkMenu(this.mnuChBR,!1),this.checkMenu(this.mnuChR,1===a));return this.btnMnu_Click(b)}mnuResetCurve_Click(a){a.button||this.resetCurve();return this.btnMnu_Click(a)}mnuShowZones_Click(a){a.button||(this.showZones=!this._showZones);return this.btnMnu_Click(a)}mnuEditRegular_Click(a){a.button||(this.editMode=GraphicalFilterEditorControl.editModeRegular);return this.btnMnu_Click(a)}mnuEditZones_Click(a){a.button||(this.editMode=GraphicalFilterEditorControl.editModeZones);
return this.btnMnu_Click(a)}mnuEditSmoothNarrow_Click(a){a.button||(this.editMode=GraphicalFilterEditorControl.editModeSmoothNarrow);return this.btnMnu_Click(a)}mnuEditSmoothWide_Click(a){a.button||(this.editMode=GraphicalFilterEditorControl.editModeSmoothWide);return this.btnMnu_Click(a)}mnuEditPeakingEq_Click(a){a.button||(this.editMode=GraphicalFilterEditorControl.editModePeakingEq);return this.btnMnu_Click(a)}mnuEditShelfEq_Click(a){a.button||(this.editMode=GraphicalFilterEditorControl.editModeShelfEq);
return this.btnMnu_Click(a)}mnuNormalizeCurves_Click(a){a.button||(this.isNormalized=!this.filter.isNormalized);return this.btnMnu_Click(a)}mnuShowActual_Click(a){a.button||(this.isActualChannelCurveNeeded=!this._isActualChannelCurveNeeded);return this.btnMnu_Click(a)}mouseDown(a){if(!a.button&&!this.drawingMode){const b=this.renderer.element.getBoundingClientRect(),c=((a.clientX-b.left)/this._scale|0)-this.renderer.leftMargin;a=(a.clientY-b.top)/this._scale|0;this.renderer.element.removeEventListener("mousemove",
this.boundMouseMove);this.drawingMode=1;switch(this._editMode){case GraphicalFilterEditorControl.editModeZones:case GraphicalFilterEditorControl.editModePeakingEq:this.filter.changeZoneY(this._currentChannelIndex,c,a);break;case GraphicalFilterEditorControl.editModeShelfEq:this.filter.changeShelfZoneY(this._currentChannelIndex,c,a);break;case GraphicalFilterEditorControl.editModeSmoothNarrow:this.filter.startSmoothEdition(this._currentChannelIndex);this.filter.changeSmoothY(this._currentChannelIndex,
c,a,GraphicalFilterEditor.visibleBinCount>>3);break;case GraphicalFilterEditorControl.editModeSmoothWide:this.filter.startSmoothEdition(this._currentChannelIndex);this.filter.changeSmoothY(this._currentChannelIndex,c,a,GraphicalFilterEditor.visibleBinCount>>1);break;default:this.filter.channelCurves[this._currentChannelIndex][this.filter.clampX(c)]=this.filter.clampY(a),this.lastDrawX=c,this.lastDrawY=a}this.drawCurve();return!0}return!1}mouseMove(a){var b=this.renderer.element.getBoundingClientRect();
let c=((a.clientX-b.left)/this._scale|0)-this.renderer.leftMargin;a=(a.clientY-b.top)/this._scale|0;b=this.filter.channelCurves[this._currentChannelIndex];if(this.drawingMode){switch(this._editMode){case GraphicalFilterEditorControl.editModeZones:case GraphicalFilterEditorControl.editModePeakingEq:this.filter.changeZoneY(this._currentChannelIndex,c,a);break;case GraphicalFilterEditorControl.editModeShelfEq:this.filter.changeShelfZoneY(this._currentChannelIndex,c,a);break;case GraphicalFilterEditorControl.editModeSmoothNarrow:this.filter.changeSmoothY(this._currentChannelIndex,
c,a,GraphicalFilterEditor.visibleBinCount>>3);break;case GraphicalFilterEditorControl.editModeSmoothWide:this.filter.changeSmoothY(this._currentChannelIndex,c,a,GraphicalFilterEditor.visibleBinCount>>1);break;default:if(1<Math.abs(c-this.lastDrawX)){const d=(a-this.lastDrawY)/Math.abs(c-this.lastDrawX),e=c<this.lastDrawX?-1:1;let f=Math.abs(c-this.lastDrawX)-1;a=this.lastDrawY+d;for(c=this.lastDrawX+e;0<f;c+=e,f--)b[this.filter.clampX(c)]=this.filter.clampY(a),a+=d}b[this.filter.clampX(c)]=this.filter.clampY(a);
this.lastDrawX=c;this.lastDrawY=a}this.drawCurve()}else this._isActualChannelCurveNeeded&&(b=this.filter.actualChannelCurve);c=this.filter.clampX(c);GraphicalFilterEditorControl.setFirstNodeText(this.lblCursor,GraphicalFilterEditorControl.formatDB(this.filter.yToDB(a)));GraphicalFilterEditorControl.setFirstNodeText(this.lblCurve,GraphicalFilterEditorControl.formatDB(this.filter.yToDB(b[c])));GraphicalFilterEditorControl.setFirstNodeText(this.lblFrequency,GraphicalFilterEditorControl.formatFrequency(this.filter.visibleBinToFrequency(c,
!0)))}mouseUp(a){this.drawingMode&&(this.renderer.element.addEventListener("mousemove",this.boundMouseMove),this.drawingMode=0,this.commitChanges())}resetCurve(){const a=this.filter.channelCurves[this._currentChannelIndex];for(let b=a.length-1;0<=b;b--)a[b]=GraphicalFilterEditor.zeroChannelValueY;this.filter.updateFilter(this._currentChannelIndex,this.isSameFilterLR,!1);this._isActualChannelCurveNeeded&&this.filter.updateActualChannelCurve(this._currentChannelIndex);this.drawCurve()}getZoneY(a){return this.filter.getZoneY(this._currentChannelIndex,
a)}changeZoneY(a,b,c){this.filter.changeZoneYByIndex(this._currentChannelIndex,a,b);this.drawCurve(c)}getShelfZoneY(a){return this.filter.getShelfZoneY(this._currentChannelIndex,a)}changeShelfZoneY(a,b,c){this.filter.changeShelfZoneYByIndex(this._currentChannelIndex,a,b);this.drawCurve(c)}changeFilterY(a,b,c){this.filter.channelCurves[this._currentChannelIndex][this.filter.clampX(a)]=this.filter.clampY(b);this.drawCurve(c)}commitChanges(){this.filter.updateFilter(this._currentChannelIndex,this.isSameFilterLR,
!1);this._isActualChannelCurveNeeded&&this.filter.updateActualChannelCurve(this._currentChannelIndex);this.drawCurve()}changeFilterLength(a){return this.filter.changeFilterLength(a,this._currentChannelIndex,this.isSameFilterLR)?(this._isActualChannelCurveNeeded&&this.filter.updateActualChannelCurve(this._currentChannelIndex),this.drawCurve(),!0):!1}changeSampleRate(a){return this.filter.changeSampleRate(a,this._currentChannelIndex,this.isSameFilterLR)?(this._isActualChannelCurveNeeded&&this.filter.updateActualChannelCurve(this._currentChannelIndex),
this.drawCurve(),!0):!1}changeAudioContext(a){return this.filter.changeAudioContext(a,this._currentChannelIndex,this.isSameFilterLR)}drawCurve(a){this.renderer&&this.renderer.drawCurve(this._showZones,!a&&this._isActualChannelCurveNeeded&&!this.drawingMode,this._currentChannelIndex)}}GraphicalFilterEditorControl.controlWidth=Math.max(512,GraphicalFilterEditor.visibleBinCount);GraphicalFilterEditorControl.controlHeight=GraphicalFilterEditor.validYRangeHeight+3;
GraphicalFilterEditorControl.editModeRegular=0;GraphicalFilterEditorControl.editModeZones=1;GraphicalFilterEditorControl.editModeSmoothNarrow=2;GraphicalFilterEditorControl.editModeSmoothWide=3;GraphicalFilterEditorControl.editModePeakingEq=4;GraphicalFilterEditorControl.editModeShelfEq=5;GraphicalFilterEditorControl.editModeFirst=0;GraphicalFilterEditorControl.editModeLast=5;
class Program{constructor(a,b,c){const d=[];var e=[];const f=[];this.gl=a;var g=a.createProgram();if(!g)throw Error("Null program");this.program=g;g=a.createShader(a.VERTEX_SHADER);if(!g)throw Error("Null vertex shader");this.vs=g;g=a.createShader(a.FRAGMENT_SHADER);if(!g)throw Error("Null fragment shader");this.fs=g;a.shaderSource(this.vs,b);a.compileShader(this.vs);if(!a.getShaderParameter(this.vs,a.COMPILE_STATUS))throw e="Vertex shader: "+a.getShaderInfoLog(this.vs),this.destroy(),alert(e),e;
this.getAttribsAndUniforms(b,d,e,f);a.shaderSource(this.fs,c);a.compileShader(this.fs);if(!a.getShaderParameter(this.fs,a.COMPILE_STATUS))throw e="Fragment shader: "+a.getShaderInfoLog(this.fs),this.destroy(),alert(e),e;this.getAttribsAndUniforms(c,d,e,f);a.attachShader(this.program,this.vs);a.attachShader(this.program,this.fs);for(b=0;b<d.length;b++)a.bindAttribLocation(this.program,b,d[b]);a.linkProgram(this.program);for(a=0;a<e.length;a++)this.prepareUniform(e[a],f[a])}static create(a,b,c,d){const e=
["webkit-3d","moz-webgl","webgl","experimental-webgl"];for(let f=0;f<e.length;f++)try{const g=a.getContext(e[f],b);return new Program(g,c,d)}catch(g){}return null}getAttribsAndUniforms(a,b,c,d){a=a.split("\n");for(let m=0;m<a.length;m++){var e=a[m].trim();if("uniform"===e.substring(0,7)){e=e.split(" ");var f=e[1];for(var g=2;g<e.length;g++){var h=e[g];if(";"===h)break;var k=h.charAt(h.length-1);const l=";"===k;if(","===k||l)h=h.substring(0,h.length-1);","!==h&&h.length&&(c.push(h),d.push(f));if(l)break}}else if("attribute"===
e.substring(0,9))for(e=e.split(" "),f=2;f<e.length;f++){g=e[f];if(";"===g)break;h=g.charAt(g.length-1);k=";"===h;if(","===h||k)g=g.substring(0,g.length-1);","!==g&&g.length&&b.push(g);if(k)break}}}prepareUniform(a,b){const c=this.gl,d=c.getUniformLocation(this.program,a);if(!this[a])if("bool"===b||"int"===b||"sampler2D"===b)this[a]=function(e){c.uniform1i(d,e)};else if("float"===b)this[a]=function(e){c.uniform1f(d,e)};else if("vec2"===b)this[a]=function(e,f){c.uniform2f(d,e,f)},this[a+"v"]=function(e){c.uniform2fv(d,
e)};else if("vec3"===b)this[a]=function(e,f,g){c.uniform3f(d,e,f,g)},this[a+"v"]=function(e){c.uniform3fv(d,e)};else if("vec4"===b)this[a]=function(e,f,g,h){c.uniform4f(d,e,f,g,h)},this[a+"v"]=function(e){c.uniform4fv(d,e)};else if("mat4"===b)this[a]=function(e){c.uniformMatrix4fv(d,!1,e)};else return!1;return!0}use(){this.gl.useProgram(this.program)}destroy(){this.gl&&(this.gl.useProgram(null),this.vs&&(this.gl.detachShader(this.program,this.vs),this.gl.deleteShader(this.vs)),this.fs&&(this.gl.detachShader(this.program,
this.fs),this.gl.deleteShader(this.fs)),this.program&&this.gl.deleteProgram(this.program),zeroObject(this))}}
class Analyzer{constructor(a,b,c,d,e,f){this.alive=!1;this.lastRequest=0;this.boundAnalyze=null;this.audioContext=a;this.canvas=document.createElement("canvas");this.canvas.width=!e||0>=e?Analyzer.controlWidth:e;this.canvas.height=!f||0>=f?Analyzer.controlHeight:f;this.canvas.style.position="relative";this.canvas.style.margin="0px";this.canvas.style.padding="0px";this.canvas.style.verticalAlign="top";this.canvas.style.display="inline-block";this.canvas.style.cursor="default";c&&(this.canvas.id=c);
this.ctx=d?null:this.canvas.getContext("2d",{alpha:!1});b.appendChild(this.canvas);this.boundAnalyze=g=>{this.alive?(this.lastRequest=requestAnimationFrame(this.boundAnalyze),this.analyze(g)):this.lastRequest=0}}destroy(){this.stop();this.cleanUp();this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);zeroObject(this)}start(){if(this.alive)return!1;this.alive=!0;this.lastRequest=requestAnimationFrame(this.boundAnalyze);return!0}stop(){this.alive=!1;this.lastRequest&&
(cancelAnimationFrame(this.lastRequest),this.lastRequest=0)}}Analyzer.controlWidth=GraphicalFilterEditorControl.controlWidth;Analyzer.controlHeight=Analyzer.controlWidth;Analyzer.colors="#000000 #0B00B2 #0C00B1 #0E00AF #0E00AF #0F00AE #1000AD #1200AC #1300AB #1500AB #1600AA #1700A9 #1900A8 #1A00A6 #1B00A6 #1D00A4 #1F00A3 #2000A1 #2200A1 #2300A0 #25009E #27009D #29009C #2B009A #2D0099 #2E0098 #300096 #320095 #340094 #360092 #380090 #39008F #3C008E #3E008C #40008B #420089 #440088 #470086 #480085 #4B0083 #4C0082 #4F0080 #51007F #54007C #56007C #57007A #5A0078 #5C0076 #5F0075 #610073 #640071 #65006F #68006E #6B006C #6D006A #6F0069 #710066 #740065 #760063 #790062 #7B0060 #7D005E #80005C #82005B #850059 #860057 #890056 #8C0054 #8E0052 #910050 #93004F #96004D #97004B #9A0049 #9C0048 #9F0046 #A10045 #A40043 #A60040 #A8003F #AA003E #AD003C #AF003A #B10039 #B30037 #B60035 #B80034 #BA0032 #BC0031 #BE002E #C1002D #C3002C #C5002A #C70028 #CA0027 #CB0025 #CE0024 #CF0023 #D10022 #D30020 #D6001E #D7001D #D9001B #DB001A #DD0019 #DF0017 #E10017 #E20015 #E40014 #E60012 #E70011 #E90010 #EA000F #EC000D #ED000C #EF000B #F1000B #F2000A #F40008 #F50007 #F60006 #F70005 #F90005 #F90003 #FB0003 #FC0002 #FD0001 #FE0001 #FF0000 #FF0100 #FF0200 #FF0300 #FF0500 #FF0600 #FF0600 #FF0800 #FF0900 #FF0B00 #FF0C00 #FF0D00 #FF0F00 #FF1000 #FF1200 #FF1400 #FF1500 #FF1700 #FF1900 #FF1A00 #FF1C00 #FF1D00 #FF2000 #FF2200 #FF2300 #FF2500 #FF2700 #FF2900 #FF2B00 #FF2D00 #FF2F00 #FF3100 #FF3400 #FF3500 #FF3700 #FF3900 #FF3C00 #FF3E00 #FF4000 #FF4200 #FF4400 #FF4700 #FF4900 #FF4B00 #FF4E00 #FF5000 #FF5200 #FF5500 #FF5700 #FF5900 #FF5C00 #FF5E00 #FF6100 #FF6300 #FF6600 #FF6800 #FF6A00 #FF6C00 #FF6F00 #FF7200 #FF7400 #FF7700 #FF7900 #FF7C00 #FF7E00 #FF8000 #FF8300 #FF8500 #FF8700 #FF8A00 #FF8D00 #FF8F00 #FF9200 #FF9500 #FF9700 #FF9900 #FF9B00 #FF9E00 #FFA000 #FFA300 #FFA500 #FFA700 #FFA900 #FFAC00 #FFAE00 #FFB100 #FFB200 #FFB600 #FFB700 #FFBA00 #FFBC00 #FFBE00 #FFC100 #FFC300 #FFC400 #FFC700 #FFC900 #FFCB00 #FFCD00 #FFCF00 #FFD100 #FFD300 #FFD500 #FFD700 #FFD900 #FFDB00 #FFDD00 #FFDE00 #FFE000 #FFE100 #FFE400 #FFE500 #FFE700 #FFE900 #FFEA00 #FFEB00 #FFED00 #FFEF00 #FFF000 #FFF100 #FFF300 #FFF400 #FFF500 #FFF600 #FFF800 #FFF900 #FFFA00 #FFFB00".split(" ");
class PlainAnalyzer extends Analyzer{constructor(a,b,c,d){super(a,b,d);this.sampleRate=c.sampleRate;this.analyzerL=a.createAnalyser();this.analyzerL.fftSize=1024;this.analyzerR=a.createAnalyser();this.analyzerR.fftSize=1024;this.visibleFrequencies=c.visibleFrequencies;a=cLib.HEAP8.buffer;this.dataPtr=this.ptr=b=cLib._allocBuffer(19456+cLib._fftSizeOff(2048));this.data=new Uint8Array(a,b,1024);this.tmpPtr=b+=1024;this.tmp=new Float32Array(a,b,2048);this.windowPtr=b+=8192;this.window=new Float32Array(a,
b,1024);this.multiplierPtr=b+=4096;this.multiplier=new Float32Array(a,b,512);this.prevLPtr=b+=2048;this.prevL=new Float32Array(a,b,512);this.prevRPtr=b+=2048;this.prevR=new Float32Array(a,b,512);this.fft4gfPtr=b+2048;cLib._fftInitf(this.fft4gfPtr,2048);d=this.window;a=this.multiplier;const e=Math.PI;b=Math.exp;const f=Math.cos;c=1/Math.LN10;for(let g=0;1024>g;g++)d[g]=4*(.54-.46*f(2*e*g/1023));for(d=0;512>d;d++)a[d]=145*c*b(2.5*d/511)}analyze(a){a=this.multiplier;const b=this.tmp,c=this.ctx,d=this.sampleRate/
2048,e=this.visibleFrequencies,f=Analyzer.colors;var g;let h,k,m,l;this.analyzerL.getByteTimeDomainData(this.data);cLib._plainAnalyzer(this.fft4gfPtr,this.windowPtr,this.dataPtr,this.tmpPtr);let n=this.prevL;c.lineWidth=1;c.fillStyle="#000000";c.fillRect(0,0,512,512);for(k=h=0;511>k&&1024>h&&d>e[k+1]-e[k];){for(g=d*h;1024>h&&g+d<e[k];)h++,g=d*h;g=(4*n[k]+a[k]*lerp(g,b[h],g+d,b[h+1],e[k]))/2.5>>1;255<g?g=255:0>g&&(g=0);n[k]=g;c.beginPath();c.strokeStyle=f[g];c.moveTo(k-.5,256.5-g);c.lineTo(k-.5,256.5);
c.stroke();k++}for(h++;1024>h&&512>k;){l=m=0;do m+=b[h],l++,h++,g=d*h;while(g<e[k]&&1024>h);g=(4*n[k]+a[k]*m/l)/2.5>>1;255<g?g=255:0>g&&(g=0);n[k]=g;c.beginPath();c.strokeStyle=f[g];c.moveTo(k-.5,256.5-g);c.lineTo(k-.5,256.5);c.stroke();k++}this.analyzerR.getByteTimeDomainData(this.data);cLib._plainAnalyzer(this.fft4gfPtr,this.windowPtr,this.dataPtr,this.tmpPtr);n=this.prevR;for(k=h=0;511>k&&1024>h&&d>e[k+1]-e[k];){for(g=d*h;1024>h&&g+d<e[k];)h++,g=d*h;g=(4*n[k]+a[k]*lerp(g,b[h],g+d,b[h+1],e[k]))/
2.5>>1;255<g?g=255:0>g&&(g=0);n[k]=g;c.beginPath();c.strokeStyle=f[g];c.moveTo(k-.5,256.5);c.lineTo(k-.5,256.5+g);c.stroke();k++}for(h++;1024>h&&512>k;){l=m=0;do m+=b[h],l++,h++,g=d*h;while(g<e[k]&&1024>h);g=(4*n[k]+a[k]*m/l)/2.5>>1;255<g?g=255:0>g&&(g=0);n[k]=g;c.beginPath();c.strokeStyle=f[g];c.moveTo(k-.5,256.5);c.lineTo(k-.5,256.5+g);c.stroke();k++}}cleanUp(){this.ptr&&cLib._freeBuffer(this.ptr)}}
class SoundParticlesAnalyzer extends Analyzer{constructor(a,b,c,d){super(a,b,d,!0,Analyzer.controlWidth,320);this.BG_COLUMNS=31;this.BG_PARTICLES_BY_COLUMN=16;this.BG_COUNT=this.BG_COLUMNS*this.BG_PARTICLES_BY_COLUMN;this.lastTime=0;this.analyzerL=a.createAnalyser();this.analyzerL.fftSize=1024;this.analyzerL.maxDecibels=-12;this.analyzerL.minDecibels=-45;this.analyzerL.smoothingTimeConstant=0;this.analyzerR=a.createAnalyser();this.analyzerR.fftSize=1024;this.analyzerR.maxDecibels=-12;this.analyzerR.minDecibels=
-45;this.analyzerR.smoothingTimeConstant=0;a=(f,g)=>{this.COLORS[3*f]=g};b=(f,g)=>{this.COLORS[3*f+1]=g};c=(f,g)=>{this.COLORS[3*f+2]=g};d=cLib.HEAP8.buffer;var e=cLib._allocBuffer(2240+8*this.BG_COUNT+8*this.BG_COUNT+this.BG_COUNT);this.processedDataPtr=this.ptr=e;this.processedData=new Uint8Array(d,e,512);this.processedDataRPtr=e+=512;this.processedDataR=new Uint8Array(d,e,512);this.fftPtr=e+=512;this.fft=new Float32Array(d,e,256);this.COLORSPtr=e+=1024;this.COLORS=new Float32Array(d,e,48);this.bgPosPtr=
e+=192;this.bgPos=new Float32Array(d,e,2*this.BG_COUNT);this.bgSpeedYPtr=e+=8*this.BG_COUNT;this.bgSpeedY=new Float32Array(d,e,this.BG_COUNT);this.bgThetaPtr=e+=4*this.BG_COUNT;this.bgTheta=new Float32Array(d,e,this.BG_COUNT);this.bgColorPtr=e+=4*this.BG_COUNT;this.bgColor=new Uint8Array(d,e,this.BG_COUNT);a(0,.75);b(0,0);c(0,0);a(1,0);b(1,.75);c(1,0);a(2,0);b(2,0);c(2,.75);a(3,.75);b(3,0);c(3,.75);a(4,.75);b(4,.75);c(4,0);a(5,0);b(5,.75);c(5,.75);a(6,.75);b(6,.75);c(6,.75);a(7,.75);b(7,.325);c(7,
0);a(8,.75);b(8,0);c(8,.325);a(9,.325);b(9,.75);c(9,0);a(10,0);b(10,.75);c(10,.325);a(11,0);b(11,.325);c(11,.75);a(12,.325);b(12,0);c(12,.75);a(13,0);b(13,0);c(13,.75);a(14,.75);b(14,.325);c(14,0);a(15,0);b(15,.325);c(15,.75);for(let f=0,g=0;f<this.BG_COLUMNS;f++)for(a=0;a<this.BG_PARTICLES_BY_COLUMN;a++,g++)this.fillBgParticle(g,-1.2+.01953125*(SoundParticlesAnalyzer.rand()&127));a=Program.create(this.canvas,{alpha:!1,depth:!1,stencil:!1,antialias:!1,premultipliedAlpha:!0},SoundParticlesAnalyzer.vertexShaderSource,
SoundParticlesAnalyzer.fragmentShaderSource);if(!a)throw this.err("Apparently your browser does not support WebGL"),Error();this.program=a;this.program.use();this.program.texColor(0);this.program.aspect(.625,1);a=this.program.gl;d=new Float32Array([-1,-1,0,1,1,-1,0,1,-1,1,0,1,1,1,0,1]);e=new Float32Array([0,1,1,1,0,0,1,0]);b=a.createBuffer();c=a.createBuffer();!a.getError()&&b&&c||this.err(-1);a.bindBuffer(a.ARRAY_BUFFER,b);a.bufferData(a.ARRAY_BUFFER,d,a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,
c);a.bufferData(a.ARRAY_BUFFER,e,a.STATIC_DRAW);a.clearColor(0,0,0,1);a.pixelStorei(a.UNPACK_ALIGNMENT,2);a.disable(a.DEPTH_TEST);a.disable(a.CULL_FACE);a.disable(a.DITHER);a.disable(a.SCISSOR_TEST);a.disable(a.STENCIL_TEST);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE);a.blendEquation(a.FUNC_ADD);a.getError();d=a.createTexture();!a.getError()&&d||this.err(-2);a.activeTexture(a.TEXTURE0);a.bindTexture(a.TEXTURE_2D,d);a.getError()&&this.err(-3);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);
a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);this.fillTexture();a.getError()&&this.err(-4);a.enableVertexAttribArray(0);a.bindBuffer(a.ARRAY_BUFFER,b);a.vertexAttribPointer(0,4,a.FLOAT,!1,0,0);a.enableVertexAttribArray(1);a.bindBuffer(a.ARRAY_BUFFER,c);a.vertexAttribPointer(1,2,a.FLOAT,!1,0,0)}static rand(){return 65536*Math.random()|0}err(a){this.destroy();
alert("Sorry! WebGL error :(\n"+a);throw a;}fillBgParticle(a,b){this.bgPos[a<<1]=.0078125*((SoundParticlesAnalyzer.rand()&7)-4);this.bgPos[(a<<1)+1]=b;this.bgTheta[a]=.03125*(SoundParticlesAnalyzer.rand()&63);this.bgSpeedY[a]=.125+.00390625*(SoundParticlesAnalyzer.rand()&15);this.bgColor[a]=SoundParticlesAnalyzer.rand()&15}fillTexture(){const a=this.program.gl,b=Math.sqrt,c=new Uint8Array(4096);for(let e=0;64>e;e++){let f=e-32;f*=f;for(let g=0;64>g;g++){var d=g-32;d=b(d*d+f)/30;1<d&&(d=1);let h=d;
d=1-d;d*=d;d+=.5*d;.55>d?d=0:1>d&&(d=smoothStep(.55,1,d));h=1-h;h=smoothStep(0,1,h);h*=h;h+=h;1<h&&(h=1);d+=.5*h;d=255*d|0;c[64*e+g]=255<=d?255:d}}a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,64,64,0,a.ALPHA,a.UNSIGNED_BYTE,c)}analyze(a){let b=a-this.lastTime;33<b&&(b=33);this.lastTime=a;a=this.program.gl;var c=.00390625*b,d=1-c;const e=this.processedData,f=this.processedDataR,g=this.fft,h=this.BG_COLUMNS,k=this.BG_PARTICLES_BY_COLUMN,m=this.COLORS,l=this.program,n=this.bgPos,q=this.bgSpeedY,p=this.bgColor,
r=this.bgTheta,t=Math.max;let u,y=44,x=116;b*=.001;this.analyzerL.getByteFrequencyData(e);this.analyzerR.getByteFrequencyData(f);for(u=0;256>u;u++){let v=t(e[u],f[u]);8>v&&(v=0);const w=g[u];v<w&&(v=c*v+d*w);g[u]=v;e[u]=255<=v?255:v}a.clear(a.COLOR_BUFFER_BIT);u=2;for(let v=0,w=0;v<h;v++){if(6>u)c=.00390625*e[u],u++;else if(20>u)c=.005859375*t(e[u],e[u+1]),u+=2;else if(36>u)c=.005859375*t(e[u],e[u+1],e[u+2],e[u+3]),u+=4;else if(100>u){for(c=0;u<y;u++)c=t(c,e[u]);c*=.0078125;y+=8}else{for(c=0;u<x;u++)c=
t(c,e[u]);c*=.009765625;x+=16}l.amplitude(1<=c?1:c);l.baseX(-.9+.06206897*v);for(c=0;c<k;c++,w++)1.2<n[(w<<1)+1]?this.fillBgParticle(w,-1.2):n[(w<<1)+1]+=q[w]*b,d=3*p[w],l.color(m[d],m[d+1],m[d+2]),d=w<<1,l.pos(n[d],n[d+1]),l.theta(r[w]),a.drawArrays(a.TRIANGLE_STRIP,0,4)}}cleanUp(){this.ptr&&cLib._freeBuffer(this.ptr);this.program&&this.program.destroy()}}SoundParticlesAnalyzer.vertexShaderSource="precision mediump float;\nattribute vec4 inPosition;\nattribute vec2 inTexCoord;\nuniform float amplitude;\nuniform float baseX;\nuniform vec2 pos;\nuniform vec2 aspect;\nuniform vec3 color;\nuniform float theta;\nvarying vec2 vTexCoord;\nvarying vec3 vColor;\n\nvoid main() {\n\tfloat a = mix(0.0625, 0.34375, amplitude);\n\tfloat bottom = 1.0 - clamp(pos.y, -1.0, 1.0);\n\tbottom = bottom * bottom * bottom * 0.125;\n\ta = (0.75 * a) + (0.25 * bottom);\n\tgl_Position = vec4(baseX + pos.x + (5.0 * (pos.y + 1.0) * pos.x * sin((2.0 * pos.y) + theta)) + (inPosition.x * aspect.x * a), pos.y + (inPosition.y * aspect.y * a), 0.0, 1.0);\n\tvTexCoord = inTexCoord;\n\tvColor = color + bottom + (0.25 * amplitude);\n}";
SoundParticlesAnalyzer.fragmentShaderSource="precision lowp float;\nuniform sampler2D texColor;\nvarying vec2 vTexCoord;\nvarying vec3 vColor;\n\nvoid main() {\n\tfloat a = texture2D(texColor, vTexCoord).a;\n\tgl_FragColor = vec4(vColor.rgb * a, 1.0);\n}";
class WaveletAnalyzer extends Analyzer{constructor(a,b,c,d){super(a,b,d);this.analyzerL=a.createAnalyser();this.analyzerL.fftSize=128;this.analyzerR=a.createAnalyser();this.analyzerR.fftSize=128;a=cLib.HEAP8.buffer;this.dataLPtr=this.ptr=b=cLib._allocBuffer(1536);this.dataL=new Uint8Array(a,b,128);this.dataRPtr=b+=128;this.dataR=new Uint8Array(a,b,128);this.tmpPtr=b+=128;this.tmp=new Float32Array(a,b,64);this.oL1Ptr=b+=256;this.oL1=new Float32Array(a,b,128);this.oR1Ptr=b+=512;this.oR1=new Float32Array(a,
b,128)}analyze(a){a=this.ctx;const b=Analyzer.colors,c=this.oL1,d=this.oR1;this.analyzerL.getByteTimeDomainData(this.dataL);this.analyzerR.getByteTimeDomainData(this.dataR);cLib._waveletAnalyzer(this.dataLPtr,this.dataRPtr,this.tmpPtr,this.oL1Ptr,this.oR1Ptr);let e,f,g=64,h=Analyzer.controlWidth/64,k,m=0,l=Analyzer.controlHeight-32;for(;;){e=g;for(k=0;512>k;)f=c[e],0>f&&(f=-f),f=127<=f?508:f<<2,a.fillStyle=b[f>>>1],a.fillRect(k,m,h,32),f=d[e],0>f&&(f=-f),f=127<=f?508:f<<2,a.fillStyle=b[f>>>1],a.fillRect(k,
l,h,32),e++,k+=h;h<<=1;m+=32;l-=32;if(!g)break;(g>>>=1)||(h=512)}}cleanUp(){this.ptr&&cLib._freeBuffer(this.ptr)}}function addAudioWorkletModule(a,b){return new Promise(function(c,d){try{const e=function(f,g){try{a.audioWorklet.addModule(f).then(c,d)}catch(h){d(h)}};location.href.startsWith("file://")?fetch(b).then(f=>{f.arrayBuffer().then(g=>{e(URL.createObjectURL(new Blob([g],{type:"text/javascript"})),!0)},d)},d):e(b,!1)}catch(e){d(e)}})}
class ConnectableNode{constructor(){this._enabled=!1;this.next=this.previous=null}get actualInput(){return this._enabled?this.input:this.next?this.next.actualInput:null}get actualOutput(){return this._enabled?this.output:this.previous?this.previous.actualOutput:null}nodesChanged(){const a=this.previous,b=this.next;a&&a.disconnectFromDestination();b&&this.disconnectFromDestination();a&&a.connectToDestination(this);b&&this.connectToDestination(b)}get enabled(){return this._enabled}set enabled(a){this._enabled!==
a&&(this._enabled=a,this.nodesChanged())}connectToDestination(a){this.disconnectFromDestination();if(this.next=a){a.previous=this;const b=this.actualOutput;b&&(a=a.actualInput)&&b.connect(a)}}disconnectFromDestination(){const a=this.actualOutput;a&&a.disconnect();this.next&&(this.next=this.next.previous=null)}}class DestinationNode extends ConnectableNode{constructor(a){super();this.node=a}get input(){return this.node}get output(){return null}}
class IntermediateNode extends ConnectableNode{constructor(a){super();this.node=a}get input(){return this.node}get output(){return this.node}}class SourceNode extends ConnectableNode{constructor(a){super();this.node=a}get input(){return null}get output(){return this.node}}var LibMikModMessageId;
(function(a){a[a.INIT=1]="INIT";a[a.LOAD_MODULE_BUFFER=2]="LOAD_MODULE_BUFFER";a[a.CHANGE_GENERAL_OPTIONS=3]="CHANGE_GENERAL_OPTIONS";a[a.STOP_MODULE=4]="STOP_MODULE";a[a.PLAYBACK_ERROR=5]="PLAYBACK_ERROR";a[a.PLAYBACK_ENDED=6]="PLAYBACK_ENDED"})(LibMikModMessageId||(LibMikModMessageId={}));
class LibMikMod{static isSupported(){return"AudioWorklet"in window&&"AudioWorkletNode"in window&&"WebAssembly"in window}static init(a,b){return __awaiter(this,void 0,void 0,function*(){if(!(LibMikMod.initialized||LibMikMod.initializing||LibMikMod.initializationError)){b?b.endsWith("/")||(b+="/"):b="";LibMikMod.initializing=!0;LibMikMod.currentId=0;try{const c=yield(yield fetch(b+"libmikmodclib.wasm?"+LibMikMod.WEB_VERSION)).arrayBuffer();yield a.audioWorklet.addModule(b+"libmikmodprocessor.min.js?"+
LibMikMod.WEB_VERSION);yield new Promise(function(d,e){const f=new AudioWorkletNode(a,"libmikmodprocessor");f.port.onmessage=function(g){(g=g.data)&&g.messageId===LibMikModMessageId.INIT&&LibMikMod.initializing&&!LibMikMod.currentId&&(g.errorStr?e(g.errorStr):(LibMikMod.LIB_VERSION=(g.id>>>16&255)+"."+(g.id>>>8&255)+"."+(g.id&255),d()))};f.onprocessorerror=function(g){e(g)};LibMikMod.audioNode=f;LibMikMod.postMessage({id:LibMikMod.currentId,messageId:LibMikModMessageId.INIT,buffer:c})});LibMikMod.initialized=
!0}finally{LibMikMod.initialized||(LibMikMod.initializationError=!0),LibMikMod.initializing=!1,LibMikMod.stopModule()}}})}static postMessage(a){LibMikMod.audioNode&&(a.buffer?LibMikMod.audioNode.port.postMessage(a,[a.buffer]):LibMikMod.audioNode.port.postMessage(a))}static loadModule(a){if(!LibMikMod.initialized)throw Error("Library not initialized");if(!a)throw Error("Null options");if(!a.audioContext)throw Error("Null audioContext");const b=a.source;if(!b)throw Error("Null source");LibMikMod.stopModule();
const c=new AudioWorkletNode(a.audioContext,"libmikmodprocessor");LibMikMod.currentId++;c.port.onmessage=LibMikMod.handleResponse;c.onprocessorerror=LibMikMod.notifyProcessorError;LibMikMod.audioNode=c;LibMikMod.infoSongName=null;LibMikMod.infoModType=null;LibMikMod.infoComment=null;LibMikMod.onload=a.onload;LibMikMod.onerror=a.onerror;LibMikMod.onended=a.onended;const d=LibMikMod.currentId,e={hqMixer:a.hqMixer,wrap:a.wrap,loop:a.loop,fadeout:a.fadeout,reverb:a.reverb,interpolation:a.interpolation,
noiseReduction:a.noiseReduction};if("lastModified"in b)if("arrayBuffer"in b)b.arrayBuffer().then(function(f){d===LibMikMod.currentId&&LibMikMod.postMessage({id:LibMikMod.currentId,messageId:LibMikModMessageId.LOAD_MODULE_BUFFER,buffer:f,options:e})},function(f){d===LibMikMod.currentId&&LibMikMod.notifyReaderError(f)});else{const f=new FileReader;f.onerror=function(g){d===LibMikMod.currentId&&LibMikMod.notifyReaderError(g)};f.onload=function(){d===LibMikMod.currentId&&(f.result?LibMikMod.postMessage({id:LibMikMod.currentId,
messageId:LibMikModMessageId.LOAD_MODULE_BUFFER,buffer:f.result,options:e}):LibMikMod.notifyReaderError("Empty reader result"))};f.readAsArrayBuffer(b)}else LibMikMod.postMessage({id:LibMikMod.currentId,messageId:LibMikModMessageId.LOAD_MODULE_BUFFER,buffer:b,options:e})}static changeGeneralOptions(a){if(!LibMikMod.initialized)throw Error("Library not initialized");LibMikMod.postMessage({id:LibMikMod.currentId,messageId:LibMikModMessageId.CHANGE_GENERAL_OPTIONS,options:a})}static cleanUp(){LibMikMod.currentId++;
LibMikMod.infoSongName=null;LibMikMod.infoModType=null;LibMikMod.infoComment=null;LibMikMod.audioNode=null;LibMikMod.onload=null;LibMikMod.onerror=null;LibMikMod.onended=null}static stopModule(){LibMikMod.audioNode&&(LibMikMod.postMessage({id:LibMikMod.currentId,messageId:LibMikModMessageId.STOP_MODULE}),LibMikMod.cleanUp())}static notifyReaderError(a){LibMikMod.notifyError(LibMikMod.ERROR_FILE_READ,a)}static notifyProcessorError(a){LibMikMod.notifyError(LibMikMod.ERROR_PLAYBACK,a)}static notifyError(a,
b){if(LibMikMod.audioNode){var c=LibMikMod.onerror;LibMikMod.cleanUp();c&&c(a,b)}}static notifyEnded(){if(LibMikMod.audioNode){var a=LibMikMod.onended;LibMikMod.cleanUp();a&&a()}}static handleResponse(a){var b;if(a=a.data)switch(a.messageId){case LibMikModMessageId.LOAD_MODULE_BUFFER:if(a.id!==LibMikMod.currentId||!LibMikMod.audioNode)break;if(a.errorCode)LibMikMod.notifyError(LibMikMod.ERROR_MODULE_LOAD,a.errorStr||a.errorCode.toString());else if(LibMikMod.infoSongName=a.infoSongName||null,LibMikMod.infoModType=
a.infoModType||null,LibMikMod.infoComment=a.infoComment||null,LibMikMod.onload)LibMikMod.onload(LibMikMod.audioNode);break;case LibMikModMessageId.PLAYBACK_ERROR:if(a.id!==LibMikMod.currentId)break;LibMikMod.notifyProcessorError(a.errorStr||(null===(b=a.errorCode)||void 0===b?void 0:b.toString()));break;case LibMikModMessageId.PLAYBACK_ENDED:a.id===LibMikMod.currentId&&LibMikMod.notifyEnded()}}}LibMikMod.WEB_VERSION=1;LibMikMod.LIB_VERSION=null;LibMikMod.ERROR_FILE_READ=1;
LibMikMod.ERROR_MODULE_LOAD=2;LibMikMod.ERROR_PLAYBACK=3;LibMikMod.initialized=!1;LibMikMod.initializing=!1;LibMikMod.initializationError=!1;LibMikMod.infoSongName=null;LibMikMod.infoModType=null;LibMikMod.infoComment=null;LibMikMod.currentId=0;LibMikMod.audioNode=null;LibMikMod.onload=null;LibMikMod.onerror=null;LibMikMod.onended=null;
class HistoryHandler{static init(...a){HistoryHandler.handlers=a||[];window.addEventListener("popstate",HistoryHandler.historyStatePopped)}static historyStatePopped(a){if(HistoryHandler.poppedInternally)HistoryHandler.poppedInternally=!1;else if(a=HistoryHandler.handlers)for(let b=0;b<a.length;b++){const c=a[b]();if(null!==c){c||HistoryHandler.pushState();break}}}static pushState(){window.history.pushState(HistoryHandler.state,Strings.AppName)}static popState(){window.history.state&&window.history.state.id===
Strings.AppName&&(HistoryHandler.poppedInternally=!0,window.history.back())}}HistoryHandler.state={id:Strings.AppName};HistoryHandler.poppedInternally=!1;
class FocusBlocker{constructor(){this.cover=this.parentContainer=this.oldBodyOverflow=this.changedElements=null;this.coverTimeout=0}block(a){this.unblock();const b=(a||document).querySelectorAll("button,input,select,textarea,.btn,.slider-control,.list"),c=[];for(let d=b.length-1;0<=d;d--){const e=b[d],f=e.getAttribute("tabindex");"-1"!==f&&(e.setAttribute("tabindex","-1"),c.push({element:e,tabindex:f}))}this.changedElements=c;a?(this.parentContainer=a,this.cover=document.createElement("div"),this.cover.className=
"blocker fade",a.appendChild(this.cover),this.coverTimeout=DelayControl.delayShortCB(()=>{this.coverTimeout&&this.cover&&this.cover.classList.add("in")})):(this.oldBodyOverflow=document.body.style.overflow,document.body.style.overflow="hidden")}unblock(){const a=this.changedElements;if(a){this.changedElements=null;for(let b=a.length-1;0<=b;b--){const c=a[b],d=c.tabindex;d?c.element.setAttribute("tabindex",d):c.element.removeAttribute("tabindex")}}this.oldBodyOverflow&&(document.body.style.overflow=
this.oldBodyOverflow,this.oldBodyOverflow=null);this.coverTimeout&&(clearTimeout(this.coverTimeout),this.coverTimeout=0);if(this.parentContainer){const b=this.parentContainer,c=this.cover;this.cover=this.parentContainer=null;c&&(c.classList.remove("in"),DelayControl.delayFadeCB(function(){b.removeChild(c)}))}}}
class Alert{static removeElement(){Alert.element&&parseInt(Alert.element.getAttribute("data-timeout"))===Alert.timeout&&(document.body.removeChild(Alert.element),Alert.timeout=0,Alert.element=null)}static hideByTimeout(){Alert.element&&parseInt(Alert.element.getAttribute("data-timeout"))===Alert.timeout&&(Alert.timeout=0,Alert.hide())}static hide(){Alert.element&&Alert.element.classList.contains("in")&&(Alert.timeout&&clearTimeout(Alert.timeout),Alert.element.classList.remove("in"),Alert.timeout=
DelayControl.delayFadeCB(Alert.removeElement),Alert.element.setAttribute("data-timeout",Alert.timeout.toString()))}static show(a,b){Alert.timeout&&(clearTimeout(Alert.timeout),Alert.timeout=0);Alert.element?(Strings.changeText(Alert.element,a),Alert.element.classList.add("in"),Alert.timeout=setTimeout(Alert.hideByTimeout,DelayControl.fadeDelayMS+(b?Alert.longDelayMS:Alert.shortDelayMS)),Alert.element.setAttribute("data-timeout",Alert.timeout.toString())):(Alert.element=document.createElement("div"),
Alert.element.setAttribute("role","alert"),Alert.element.className="alert fade",Alert.element.onclick=Alert.hide,document.body.appendChild(Alert.element),DelayControl.delayShortCB(function(){Alert.show(a,b)}))}}Alert.shortDelayMS=2500;Alert.longDelayMS=4500;Alert.timeout=0;Alert.element=null;
class ButtonControl{static init(){const a=document.getElementsByTagName("button");if(a)for(let b=a.length-1;0<=b;b--)ButtonControl.prepare(a[b])}static create(a,b){const c=document.createElement("button");c.setAttribute("type","button");a.id&&c.setAttribute("id",a.id);!1===a.keyboardFocusable&&c.setAttribute("tabindex","-1");let d="btn";a.color&&(d+=" "+a.color);a.square&&(d+=" square");a.opaque||(d+=" transparent");a.className&&(d+=" "+a.className);c.className=d;const e=document.createElement("span"),
f=a.text||(a.stringKey?Strings.translate(a.stringKey):"");e.setAttribute("tabindex","-1");e.setAttribute("aria-hidden","true");a.icon&&(d="large",!a.square&&f&&(d+=" margin"),!a.opaque&&a.color&&(d+=" "+a.color),e.appendChild(Icon.create(a.icon,d)));c.setAttribute("aria-label",f);a.square?c.setAttribute("title",f):e.appendChild(document.createTextNode(f));b||(a.onclick&&(c.onclick=a.onclick),a.parent&&a.parent.appendChild(c));c.appendChild(e);return c}static prepare(a){const b=document.createElement("span");
b.setAttribute("tabindex","-1");for(b.setAttribute("aria-hidden","true");a.firstChild;){const c=a.firstChild;a.removeChild(c);b.appendChild(c)}a.appendChild(b);a.setAttribute("aria-label",a.classList.contains("square")?a.getAttribute("title"):a.textContent);return b}static setText(a,b){a.setAttribute("aria-label",b);let c=a.firstChild;if(!c||"SPAN"!==c.tagName)if(c=a.querySelector("span"),!c)return;a=c.lastChild;!a||a.tagName?c.appendChild(document.createTextNode(b)):a.nodeValue=b}static getDefaultFocusElement(a){return a.getElementsByTagName("span")[0]||
a}}
class CheckboxControl{static init(){const a=document.querySelectorAll("input[type=checkbox]");if(a)for(let b=a.length-1;0<=b;b--)CheckboxControl.prepare(a[b],!0)}static isChecked(a){return(a=a.childInput)?a.checked:!1}static setChecked(a,b){const c=a.childInput;c&&(c.checked=!!b,a.setAttribute("aria-pressed",b?"true":"false"))}static create(a){var b=document.createElement("input");b.setAttribute("type","checkbox");b.setAttribute("value",a.stringKey);a.square&&b.setAttribute("data-square","1");a.id&&
b.setAttribute("id",a.id);let c="btn";a.color&&(c+=" "+a.color);a.square&&(c+=" square");a.opaque||(c+=" transparent");a.className&&(c+=" "+a.className);b.className=c;b=CheckboxControl.prepare(b,a.keyboardFocusable,a.icon,a.iconColor,a.checkbox0Color,a.checkbox1Color);!1===a.keyboardFocusable&&b.setAttribute("tabindex","-1");a.parent&&a.parent.appendChild(b);return b}static prepare(a,b,c,d,e,f){const g=document.createElement("label"),h=document.createElement("span"),k=a.parentNode,m=c?null:a.getAttribute("data-square"),
l=Strings.translate(a.getAttribute("title")||a.value);let n=a.getAttribute("id");n||(n="checkBoxControl"+CheckboxControl.internalId++,a.setAttribute("id",n));g.setAttribute("aria-label",l);g.setAttribute("aria-pressed",a.checked?"true":"false");g.setAttribute("role","button");g.setAttribute("for",n);g.setAttribute("tabindex","0");h.setAttribute("tabindex","-1");h.setAttribute("aria-hidden","true");a.setAttribute("tabindex","-1");a.setAttribute("aria-hidden","true");g.className=a.className;a.className=
"";c||(c=a.getAttribute("data-icon"));c&&!d&&(d=a.getAttribute("data-icon-color"));e||(e=a.getAttribute("data-checkbox0-color"));f||(f=a.getAttribute("data-checkbox1-color"))||(f="orange");k&&(k.insertBefore(g,a),k.removeChild(a));g.appendChild(h);h.appendChild(a);h.appendChild(Icon.createLarge("icon-checkbox-0",(m?"":"margin")+(e?" "+e:"")));h.appendChild(Icon.createLarge("icon-checkbox-1",m?f:"margin "+f));c&&h.appendChild(Icon.createLarge(c,d?"margin "+d:"margin"));m||h.appendChild(document.createTextNode(l));
a.removeAttribute("value");a.removeAttribute("title");g.childInput=a;g.addEventListener("click",CheckboxControl.buttonClick);b&&g.addEventListener("keydown",CheckboxControl.buttonKeyDown);return g}static buttonClick(a){(a=this.childInput)&&this.setAttribute("aria-pressed",a.checked?"true":"false")}static buttonKeyDown(a){if(!(a.ctrlKey||a.metaKey||a.shiftKey||a.altKey||a.repeat||"Enter"!==a.key&&" "!==a.key)){this.click();try{this.focus()}catch(b){}}}}CheckboxControl.internalId=0;
class SimpleFilterEditorControl{constructor(a,b){this.element=a;this.editor=b;a.classList.add("simple-filter");b=Array(GraphicalFilterEditor.shelfEquivalentZoneCount);const c=function(d){return Formatter.formatDB(.5*d)};this.sliders=b;for(let d=0;d<b.length;d++){const e=document.createElement("span"),f=document.createElement("span"),g=document.createElement("span"),h=this.filterToSlider(d);let k;f.className="simple-filter-freq small-bottom-margin";switch(d){case 0:f.innerHTML="31<br/>62";k="31 / 62 Hz";
break;case 1:f.innerHTML="<br/>125";k="125 Hz";break;case 2:f.innerHTML="<br/>250";k="250 Hz";break;case 3:f.innerHTML="500<br/>1k";k="500 / 1000 Hz";break;case 4:f.innerHTML="2k<br/>4k";k="2000 / 4000 Hz";break;case 5:f.innerHTML="<br/>8k";k="8000 Hz";break;default:f.innerHTML="<br/>16k",k="16000 Hz"}g.className="small-top-margin";e.className="simple-filter-slider"+(!d||AppUI.primaryInputIsTouch?"":" left-margin");a.appendChild(e);b[d]=new SliderControl(e,k,c,SliderControlValueChild.LeftChild,!0,
!0,-30,30,h,g,f);this.createHandler(b[d],d)}}static sliderToY(a){return GraphicalFilterEditor.zeroChannelValueY-(a<<1)}static yToSlider(a){return Math.max(-30,Math.min(30,-(a-GraphicalFilterEditor.zeroChannelValueY)>>1))}filterToSlider(a){return SimpleFilterEditorControl.yToSlider(this.editor.getShelfZoneY(a))}createHandler(a,b){const c=this.editor,d=function(e){c.changeShelfZoneY(b,SimpleFilterEditorControl.sliderToY(e));c.commitChanges()};a.ondragend=d;a.onkeyboardchange=d}updateSliders(){const a=
this.sliders;for(let b=0;b<a.length;b++)a[b].value=this.filterToSlider(b)}}
class ListControlItem{constructor(a){this.index=-1;this.keyboard=this.current=this.selected=!1;this.item=null;this.element=a;a.setAttribute("id","listControlItem"+ListControlItem.internalId++);a.setAttribute("role","row");a.setAttribute("aria-selected","false");a.setAttribute("aria-readonly","true")}reset(){this.index=-1;this.keyboard=this.current=this.selected=!1;this.item=null;this.element&&(this.element.classList.remove("current","selected","keyboard"),this.element.setAttribute("aria-selected",
"false"))}zero(){this.index=-1;this.keyboard=this.current=this.selected=!1;this.element=this.item=null}}ListControlItem.internalId=0;
class ListControl{constructor(a,b,c){this.element="string"===typeof a?document.getElementById(a):a;this.element.classList.add("list","scrollable");this.element.style.padding="0";this.element.setAttribute("role","grid");this.element.setAttribute("aria-label",b);this.element.setAttribute("aria-readonly","true");this.element.setAttribute("aria-rowcount","0");this.element.removeAttribute("aria-activedescendant");this.element.getAttribute("tabindex")||this.element.setAttribute("tabindex","0");this.useVirtualItems=
c;a=document.createElement("div");a.className="list-container";this.container=a;c&&this.element.appendChild(a);this._adapter=null;this.boundZoomChanged=this.zoomChanged.bind(this);this.boundRefreshVisibleItemsInternal=this.refreshVisibleItemsInternal.bind(this);this.boundAdjustScrollbarPaddingFromResize=this.adjustScrollbarPaddingFromResize.bind(this);this.element.addEventListener("focus",this.elementFocus.bind(this));this.element.addEventListener("keydown",this.elementKeyDown.bind(this));this.element.addEventListener("keyup",
this.elementKeyUp.bind(this));this.element.addEventListener("blur",this.elementBlur.bind(this));c?this.element.addEventListener("scroll",this.elementScroll.bind(this),{passive:!0}):this.boundNotifyCurrentItemChangedInternal=this.notifyCurrentItemChangedInternal.bind(this);this.resizeObserver=new ResizeObserver(this.resize.bind(this));this.resizeObserver.observe(this.element,{box:"border-box"});this.itemMargin=this.itemHeight=1;this.itemHeightAndMargin=2;this.ignoreFirstIndex=!1;this.lastIndex=this.firstIndex=
0;this.keyboardItem=this.currentItem=this.currentListItem=null;this.clientHeight=1;this.containerHeight=0;this.scrollbarPaddingScheduled=this.scrollbarPadding=!1;this.visibleCount=1;this.items=[];this.focused=this.notifyCurrentItemChangedEnqueued=this.refreshVisibleItemsEnqueued=!1;this.lastKeyboardIndex=this.keyboardIndex=-1;this.deleteMode=!1;this.onitemcontextmenu=this.onitemcontrolclick=this.onitemclick=null;this.element.onclick=this.elementClick.bind(this);this.element.oncontextmenu=this.elementContextMenu.bind(this);
this.resize();AppUI.addZoomHandler(this.boundZoomChanged)}destroy(){this._adapter&&(this._adapter.control=null);this.resizeObserver&&this.resizeObserver.unobserve(this.element);this.items&&this.items.fill(null);this.boundZoomChanged&&AppUI.removeZoomHandler(this.boundZoomChanged);zeroObject(this)}get adapter(){return this._adapter}set adapter(a){this._adapter!==a&&(this._adapter&&(this._adapter.control=null),this._adapter=a,this.clear(),a&&(a.control=this,this.prepareAdapter(),this.useVirtualItems?
this.element.setAttribute("aria-rowcount",a.list.length.toString()):a.list.length&&this.notifyItemsAdded(0,a.list.length-1)))}prepareAdapter(){const a=this._adapter;a&&(this.itemHeight=a.itemHeight,this.itemMargin=AppUI.thickBorderPX,this.itemHeightAndMargin=this.itemHeight+this.itemMargin,this.currentListItem=a.list.currentItem,this.adjustContainerHeight(),this.resize())}zoomChanged(){if(this._adapter){this.prepareAdapter();var a=this.items;for(let b=a.length-1;0<=b;b--)a[b].index=-1;this.useVirtualItems&&
this.elementScroll()}}adjustScrollbarPadding(){const a=(this.containerHeight|0)>this.clientHeight;if(this.scrollbarPadding!==a){this.scrollbarPadding=a;const b=this.element;this.useVirtualItems?a?b.classList.add("virtual-padding"):b.classList.remove("virtual-padding"):b.style.padding=a?"":"0"}}adjustScrollbarPaddingFromResize(){this.scrollbarPaddingScheduled=!1;this.adjustScrollbarPadding()}adjustContainerHeight(){var a=this._adapter;const b=this.container;a&&b&&(a=(a=a.list.length)?a*this.itemHeightAndMargin-
this.itemMargin:0,this.containerHeight!==a&&(this.containerHeight=a,b.style.height=a+"px",this.adjustScrollbarPadding()))}clear(){if(this.container){var a=this.items;for(var b=a.length-1;0<=b;b--)if(a[b].element){const c=a[b].element.parentNode;c&&c.removeChild(a[b].element)}if(this.useVirtualItems)for(b=a.length-1;0<=b;b--)a[b].reset();else{for(b=a.length-1;0<=b;b--)a[b].zero();a.splice(0)}this.lastIndex=this.firstIndex=0;this.keyboardItem=this.currentItem=this.currentListItem=null;this.containerHeight=
this.element.scrollTop=0;this.container.style.height="0";this.lastKeyboardIndex=0<this.keyboardIndex?this.keyboardIndex=0:-1;this.element.setAttribute("aria-rowcount","0");this.element.removeAttribute("aria-activedescendant");this.adjustScrollbarPadding()}}elementScroll(){var a=this._adapter;const b=this.element;if(a&&b){var c=this.items,d=this.itemHeightAndMargin,e=this.firstIndex-2,f=b.scrollTop/d|0;0>e&&(e=0);if(this.ignoreFirstIndex)this.ignoreFirstIndex=!1;else if(this.firstIndex===f)return;
this.firstIndex=f;var g=this.visibleCount+(0===f?2:1===f?3:4);g>c.length&&(g=c.length);0>(f-=2)&&(f=0);if(f>e){if((e=f-e)&&e<g)for(let n=e,q=0;n<g;n++,q++)e=c[q],c[q]=c[n],c[n]=e}else if((e-=f)&&e<g)for(let n=g-1,q=n-e;0<=q;q--,n--)e=c[n],c[n]=c[q],c[q]=e;var h=a.list,k=h.length,m=a.list.currentItem,l=this.keyboardIndex;e=0;for(let n=f*d;e<g&&f<k;e++,f++,n+=d){const q=h.item(f),p=c[e];if(p.item!==q){let r=m===q;p.current!==r&&((p.current=r)?p.element.classList.add("current"):p.element.classList.remove("current"));
r=l===f;p.keyboard!==r&&((p.keyboard=r)?(p.element.classList.add("keyboard"),p.element.setAttribute("aria-selected","true"),this.element.setAttribute("aria-activedescendant",p.element.getAttribute("id"))):(this.element.getAttribute("aria-activedescendant")===p.element.getAttribute("id")&&this.element.removeAttribute("aria-activedescendant"),p.element.classList.remove("keyboard"),p.element.setAttribute("aria-selected","false")));a.prepareElement(q,f,k,p.element);p.element.setAttribute("aria-rowindex",
f.toString());p.item||b.appendChild(p.element);p.item=q}p.index!==f&&(p.index=f,p.element.style.transform="translateY("+n+"px)")}for(a=c.length;e<a;e++)d=c[e],d.item&&(d.item=null,b.removeChild(d.element));this.lastIndex=f-1;this.lastIndex<this.firstIndex&&(this.lastIndex=this.firstIndex)}}refreshVisibleItemsInternal(){this.refreshVisibleItemsEnqueued=!1;var a=this._adapter,b=this.element;if(a&&b){this.adjustContainerHeight();var c=this.items,d=this.itemHeightAndMargin,e=a.list,f=e.length,g=a.list.currentItem,
h=this.keyboardIndex;if(this.useVirtualItems){this.currentListItem=g;var k=0,m=this.firstIndex,l=this.visibleCount+(0===m?2:1===m?3:4);l>c.length&&(l=c.length);0>(m-=2)&&(m=0);for(let n=m*d;k<l&&m<f;k++,m++,n+=d){const q=e.item(m),p=c[k];let r=g===q;p.current!==r&&((p.current=r)?p.element.classList.add("current"):p.element.classList.remove("current"));r=h===m;p.keyboard!==r&&((p.keyboard=r)?(p.element.classList.add("keyboard"),p.element.setAttribute("aria-selected","true"),this.element.setAttribute("aria-activedescendant",
p.element.getAttribute("id"))):(this.element.getAttribute("aria-activedescendant")===p.element.getAttribute("id")&&this.element.removeAttribute("aria-activedescendant"),p.element.classList.remove("keyboard"),p.element.setAttribute("aria-selected","false")));a.prepareElement(q,m,f,p.element);p.element.setAttribute("aria-rowindex",m.toString());p.item||b.appendChild(p.element);p.item=q;p.index!==m&&(p.index=m,p.element.style.transform="translateY("+n+"px)")}for(a=c.length;k<a;k++)e=c[k],e.item&&(e.item=
null,b.removeChild(e.element))}else{b=this.visibleCount;k=0<=h&&h<c.length?c[h]:null;this.keyboardItem!==k&&(this.keyboardItem&&(this.keyboardItem.element.classList.remove("keyboard"),this.keyboardItem.element.setAttribute("aria-selected","false")),k?(k.element.classList.add("keyboard"),k.element.setAttribute("aria-selected","true"),this.element.setAttribute("aria-activedescendant",k.element.getAttribute("id"))):this.element.removeAttribute("aria-activedescendant"),this.keyboardItem=k);for(let n=
0,q=this.indexFromY(0);n<=b&&q<f;n++,q++)k=c[q].element,a.prepareElement(e.item(q),q,f,k),k.setAttribute("aria-rowindex",q.toString())}}}resize(){const a=this._adapter;var b=this.element;if(a&&b){var c=this.clientHeight;b=b.clientHeight;0>b&&(b=0);var d=Math.ceil(b/this.itemHeightAndMargin)+1;if(this.visibleCount!==d&&(this.visibleCount=d,this.useVirtualItems)){const e=this.items;for(;d+4>e.length;)e.push(new ListControlItem(a.createEmptyElement("list-item virtual")))}c!==b&&(this.clientHeight=b,
this.useVirtualItems&&(this.ignoreFirstIndex=!0,this.elementScroll()),this.scrollbarPaddingScheduled||(this.scrollbarPaddingScheduled=!0,requestAnimationFrame(this.boundAdjustScrollbarPaddingFromResize)))}}elementClick(a){if(this.element&&this._adapter&&a.target){var b=this.element.getBoundingClientRect();b=this.indexFromY(a.clientY-b.top);0<=this.keyboardIndex&&(this.keyboardIndex=-1,this.refreshVisibleItems());if(0<=b){this.lastKeyboardIndex=b;const c=this._adapter.list.item(b);if(c)if(a.target.classList.contains("list-item"))if(this.deleteMode)this._adapter.list.removeItems(b,
b);else{if(this.onitemclick)this.onitemclick(c,b,a.button)}else if(this.onitemcontrolclick)this.onitemcontrolclick(c,b,a.button,a.target)}}}elementContextMenu(a){if(!(this.element&&this._adapter&&this.onitemcontextmenu&&a.target))return cancelEvent(a);var b=this.element.getBoundingClientRect();b=this.indexFromY(a.clientY-b.top);0<=this.keyboardIndex&&(this.keyboardIndex=-1,this.refreshVisibleItems());if(0<=b){this.lastKeyboardIndex=b;const c=this._adapter.list.item(b);if(c)this.onitemcontextmenu(c,
b)}return cancelEvent(a)}elementFocus(){this.focused=!0}elementKeyDown(a){var b=this._adapter;if(!(!b||a.ctrlKey||a.metaKey||a.shiftKey||a.altKey)){var c=0,d=0;switch(a.key){case "ArrowDown":case "ArrowRight":c=1;break;case "ArrowUp":case "ArrowLeft":c=-1;break;case "PageDown":c=this.clientHeight/this.itemHeightAndMargin|0;break;case "PageUp":c=-(this.clientHeight/this.itemHeightAndMargin|0);break;case "Home":d=-1;break;case "End":d=1;break;case "Enter":a.repeat||(d=2);break;case " ":a.repeat||(d=
3);break;default:return}var e=b.list.length;if(0<e){let f=this.keyboardIndex;0>f&&(f=this.lastKeyboardIndex);this.isItemVisible(f)||(f=this.isItemVisible(b.list.currentIndex)?b.list.currentIndex:this.indexFromY(0));f=Math.min(e-1,Math.max(0,f));if(-1===d)f=0;else if(1===d)f=e-1;else{const g=f;f+=c;0>f?f=g?0:e-1:f>=e&&(f=g===e-1?0:e-1)}this.keyboardIndex=f;this.bringItemIntoView(f);this.refreshVisibleItems();if(1<d&&(c=b.list.item(f)))switch(d){case 2:if(this.deleteMode)b.list.removeItems(f,f);else if(this.onitemclick)this.onitemclick(c,
f,0);break;case 3:if(this.deleteMode)b.list.removeItems(f,f);else if(this.onitemcontrolclick&&(b=this.listControlItemFromIndex(f)))this.onitemcontrolclick(c,f,0,b.element)}}else this.keyboardIndex=-1;return cancelEvent(a)}}elementKeyUp(a){const b=this._adapter;b&&!a.ctrlKey&&!a.metaKey&&!a.altKey&&"Tab"===a.key&&this.focused&&(a=b.list.length)&&(a=Math.min(a-1,Math.max(0,this.lastKeyboardIndex)),this.isItemVisible(a)||(a=this.isItemVisible(b.list.currentIndex)?b.list.currentIndex:this.indexFromY(0)),
this.keyboardIndex=a,this.bringItemIntoView(a),this.refreshVisibleItems())}elementBlur(){this.focused=!1;this.lastKeyboardIndex=this.keyboardIndex;0<=this.keyboardIndex&&(this.keyboardIndex=-1,this.refreshVisibleItems())}listControlItemFromIndex(a){if(!this.items)return null;const b=this.items;for(let c=b.length-1;0<=c;c--)if(b[c].index===a&&b[c].item&&b[c].element)return b[c];return null}yFromIndex(a){return this.element?a*this.itemHeightAndMargin-this.element.scrollTop:0}indexFromY(a){if(!this.element||
!this._adapter)return-1;a=(a+this.element.scrollTop+.9)/this.itemHeightAndMargin|0;return 0>a||a>=this._adapter.list.length?-1:a}isItemVisible(a){a=this.yFromIndex(a);return a>-this.itemHeight&&a<this.clientHeight}bringItemIntoView(a,b){const c=this.yFromIndex(a);0>c?b?this.centerItemIntoView(a):this.element.scrollTop+=c:c>this.clientHeight-this.itemHeight&&(b?this.centerItemIntoView(a):this.element.scrollTop+=c-(this.clientHeight-this.itemHeight))}centerItemIntoView(a){this.element.scrollTop=a*this.itemHeightAndMargin-
(this.clientHeight-this.itemHeight>>1)}refreshVisibleItems(){this.refreshVisibleItemsEnqueued||(this.refreshVisibleItemsEnqueued=!0,queueMicrotask(this.boundRefreshVisibleItemsInternal))}notifyCleared(){this.clear()}notifyItemsAdded(a,b){if(this.useVirtualItems)this.refreshVisibleItems();else{const g=this._adapter;var c=b-a+1,d=this.element;if(!g||0>=c||!d)return;const h=this.items,k=g.list,m=k.length;var e=k.currentItem;const l=Array(c);for(var f=b;f>=a;f--){const n=k.item(f),q=new ListControlItem(g.createEmptyElement("list-item real"));
g.prepareElement(n,f,m,q.element);q.element.setAttribute("aria-rowindex",f.toString());l[f-a]=q;e===n&&(this.currentItem&&(this.currentItem.current=!1,this.currentItem.element.classList.remove("current")),this.currentItem=q,q.current=!0,q.element.classList.add("current"))}e=a>=h.length?null:h[a].element;a>=h.length?h.push(...l):h.splice(a,0,...l);if(this.items.length!==k.length)throw Error("Assertion error: this.items.length !== list.length");this.adjustContainerHeight();for(f=0;f<c;f++)d.insertBefore(l[f].element,
e);for(c=h.length-1;c>b;c--)d=h[c].element,g.prepareElementIndexOrLengthChanged(k.item(c),c,m,d),d.setAttribute("aria-rowindex",c.toString());for(--a;0<=a;a--)b=h[a].element,g.prepareElementIndexOrLengthChanged(k.item(a),a,m,b),b.setAttribute("aria-rowindex",a.toString())}this.element&&this._adapter&&this.element.setAttribute("aria-rowcount",this._adapter.list.length.toString())}notifyItemsRemoved(a,b){if(this.useVirtualItems)this.refreshVisibleItems();else{const e=this._adapter;var c=b-a+1,d=this.element;
if(!e||0>=c||!d)return;b=this.items;const f=e.list,g=f.length;a=b.splice(a,c);for(c=a.length-1;0<=c;c--){const h=a[c];h.current&&(this.currentItem=null);d.removeChild(h.element);h.zero()}if(this.items.length!==f.length)throw Error("Assertion error: this.items.length !== list.length");for(d=b.length-1;0<=d;d--)a=b[d].element,e.prepareElementIndexOrLengthChanged(f.item(d),d,g,a),a.setAttribute("aria-rowindex",d.toString());this.adjustContainerHeight()}this.element&&this._adapter&&this.element.setAttribute("aria-rowcount",
this._adapter.list.length.toString())}notifyCurrentItemChanged(a,b){this.useVirtualItems?this.refreshVisibleItems():this.notifyCurrentItemChangedEnqueued||(this.notifyCurrentItemChangedEnqueued=!0,queueMicrotask(this.boundNotifyCurrentItemChangedInternal))}notifyCurrentItemChangedInternal(){this.notifyCurrentItemChangedEnqueued=!1;var a=this._adapter;a&&(this.currentItem&&(this.currentItem.current=!1,this.currentItem.element.classList.remove("current")),a=a.list.currentIndex,0<=a&&a<this.items.length?
(this.currentItem=this.items[a],this.currentItem.current=!0,this.currentItem.element.classList.add("current")):this.currentItem=null)}}var SliderControlValueChild;(function(a){a[a.None=0]="None";a[a.LeftChild=1]="LeftChild";a[a.RightChild=2]="RightChild"})(SliderControlValueChild||(SliderControlValueChild={}));
class SliderControl{constructor(a,b,c,d,e,f,g,h,k,m,l,n){this.element="string"===typeof a?document.getElementById(a):a;this.element.classList.add("slider-control");f&&this.element.classList.add("vertical");this.element.setAttribute("role","slider");this.element.setAttribute("aria-label",b);this.element.setAttribute("aria-orientation",f?"vertical":"horizontal");e&&this.element.setAttribute("tabindex","0");this.mapper=c;this.valueChild=d;this.keyboardFocusable=e;this.vertical=f;this.manualAria=!!n;
a=f?" vertical":"";b=document.createElement("span");b.className="slider-control-focus-container"+a;b.setAttribute("tabindex","-1");b.setAttribute("aria-hidden","true");this.focusContainer=b;this.onkeyboardchange=this.ondragend=this.onvaluechange=null;c=document.createElement("span");c.className="slider-control-container"+a;b.appendChild(c);this.container=c;d=document.createElement("span");d.className="slider-control-inner-container"+a;c.appendChild(d);this.innerContainer=d;f=document.createElement("span");
f.className="slider-control-ruler"+a;d.appendChild(f);this.ruler=f;f=document.createElement("span");f.className="slider-control-color slider-control-filled-ruler"+a;d.appendChild(f);this.filledRuler=f;f=document.createElement("span");f.className="slider-control-color slider-control-thumb"+a;d.appendChild(f);this.thumb=f;this.element.appendChild(b);g>h?(this._min=h|0,this._max=g|0):(this._min=g|0,this._max=h|0);this.delta=this._max-this._min;this.delta||(this.delta=1);this._disabled=!1;this._value=
g-1;this.percent=0;this.valueChangedDragging=this.forcedDragging=!1;this.value=void 0===k?g:k;this.pointerHandler=new PointerHandler(c,this.mouseDown.bind(this),this.mouseMove.bind(this),this.mouseUp.bind(this));this.element.setAttribute("aria-valuemin",g.toString());this.element.setAttribute("aria-valuemax",h.toString());e&&(this.element.addEventListener("keydown",this.keyDown.bind(this)),this.element.addEventListener("focus",this.focus.bind(this)),this.element.addEventListener("blur",this.blur.bind(this)));
this._rightChild=this._leftChild=null;m&&(this.leftChild=m);l&&(this.rightChild=l)}get leftChild(){return this._leftChild}set leftChild(a){this.focusContainer&&(a?this._leftChild?this.focusContainer.replaceChild(a,this._leftChild):this.focusContainer.insertBefore(a,this.focusContainer.firstChild):this._leftChild&&this.focusContainer.removeChild(this._leftChild),(this._leftChild=a)&&this.valueChild===SliderControlValueChild.LeftChild&&!this.manualAria&&Strings.changeText(a,this.element.getAttribute("aria-valuetext")||
this.element.getAttribute("aria-valuenow")))}get rightChild(){return this._rightChild}set rightChild(a){this.focusContainer&&(a?this._rightChild?this.focusContainer.replaceChild(a,this._rightChild):this.focusContainer.appendChild(a):this._rightChild&&this.focusContainer.removeChild(this._rightChild),(this._rightChild=a)&&this.valueChild===SliderControlValueChild.RightChild&&!this.manualAria&&Strings.changeText(a,this.element.getAttribute("aria-valuetext")||this.element.getAttribute("aria-valuenow")))}get dragging(){return this.forcedDragging||
(this.pointerHandler?this.pointerHandler.captured:!1)}get disabled(){return this._disabled}set disabled(a){this._disabled!==a&&(this._disabled=a,this.element&&(this.keyboardFocusable&&this.element.setAttribute("tabindex",a?"-1":"0"),this.element.style.pointerEvents=a?"none":""))}get min(){return this._min}set min(a){this._min=a|=0;a>this._max&&(this._max=a,this.element.setAttribute("aria-valuemax",a.toString()));this.delta=this._max-a;this.delta||(this.delta=1);this.element.setAttribute("aria-valuemin",
a.toString());this.value=this._value}get max(){return this._max}set max(a){this._max=a|=0;a<this._min&&(this._min=a,this.element.setAttribute("aria-valuemin",a.toString()));this.delta=a-this._min;this.delta||(this.delta=1);this.element.setAttribute("aria-valuemax",a.toString());this.value=this._value}get value(){return this._value}set value(a){a|=0;a<this._min?a=this._min:a>this._max&&(a=this._max);var b=this._value;this._value=a;this.percent=100*(a-this._min)/this.delta;const c=this.percent+"%";
this.filledRuler&&(this.vertical?this.filledRuler.style.top=100-this.percent+"%":this.filledRuler.style.right=100-this.percent+"%");this.ruler&&(this.vertical?this.ruler.style.bottom=c:this.ruler.style.left=c);this.thumb&&(this.vertical?this.thumb.style.bottom=c:this.thumb.style.left=c);if(a!==b){if(!this.manualAria)switch(this.mapper?(this.element.setAttribute("aria-valuetext",b=this.mapper(a)),this.element.setAttribute("aria-valuenow",a.toString())):this.element.setAttribute("aria-valuenow",b=a.toString()),
this.valueChild){case SliderControlValueChild.LeftChild:this._leftChild&&Strings.changeText(this._leftChild,b);break;case SliderControlValueChild.RightChild:this._rightChild&&Strings.changeText(this._rightChild,b)}this.dragging&&(this.valueChangedDragging=!0);if(this.onvaluechange)this.onvaluechange(a)}}manuallyChangeAll(a,b,c){this.value=a;this.manuallyChangeAria(b,c)}manuallyChangeAria(a,b){this.element.setAttribute("aria-valuetext",a);this.element.setAttribute("aria-valuenow",this._value.toString());
switch(b){case SliderControlValueChild.LeftChild:this._leftChild&&Strings.changeText(this._leftChild,a);break;case SliderControlValueChild.RightChild:this._rightChild&&Strings.changeText(this._rightChild,a)}}mouseDown(a){if(a.button||this._disabled||!this.element)return!1;this.focusContainer.focus();this.container.classList.add("active");this.forcedDragging=!0;this.valueChangedDragging=!1;this.mouseMove(a);this.forcedDragging=!1;return!0}mouseMove(a){const b=this.innerContainer.getBoundingClientRect();
let c;this.vertical?(c=b.bottom-b.top,a=c-(a.clientY-(b.top-3))):(c=b.right-b.left,a=a.clientX-(b.left+4));this.value=0>=c?this._min:this._min+this.delta*a/c}mouseUp(a){this.container.classList.remove("active");if(this.ondragend&&this.valueChangedDragging)this.ondragend(this._value);this.valueChangedDragging=!1}keyDown(a){if(!(this.pointerHandler.captured||a.ctrlKey||a.metaKey||a.shiftKey||a.altKey)){var b=this._value;switch(a.key){case "ArrowDown":case "ArrowLeft":this.value=b-1;if(this.onkeyboardchange&&
this._value!==b)this.onkeyboardchange(this._value);break;case "ArrowUp":case "ArrowRight":this.value=b+1;if(this.onkeyboardchange&&this._value!==b)this.onkeyboardchange(this._value);break;case "PageDown":this.value=b-.1*this.delta;if(this.onkeyboardchange&&this._value!==b)this.onkeyboardchange(this._value);break;case "PageUp":this.value=b+.1*this.delta;if(this.onkeyboardchange&&this._value!==b)this.onkeyboardchange(this._value);break;default:return}return cancelEvent(a)}}focus(){this.container.classList.add("active")}blur(){this.container.classList.remove("active")}}
class Menu{static historyStatePopped(){return null}}
class GraphicalFilterControl extends ConnectableNode{constructor(a,b,c,d){super();this._simpleMode=!!d;this.container=a;this.outerContainer=b;d=document.createElement("div");this._simpleMode||(b.style.minWidth=GraphicalFilterControl.advancedModeMinWidth,a.appendChild(d));const e=InternalStorage.loadGraphicalFilterEditorSettings();this._simpleMode&&(e.editMode=GraphicalFilterEditorControl.editModeShelfEq);this.editor=new GraphicalFilterEditorControl(d,2048,c,this.filterChanged.bind(this),e,{svgRenderer:!0,
fontSize:AppUI.smallFontSizeREM+"rem",lineHeight:AppUI.smallContentsSizeREM+"rem",radioHTML:Icon.createHTML("icon-radio",!1,"menu-icon"),checkHTML:Icon.createHTML("icon-check",!1,"menu-icon"),openMenuHTML:"<span>"+Icon.createHTML("icon-expand-less",!0)+"</span>",closeMenuHTML:"<span>"+Icon.createHTML("icon-expand-more",!0)+"</span>"});d=document.createElement("div");d.className="button-bottom-margin";this._simpleMode&&(b.style.minWidth=GraphicalFilterControl.simpleModeMinWidth,a.appendChild(d));this.simpleEditor=
new SimpleFilterEditorControl(d,this.editor);a=this.editor.element.querySelectorAll("div.GELBL");for(b=a.length-1;0<=b;b--)c=a[b],c.style.height="var(--button-size)",c.style.fontSize=AppUI.smallFontSizeREM+"rem",c.style.lineHeight=AppUI.contentsSizeREM+"rem",c.style.paddingTop="var(--button-padding)",c.style.paddingBottom="0";a=this.editor.element.querySelector("div.GEBTN.GECLK");a.className="btn square white transparent";a.style.width="";a.style.padding="";a.style.float="right"}get input(){return this.editor.filter.inputNode}get output(){return this.editor.filter.outputNode}filterChanged(){this.enabled&&
this.nodesChanged()}get simpleMode(){return this._simpleMode}set simpleMode(a){if(this._simpleMode!==a){this._simpleMode=a;if(a){this.outerContainer.style.minWidth=GraphicalFilterControl.simpleModeMinWidth;this.editor.editMode=GraphicalFilterEditorControl.editModeShelfEq;this.simpleEditor.updateSliders();a=this.editor.element;var b=this.simpleEditor.element}else this.outerContainer.style.minWidth=GraphicalFilterControl.advancedModeMinWidth,a=this.simpleEditor.element,b=this.editor.element;a&&a.parentNode&&
a.parentNode.removeChild(a);this.container&&b&&!b.parentNode&&this.container.appendChild(b);this.filterChanged()}}saveSettings(){this.editor&&InternalStorage.saveGraphicalFilterEditorSettings(this.editor.saveSettings())}}GraphicalFilterControl.defaultPresets={Powerful:"oaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGgoKCgoKCgoKCfn5+fn5+enp6enp2dnZ2cnJybm5qampqZmZmYmJiXl5eWlpWVlZSUlJOTkpKSkZGRkZCQkI+Pj46Ojo6NjY2NjYyMjIyLi4uLi4uKioqKioqKioqKiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmKioqKioqKioqKioqKiouLi4uLjIyMjIyNjY2Njo6Ojo+Pj4+QkJCRkpKSk5OTk5SUlJWVlZWWlpaXl5eXmJiYmZmZmZqampqbm5ubnJycnJ2dnZ2enp6enp+fn5+fn6CgoKCgoKCgoKGhoaGhoaGhoaGhoaGhoaE="};
GraphicalFilterControl.simpleModeMinWidth="280px";GraphicalFilterControl.advancedModeMinWidth="512px";
class StereoPannerControl extends ConnectableNode{constructor(a,b){super();this._pan=InternalStorage.loadStereoPannerSettings();this._appliedGain=1;this.channelSplitter=b.createChannelSplitter(2);this.gain=b.createGain();this.channelMerger=b.createChannelMerger(2);this.rightGain=this.leftGain=!1;this.onappliedgainchange=null;b=this.commitChanges.bind(this);this.slider=new SliderControl(a,Strings.Panning,function(c){return(c?(0>c?Strings.RightAbbrev:Strings.LeftAbbrev)+" "+((c=Math.abs(c))>=StereoPannerControl.maxAbsoluteValue?
GraphicalFilterEditorStrings.MinusInfinity:"-"+c):"-0")+" dB"},SliderControlValueChild.RightChild,!0,!1,-StereoPannerControl.maxAbsoluteValue,StereoPannerControl.maxAbsoluteValue,this._pan);a=document.createElement("span");a.className="db-label large small-left-margin";this.slider.rightChild=a;this.slider.ondragend=b;this.slider.onkeyboardchange=b;this.commitChanges(this._pan)}get input(){return this.channelSplitter}get output(){return this.channelMerger}commitChanges(a){const b=this.channelSplitter,
c=this.gain,d=this.channelMerger;if(b&&c&&d){var e=Math.abs(a),f=Math.abs(this._pan)!==e;this._pan=a;if(e){a=0<a;const g=!a;this._appliedGain=e>=StereoPannerControl.maxAbsoluteValue?0:Math.pow(10,-e/20);c.gain.value=this._appliedGain;if(a!==this.leftGain||g!==this.rightGain)b.disconnect(),c.disconnect(),this.leftGain=a,this.rightGain=g,a?(b.connect(c,0,0),c.connect(d,0,0),b.connect(d,1,1)):(b.connect(c,1,0),c.connect(d,0,1),b.connect(d,0,0))}else this._appliedGain=1,this.rightGain=this.leftGain=!1,
c.disconnect(),b.disconnect(),b.connect(d,0,0),b.connect(d,1,1);if(f&&this.enabled&&this.onappliedgainchange)this.onappliedgainchange(this._appliedGain)}}get enabled(){return super.enabled}set enabled(a){if(a!==this.enabled&&(super.enabled=a,this.onappliedgainchange))this.onappliedgainchange(this.appliedGain)}get appliedGain(){return this.enabled?this._appliedGain:1}get pan(){return this._pan}set pan(a){a=Math.max(-StereoPannerControl.maxAbsoluteValue,Math.min(StereoPannerControl.maxAbsoluteValue,
a|0));this._pan!==a&&(this.slider.value=a,this.commitChanges(a))}saveSettings(){InternalStorage.saveStereoPannerSettings(this._pan)}}StereoPannerControl.maxAbsoluteValue=20;
class MonoDownMixerControl extends ConnectableNode{constructor(a){super();this._multiplier=.5;this.audioContext=a;this.audioNode=null;this.desiredEnabled=this.loaded=this.loading=!1}static isSupported(){return"AudioWorklet"in window&&"AudioWorkletNode"in window}get input(){return this.audioNode}get output(){return this.audioNode}get enabled(){return super.enabled}set enabled(a){MonoDownMixerControl.isSupported()||(a=!1);this.desiredEnabled=a;this.audioNode?super.enabled=a:a&&(this.loaded?this.createAudioNode():
this.load())}get multiplier(){return this._multiplier}set multiplier(a){this._multiplier=a;this.audioNode&&(this.audioNode.parameters.get("multiplier").value=a)}showError(a,b){Alert.show("Error while "+a+": "+(b?b.message||b.toString():"Unknown error"),!0)}load(){this.loading||this.loaded||!this.audioContext||(this.loading=!0,addAudioWorkletModule(this.audioContext,"assets/js/monodownmixerprocessor.js?"+window.CACHE_VERSION).then(()=>{this.loading=!1;this.loaded=!0;this.createAudioNode()},a=>{this.showError("loading the mono down-mixer script",
a)}))}createAudioNode(){if(this.loaded){this.audioNode&&(this.audioNode.disconnect(),this.audioNode=null);try{const a=new AudioWorkletNode(this.audioContext,"monodownmixerprocessor");1!==a.numberOfInputs?(super.enabled=!1,this.showError("creating the mono down-mixer node","audioNode.numberOfInputs is "+a.numberOfInputs+", but should be 1")):1!==a.numberOfOutputs?(super.enabled=!1,this.showError("creating the mono down-mixer node","audioNode.numberOfOutputs is "+a.numberOfOutputs+", but should be 1")):
2!==a.channelCount?(super.enabled=!1,this.showError("creating the mono down-mixer node","audioNode.channelCount is "+a.channelCount+", but should be 2")):(this.audioNode=a,a.onprocessorerror=b=>{this.audioNode&&this.audioNode===a&&(a.disconnect(),super.enabled=!1,this.audioNode=null,this.showError("processing the mono down-mixer",b))},a.parameters.get("multiplier").value=this._multiplier,super.enabled=this.desiredEnabled)}catch(a){super.enabled=!1,this.showError("creating the mono down-mixer node",
a)}}}}
class HostMediaSession{static setActionHandler(a,b,c){try{a.setActionHandler(b,c)}catch(d){}}static setUpMediaSession(a){if(a){var b=function(){App.player&&App.player.playPause()};HostMediaSession.setActionHandler(a,"previoustrack",function(){App.player&&App.player.previous()});HostMediaSession.setActionHandler(a,"seekbackward",function(){App.player&&App.player.seekBackward()});HostMediaSession.setActionHandler(a,"pause",b);HostMediaSession.setActionHandler(a,"play",b);HostMediaSession.setActionHandler(a,"seekforward",
function(){App.player&&App.player.seekForward()});HostMediaSession.setActionHandler(a,"nexttrack",function(){App.player&&App.player.next()})}}static cleanUpMediaSession(a){a&&(HostMediaSession.setActionHandler(a,"previoustrack",null),HostMediaSession.setActionHandler(a,"seekbackward",null),HostMediaSession.setActionHandler(a,"pause",null),HostMediaSession.setActionHandler(a,"play",null),HostMediaSession.setActionHandler(a,"seekforward",null),HostMediaSession.setActionHandler(a,"nexttrack",null))}static getMediaSession(){if(App.hostInterface)return App.hostInterface;
if(!HostMediaSession.browserWrapper){const a="mediaSession"in navigator&&"MediaMetadata"in window?navigator.mediaSession:null;if(a&&"setActionHandler"in a){HostMediaSession.setUpMediaSession(a);let b=!0,c=!1;const d="setPositionState"in a?function(e,f){try{0<=e?(e/=1E3,a.setPositionState({duration:e,position:Math.min(0<=f?f:0,e),playbackRate:1})):a.setPositionState({duration:Infinity,position:0<=f?f:0,playbackRate:1})}catch(g){}}:function(){};HostMediaSession.browserWrapper={setPaused:function(e,
f,g){b=e;a.playbackState=b||c?"paused":"playing";d(f,g)},setLoading:function(e,f,g){c=e;a.playbackState=b||c?"paused":"playing";d(f,g)},setMetadata:function(e,f,g,h,k,m,l,n){0<e?(a.metadata=new window.MediaMetadata({title:f,artist:g,album:h,artwork:[{src:"assets/images/albumArts/64x64.png",sizes:"64x64",type:"image/png"},{src:"assets/images/albumArts/96x96.png",sizes:"96x96",type:"image/png"},{src:"assets/images/albumArts/192x192.png",sizes:"192x192",type:"image/png"},{src:"assets/images/albumArts/256x256.png",
sizes:"256x256",type:"image/png"},{src:"assets/images/albumArts/512x512.png",sizes:"512x512",type:"image/png"}]}),"none"==a.playbackState&&(a.playbackState="paused"),d(l,n)):(a.metadata=null,a.playbackState="none")},cleanUpMediaSession:function(){HostMediaSession.cleanUpMediaSession(a)}}}}return HostMediaSession.browserWrapper}}HostMediaSession.browserWrapper=null;
class Player{constructor(a,b,c,...d){this.audioContextTimeout=0;this.audioContextSuspended=!0;var e=navigator.userAgent&&0<=navigator.userAgent.indexOf("Firefox")?1:"playback";this.audioContext=window.AudioContext?new window.AudioContext({latencyHint:e}):new window.webkitAudioContext({latencyHint:e});this.audioContext.suspend();this.audioContext.onstatechange=this.audioContextStateChange.bind(this);if(d&&d.length){e=Array(d.length);for(let f=0;f<d.length;f++)e[f]=d[f](this.audioContext)}else e=[];
this.intermediateNodes=e;this.destinationNode=new DestinationNode(this.audioContext.destination);this.destinationNode.enabled=!0;this.boundPlaybackError=this.onerror=this.oncurrenttimeschange=this.onpausedchange=this.onloadingchange=this.onsongchange=null;this.boundNotifySongChange=this.notifySongChange.bind(this);this.boundCheckAudioContext=this.checkAudioContext.bind(this);this.boundAutoNext=this.next.bind(this,!0);this._alive=!0;this._loading=!1;this._paused=!0;this.songToResumeTime=this.loadedSong=
this.currentPlaylistSong=this._playlist=null;this._volume=0;this.lastObjectURL=null;this.resumeTimeS=this.lastTimeS=-1;this.songStartedAutomatically=!0;this.haltOnAllErrors=!1;this.volume=a||0;this.sourceNode=this.audio=null;this.recreateAudioPath();this.mediaSession=c||null;b&&(this.playlist=b)}recreateAudioPath(){const a=this.intermediateNodes;this.sourceNode&&this.sourceNode.disconnectFromDestination();for(var b=a.length-1;0<=b;b--)a[b].disconnectFromDestination();this.audio&&document.body.removeChild(this.audio);
const c=document.createElement("audio");b=this.audioContext.createMediaElementSource(c);b=new SourceNode(b);c.style.pointerEvents="none";c.style.position="absolute";c.style.left="0";c.style.top="0";c.style.zIndex="-1";c.loop=!1;c.controls=!1;c.autoplay=!1;document.body.appendChild(c);this.audio=c;this.sourceNode=b;var d=()=>{this.audio===c&&this.playbackLoadStart()};c.onwaiting=d;c.onloadstart=d;c.oncanplay=()=>{this.audio===c&&this.playbackLoadEnd()};c.onended=()=>{this.audio===c&&this.playbackEnd()};
this.boundPlaybackError=d=(e,f,g,h,k)=>{this.audio===c&&this.playbackError(e,f,g,h,k)};c.onerror=d;c.onpause=()=>{this.audio===c&&this.playbackPaused()};c.onplaying=()=>{this.audio===c&&this.playbackStarted()};d=()=>{this.audio===c&&this.playbackAborted()};c.onabort=d;c.onemptied=d;c.ondurationchange=()=>{this.audio===c&&this.playbackLengthChange()};c.ontimeupdate=()=>{this.audio===c&&this.currentTimeChange()};b.enabled=!0;if(a.length){b.connectToDestination(a[0]);for(b=0;b<a.length-1;b++)a[b].connectToDestination(a[b+
1]);a[a.length-1].connectToDestination(this.destinationNode)}else b.connectToDestination(this.destinationNode);this.volume=this._volume}destroy(a){this.stop();if(a){if(this._alive=!1,this.sourceNode&&this.sourceNode.disconnectFromDestination(),(a=this.intermediateNodes)&&a.length)for(let b=a.length-1;0<=b;b--)a[b].disconnectFromDestination()}else this._playlist&&this._playlist.destroy(),(a=this.mediaSession)&&a.cleanUpMediaSession&&a.cleanUpMediaSession(),zeroObject(this)}get alive(){return this._alive}get loading(){return this._loading}get paused(){return this._paused}get volume(){return this._volume}set volume(a){this._volume=
Math.max(Player.minVolume,Math.min(0,a|0));this.audio&&(this.audio.volume=a<=Player.minVolume?0:Math.pow(10,this._volume/20))}get playlist(){return this._playlist}set playlist(a){if(this._alive){var b=this.currentPlaylistSong;this.stop();if(this._playlist=a)this.currentPlaylistSong=a.currentItem,0<a.currentIndexResumeTimeS&&this.currentPlaylistSong?(this.songToResumeTime=this.currentPlaylistSong,this.lastTimeS=a.currentIndexResumeTimeS):this.lastTimeS=0;b!==this.currentPlaylistSong&&this.notifySongChange()}}get currentSong(){return this.currentPlaylistSong}get currentTimeMS(){if(this.loadedSong&&
this.audio)try{const a=this.audio.currentTime||0;this.lastTimeS=a;return 1E3*a|0}catch(a){}return 1E3*this.lastTimeS|0}handleError(a){const b=this.lastTimeS;this.stop();this.recreateAudioPath();if(this.haltOnAllErrors){if(this.onerror)this.onerror(a)}else{var c=!1;this._playlist&&this._playlist.length?0>b&&(c=!this.songStartedAutomatically):c=!0;if(c&&this.onerror)this.onerror(a);else queueMicrotask(this.boundAutoNext)}}audioContextStateChange(){this._alive&&"running"!==this.audioContext.state&&!this.audioContextSuspended&&
(this.audioContextSuspended=!0,this.playbackPaused())}playbackLoadStart(){if(this._alive&&!this._loading){this._loading=!0;if(this.onloadingchange)this.onloadingchange(!0);this.mediaSession&&this.mediaSession.setLoading(!0,this.currentPlaylistSong?this.currentPlaylistSong.lengthMS:0,this.lastTimeS)}}playbackLoadEnd(){if(this._alive&&this._loading){this._loading=!1;if(this.songToResumeTime){if(this.audio&&this.songToResumeTime===this.loadedSong&&0<this.resumeTimeS){try{this.audio.currentTime=this.resumeTimeS}catch(b){}const a=
this.audio.play();a&&a.catch(Player.nop)}this.songToResumeTime=null}if(this.onloadingchange)this.onloadingchange(!1);this.mediaSession&&this.mediaSession.setLoading(!1,this.currentPlaylistSong?this.currentPlaylistSong.lengthMS:0,this.lastTimeS)}}playbackEnd(){this._alive&&this.next(!0)}playbackError(a,b,c,d,e){this._alive&&this.handleError(e?e.message?e.message:"string"===typeof e?e:e.toString():"string"===typeof a?a:Strings.UnknownError)}suspendAudioContext(a){this.audioContextTimeout&&(clearTimeout(this.audioContextTimeout),
this.audioContextTimeout=0);this.audioContextSuspended||(a?this.audioContextTimeout=window.setTimeout(this.boundCheckAudioContext,5E3):(this.audioContextSuspended=!0,this.audioContext.suspend()))}resumeAudioContext(){this.audioContextTimeout&&(clearTimeout(this.audioContextTimeout),this.audioContextTimeout=0);if(this.audioContextSuspended||"running"!==this.audioContext.state)this.audioContextSuspended=!1,this.audioContext.resume()}checkAudioContext(){this.audioContextTimeout=0;this._paused?this.audioContextSuspended||
(this.audioContextSuspended=!0,this.audioContext.suspend()):this.audioContextSuspended&&(this.audioContextSuspended=!1,this.audioContext.resume())}playbackPaused(){if(this._alive&&!this._paused){this._paused=!0;this.suspendAudioContext(!0);if(this.audio)try{this.lastTimeS=this.audio.currentTime||0}catch(a){}if(this.onpausedchange)this.onpausedchange(!0);this.mediaSession&&this.mediaSession.setPaused(!0,this.currentPlaylistSong?this.currentPlaylistSong.lengthMS:0,this.lastTimeS)}}playbackStarted(){if(this._alive&&
this._paused){this._paused=!1;this.resumeAudioContext();if(this.audio)try{this.lastTimeS=this.audio.currentTime||0}catch(a){}if(this.onpausedchange)this.onpausedchange(!1);this.mediaSession&&this.mediaSession.setPaused(!1,this.currentPlaylistSong?this.currentPlaylistSong.lengthMS:0,this.lastTimeS)}}playbackAborted(){if(this._alive){if(this._loading){this._loading=!1;if(this.onloadingchange)this.onloadingchange(!1);this.mediaSession&&this.mediaSession.setLoading(!1,this.currentPlaylistSong?this.currentPlaylistSong.lengthMS:
0,0)}if(!this._paused){this._paused=!0;this.suspendAudioContext(!0);if(this.onpausedchange)this.onpausedchange(!0);this.mediaSession&&this.mediaSession.setPaused(!0,this.currentPlaylistSong?this.currentPlaylistSong.lengthMS:0,0)}}}playbackLengthChange(){this._alive&&this.audio&&this._playlist&&this.loadedSong&&this._playlist.updateSongLength(this.loadedSong,this.audio.duration)&&this.notifySongChange()}currentTimeChange(){if(this._alive&&this.audio&&this.loadedSong){try{this.lastTimeS=this.audio.currentTime||
0}catch(a){}if(this.oncurrenttimeschange)this.oncurrenttimeschange(this.lastTimeS)}}notifyMediaSessionChange(){if(this.mediaSession){var a=this.currentPlaylistSong;a?this.mediaSession.setMetadata(a.id,a.title,a.artist,a.album,a.track,a.year,a.lengthMS,this.lastTimeS):this.mediaSession.setMetadata(0,null,null,null,0,0,0,0)}}notifyCurrentTimeSChange(){if(this._alive){if(this.oncurrenttimeschange)this.oncurrenttimeschange(this.lastTimeS);this.notifyMediaSessionChange()}}notifySongChange(){if(this._alive){if(this.onsongchange)this.onsongchange(this.currentPlaylistSong,
this.lastTimeS);this.notifyMediaSessionChange()}}setPlaylistData(){const a=this._playlist;a&&(a.currentIndexResumeTimeS=this.lastTimeS)}previous(a){this._alive&&this._playlist&&(this._playlist.moveCurrentToPrevious(),this.play(-1,a))}seekBackward(){this._alive&&this.seekTo(-1E4,!0)}pause(){this._alive&&(this.suspendAudioContext(!1),this.loadedSong&&this.audio&&this.audio.pause())}play(a,b){if(this._alive&&this.audio){if(this.loadedSong&&void 0===a){this.resumeAudioContext();var c=this.audio.play()}else if(this._playlist){void 0!==
a&&0<=a&&(this._playlist.currentIndex=a);a=this._playlist.currentItem;!a&&this._playlist.length&&(this._playlist.moveCurrentToNext(),a=this._playlist.currentItem);if(!a){this.stop();return}this.loadedSong=a;this.resumeTimeS=this.lastTimeS;this.lastTimeS=-1;this.songStartedAutomatically=!!b;this.currentPlaylistSong!==a&&(this.currentPlaylistSong=a,queueMicrotask(this.boundNotifySongChange));for(this.resumeAudioContext();this.audio.firstChild;)this.audio.removeChild(this.audio.firstChild);const d=document.createElement("source");
if(a.url&&!a.url.startsWith(FileUtils.localURLPrefix))d.src=a.url;else if(a.file)this.lastObjectURL&&URL.revokeObjectURL(this.lastObjectURL),this.lastObjectURL=URL.createObjectURL(a.file),d.src=this.lastObjectURL;else{if(a.url){this.pause();const e=this._playlist.currentIndex,f=this._playlist.currentItem;FileSystemAPI.getFile(a.url.substring(FileUtils.localURLPrefix.length)).then(g=>{f&&!f.file&&g&&(f.file=g);this._playlist&&e===this._playlist.currentIndex&&f===this._playlist.currentItem&&(g?(this.lastTimeS=
this.resumeTimeS,this.play(e,b)):this.handleError(Strings.FileNotFoundOrNoPermissionError))},()=>{this._playlist&&e===this._playlist.currentIndex&&f===this._playlist.currentItem&&this.handleError(Strings.FileNotFoundOrNoPermissionError)})}else this.handleError(Strings.MissingSongError);return}d.onerror=this.boundPlaybackError;this.audio.appendChild(d);this.audio.load();if(this.songToResumeTime!==a||!this.resumeTimeS||0>=this.resumeTimeS)c=this.audio.play()}c&&c.catch(Player.nop)}}playSongId(a,b){if(!this._alive||
!this.audio||!this._playlist)return!1;a=this._playlist.findIndexById(a);return 0<=a?(this.play(a,b),!0):!1}playPause(){this._alive&&this.audio&&(!this.loadedSong||this.audio.paused?this.play():this.pause())}stop(){if(this._alive&&this.audio){this.songToResumeTime=this.loadedSong=null;this.lastTimeS=-1;if(this.currentPlaylistSong){for(;this.audio.firstChild;)this.audio.removeChild(this.audio.firstChild);this.audio.load();this.lastObjectURL&&(URL.revokeObjectURL(this.lastObjectURL),this.lastObjectURL=
null);if(this._loading){this._loading=!1;if(this.onloadingchange)this.onloadingchange(!1);this.mediaSession&&this.mediaSession.setLoading(!1,0,0)}if(!this._paused){this._paused=!0;if(this.onpausedchange)this.onpausedchange(!0);this.mediaSession&&this.mediaSession.setPaused(!0,0,0)}this.currentPlaylistSong=null;this.notifySongChange()}this.songToResumeTime=this.loadedSong=null;this.lastTimeS=-1;this.suspendAudioContext(!1)}}seekForward(){this._alive&&this.seekTo(1E4,!0)}next(a){this._alive&&this._playlist&&
(this._playlist.moveCurrentToNext(),this.play(-1,a))}seekTo(a,b){if(this._alive&&this.currentPlaylistSong&&this.currentPlaylistSong.isSeekable&&!(0>=this.currentPlaylistSong.lengthMS))if(!this.loadedSong)this.songToResumeTime||(this.songToResumeTime=this.currentPlaylistSong),this.songToResumeTime===this.currentPlaylistSong&&(this.lastTimeS=Math.min(Math.max(0,this.currentPlaylistSong.lengthMS),Math.max(0,a+(b?1E3*Math.max(0,this.lastTimeS)|0:0)))/1E3,this.notifyCurrentTimeSChange());else if(this.audio&&
this.audio.seekable&&this.audio.seekable.length){try{const c=Math.min(this.audio.duration||0,Math.max(0,a/1E3+(b?this.audio.currentTime||0:0)));this.lastTimeS=c;this.audio.currentTime=c}catch(c){}this.notifyCurrentTimeSChange()}}}Player.minVolume=-40;Player.nop=function(){};
class InternalStorage{static cacheGet(a,b){return __awaiter(this,void 0,void 0,function*(){var c=yield caches.open(a);b=b?InternalStorage.playlistCachePrefix+b:InternalStorage.playlistCachePrefix;return(c=yield c.match(b))?c.arrayBuffer():null})}static cachePut(a,b,c){return __awaiter(this,void 0,void 0,function*(){const d=yield caches.open(a);b=b?InternalStorage.playlistCachePrefix+b:InternalStorage.playlistCachePrefix;return d.put(b,c)})}static loadAppSettings(){try{const a=localStorage.getItem(InternalStorage.appSettingsName);
if(a){const b=JSON.parse(a);if(b)return b}}catch(a){}return{playerVolume:0,graphicalFilterControlEnabled:!1,graphicalFilterControlSimpleMode:544>window.innerWidth,stereoPannerControlEnabled:!1,monoDownMixerControlEnabled:!1}}static saveAppSettings(a){const b=localStorage.getItem(InternalStorage.appSettingsName);a?(a=JSON.stringify(a),b!==a&&localStorage.setItem(InternalStorage.appSettingsName,a)):b&&localStorage.removeItem(InternalStorage.appSettingsName)}static loadGraphicalFilterEditorSettings(){try{const a=
localStorage.getItem(InternalStorage.graphicalFilterEditorSettingsName);if(a){const b=JSON.parse(a);if(b)return b}}catch(a){}return{currentChannelIndex:0,editMode:GraphicalFilterEditorControl.editModeShelfEq,isActualChannelCurveNeeded:!0,isNormalized:!1,isSameFilterLR:!0,showZones:!0}}static saveGraphicalFilterEditorSettings(a){const b=localStorage.getItem(InternalStorage.graphicalFilterEditorSettingsName);a?(a=JSON.stringify(a),b!==a&&localStorage.setItem(InternalStorage.graphicalFilterEditorSettingsName,
a)):b&&localStorage.removeItem(InternalStorage.graphicalFilterEditorSettingsName)}static loadStereoPannerSettings(){return Math.max(-StereoPannerControl.maxAbsoluteValue,Math.min(StereoPannerControl.maxAbsoluteValue,parseInt(localStorage.getItem(InternalStorage.stereoPannerSettingsName))|0))}static saveStereoPannerSettings(a){const b=localStorage.getItem(InternalStorage.stereoPannerSettingsName);a=(a|0).toString();b!==a&&localStorage.setItem(InternalStorage.stereoPannerSettingsName,a)}static loadPlaylist(a){return __awaiter(this,
void 0,void 0,function*(){const b=yield InternalStorage.cacheGet(InternalStorage.playlistCacheName,a);if(!b)return null;try{return Playlist.deserialize(new DataReader(b))}catch(c){return null}})}static loadPlaylistWeb(a){return(a=localStorage.getItem(a||InternalStorage.defaultPlaylistName))?Playlist.deserializeWeb(a):null}static savePlaylist(a,b){if(!b){if(!a.modified)return Promise.resolve();a.modified=!1}return InternalStorage.cachePut(InternalStorage.playlistCacheName,b,new Response(a.serialize().trimmedArrayBuffer))}static savePlaylistWeb(a,
b){if(!b){if(!a.modified)return;a.modified=!1}return localStorage.setItem(b||InternalStorage.defaultPlaylistName,JSON.stringify(a.serializeWeb()))}}InternalStorage.playlistCachePrefix="https://fplay.com.br/";InternalStorage.playlistCacheName="playlists";InternalStorage.appSettingsName="appSettings";InternalStorage.graphicalFilterEditorSettingsName="graphicalFilterEditorSettings";InternalStorage.stereoPannerSettingsName="stereoPannerSettings";InternalStorage.defaultPlaylistName="defaultPlaylist";
class Modal{constructor(a){this.options=a;this.focusBlocker=new FocusBlocker;this.focusBlocker.block();HistoryHandler.pushState();const b=document.createElement("div");this.containerElement=b;b.className=a.transparentBackground?"modal-container fade":"modal-container fade background";var c="modalHeader"+Modal.internalId;const d=document.createElement("form");this.modalElement=d;d.setAttribute("tabindex","-1");d.setAttribute("role","dialog");d.setAttribute("aria-modal","true");d.setAttribute("aria-labelledby",
c);d.className="modal"+(a.fullHeight?" full-height":"");d.onsubmit=this.submit.bind(this);var e=document.createElement("div");this.modalHeaderElement=e;(a.titleHeader||e).setAttribute("id",c);e.className="modal-header padding"+(a.rightHeader?" right":"");a.title?"string"===typeof a.title?e.innerHTML=a.title:e.appendChild(a.title):e.innerHTML=a.titleStringKey?Strings.translate(a.titleStringKey):Strings.Oops;this.modalBodyElement=c=document.createElement("div");c.className="modal-body scrollable padding"+
(a.leftBody?" left":"");a.html||(a.html=document.createElement("div"),a.text&&Strings.changeText(a.html,a.text));if("string"===typeof a.html)c.innerHTML=a.html;else if(Array.isArray(a.html)){var f=a.html;for(var g=0;g<f.length;g++)c.appendChild(f[g])}else c.appendChild(a.html);if((f=c.getElementsByTagName("button"))&&f.length)for(g=f.length-1;0<=g;g--){const h=f[g];ButtonControl.prepare(h);h.onclick=()=>{if(!this.fading&&this.options.onbuttonclick)this.options.onbuttonclick(h.id,h)}}this.modalFooterElement=
f=document.createElement("div");f.className="modal-footer padding left-margin right-margin";this.defaultSubmitButton=this.defaultCancelButton=null;if(a.buttons)for(g=0;g<a.buttons.length;g++){const h=a.buttons[g],k=ButtonControl.create(h,!0);h.defaultCancel&&(this.defaultCancelButton=k);h.defaultSubmit&&(this.defaultSubmitButton=k);k.onclick=()=>{if(!this.fading){if(h.onclick)h.onclick(h.id,k);if(this.options.onbuttonclick)this.options.onbuttonclick(h.id,k)}};f.appendChild(k)}d.appendChild(e);if(a.skipBody)for(;c.firstChild;)e=
c.firstChild,c.removeChild(e),d.appendChild(e);else d.appendChild(c);d.appendChild(f);b.appendChild(d);document.body.appendChild(b);this.boundDocumentKeyDown=this.documentKeyDown.bind(this);document.addEventListener("keydown",this.boundDocumentKeyDown,!0);this.fading=!0;DelayControl.delayShortCB(()=>{if(a.onshowing)a.onshowing();this.containerElement.classList.add("in");DelayControl.delayFadeCB(()=>{this.fading=!1;const h=this.options.onshown&&this.options.onshown()||this.modalElement;try{h.focus()}catch(k){}})})}static get visible(){return!!Modal.modal}static get currentModalElement(){return Modal.modal?
Modal.modal.modalElement:null}static get currentModalHeaderElement(){return Modal.modal?Modal.modal.modalHeaderElement:null}static get currentModalBodyElement(){return Modal.modal?Modal.modal.modalBodyElement:null}static get currentModalFooterElement(){return Modal.modal?Modal.modal.modalFooterElement:null}static show(a){if(Modal.modal)return!1;a.okCancel?a.buttons=[{id:"cancel",defaultCancel:!0,icon:"icon-clear",text:a.cancelText||Strings.Cancel,color:"red",onclick:a.oncancel||Modal.hide},{id:"ok",
defaultSubmit:a.okCancelSubmit,icon:"icon-check",text:a.okText||Strings.OK,color:"green",onclick:a.onok||Modal.hide}]:a.buttons&&a.buttons.length||(a.buttons=[{id:"cancel",defaultCancel:!0,icon:"icon-clear",text:Strings.Close,color:"red",onclick:Modal.hide}]);Modal.modal=new Modal(a);return!0}static hide(){Modal.modal&&Modal.modal.hideInternal()}static defaultCancelAction(){return Modal.modal?Modal.modal.defaultCancelActionInternal():!1}static historyStatePopped(){if(!Modal.modal)return null;Modal.modal.fading||
Modal.defaultCancelAction();return!1}hideInternal(){Modal.modal!==this||this.fading||this.options.onhiding&&!1===this.options.onhiding()||(document.removeEventListener("keydown",this.boundDocumentKeyDown,!0),this.fading=!0,this.containerElement.classList.remove("in"),DelayControl.delayFadeCB(()=>{Modal.modal=null;if(this.options.returnFocusElement)try{this.options.returnFocusElement.focus()}catch(a){}if(this.options.onhidden)this.options.onhidden();document.body.removeChild(this.containerElement);
HistoryHandler.popState();this.focusBlocker&&this.focusBlocker.unblock();if(this.options.buttons)for(let a=this.options.buttons.length-1;0<=a;a--)zeroObject(this.options.buttons[a]);zeroObject(this.options);zeroObject(this)}))}documentKeyDown(a){a.ctrlKey||a.metaKey||a.shiftKey||a.altKey||a.repeat||"Escape"!==a.key||this.defaultCancelActionInternal()}defaultCancelActionInternal(){return this.defaultCancelButton?(this.defaultCancelButton.click(),!0):!1}submit(a){cancelEvent(a);this.defaultSubmitButton&&
this.defaultSubmitButton.click();return!1}}Modal.internalId=0;Modal.modal=null;
class FilePickerListAdapter extends ListAdapter{constructor(a){super(a)}get itemHeight(){return AppUI.buttonSizePX}createEmptyElement(a){const b=document.createElement("div");b.className=a;CheckboxControl.create({stringKey:"Selected",checkbox0Color:"pink",checkbox1Color:"green",square:!0,keyboardFocusable:!1,parent:b}).setAttribute("data-check","1");ButtonControl.create({icon:"icon-clear",text:Strings.Delete,color:"red",square:!0,keyboardFocusable:!1,className:"no-left-margin",parent:b}).setAttribute("data-delete",
"1");b.appendChild(Icon.createLarge("icon-folder","orange button-top-margin margin",null,Strings.FolderLabel));b.appendChild(Icon.createLarge("icon-add-folder","green button-top-margin margin left-margin"));b.appendChild(document.createTextNode(Formatter.none));return b}prepareElement(a,b,c,d){b=d.childNodes;a.root?(b[0].classList.add("hidden"),a.path?b[3].classList.add("hidden"):b[3].classList.remove("hidden")):(c=b[0],c.classList.remove("hidden"),a.dir?c.classList.remove("small-right-margin"):c.classList.add("small-right-margin"),
CheckboxControl.setChecked(c,a.selected),b[3].classList.add("hidden"));a.deletable?b[1].classList.remove("hidden"):b[1].classList.add("hidden");a.dir?(c=b[2],c.classList.remove("hidden"),a.root&&!a.deletable?c.classList.add("left-margin"):c.classList.remove("left-margin")):b[2].classList.add("hidden");b[4].nodeValue=a.name}prepareElementIndexOrLengthChanged(a,b,c,d){}}
class FilePicker{constructor(a,b,c){const d=document.createElement("div"),e=Strings.createSrOnlyText(Strings.AddSongs);d.appendChild(e);ButtonControl.create({color:"orange",icon:"icon-up",text:Strings.Up,parent:d,onclick:this.navigateUp.bind(this)});ButtonControl.create({icon:"icon-checkbox-1",text:Strings.All,parent:d,onclick:this.toggleAll.bind(this)});const f=document.createElement("div");f.className="file-picker-path padding border-bottom left";f.setAttribute("aria-atomic","true");f.setAttribute("aria-live",
"assertive");f.setAttribute("aria-relevant","all");const g=Icon.createLarge("icon-folder-open","orange hidden",null,Strings.CurrentPathLabel);f.appendChild(g);const h=document.createElement("i");h.className="icon loading large";h.appendChild(Strings.createSrOnlyText(Strings.LoadingCurrentPathLabel));f.appendChild(h);const k=document.createElement("div");k.className="file-picker-path-element small-left-padding";f.appendChild(k);const m=document.createElement("div");m.className="file-picker-list fade bottom-margin";
this.callback=c||null;this.resolve=a;this.provider=App.hostType===App.hostTypeAndroid?new FilePickerAndroidProvider:new FilePickerFileSystemAPIProvider;this.list=new List;this.listAdapter=new FilePickerListAdapter(this.list);this.listControl=new ListControl(m,Strings.FileList,!0);this.listControl.element.addEventListener("keydown",this.listKeyDown.bind(this));this.listControl.onitemclick=this.itemClick.bind(this);this.listControl.onitemcontrolclick=this.itemControlClick.bind(this);this.listControl.adapter=
this.listAdapter;this.selectedFiles=null;this.fading=this.gettingFiles=!1;this.providerVersion=0;this.path=FilePicker.lastPath;this.rootLength=FilePicker.lastRootLength;this.iconFolder=g;this.iconLoading=h;this.pathElement=k;this.boundRefreshRoot=this.refreshRoot.bind(this);this.updatePathElement(this.path);a={html:[f,m],title:d,titleHeader:e,returnFocusElement:b,skipBody:!0,fullHeight:!0,onshown:this.modalShown.bind(this),onhiding:this.modalHiding.bind(this),onhidden:this.modalHidden.bind(this)};
this.callback?a.buttons=[{id:"cancel",defaultCancel:!0,icon:"icon-clear",text:Strings.Close,color:"red",onclick:Modal.hide},{id:"add",icon:"icon-add",text:Strings.Add,color:"green",onclick:()=>this.modalOk(!1)},{id:"play",icon:"icon-play",text:Strings.Play,color:"blue",onclick:()=>this.modalOk(!0)}]:(a.okCancel=!0,a.onok=()=>this.modalOk(!1));if(!Modal.show(a))throw Error("Assertion error: Modal.show() === false");}static isSupported(){return!!App.hostInterface||FileSystemAPI.isSupported()}static get visible(){return!!FilePicker.filePicker}static show(a){return FilePicker.filePicker||
Modal.visible?Promise.resolve(null):new Promise(function(b){FilePicker.filePicker=new FilePicker(b,a)})}static showAddPlay(a){if(FilePicker.filePicker||Modal.visible)return null;let b=!1,c=[],d=null;FilePicker.filePicker=new FilePicker(function(){b=!0;d&&(d(null),d=null)},a,function(e){d?(d(e),d=null):c.push(e)});return function(){if(c.length){const e=c.pop();return Promise.resolve(e)}return b?Promise.resolve(null):new Promise(function(e){d=e})}}updatePathElement(a){a&&a.endsWith("/")&&(a=a.substring(0,
a.length-1));Strings.changeText(this.pathElement,a||Strings.Storage);return a}updateIconLoading(a){this.iconFolder&&this.iconLoading&&(a?(this.iconFolder.classList.add("hidden"),this.iconLoading.classList.remove("hidden")):(this.iconLoading.classList.add("hidden"),this.iconFolder.classList.remove("hidden")))}listKeyDown(a){a.ctrlKey||a.metaKey||a.shiftKey||a.altKey||a.repeat||"Backspace"!==a.key||this.navigateUp()}itemClick(a,b,c){this.gettingFiles||this.fading||(a.root&&!a.path&&this.provider.editableRoots()?
(this.updateIconLoading(!0),this.provider.addNewRoot().then(this.boundRefreshRoot,this.boundRefreshRoot)):a.dir?this.navigate(a.path):this.listControl&&(a.selected=!a.selected,this.listControl.refreshVisibleItems()))}itemControlClick(a,b,c,d){if(!this.gettingFiles&&!this.fading){if("INPUT"===d.tagName&&(d=d.parentNode,!d)||"SPAN"===d.tagName&&(d=d.parentNode,!d))return;if(d.classList.contains("list-item"))for(b=d.childNodes,c=0;c<b.length;c++)if(b[c]&&b[c].tagName&&!b[c].classList.contains("hidden")){d=
b[c];d.getAttribute("data-check")&&CheckboxControl.setChecked(d,!CheckboxControl.isChecked(d));break}d.getAttribute("data-check")?a.selected=CheckboxControl.isChecked(d):d.getAttribute("data-delete")&&(this.updateIconLoading(!0),this.provider.removeRoot(a).then(this.boundRefreshRoot,this.boundRefreshRoot))}}refreshRoot(a){this.path||(!0===a?this.navigate(null):this.updateIconLoading(!1))}finishNavigation(a){!this.path&&this.provider.editableRoots()&&a.push({name:Strings.AddMoreFolders,dir:0,path:"",
root:!0,deletable:!1});this.updateIconLoading(!1);a.length&&(this.list.addItems(a),this.listControl.element.classList.add("in"))}navigate(a){if(FilePicker.filePicker===this&&!this.gettingFiles&&!this.fading){var b=!this.path;this.path=a=this.updatePathElement(a);b&&(this.rootLength=a?a.length:0);this.providerVersion++;var c=this.providerVersion;this.updateIconLoading(!0);var d=null;this.listControl.element.classList.contains("in")&&(this.fading=!0,this.listControl.element.classList.remove("in"),DelayControl.delayFadeCB(()=>
{FilePicker.filePicker===this&&this.provider&&c===this.providerVersion&&(this.list.clear(),this.fading=!1,d&&this.finishNavigation(d))}));this.provider.navigate(a).then(e=>{FilePicker.filePicker===this&&this.provider&&c===this.providerVersion&&(d=e||[],this.fading||this.finishNavigation(d))},e=>{FilePicker.filePicker===this&&this.provider&&c===this.providerVersion&&(this.updateIconLoading(!1),Alert.show(e.message||("string"===typeof e.error?e.error:e.error&&e.error.message||e.toString()),!0))})}}navigateUp(){let a=
this.path,b;!a||0>=(b=a.lastIndexOf("/"))?this.navigate(null):(a=a.substring(0,b),this.navigate(a.length<this.rootLength?null:a))}toggleAll(){if(FilePicker.filePicker===this&&!this.gettingFiles&&!this.fading){var a=this.list,b=!1;for(var c=a.length-1;0<=c;c--)if(!a.item(c).selected){b=!0;break}for(c=a.length-1;0<=c;c--)a.item(c).selected=b;this.listControl.refreshVisibleItems()}}modalShown(){this.navigate(this.path);return this.listControl.element}modalHiding(){if(FilePicker.filePicker!==this)return!0;
FilePicker.filePicker=null;this.provider&&this.provider.destroy();return!0}modalHidden(){const a=this.resolve,b=this.selectedFiles;this.selectedFiles=null;zeroObject(this);a&&a(b)}modalOk(a){if(FilePicker.filePicker===this&&!this.gettingFiles&&!this.fading){var b=[],c=[],d=this.list,e=d.length;if(this.path)for(let g=0;g<e;g++){const h=d.item(g);h.selected&&(h.dir?b:c).push(h)}if(this.path&&(b.length||c.length)){FilePicker.lastPath=this.path;FilePicker.lastRootLength=this.rootLength;this.gettingFiles=
!0;this.providerVersion++;var f=this.providerVersion;this.updateIconLoading(!0);this.provider.getFiles(b,c).then(g=>{if(FilePicker.filePicker===this&&this.provider&&f===this.providerVersion)if(this.callback){const h=this.list;for(let k=h.length-1;0<=k;k--)h.item(k).selected=!1;this.listControl.refreshVisibleItems();this.updateIconLoading(!1);this.gettingFiles=!1;this.callback({play:a,files:g})}else this.selectedFiles=g,Modal.hide()},g=>{FilePicker.filePicker===this&&this.provider&&f===this.providerVersion&&
(this.updateIconLoading(!1),this.gettingFiles=!1,Alert.show(g.message||("string"===typeof g.error?g.error:g.error&&g.error.message||g.toString()),!0))})}else Alert.show(Strings.NothingSelected)}}}FilePicker.filePicker=null;FilePicker.lastPath=null;FilePicker.lastRootLength=0;
class AppUI{static preparePlaylist(){if(App.player&&AppUI.playlistControl){var a=App.player.playlist;a?(a.onsonglengthchange=AppUI.playlistSongLengthChange,AppUI.playlistControl.adapter=new PlaylistAdapter(a)):AppUI.playlistControl.adapter=null}}static adjustDecimal(a){var b=!0;let c=a.toFixed(5);for(c=c.substring(0,c.length-1);;){var d=c.charAt(c.length-1),e=c.charAt(c.length-2);if(d===e){if("0"!==d&&(c=c.padEnd(24,d),"9"===d&&b)){c=parseFloat(c).toFixed(5);b=!1;continue}}else if(b=c.lastIndexOf("."),
d=c.substring(b+1,b+1+2),e=c.substring(b+3,b+3+2),d===e)for(c=c.substring(0,b+1);24>c.length;)c+=d;else if(c=a.toFixed(7),b=c.lastIndexOf("."),d=c.substring(b+1,b+1+3),e=c.substring(b+4,b+4+3),d===e)for(c=c.substring(0,b+1);24>c.length;)c+=d;else c=a.toFixed(18);break}return c.replace(/0+$/,"").replace(/[,\.]$/,"")}static adjustWindow(){var a=App.hostInterface?AppUI.baseSizePX*(AppUI._fontScale=App.hostInterface.getFontScale()):.125*AppUI.ruler.getBoundingClientRect().height;if(AppUI.devicePixelRatio!==
devicePixelRatio||AppUI._1remInPX!==a){AppUI.devicePixelRatio=devicePixelRatio;AppUI._1remInPX=a;App.hostInterface?document.documentElement.style.fontSize=a!==AppUI.baseSizePX?a+"px":"":AppUI._fontScale=AppUI._1remInPX/AppUI.baseSizePX;var b=AppUI.adjustDecimal(AppUI.remToPX(AppUI.contentsSizeREM));AppUI._contentsSizePX=parseFloat(b);AppUI._buttonSizePX=AppUI._contentsSizePX+(AppUI.primaryInputIsTouch?AppUI.s6PX:AppUI.s2PX);a=Icon.baseSizePX/devicePixelRatio;var c=AppUI._contentsSizePX/a|0,d=Math.ceil(AppUI._contentsSizePX/
a);2>=d*devicePixelRatio-AppUI._contentsSizePX&&(c=d);0>=c?(a=b,AppUI._smallIconSizePX=AppUI._contentsSizePX,AppUI._largeIconSizePX=AppUI._contentsSizePX):1===c?(b=a=AppUI.adjustDecimal(a),AppUI._smallIconSizePX=parseFloat(a),AppUI._largeIconSizePX=AppUI._smallIconSizePX):(a=AppUI.adjustDecimal(Math.max(c>>1&-2,1)*Icon.baseSizePX/devicePixelRatio),b=AppUI.adjustDecimal((c&-2)*Icon.baseSizePX/devicePixelRatio),AppUI._smallIconSizePX=parseFloat(a),AppUI._largeIconSizePX=parseFloat(b));(d=(AppUI.baseThinBorderPX*
devicePixelRatio|0)/devicePixelRatio)||(d=1);c=AppUI.adjustDecimal(d);AppUI._thinBorderPX=parseFloat(c);(d=(AppUI.baseThickBorderPX*devicePixelRatio|0)/devicePixelRatio)||(d=1);d=AppUI.adjustDecimal(d);AppUI._thickBorderPX=parseFloat(d);const e=AppUI.adjustDecimal(3*AppUI.remToPX(AppUI.smallContentsSizeREM)+AppUI.s2PX);AppUI._playlistItemSizePX=parseFloat(e);AppUI.rootVariables.textContent=`:root {
				--button-size: ${AppUI._buttonSizePX}px;
				--button-padding: ${AppUI.adjustDecimal(.5*(AppUI._buttonSizePX-AppUI._contentsSizePX))}px;
				--negative-button-padding: -${AppUI.adjustDecimal(.5*(AppUI._buttonSizePX-AppUI._contentsSizePX))}px;
				--icon-size: ${a}px;
				--icon-padding: ${AppUI.adjustDecimal(.5*(AppUI._contentsSizePX-AppUI._smallIconSizePX))}px;
				--large-icon-size: ${b}px;
				--large-icon-margin: ${AppUI.adjustDecimal(Math.min(0,.5*(AppUI._contentsSizePX-AppUI._largeIconSizePX)))}px;
				--large-icon-padding: ${AppUI.adjustDecimal(Math.max(0,.5*(AppUI._contentsSizePX-AppUI._largeIconSizePX)))}px;
				--thin-border: ${c}px;
				--thick-border: ${d}px;
				--scrollbar-size: ${AppUI.primaryInputIsTouch?20:12}px;
				--playlist-item-size: ${e}px;
			}`;for(a=AppUI.zoomHandlers.length-1;0<=a;a--)AppUI.zoomHandlers[a]()}AppUI.checkPanelContainerToggleState()}static changeZoom(a){if(AppUI.webFrame)if(a=(1<=devicePixelRatio?1+Math.ceil(4*devicePixelRatio):.51>=devicePixelRatio?0:.67>=devicePixelRatio?1:.76>=devicePixelRatio?2:.81>=devicePixelRatio?3:4)+a,0>=a)AppUI.webFrame.setZoomFactor(.5);else if(21<=a)AppUI.webFrame.setZoomFactor(5);else switch(a){case 1:AppUI.webFrame.setZoomFactor(2/3);break;case 2:AppUI.webFrame.setZoomFactor(.75);break;
case 3:AppUI.webFrame.setZoomFactor(.8);break;case 4:AppUI.webFrame.setZoomFactor(.9);break;default:AppUI.webFrame.setZoomFactor((a-1)/4)}}static globalKeyHandler(a){if(a.ctrlKey||a.metaKey){if(AppUI.webFrame)switch(a.key){case "-":return a.repeat||AppUI.changeZoom(-1),cancelEvent(a);case "+":case "=":return a.repeat||AppUI.changeZoom(1),cancelEvent(a);case "0":return cancelEvent(a)}}else switch(a.key){case "Escape":return a.repeat||(Modal.visible?Modal.hide():AppUI.playlistControl&&AppUI.playlistControl.deleteMode?
AppUI.toggleDeleteMode(!0):App.player&&App.player.playPause()),cancelEvent(a);case "F1":return!a.repeat&&App.player&&App.player.previous(),cancelEvent(a);case "F2":return!a.repeat&&App.player&&App.player.playPause(),cancelEvent(a);case "F3":return!a.repeat&&App.player&&App.player.stop(),cancelEvent(a);case "F4":return!a.repeat&&App.player&&App.player.next(),cancelEvent(a);default:if(a.target===document.body&&!AppUI.panelContainerToggled&&!Modal.visible)switch(a.key){case "ArrowDown":case "ArrowRight":case "ArrowUp":case "ArrowLeft":case "PageDown":case "PageUp":case "Home":case "End":case "Enter":case " ":return cancelEvent(a),
AppUI.playlistControl.element.focus(),AppUI.playlistControl.elementKeyDown(a),!1}}}static historyStatePopped(){if(!AppUI.playlistControl||!AppUI.playlistControl.deleteMode){if(!AppUI.panelContainerToggled)return null;AppUI.toggleView(!1);return!0}AppUI.toggleDeleteMode(!1);return!0}static preInit(a,b){window.addEventListener("resize",AppUI.adjustCover);AppUI.adjustCover();AppUI.webFrame=a;window.addEventListener("keydown",AppUI.globalKeyHandler,!0);a&&b.devicePixelRatio&&b.devicePixelRatio!==devicePixelRatio&&
a.setZoomFactor(b.devicePixelRatio);FilePicker.isSupported()&&(FilePicker.lastPath=b.filePickerLastPath||null,FilePicker.lastRootLength=b.filePickerRootLength||0,a=document.getElementById("add-folder-button"),a.parentNode.removeChild(a));ButtonControl.init();CheckboxControl.init();AppUI.seekSlider=new SliderControl("seek-slider",Strings.Seek,null,SliderControlValueChild.None,!1,!1,0,1,0,null,null,!0);AppUI.seekSlider.disabled=!0;AppUI.seekSlider.onvaluechange=AppUI.seekSliderValueChange;AppUI.seekSlider.ondragend=
AppUI.seekSliderDragEnd;a=document.createElement("span");a.className="seek-label";AppUI.currentTimeS=0;Strings.changeText(a,Formatter.none);AppUI.seekSlider.leftChild=a;AppUI.songLengthLabel=document.createElement("span");AppUI.songLengthLabel.className="seek-label";Strings.changeText(AppUI.songLengthLabel,Formatter.none);Strings.changeText(AppUI.assistiveSongLengthLabel,Formatter.none);AppUI.seekSlider.rightChild=AppUI.songLengthLabel;AppUI.volumeSlider=new SliderControl("volume-slider",Strings.Volume,
function(c){return(c<=Player.minVolume?GraphicalFilterEditorStrings.MinusInfinity:c?c:"-0")+" dB"},SliderControlValueChild.RightChild,!0,!1,Player.minVolume,0,b.playerVolume);AppUI.volumeSlider.leftChild=Icon.createLarge("icon-volume","green small-right-margin");a=document.createElement("span");a.className="small-left-margin";a.setAttribute("id","volume-label");AppUI.volumeSlider.rightChild=a;AppUI.volumeSlider.onvaluechange=AppUI.volumeSliderValueChange;AppUI.playlistControl=new ListControl("playlist-control",
Strings.Playlist,!0);AppUI.playlistControl.onitemclick=AppUI.playlistControlItemClick;AppUI.playlistControl.onitemcontextmenu=AppUI.playlistControlItemContextMenu;AppUI.graphicalFilterControlType=document.getElementById("graphical-filter-control-type");ButtonControl.setText(AppUI.graphicalFilterControlType,b.graphicalFilterControlSimpleMode?Strings.TraditionalFilter:Strings.AdvancedFilter);AppUI.graphicalFilterControlType.onclick=AppUI.graphicalFilterControlTypeClick;AppUI.graphicalFilterControlEnabled=
document.getElementById("graphical-filter-control-enabled");AppUI.graphicalFilterControlEnabled.checked=b.graphicalFilterControlEnabled||!1;AppUI.graphicalFilterControlEnabled.onclick=AppUI.graphicalFilterControlEnabledClick;AppUI.stereoPannerControlEnabled=document.getElementById("stereo-panner-control-enabled");AppUI.stereoPannerControlEnabled.checked=b.stereoPannerControlEnabled||!1;AppUI.stereoPannerControlEnabled.onclick=AppUI.stereoPannerControlEnabledClick;MonoDownMixerControl.isSupported()?
(AppUI.monoDownMixerControlEnabled=document.getElementById("mono-down-mixer-control-enabled"),AppUI.monoDownMixerControlEnabled.checked=b.monoDownMixerControlEnabled||!1,AppUI.monoDownMixerControlEnabled.onclick=AppUI.monoDownMixerControlEnabledClick):(b=document.getElementById("mono-down-mixer-control-container"),b.parentNode.removeChild(b));App.frameless&&AppUI.panelContainer.classList.remove("web");window.addEventListener("resize",AppUI.adjustWindow,{passive:!0});AppUI.adjustWindow()}static init(a){if(App.player){AppUI.volumeSlider.value=
App.player.volume;App.player.onsongchange=AppUI.playerSongChange;App.player.onloadingchange=AppUI.playerLoadingChange;App.player.onpausedchange=AppUI.playerPausedChange;App.player.oncurrenttimeschange=AppUI.playerCurrentTimeSChange;App.player.onerror=AppUI.playerError;AppUI.preparePlaylist();AppUI.playerSongChange(App.player.currentSong,App.player.currentTimeMS/1E3);AppUI.centerCurrentSongIntoView();try{AppUI.playlistControl.element.focus()}catch(b){}HistoryHandler.init(Menu.historyStatePopped,Modal.historyStatePopped,
AppUI.historyStatePopped);AppUI.cover.classList.remove("in");DelayControl.delayShortCB(function(){AppUI.centerCurrentSongIntoView();DelayControl.delayFadeCB(function(){AppUI.cover&&document.body.removeChild(AppUI.cover)})})}}static adjustCover(){if(AppUI.cover){const a=document.body.getBoundingClientRect();AppUI.cover.style.transform=`scale(${a.right}, ${a.bottom})`}}static centerCurrentSongIntoView(){App.player&&App.player.playlist&&0<=App.player.playlist.currentIndex&&AppUI.playlistControl.centerItemIntoView(App.player.playlist.currentIndex)}static destroy(){zeroObject(AppUI)}static get loading(){return AppUI._loading}static get fontScale(){return AppUI._fontScale}static get smallIconSizePX(){return AppUI._smallIconSizePX}static get largeIconSizePX(){return AppUI._largeIconSizePX}static get thinBorderPX(){return AppUI._thinBorderPX}static get thickBorderPX(){return AppUI._thickBorderPX}static get buttonSizePX(){return AppUI._buttonSizePX}static get contentsSizePX(){return AppUI._contentsSizePX}static get playlistItemSizePX(){return AppUI._playlistItemSizePX}static get playlistControlElement(){return AppUI.playlistControl.element}static addZoomHandler(a){a&&
AppUI.zoomHandlers.push(a)}static removeZoomHandler(a){if(a)for(let b=AppUI.zoomHandlers.length-1;0<=b;b--)if(AppUI.zoomHandlers[b]===a){AppUI.zoomHandlers.splice(b,1);break}}static factorToZoom(a){return 1>=a?0:Math.round(4*a)-4}static zoomToFactor(a){return 0>=a?1:.25*(a+4)}static remToPX(a){return a*AppUI._1remInPX}static pxToREM(a){return a/AppUI._1remInPX}static playerSongChange(a,b){App.player&&AppUI.playlistControl&&(document.title=a&&a.title?a.title+" - FPlay":"FPlay",Strings.changeText(AppUI.titleLabel,
a&&a.title||Formatter.none),Strings.changeText(AppUI.artistLabel,a&&a.artist||Formatter.none),App.player.playlist&&0<=App.player.playlist.currentIndex&&!AppUI.playlistControl.deleteMode&&a&&AppUI.playlistControl.bringItemIntoView(App.player.playlist.currentIndex),0>b&&(b=0),AppUI.currentTimeS=b|0,a?(Strings.changeText(AppUI.songLengthLabel,a.length),Strings.changeText(AppUI.assistiveSongLengthLabel,a.length),AppUI.seekSlider&&(0<a.lengthMS?(AppUI.seekSlider.disabled=!1,AppUI.seekSlider.max=a.lengthMS):
AppUI.seekSlider.disabled=!0,AppUI.seekSlider.manuallyChangeAll(1E3*b,Formatter.formatTimeS(AppUI.currentTimeS),SliderControlValueChild.LeftChild))):(Strings.changeText(AppUI.songLengthLabel,Formatter.none),Strings.changeText(AppUI.assistiveSongLengthLabel,Formatter.none),AppUI.seekSlider&&(AppUI.seekSlider.disabled=!0,AppUI.seekSlider.manuallyChangeAll(0,Formatter.none,SliderControlValueChild.LeftChild))))}static playerLoadingChange(a){App.updateLoadingIcon()}static playerPausedChange(a){AppUI.iconPlay&&
AppUI.iconPause&&(a?(AppUI.iconPause.classList.add("hidden"),AppUI.iconPlay.classList.remove("hidden")):(AppUI.iconPlay.classList.add("hidden"),AppUI.iconPause.classList.remove("hidden")))}static playerCurrentTimeSChange(a){if(AppUI.seekSlider&&!AppUI.seekSlider.dragging){0>a&&(a=0);var b=a|0;AppUI.currentTimeS!==b?(AppUI.currentTimeS=b,AppUI.seekSlider.manuallyChangeAll(1E3*a,Formatter.formatTimeS(b),SliderControlValueChild.LeftChild)):AppUI.seekSlider.value=1E3*a}}static playerError(a){Modal.show({text:a,
returnFocusElement:AppUI.playlistControl.element})}static playlistSongLengthChange(a){App.player&&(a===App.player.currentSong&&(Strings.changeText(AppUI.songLengthLabel,a.length),Strings.changeText(AppUI.assistiveSongLengthLabel,a.length),AppUI.seekSlider&&(0<a.lengthMS?(AppUI.seekSlider.disabled=!1,AppUI.seekSlider.max=a.lengthMS):(AppUI.seekSlider.value=0,AppUI.seekSlider.disabled=!0))),AppUI.playlistControl&&AppUI.playlistControl.refreshVisibleItems())}static seekSliderValueChange(a){AppUI.seekSlider&&
AppUI.seekSlider.dragging&&(a=a/1E3|0,AppUI.currentTimeS!==a&&(AppUI.currentTimeS=a,AppUI.seekSlider.manuallyChangeAria(Formatter.formatTimeS(a),SliderControlValueChild.LeftChild)))}static seekSliderDragEnd(a){App.player&&App.player.seekTo(a)}static volumeSliderValueChange(a){App.player&&(App.player.volume=a)}static playlistControlItemClick(a,b,c){App.player&&!c&&App.player.play(b)}static playlistControlItemContextMenu(a,b){}static graphicalFilterControlTypeClick(){App.graphicalFilterControl&&(App.graphicalFilterControl.simpleMode=
!App.graphicalFilterControl.simpleMode,ButtonControl.setText(AppUI.graphicalFilterControlType,App.graphicalFilterControl.simpleMode?Strings.TraditionalFilter:Strings.AdvancedFilter))}static graphicalFilterControlEnabledClick(){App.graphicalFilterControl&&(App.graphicalFilterControl.enabled=AppUI.graphicalFilterControlEnabled.checked)}static stereoPannerControlEnabledClick(){App.stereoPannerControl&&(App.stereoPannerControl.enabled=AppUI.stereoPannerControlEnabled.checked)}static monoDownMixerControlEnabledClick(){App.monoDownMixerControl&&
(App.monoDownMixerControl.enabled=AppUI.monoDownMixerControlEnabled.checked)}static hideTopMessage(){0>AppUI.topMessageFading||!AppUI.topMessage||(AppUI.topMessageTimeout&&clearTimeout(AppUI.topMessageTimeout),AppUI.topMessageFading=-1,AppUI.topMessage.classList.remove("in"),AppUI.topMessageTimeout=DelayControl.delayFadeCB(function(){0<=AppUI.topMessageFading||(AppUI.topMessageFading=0,AppUI.topMessageTimeout=0,AppUI.topMessage.style.visibility="",AppUI.topMessage.innerHTML="",AppUI.titleLabel&&AppUI.titleLabel.classList.remove("behind"),
AppUI.artistLabel&&AppUI.artistLabel.classList.remove("behind"))}))}static showTopMessage(a,b){AppUI.topMessage&&(AppUI.topMessageTimeout&&clearTimeout(AppUI.topMessageTimeout),AppUI.topMessageFading=1,AppUI.titleLabel&&AppUI.titleLabel.classList.add("behind"),AppUI.artistLabel&&AppUI.artistLabel.classList.add("behind"),AppUI.topMessage.innerHTML=a,b&&b(AppUI.topMessage),AppUI.topMessage.style.visibility="visible",AppUI.topMessageTimeout=DelayControl.delayShortCB(function(){0>=AppUI.topMessageFading||
1!==AppUI.topMessageFading||(AppUI.topMessageFading=2,AppUI.topMessage.classList.add("in"),AppUI.topMessageTimeout=DelayControl.delayFadeCB(function(){2===AppUI.topMessageFading&&(AppUI.topMessageFading=0,AppUI.topMessageTimeout=0)}))}))}static addFiles(a){return __awaiter(this,void 0,void 0,function*(){if(App.player&&!AppUI._loading&&!Modal.visible&&!FilePicker.visible){var b=App.hostType===App.hostTypeElectron;if(FilePicker.isSupported()){var c=null;var d=FilePicker.showAddPlay(AppUI.playlistControl.element)}else c=
yield App.showOpenDialogWeb(a),d=null;if((c||d)&&App.player)try{App.player.playlist||(App.player.playlist=new Playlist,AppUI.preparePlaylist());const e=App.player.playlist,f=b?null:new Uint8Array(BufferedReader.minBufferLength),g=b?null:[new Uint8Array(2048)];let h=!1;do{let k=!1;if(d){const m=yield d();if(!m)break;k=m.play;c=m.files}if(!c)break;AppUI._loading=!0;App.updateLoadingIcon();for(let m=0;m<c.length&&App.player;m++)if(b)(yield e.addSong(c[m]))&&k&&(k=!1,App.player&&App.player.play(e.length-
1));else{const l=e.length;if(yield e.addSongWeb(c[m],f,g))l==e.length?h=!0:k&&(k=!1,App.player&&App.player.play(l))}AppUI._loading=!1;App.updateLoadingIcon()}while(d);h&&AppUI.playlistControl&&AppUI.playlistControl.refreshVisibleItems()}catch(e){Modal.show({text:"addFiles error: "+(e.message||e.toString()),returnFocusElement:AppUI.playlistControl.element})}finally{AppUI._loading=!1,App.updateLoadingIcon()}}})}static toggleDeleteMode(a){if(AppUI.playlistControl){AppUI.focusBlocker&&(AppUI.focusBlocker.unblock(),
AppUI.focusBlocker=null);AppUI.playlistControl.deleteMode?(AppUI.playlistControl.deleteMode=!1,AppUI.hideTopMessage(),a&&HistoryHandler.popState()):(AppUI.playlistControl.deleteMode=!0,AppUI.focusBlocker=new FocusBlocker,AppUI.focusBlocker.block(AppUI.middlePanel),AppUI.showTopMessage(Strings.DeleteModeHTML,function(b){const c=document.createElement("div");ButtonControl.create({color:"red",icon:"icon-delete-all",text:Strings.DeleteAllSongs,parent:c,onclick:function(){App.player&&App.player.playlist&&
App.player.playlist.clear();AppUI.playlistControl&&AppUI.playlistControl.deleteMode&&AppUI.toggleDeleteMode(!0)}});ButtonControl.create({color:"green",icon:"icon-check",text:Strings.Done,parent:c,onclick:function(){AppUI.playlistControl&&AppUI.playlistControl.deleteMode&&AppUI.toggleDeleteMode(!0)}});b.appendChild(c)}),HistoryHandler.pushState());try{AppUI.playlistControl.element.focus()}catch(b){}}}static checkPanelContainerToggleState(){if(!(875>=window.innerWidth)&&AppUI.fixedPanel&&AppUI.optionalPanel){if(AppUI.panelContainerToggling){AppUI.panelContainerToggleVersion++;
AppUI.panelContainerToggling=!1;const a=AppUI.cover.parentNode;a&&a.removeChild(AppUI.cover);AppUI.cover.classList.remove("in")}AppUI.panelContainerToggled&&(AppUI.panelContainerToggled=!1,AppUI.panelContainer.classList.remove("toggled"),HistoryHandler.popState())}}static toggleView(a){if(AppUI.panelContainer){AppUI.panelContainerToggleVersion++;const b=AppUI.panelContainerToggleVersion,c=function(d,e){AppUI.panelContainerToggling=!0;AppUI.cover.classList.remove("in");AppUI.cover.parentNode||document.body.appendChild(AppUI.cover);
DelayControl.delayShortCB(function(){return __awaiter(this,void 0,void 0,function*(){if(AppUI.panelContainerToggleVersion===b&&(AppUI.cover.classList.add("in"),yield DelayControl.delayFade(),AppUI.panelContainerToggleVersion===b&&(e?AppUI.panelContainer.classList.add("toggled"):AppUI.panelContainer.classList.remove("toggled"),AppUI.cover.classList.remove("in"),yield DelayControl.delayFade(),AppUI.panelContainerToggleVersion===b))){var f=AppUI.cover.parentNode;f&&f.removeChild(AppUI.cover);AppUI.panelContainerToggling=
!1;try{d.focus()}catch(g){}}})})};AppUI.panelContainerToggled?(AppUI.panelContainerToggled=!1,c(AppUI.playlistControl.element,!1),a&&HistoryHandler.popState()):(AppUI.panelContainerToggled=!0,c(ButtonControl.getDefaultFocusElement(AppUI.toggleViewButton),!0),HistoryHandler.pushState())}}static showSongInfo(a){a||(a=App.player&&App.player.currentSong);a?Modal.show({html:`<div class="selectable-text">
				<p><b>${Strings.Title}</b><br/>${Strings.htmlEncode(a.title)}</p>
				${a.artist?`<p><b>${Strings.Artist}</b><br/>${Strings.htmlEncode(a.artist)}</p>`:""}
				${a.album?`<p><b>${Strings.Album}</b><br/>${Strings.htmlEncode(a.album)}</p>`:""}
				${0<a.track?`<p><b>${Strings.Track}</b><br/>${a.track}</p>`:""}
				${0<a.year?`<p><b>${Strings.Year}</b><br/>${a.year}</p>`:""}
				${0<a.lengthMS?`<p><b>${Strings.Duration}</b><br/>${a.length}</p>`:""}
				${0<a.sampleRate?`<p><b>${Strings.SampleRate}</b><br/>${a.sampleRate} Hz</p>`:""}
				${0<a.channels?`<p><b>${Strings.Channels}</b><br/>${a.channels}</p>`:""}
				${a.url?`<p><b>${Strings.Path}</b><br/>${Strings.htmlEncode(a.url.startsWith(FileUtils.localURLPrefix)?a.url.substring(FileUtils.localURLPrefix.length):a.url.startsWith(FileUtils.fileURLPrefix)?decodeURI(a.url.substring(FileUtils.fileURLPrefix.length)):a.url)}</p>`:""}
			</div>`,title:Strings.SongInfo,returnFocusElement:AppUI.playlistControl.element}):Alert.show(Strings.NoSongPlaying)}static showAbout(){Modal.show({html:Strings.AboutHTML+(App.player&&App.player.audioContext?`
				<p class="large-top-margin"><small>
					Base latency: ${(App.player.audioContext.baseLatency||0).toFixed(4)} s
				</small></p><p class="small-top-margin"><small>
					Output latency: ${isNaN(App.player.audioContext.outputLatency)?"-":App.player.audioContext.outputLatency.toFixed(4)+" s"}
				</small></p><p class="small-top-margin"><small>
					Output sample rate: ${isNaN(App.player.audioContext.sampleRate)?"-":App.player.audioContext.sampleRate} Hz
				</small></p><p class="small-top-margin"><small>
					User agent: ${Strings.htmlEncode(navigator.userAgent)}
				</small></p>
			`:""),title:Strings.About+" (v"+window.CACHE_VERSION+")",returnFocusElement:AppUI.playlistControl.element})}}AppUI.primaryInputIsTouch="matchMedia"in window?window.matchMedia("(pointer: coarse)").matches:0<navigator.maxTouchPoints||0<navigator.msMaxTouchPoints;AppUI.baseSizePX=4;AppUI.s1PX=AppUI.baseSizePX;AppUI.s2PX=2*AppUI.baseSizePX;AppUI.s3PX=3*AppUI.baseSizePX;AppUI.s4PX=4*AppUI.baseSizePX;AppUI.s5PX=5*AppUI.baseSizePX;AppUI.s6PX=6*AppUI.baseSizePX;AppUI.s7PX=7*AppUI.baseSizePX;
AppUI.s8PX=8*AppUI.baseSizePX;AppUI.smallFontSizeREM=3;AppUI.smallContentsSizeREM=4;AppUI.fontSizeREM=3.5;AppUI.contentsSizeREM=6;AppUI.baseThinBorderPX=1;AppUI.baseThickBorderPX=2;AppUI.zoomHandlers=[];AppUI.rootVariables=document.getElementById("root-variables");AppUI.cover=document.getElementById("cover");AppUI.panelContainer=document.getElementById("panel-container");AppUI.fixedPanel=document.getElementById("fixed-panel");AppUI.middlePanel=document.getElementById("middle-panel");
AppUI.optionalPanel=document.getElementById("optional-panel");AppUI.iconPlay=document.getElementById("i-play");AppUI.iconPause=document.getElementById("i-pause");AppUI.ruler=document.getElementById("ruler");AppUI.titleLabel=document.getElementById("title-label");AppUI.artistLabel=document.getElementById("artist-label");AppUI.assistiveSongLengthLabel=document.getElementById("assistive-song-length-label");AppUI.topMessage=document.getElementById("top-message");AppUI.toggleViewButton=document.getElementById("toggle-view-button");
AppUI._loading=!1;AppUI.devicePixelRatio=-1;AppUI._1remInPX=1;AppUI._fontScale=1;AppUI._smallIconSizePX=Icon.baseSizePX;AppUI._largeIconSizePX=Icon.baseSizePX<<1;AppUI._thinBorderPX=AppUI.baseThinBorderPX;AppUI._thickBorderPX=AppUI.baseThickBorderPX;AppUI._buttonSizePX=1;AppUI._contentsSizePX=1;AppUI._playlistItemSizePX=1;AppUI.directoryCancelled=!1;AppUI.topMessageFading=0;AppUI.topMessageTimeout=0;AppUI.focusBlocker=null;AppUI.panelContainerToggled=!1;AppUI.panelContainerToggling=!1;
AppUI.panelContainerToggleVersion=0;
class App{static saveSettings(a){App.player&&App.player.alive&&(App.player.setPlaylistData(),InternalStorage.saveAppSettings({devicePixelRatio,playerVolume:App.player.volume,graphicalFilterControlEnabled:App.graphicalFilterControl?App.graphicalFilterControl.enabled:!1,graphicalFilterControlSimpleMode:App.graphicalFilterControl?App.graphicalFilterControl.simpleMode:!0,stereoPannerControlEnabled:App.stereoPannerControl?App.stereoPannerControl.enabled:!1,monoDownMixerControlEnabled:App.monoDownMixerControl?App.monoDownMixerControl.enabled:
!1,filePickerLastPath:FilePicker.lastPath,filePickerRootLength:FilePicker.lastRootLength}),App.graphicalFilterControl&&App.graphicalFilterControl.saveSettings(),App.stereoPannerControl&&App.stereoPannerControl.saveSettings(),a&&App.player.playlist&&InternalStorage.savePlaylistWeb(App.player.playlist))}static mainWindowStateChanged(a,b,c){if(App.isMinimized!==b||App.isMaximized!==c)App.isMinimized=b,App.isMaximized=c,b||(App.titleBar&&(App.titleBar.className=c?"maximized":""),App.iconRestore&&(App.iconRestore.className=
c?"":"hidden"),App.iconMaximize&&(App.iconMaximize.className=c?"hidden":""))}static mainWindowClosing(){if(App.player&&App.player.alive){const a=App.closeHandlers,b=[];App.saveSettings(!0);App.player.destroy(!0);if(a&&a.length)for(let c=a.length-1;0<=c;c--)if(a[c]){const d=a[c]();d&&b.push(d)}App.hostInterface&&(b.length?Promise.all(b).then(App.destroy,App.destroy):App.destroy())}}static destroy(){App.player&&App.player.destroy();AppUI.destroy();const a=App.ipcRenderer;zeroObject(App);a&&a.invoke("mainWindowFinalClose")}static updateLoadingIcon(){App.iconLoading&&
(App.iconLoading.style.display=App.loading?"":"none")}static get loading(){return(App.player?App.player.loading:!1)||AppUI.loading||App._loading}static set loading(a){App._loading!==a&&(App._loading=a,App.updateLoadingIcon())}static get installPromptReady(){return!!App.installPrompt}static showInstallPrompt(){const a=App.installPrompt;if(a&&a.prompt)try{App.installPrompt=null,a.prompt()}catch(b){}}static beforeInstallPrompt(a){"preventDefault"in a&&a.preventDefault();App.installPrompt=a}static sortFiles(a){if(a.length){const b=
Strings.comparer;a[0]["data-path"]?a.sort(function(c,d){return b(c["data-path"],d["data-path"])}):a[0].webkitRelativePath?a.sort(function(c,d){return b(c.webkitRelativePath,d.webkitRelativePath)}):a.sort(function(c,d){return b(c.name,d.name)})}return a}static preInit(){return __awaiter(this,void 0,void 0,function*(){Strings.init();Icon.init();GraphicalFilterEditorStrings.init(Strings.language);Strings.toFixed=GraphicalFilterEditorStrings.toFixed;if(!App.hostInterface&&FileSystemAPI.isSupported())try{yield FileSystemAPI.init()}catch(c){Alert.show(c.message||
c.toString())}const a=InternalStorage.loadAppSettings(),b=window.electronWebFrame;App.ipcRenderer&&delete window.electronIpcRenderer;b&&delete window.electronWebFrame;if("serviceWorker"in navigator&&!location.href.startsWith("file://")){window.addEventListener("beforeinstallprompt",App.beforeInstallPrompt);const c=navigator.serviceWorker.register("sw.js");c&&"then"in c&&c.then(function(d){d&&"onupdatefound"in d&&d.active&&(d.onupdatefound=function(){Modal.show({html:Strings.PleaseRefresh,title:Strings.UpdateAvailable,
returnFocusElement:AppUI.playlistControlElement,okText:Strings.Refresh,okCancel:!0,onok:function(){window.location.reload()}})})})}App.ipcRenderer?(App.ipcRenderer.on("mainWindowStateChanged",App.mainWindowStateChanged),App.ipcRenderer.on("mainWindowClosing",App.mainWindowClosing),App.triggerMainWindowStateChanged()):App.hostInterface||window.addEventListener("onpagehide"in window?"pagehide":"unload",App.mainWindowClosing);App.frameless&&(App.titleBar=document.createElement("h1"),App.titleBar.innerHTML=
`
				<div></div>
				<i id="icon-main"></i>
				FPlay
				<span><span role="button" onclick="App.mainWindowMinimize()">${Icon.createHTML("icon-minimize",!1)}</span><span role="button" onclick="App.mainWindowRestoreOrMaximize()">${Icon.createHTML("icon-restore",!1,"hidden","icon-restore-i")}${Icon.createHTML("icon-maximize",!1,null,"icon-maximize-i")}</span><span role="button" class="close" onclick="App.mainWindowClose()">${Icon.createHTML("icon-close",!1)}</span></span>
			`,document.body.insertBefore(App.titleBar,document.body.firstChild),App.iconRestore=document.getElementById("icon-restore-i"),App.iconMaximize=document.getElementById("icon-maximize-i"));AppUI.preInit(b,a);App.init(a)})}static init(a){App.player||(App.player=new Player(a.playerVolume,InternalStorage.loadPlaylistWeb(),HostMediaSession.getMediaSession(),function(b){App.graphicalFilterControl=new GraphicalFilterControl(document.getElementById("filter-container"),document.getElementById("optional-panel-container"),
b,a.graphicalFilterControlSimpleMode);App.graphicalFilterControl.enabled=!!a.graphicalFilterControlEnabled;return App.graphicalFilterControl},function(b){App.stereoPannerControl=new StereoPannerControl(document.getElementById("stereo-panner-slider"),b);App.stereoPannerControl.enabled=!!a.stereoPannerControlEnabled;App.stereoPannerControl.onappliedgainchange=function(c){App.monoDownMixerControl&&(App.monoDownMixerControl.multiplier=1/(1+c))};return App.stereoPannerControl},function(b){App.monoDownMixerControl=
new MonoDownMixerControl(b);App.monoDownMixerControl.enabled=MonoDownMixerControl.isSupported()&&!!a.monoDownMixerControlEnabled;return App.monoDownMixerControl}),AppUI.init(a),App.loading=!1)}static triggerMainWindowStateChanged(){App.ipcRenderer&&App.ipcRenderer.invoke("triggerMainWindowStateChanged")}static mainWindowMinimize(){App.ipcRenderer&&App.ipcRenderer.invoke("mainWindowMinimize")}static mainWindowRestoreOrMaximize(){App.ipcRenderer&&App.ipcRenderer.invoke(App.isMaximized?"mainWindowRestore":
"mainWindowMaximize")}static mainWindowClose(){App.ipcRenderer&&App.ipcRenderer.invoke("mainWindowClose")}static extractMetadata(a,b){return App.ipcRenderer.invoke("extractMetadata",a,b)}static showOpenDialogWeb(a,b){const c=document.createElement("input");c.setAttribute("type","file");c.setAttribute("multiple","multiple");c.setAttribute("aria-label",Strings.AddSongs);a&&(c.setAttribute("webkitdirectory","webkitdirectory"),c.setAttribute("directory","directory"));c.onchange=function(){if(App.fileInputPromiseResolve){var e=
App.fileInputPromiseResolve;App.fileInputPromiseResolve=null;if(c.files&&c.files.length&&(1!==c.files.length||FileUtils.isTypeSupported(c.files[0].name))){var f=Array(c.files.length);for(let g=f.length-1;0<=g;g--)f[g]=c.files[g];c.value="";e(b?f:App.sortFiles(f))}else e(null)}};a=App.fileInputPromiseResolve;App.fileInputPromiseResolve=null;const d=new Promise(function(e){App.fileInputPromiseResolve=e});c.click();a&&a(null);return d}}App.hostTypeElectron="Electron";App.hostTypeAndroid="Android";
App.ipcRenderer=window.electronIpcRenderer||null;App.closeHandlers=[];App.frameless=!!window.electronIpcRenderer;App.hostInterface=window.hostInterface||null;App.hostType=App.hostInterface&&App.hostInterface.getHostType()||null;App.iconLoading=document.getElementById("icon-loading");App.titleBar=null;App.iconRestore=null;App.iconMaximize=null;App.installPrompt=null;App.fileInputPromiseResolve=null;App._loading=!0;App.isMinimized=!1;App.isMaximized=!1;
function main(){App.preInit().catch(console.error)}let cLib;function cancelEvent(a){a&&("isCancelled"in a&&(a.isCancelled=!0),!("preventDefault"in a)||"cancelable"in a&&!a.cancelable||a.preventDefault(),"stopPropagation"in a&&a.stopPropagation());return!1}function lerp(a,b,c,d,e){return(e-a)*(d-b)/(c-a)+b}function smoothStep(a,b,c){a=(c-a)/(b-a);return 0>=a?0:1<=a?1:a*a*(3-2*a)}
function zeroObject(a){for(let b in a)switch(typeof a[b]){case "function":break;case "boolean":a[b]=!1;break;case "number":a[b]=0;break;default:const c=a[b];Array.isArray(c)&&c.fill(null);a[b]=null}}
function setup(){function a(c){window.CLib(c).then(function(d){cLib=d;window.main&&window.main()},function(d){alert(d);throw d;})}Array.prototype.fill||(Array.prototype.fill=function(c,d,e){var f=this.length|0;d|=0;e=void 0===e?f:e|0;e=0>e?Math.max(f+e,0):Math.min(e,f);for(d=0>d?Math.max(f+d,0):Math.min(d,f);d<e;)this[d++]=c;return this});var b=window.CLibWasmBinary;b?(delete window.CLibWasmBinary,Promise.resolve(b).then(function(c){a({wasmBinary:c})},function(){a()})):(b=window.CLibMemoryArrayBuffer)?
(delete window.CLibMemoryArrayBuffer,Promise.resolve(b).then(function(c){a({memoryInitializerRequest:{status:200,response:c}})},function(){a()})):a()}setup();
