'use strict';class Icon{static init(){const a=document.getElementsByTagName("i");if(a)for(let b=a.length-1;0<=b;b--)Icon.prepare(a[b])}static prepare(a){if(!a)return null;const b=a.className;let c;if(b&&0<=(c=b.indexOf("icon-"))&&a.parentNode){const d=b.indexOf(" ",c);return Icon.create(d>c?b.substring(c,d):b.substring(c),d>c?b.substring(0,c)+b.substring(d+1):b.substring(0,c),null,a)}return null}static createHTML(a,b,c,d){return`<i class="icon ${b?"large":""} ${c||""}" ${d?"id="+d:""}><svg viewBox="${Icon.viewBox}">${Icon.paths[a]}</svg></i>`}static create(a,
b,c,d){d=d||document.createElement("i");const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("viewBox",Icon.viewBox);e.innerHTML=Icon.paths[a];c&&d.setAttribute("id",c);d.className=b?"icon "+b:"icon";d.appendChild(e);return d}static createLarge(a,b,c){return Icon.create(a,b?b+" large":"large",c)}}Icon.outerSizeREM=6;Icon.baseSizePX=12;Icon.viewBox=`0 0 ${Icon.baseSizePX} ${Icon.baseSizePX}`;
Icon.paths={"icon-add-folder":'<path d="M 11,3 H 6 L 5,2 H 1 v 8 H 11 Z M 9.5,7 H 8 V 8.5 H 7 V 7 H 5.5 V 6 H 7 V 4.5 H 8 V 6 h 1.5 z" />',"icon-add-title":'<path d="M 4.5 1.5 L 4.5 6.7753906 C 4.205 6.6053906 3.865 6.5 3.5 6.5 C 2.395 6.5 1.5 7.395 1.5 8.5 C 1.5 9.605 2.395 10.5 3.5 10.5 C 4.605 10.5 5.5 9.605 5.5 8.5 L 5.5 3.5 L 7.5 3.5 L 7.5 1.5 L 4.5 1.5 z M 8 6.5 L 8 8 L 6.5 8 L 6.5 9 L 8 9 L 8 10.5 L 9 10.5 L 9 9 L 10.5 9 L 10.5 8 L 9 8 L 9 6.5 L 8 6.5 z" />',"icon-artist":'<path d="M 6 1 C 5.17 1 4.5 1.67 4.5 2.5 L 4.5 5.5 C 4.5 6.33 5.17 7 6 7 C 6.83 7 7.5 6.33 7.5 5.5 L 7.5 2.5 C 7.5 1.67 6.83 1 6 1 z M 2.5 5.5 C 2.5 7.265 3.805 8.7159375 5.5 8.9609375 L 5.5 10.5 L 6.5 10.5 L 6.5 8.9609375 C 8.195 8.7159375 9.5 7.265 9.5 5.5 L 8.5 5.5 C 8.5 6.88 7.38 8 6 8 C 4.62 8 3.5 6.88 3.5 5.5 L 2.5 5.5 z" />',
"icon-check":'<path d="M 4.5,8.085 2.415,6 1.705,6.705 4.5,9.5 l 6,-6 -0.705,-0.705 z" />',"icon-checkbox-0":'<path d="M 9,3 V 9 H 3 V 3 H 9 M 10,2 H 2 v 8 h 8 z" />',"icon-checkbox-1":'<path d="M 10,2 H 2 v 8 h 8 z M 5,8.5 2.5,6 3.205,5.295 5,7.085 8.795,3.29 9.5,4 Z" />',"icon-clear":'<path d="M 9.5,3.205 8.795,2.5 6,5.295 3.205,2.5 2.5,3.205 5.295,6 2.5,8.795 3.205,9.5 6,6.705 8.795,9.5 9.5,8.795 6.705,6 Z" />',"icon-close":'<path d="M 1.7070312 1 L 1 1.7070312 L 5.2929688 6 L 1 10.292969 L 1.7070312 11 L 6 6.7070312 L 10.292969 11 L 11 10.292969 L 6.7070312 6 L 11 1.7070312 L 10.292969 1 L 6 5.2929688 L 1.7070312 1 z" />',
"icon-expand-less":'<path d="M 6,4 3,7 3.705,7.705 6,5.415 8.295,7.705 9,7 Z" />',"icon-expand-more":'<path d="M 8.295,4.295 6,6.585 3.705,4.295 3,5 6,8 9,5 Z" />',"icon-filter":'<path d="m 1.5,8.5 v 1 h 3 v -1 z m 0,-6 v 1 h 5 v -1 z m 5,8 v -1 h 4 v -1 h -4 v -1 h -1 v 3 z m -3,-6 v 1 h -2 v 1 h 2 v 1 h 1 v -3 z m 7,2 v -1 h -5 v 1 z m -3,-2 h 1 v -1 h 2 v -1 h -2 v -1 h -1 z" />',"icon-folder":'<path d="M 5,2 H 1 v 8 H 11 V 3 H 6 Z" />',"icon-folder-open":'<path d="M 11,3 H 6 L 5,2 H 1 v 8 H 11 Z M 10,9 H 2 V 4 h 8 z" />',
"icon-maximize":'<path d="M 0 0 L 0 12 L 12 12 L 12 0 L 0 0 z M 1 1 L 11 1 L 11 11 L 1 11 L 1 1 z" />',"icon-menu":'<path d="m 1.5,9 h 9 V 8 h -9 z m 0,-2.5 h 9 v -1 h -9 z M 1.5,3 v 1 h 9 V 3 Z" />',"icon-minimize":'<path d="M 1,6 H 11 V 7 H 1 Z" />',"icon-more-h":'<path d="M 3,5 C 2.45,5 2,5.45 2,6 2,6.55 2.45,7 3,7 3.55,7 4,6.55 4,6 4,5.45 3.55,5 3,5 Z M 9,5 C 8.45,5 8,5.45 8,6 8,6.55 8.45,7 9,7 9.55,7 10,6.55 10,6 10,5.45 9.55,5 9,5 Z M 6,5 C 5.45,5 5,5.45 5,6 5,6.55 5.45,7 6,7 6.55,7 7,6.55 7,6 7,5.45 6.55,5 6,5 Z" />',
"icon-more-v":'<path d="M 6,4 C 6.55,4 7,3.55 7,3 7,2.45 6.55,2 6,2 5.45,2 5,2.45 5,3 5,3.55 5.45,4 6,4 Z M 6,5 C 5.45,5 5,5.45 5,6 5,6.55 5.45,7 6,7 6.55,7 7,6.55 7,6 7,5.45 6.55,5 6,5 Z M 6,8 C 5.45,8 5,8.45 5,9 5,9.55 5.45,10 6,10 6.55,10 7,9.55 7,9 7,8.45 6.55,8 6,8 Z" />',"icon-next":'<path d="M 3,2 V 10 L 8,6 Z M 8,6 V 10 H 9 V 2 H 8 Z" />',"icon-pause":'<path d="M 3 2 L 3 10 L 5 10 L 5 2 L 3 2 z M 7 2 L 7 10 L 9 10 L 9 2 L 7 2 z" />',"icon-play":'<path d="M 3,2 9,6 3,10 Z" />',"icon-playlist":'<path d="m 7.5,3 h -6 v 1 h 6 z m 0,2 h -6 v 1 h 6 z m -6,3 h 4 V 7 h -4 z m 7,-5 V 7.09 C 8.345,7.035 8.175,7 8,7 7.17,7 6.5,7.67 6.5,8.5 6.5,9.33 7.17,10 8,10 8.83,10 9.5,9.33 9.5,8.5 V 4 H 11 V 3 Z" />',
"icon-previous":'<path d="M 9,2 V 10 L 4,6 Z M 4,6 V 10 H 3 V 2 h 1 z" />',"icon-radio":'<path d="M 11,6 A 5,5 0 0 1 6,11 5,5 0 0 1 1,6 5,5 0 0 1 6,1 5,5 0 0 1 11,6 Z" />',"icon-radiobutton-0":'<path d="M 6,1 C 3.24,1 1,3.24 1,6 1,8.76 3.24,11 6,11 8.76,11 11,8.76 11,6 11,3.24 8.76,1 6,1 Z m 0,9 C 3.79,10 2,8.21 2,6 2,3.79 3.79,2 6,2 c 2.21,0 4,1.79 4,4 0,2.21 -1.79,4 -4,4 z" />',"icon-radiobutton-1":'<path d="M 6 1 C 3.24 1 1 3.24 1 6 C 1 8.76 3.24 11 6 11 C 8.76 11 11 8.76 11 6 C 11 3.24 8.76 1 6 1 z M 6 2 C 8.21 2 10 3.79 10 6 C 10 8.21 8.21 10 6 10 C 3.79 10 2 8.21 2 6 C 2 3.79 3.79 2 6 2 z M 6 3.5 A 2.5 2.5 0 0 0 3.5 6 A 2.5 2.5 0 0 0 6 8.5 A 2.5 2.5 0 0 0 8.5 6 A 2.5 2.5 0 0 0 6 3.5 z" />',
"icon-restore":'<path d="M 2 0 L 2 2 L 0 2 L 0 12 L 10 12 L 10 10 L 12 10 L 12 0 L 2 0 z M 3 1 L 11 1 L 11 9 L 10 9 L 10 2 L 3 2 L 3 1 z M 1 3 L 9 3 L 9 11 L 1 11 L 1 3 z" />',"icon-stop":'<path d="m 2,2 h 8 v 8 H 2 Z" />',"icon-title":'<path d="M 6,1.5 V 6.775 C 5.705,6.605 5.365,6.5 5,6.5 c -1.105,0 -2,0.895 -2,2 0,1.105 0.895,2 2,2 1.105,0 2,-0.895 2,-2 v -5 h 2 v -2 z" />',"icon-volume":'<path d="m 1.5,4.5 v 3 h 2 L 6,10 V 2 L 3.5,4.5 Z M 8.25,6 C 8.25,5.115 7.74,4.355 7,3.985 V 8.01 C 7.74,7.645 8.25,6.885 8.25,6 Z M 7,1.615 v 1.03 C 8.445,3.075 9.5,4.415 9.5,6 9.5,7.585 8.445,8.925 7,9.355 v 1.03 C 9.005,9.93 10.5,8.14 10.5,6 10.5,3.86 9.005,2.07 7,1.615 Z" />'};
class Strings{static init(){const a=navigator.userLanguage||navigator.language;a&&0===a.toLowerCase().indexOf("pt")&&(Strings.language="pt-br",document.documentElement.setAttribute("lang","pt-br"),Strings.DecimalSeparator=",",Strings.OppositeDecimalSeparator=".",Strings.Edit="Edit",Strings.Delete="Excluir",Strings.Enable="Habilitar",Strings.Disable="Desabilitar",Strings.Enabled="Habilitado",Strings.Disabled="Desabilitado",Strings.Cancel="Cancelar",Strings.Clear="Limpar",Strings.Back="Voltar",Strings.Close=
"Fechar",Strings.Exit="Sair",Strings.Previous="Anterior",Strings.Play="Tocar",Strings.Pause="Pausar",Strings.PlayPause="Tocar / Pausar",Strings.Stop="Parar",Strings.Next="Pr\u00f3xima",Strings.UnknownError="Erro desconhecido",Strings.AddFiles="Adicionar Arquivos",Strings.AddFolders="Adicionar Pastas",Strings.ShowFilter="Exibir Filtro",Strings.ShowPlaylist="Exibir Lista",Strings.UpdateAvailable="Atualiza\u00e7\u00e3o Dispon\u00edvel!",Strings.PleaseRefresh="Por favor, recarregue a p\u00e1gina para atualizar a aplica\u00e7\u00e3o \ud83d\ude0a");
Strings.translateChildren(document.body)}static translate(a){const b=Strings[a];return void 0!==b?b:a}static translateChildren(a){a=a.childNodes;for(let d=a.length-1;0<=d;d--){const e=a[d];if(!e.tagName)continue;e.childNodes&&e.childNodes.length&&Strings.translateChildren(e);let f;(f=e.getAttribute("title"))&&e.setAttribute("title",Strings.translate(f));if(f=e.getAttribute("data-string")){e.removeAttribute("data-string");var b=0;do{let g=f.indexOf(";",b);g<b&&(g=f.length);var c=f.indexOf("|",b);0>
c||c>=g?e.appendChild(document.createTextNode(Strings.translate(f))):(b=f.substring(b,c),c=f.substring(c+1,g),e.setAttribute(b,Strings.translate(c)));b=g+1}while(b<f.length)}}}}Strings.language="en";Strings.DecimalSeparator=".";Strings.OppositeDecimalSeparator=",";Strings.Oops="Oops\u2026";Strings.Menu="Menu";Strings.Edit="Edit";Strings.Delete="Delete";Strings.Enable="Enable";Strings.Disable="Disable";Strings.Enabled="Enabled";Strings.Disabled="Disabled";Strings.OK="OK";Strings.Cancel="Cancel";
Strings.Clear="Clear";Strings.Back="Back";Strings.Close="Close";Strings.Exit="Exit";Strings.Previous="Previous";Strings.Play="Play";Strings.Pause="Pause";Strings.PlayPause="Play / Pause";Strings.Stop="Stop";Strings.Next="Next";Strings.Volume="Volume";Strings.UnknownError="Unknown error";Strings.AddFiles="Add Files";Strings.AddFolders="Add Folders";Strings.ShowFilter="Show Filter";Strings.ShowPlaylist="Show Playlist";Strings.UpdateAvailable="Update Available!";Strings.PleaseRefresh="Please, refresh the page to update the app \ud83d\ude0a";
class DataReader{constructor(a){this.arrayBuffer=a;this.dataView=new DataView(a);this.textDecoder=new TextDecoder("utf-8",{ignoreBOM:!0});this._position=0;this.length=a.byteLength}get position(){return this._position}get available(){return this.length-this._position}destroy(){zeroObject(this)}readInt8(){return this.dataView.getInt8(this._position++)}readUint8(){return this.dataView.getUint8(this._position++)}readInt16(){const a=this.dataView.getInt16(this._position,!0);this._position+=2;return a}readUint16(){const a=
this.dataView.getUint16(this._position,!0);this._position+=2;return a}readInt32(){const a=this.dataView.getInt32(this._position,!0);this._position+=4;return a}readFloat32(){const a=this.dataView.getFloat32(this._position,!0);this._position+=4;return a}readFloat64(){const a=this.dataView.getFloat64(this._position,!0);this._position+=8;return a}readString(){const a=this.dataView.getUint16(this._position,!0);this._position+=2;return a?this.textDecoder.decode(this.arrayBuffer.slice(this._position,this._position+=
a)):""}}
class DataWriter{constructor(a){this._capacity=a&&0<a?a:16384;this.arrayBuffer=new ArrayBuffer(this._capacity);this.dataView=new DataView(this.arrayBuffer);this.textEncoder=new TextEncoder;this._length=0}get trimmedArrayBuffer(){return this.arrayBuffer.slice(0,this._length)}get length(){return this._length}get capacity(){return this._capacity}destroy(){zeroObject(this)}ensureCapacity(a){a=this._length+a;a<=this._capacity||(a=new ArrayBuffer(a+(a>>2)),(new Uint8Array(a)).set(new Uint8Array(this.arrayBuffer)),this.arrayBuffer=
a,this.dataView=new DataView(this.arrayBuffer),this._capacity=a.byteLength)}writeInt8(a){this.ensureCapacity(1);this.dataView.setInt8(this._length++,a);return this}writeUint8(a){this.ensureCapacity(1);this.dataView.setUint8(this._length++,a);return this}writeInt16(a){this.ensureCapacity(2);this.dataView.setInt16(this._length,a,!0);this._length+=2;return this}writeUint16(a){this.ensureCapacity(2);this.dataView.setUint16(this._length,a,!0);this._length+=2;return this}writeInt32(a){this.ensureCapacity(4);
this.dataView.setInt32(this._length,a,!0);this._length+=4;return this}writeFloat32(a){this.ensureCapacity(4);this.dataView.setFloat32(this._length,a,!0);this._length+=4;return this}writeFloat64(a){this.ensureCapacity(8);this.dataView.setFloat64(this._length,a,!0);this._length+=8;return this}writeString(a){if(!a)return this.writeInt16(0);this.ensureCapacity(2+6*a.length);a=this.textEncoder.encodeInto(a,new Uint8Array(this.arrayBuffer,this._length+2));if(!a.written)throw Error("String encoding error");
if(65535<a.written)throw Error("String too large");this.dataView.setUint16(this._length,a.written,!0);this._length+=2+a.written;return this}}
class BufferedFileHandle{constructor(a,b){if(b.length<BufferedFileHandle.minBufferLength)throw Error("Buffer length too small: "+b.length);this.file=a;this.fileLength=a.size;this.buffer=b;this._bufferAvailable=this.bufferPosition=this.position=0;this._eof=!1}get bufferAvailable(){return this._bufferAvailable}get eof(){return this._eof}seekTo(a){if(0>a)throw Error("Invalid position");this._bufferAvailable=this.bufferPosition=0;a>=this.fileLength?(this.position=this.fileLength,this._eof=!0):(this.position=
a,this._eof=!1)}skip(a){0>=a||(a>=this._bufferAvailable?(a-=this._bufferAvailable,this.position+=a,this.position>=this.fileLength&&(this.position=this.fileLength,this._eof=!0),this._bufferAvailable=this.bufferPosition=0):(this.bufferPosition+=a,this._bufferAvailable-=a))}fillBuffer(a){if(0>=a)a=this.buffer.length;else if(0>a||a>this.buffer.length)throw Error("Invalid length");const b=this._bufferAvailable;if(a<=b||this._eof)return null;a=this.buffer.length;b&&this.bufferPosition&&(this.buffer.copyWithin(0,
this.bufferPosition,this.bufferPosition+b),this.bufferPosition=0);a-=b;return new Promise((c,d)=>{this.file.slice(this.position,this.position+a).arrayBuffer().then(e=>{e.byteLength?(this.position+=e.byteLength,this.position>=this.fileLength&&(this.position=this.fileLength,this._eof=!0),this._bufferAvailable+=e.byteLength):this._eof=!0;this.buffer.set(new Uint8Array(e),b);c()},d)})}readByte(){if(!this._bufferAvailable)return-1;this._bufferAvailable--;return this.buffer[this.bufferPosition++]}readUInt32BE(){if(4>
this._bufferAvailable)return null;this._bufferAvailable-=4;return this.buffer[this.bufferPosition++]<<24|this.buffer[this.bufferPosition++]<<16|this.buffer[this.bufferPosition++]<<8|this.buffer[this.bufferPosition++]}readUInt32LE(){if(4>this._bufferAvailable)return null;this._bufferAvailable-=4;return this.buffer[this.bufferPosition++]|this.buffer[this.bufferPosition++]<<8|this.buffer[this.bufferPosition++]<<16|this.buffer[this.bufferPosition++]<<24}readUInt16BE(){if(2>this._bufferAvailable)return null;
this._bufferAvailable-=2;return this.buffer[this.bufferPosition++]<<8|this.buffer[this.bufferPosition++]}readUInt16LE(){if(2>this._bufferAvailable)return null;this._bufferAvailable-=2;return this.buffer[this.bufferPosition++]|this.buffer[this.bufferPosition++]<<8}read(a,b,c){if(0>c)throw Error("Invalid length");const d=this._bufferAvailable;if(c<=d)return a.set(this.buffer.subarray(this.bufferPosition,this.bufferPosition+=c),b),this._bufferAvailable-=c,this._bufferAvailable||(this.bufferPosition=
0),c;let e=0;d&&(a.set(this.buffer.subarray(this.bufferPosition,this.bufferPosition+d),b),e+=d,b+=d,c-=d,this._bufferAvailable=this.bufferPosition=0);return this._eof?e:new Promise((f,g)=>{this.file.slice(this.position,this.position+c).arrayBuffer().then(h=>{h.byteLength?(this.position+=h.byteLength,this.position>=this.fileLength&&(this.position=this.fileLength,this._eof=!0)):this._eof=!0;a.set(new Uint8Array(h),b);f(h.byteLength+e)},g)})}}BufferedFileHandle.minBufferLength=32768;
class MetadataExtractor{static async extractRIFF(a,b,c){if(44>b.fileLength)return null;var d=b.readUInt32LE();if(null===d||b.fileLength<8+d)return null;var e=d;let f=!1,g=!1,h=d=0,k=0;a:for(;0<e;){var m=!1,l=0,p=void 0;switch(b.readUInt32BE()){case null:break a;case 1463899717:m=!0;e-=4;break;case 1279873876:l=b.readUInt32LE();if(null===l)break a;e-=8;if(0>l||l>e)break a;break;case 1768174368:l=b.readUInt32LE();if(null===l)break a;e-=8;if(0>l||l>e)break a;(p=b.fillBuffer(1024))&&await p;if(4<l){m=
b.readByte();var n=b.readByte();p=b.readByte();if(null===m||null===n||null===p)break a;e-=3;l-=3;if(73===m||68===n||51===p)if(d=b.fileLength-e,f&&g){d=-1;break a}}b.skip(l);(p=b.fillBuffer(1024))&&await p;continue;default:l=b.readUInt32LE();if(null===l)break a;e-=8;if(0>l||l>e)break a;b.skip(l);(p=b.fillBuffer(1024))&&await p;continue}for((p=b.fillBuffer(1024))&&await p;m&&(!f||!g)||0<l;){var q=b.readUInt32BE();n=0;if(null===q)break a;e-=4;l-=4;if(1229866575!==q){n=b.readUInt32LE();if(null===n||0>
n||n>e||!m&&n>l)break a;e-=4;l-=4}1684108385!==q&&(p=b.fillBuffer(Math.min(264,8+n)))&&await p;switch(q){case 1718449184:if(!m)break;p=b.readUInt16LE();q=b.readUInt16LE();var t=b.readUInt32LE(),u=b.readUInt32LE(),r=b.readUInt16LE();const y=b.readUInt16LE();n-=16;e-=16;l-=16;if(null===p||null===q||null===t||null===u||null===r||null===y)break a;f=!0;k||(k=u);break;case 1684108385:m&&(g=!0,h||(h=n));break;case 1229866575:for(q=function(x){b.read(c,0,x);return MetadataExtractor.finishReadingV2Frame(0,
x,c)};0<l;){(p=b.fillBuffer(8))&&await p;t=b.readUInt32BE();e-=4;l-=4;if(null===t)break a;u=b.readUInt32LE();e-=4;l-=4;if(null===u||0>u||u>l)break a;if(1>=u)b.skip(u);else{r=Math.min(257,u)-1;(p=b.fillBuffer(r))&&await p;switch(t){case 1229865293:a.title=q(r);break;case 1230000708:a.album=q(r);break;case 1229017684:a.artist=q(r);break;case 1229148740:a.year=parseInt(q(r))||0;break;case 1230262859:a.track=parseInt(q(r))||0;break;default:r=0}b.skip(u-r);e-=u;l-=u}}}0<n&&(b.skip(n),e-=n,l-=n);e&&(p=
b.fillBuffer(8))&&await p}}return f&&g?(d&&(0<d&&b.seekTo(d),(e=b.fillBuffer(1024))&&await e),a.lengthMS=1E3*h/k|0,[a,!!d]):null}static finishReadingV2Frame(a,b,c){let d=0;var e=b-1;a:for(;0<b;)switch(c[d]){case 0:case 9:case 10:case 11:case 12:case 13:case 32:case 133:case 160:b--;d++;break;default:break a}a:for(;0<b;)switch(c[e]){case 0:case 9:case 10:case 11:case 12:case 13:case 32:case 133:case 160:b--;e--;break;default:break a}e=null;switch(a){case 0:e=MetadataExtractor.textDecoderIso88591.decode(c.subarray(d,
d+b));break;case 1:b&1&&d+b<c.length&&b++;e=MetadataExtractor.textDecoderUtf16.decode(c.subarray(d,d+b));break;case 2:b&1&&d+b<c.length&&b++;e=MetadataExtractor.textDecoderUtf16be.decode(c.subarray(d,d+b));break;case 3:e=MetadataExtractor.textDecoderUtf8.decode(c.subarray(d,d+b))}return e&&e.length?e:null}static readV2Frame(a,b,c){if(2>b)return a.skip(b),null;const d=a.readByte();b--;if(0>d||3<d)return a.skip(b),null;let e=c[0];b>e.length&&(e=new Uint8Array(b+16),c[0]=e);a=a.read(e,0,b);return"number"===
typeof a?MetadataExtractor.finishReadingV2Frame(d,a,e):a.then(function(f){return MetadataExtractor.finishReadingV2Frame(d,f,e)})}static async extractID3v1(a,b,c,d){try{b.seekTo(b.fileLength-128);const g=b.read(d,0,128);"number"!==typeof g&&await g;if(84==d[0]&&65==d[1]&&71==d[2]){var e;if(!(c&MetadataExtractor.TITLE_B)){var f=3;for(e=0;30>e&&d[f];)e++,f++;e&&(a.title=MetadataExtractor.textDecoderIso88591.decode(d.subarray(3,3+e)))}if(!(c&MetadataExtractor.ARTIST_B)){f=33;for(e=0;30>e&&d[f];)e++,f++;
e&&(a.artist=MetadataExtractor.textDecoderIso88591.decode(d.subarray(33,33+e)))}if(!(c&MetadataExtractor.ALBUM_B)){f=63;for(e=0;30>e&&d[f];)e++,f++;e&&(a.album=MetadataExtractor.textDecoderIso88591.decode(d.subarray(63,63+e)))}if(!(c&MetadataExtractor.YEAR_B)){f=93;for(e=0;4>e&&d[f];)e++,f++;e&&(a.year=parseInt(MetadataExtractor.textDecoderIso88591.decode(d.subarray(93,93+e))))}c&MetadataExtractor.TRACK_B||d[125]||!d[126]||(a.track=d[126]&255)}}catch(g){}}static async extractID3v2Andv1(a,b,c){a={url:Formatter.pathToURL(a.path)||
Formatter.empty,file:a};var d=b.readByte()<<24|b.readByte()<<16|b.readByte()<<8;if(1229206272!==d)if(d|=b.readByte(),1380533830===d){d=await MetadataExtractor.extractRIFF(a,b,c[0]);if(!d)return null;if(!d[1])return a}else return await MetadataExtractor.extractID3v1(a,b,0,c[0]),a;var e=b.readByte(),f=b.readByte();d=b.readByte();var g=b.readByte();const h=b.readByte(),k=b.readByte(),m=b.readByte();d=(d&16?10:0)+(m&127|(k&127)<<7|(h&127)<<14|(g&127)<<21);if(2<(e&255)||f){for(e=0;0<d&&e!==MetadataExtractor.ALL_B;){(f=
b.fillBuffer(1024))&&await f;g=b.readByte()<<24|b.readByte()<<16|b.readByte()<<8|b.readByte();f=b.readByte()<<24|b.readByte()<<16|b.readByte()<<8|b.readByte();b.skip(2);if(!g||0>=f||f>d)break;switch(g){case 1414091826:e&MetadataExtractor.TITLE_B?b.skip(f):(g=MetadataExtractor.readV2Frame(b,f,c),a.title=g&&g.then?await g:g,a.title&&(e|=MetadataExtractor.TITLE_B));break;case 1414546737:e&MetadataExtractor.ARTIST_B?b.skip(f):(g=MetadataExtractor.readV2Frame(b,f,c),a.artist=g&&g.then?await g:g,a.artist&&
(e|=MetadataExtractor.ARTIST_B));break;case 1413565506:e&MetadataExtractor.ALBUM_B?b.skip(f):(g=MetadataExtractor.readV2Frame(b,f,c),a.album=g&&g.then?await g:g,a.album&&(e|=MetadataExtractor.ALBUM_B));break;case 1414677323:e&MetadataExtractor.TRACK_B?b.skip(f):(g=MetadataExtractor.readV2Frame(b,f,c),a.track=g&&g.then?parseInt(await g):parseInt(g),a.track?e|=MetadataExtractor.TRACK_B:a.track=0);break;case 1414284622:e&MetadataExtractor.LENGTH_B?b.skip(f):(g=MetadataExtractor.readV2Frame(b,f,c),a.lengthMS=
g&&g.then?parseInt(await g):parseInt(g),a.lengthMS?e|=MetadataExtractor.LENGTH_B:a.lengthMS=0);break;case 1415136594:case 1413763651:e&MetadataExtractor.YEAR_B?b.skip(f):(g=MetadataExtractor.readV2Frame(b,f,c),a.year=g&&g.then?parseInt(await g):parseInt(g),a.year?e|=MetadataExtractor.YEAR_B:a.year=0);break;default:b.skip(f)}d-=10+f}(e&MetadataExtractor.ALL_BUT_LENGTH_B)!==MetadataExtractor.ALL_BUT_LENGTH_B&&await MetadataExtractor.extractID3v1(a,b,e,c[0])}return a}static async extract(a,b,c){if(!a)return null;
if(!a.name.endsWith(".mp3")&&!a.name.endsWith(".aac")&&!a.name.endsWith(".wav")){const d=a.name.toLowerCase();if(!d.endsWith(".mp3")&&!d.endsWith(".aac")&&!d.endsWith(".wav"))return null}b||(b=new Uint8Array(BufferedFileHandle.minBufferLength));c||(c=[new Uint8Array(256)]);try{const d=new BufferedFileHandle(a,b);await d.fillBuffer(-1);return await MetadataExtractor.extractID3v2Andv1(a,d,c)}catch(d){return null}}}MetadataExtractor.ALL_B=63;MetadataExtractor.ALL_BUT_LENGTH_B=31;
MetadataExtractor.TITLE_B=1;MetadataExtractor.ARTIST_B=2;MetadataExtractor.ALBUM_B=4;MetadataExtractor.TRACK_B=8;MetadataExtractor.YEAR_B=16;MetadataExtractor.LENGTH_B=32;MetadataExtractor.textDecoderIso88591=new TextDecoder("iso-8859-1");MetadataExtractor.textDecoderUtf16=new TextDecoder("utf-16");MetadataExtractor.textDecoderUtf16be=new TextDecoder("utf-16be");MetadataExtractor.textDecoderUtf8=new TextDecoder("utf-8");
class Formatter{static formatTimeMS(a){if(0>a)return Formatter.none;a=a/1E3|0;let b=(a/60|0)+":";a%=60;10>a&&(b+="0");return b+a}static formatTimeS(a){if(0>a)return Formatter.none;let b=(a/60|0)+":";a%=60;10>a&&(b+="0");return b+a}static pathToURL(a){return!a||a.startsWith(Formatter.fileURLPrefix)?a:encodeURI(a.startsWith("/")?Formatter.fileURLPrefix+a:Formatter.fileURLPrefixWindows+a.replace(Formatter.regExpSepWindows,"/"))}}Formatter.zero="0:00";Formatter.none="-";Formatter.noneInt=-1;
Formatter.empty="";Formatter.fileURLPrefix="file://";Formatter.fileURLPrefixWindows="file:///";Formatter.regExpSepWindows=/\\/g;class ListItem{constructor(){this.id=++ListItem.Id}}ListItem.Id=0;
class ListAdapter{constructor(a,b){this.list=a;this.control=b||null;a.adapter=this}destroy(){const a=this.list,b=this.control;a&&(zeroObject(this),a.adapter=null,b&&(b.adapter=null))}cleared(){this.control&&this.control.notifyCleared()}itemsAdded(a,b){this.control&&this.control.notifyItemsAdded(a,b)}itemsRemoved(a,b){this.control&&this.control.notifyItemsRemoved(a,b)}currentItemChanged(){this.control&&this.control.notifyCurrentItemChanged()}}
class List{constructor(a,b){this.items=a||[];this._currentIndex=void 0===b?-1:b;this._adapter=null;this.modified=!1;this.items.length?(0>this._currentIndex?this._currentIndex=-1:this._currentIndex>=this.items.length&&(this._currentIndex=this.items.length-1),this._currentItem=0<=this._currentIndex?this.items[this._currentIndex]:null):(this._currentIndex=-1,this._currentItem=null)}destroy(){if(this.items){this.items.fill(null);var a=this._adapter;zeroObject(this);a&&a.destroy()}}get adapter(){return this._adapter}set adapter(a){this.items&&
this._adapter!==a&&(this._adapter&&this._adapter.destroy(),this._adapter=a)}get length(){return this.items?this.items.length:0}get currentIndex(){return this._currentIndex}set currentIndex(a){a>=this.items.length&&(a=this.items.length-1);0>a&&(a=0);const b=a<this.items.length?this.items[a]:null;this._currentIndex=b?a:-1;this._currentItem!==b&&(this.modified=!0,this._currentItem=b,this._adapter&&this._adapter.currentItemChanged())}get currentItem(){return this._currentItem}item(a){return this.items[a]}serialize(a){const b=
this.items,c=b.length;a||(a=new DataWriter(this.estimateSerializedLength()));a.writeUint8(0).writeInt32(c).writeInt32(this._currentIndex);for(let d=0;d<c;d++)b[d].serialize(a);return a}moveCurrentToPrevious(){this.currentIndex=this._currentItem?0>=this._currentIndex?this.items.length-1:this._currentIndex-1:this._currentIndex;return this._currentIndex}moveCurrentToNext(){this.currentIndex=this._currentItem?this._currentIndex>=this.items.length-1?0:this._currentIndex+1:this._currentIndex;return this._currentIndex}clear(){const a=
this._currentItem;this.items&&this.items.fill(null);this.modified=!0;this.items=[];this._currentIndex=-1;this._currentItem=null;this._adapter&&(this._adapter.cleared(),a&&this._adapter.currentItemChanged())}addItem(a,b){if(!this.items||!a)return-1;void 0===b||0>b||b>=this.items.length?(b=this.items.length,this.items.push(a)):this.items.splice(b,0,a);this.modified=!0;this._adapter&&this._adapter.itemsAdded(b,b);return b}addItems(a,b){if(!this.items||!a||!a.length)return-1;void 0===b||0>b||b>=this.items.length?
(b=this.items.length,this.items.push(...a)):this.items.splice(b,0,...a);this.modified=!0;this._adapter&&this._adapter.itemsAdded(b,b+a.length-1);return b}removeItems(a,b){if(!this.items||0>a||a>=this.items.length)return 0;void 0===b||b<a?b=a:b>=this.items.length&&(b=this.items.length-1);const c=b-a+1;this.items.splice(a,c);this.modified=!0;0<=this._currentIndex&&(b<this._currentIndex?this._currentIndex-=c:a<=this._currentIndex&&this._currentItem&&(this._currentItem=null,this._adapter&&this._adapter.currentItemChanged()));
this._adapter&&this._adapter.itemsRemoved(a,b);return c}}
class Song extends ListItem{constructor(a,b,c,d,e,f,g){super();if("string"!==typeof a){var h=a;a=h.url;b=h.title;c=h.artist;d=h.album;e=h.track;f=h.lengthMS;g=h.year;h.file&&(a||(this.file=h.file),b||(b=h.file.name.lastIndexOf("."),b=0<b?h.file.name.substr(0,b):h.file.name))}this.url=a;this.isHttp=Song.isPathHttp(this.url);b||(a=decodeURI(a),h=a.lastIndexOf("/"),b=0<=h?a.substr(h+1):a,this.isHttp||(h=b.lastIndexOf("."),0<h&&(b=b.substr(0,h))));this.title=b||Formatter.none;this.artist=c||Formatter.none;
this.album=d||Formatter.none;this.track=e&&0<e?e:Formatter.noneInt;this.lengthMS=f&&0<f?f:Formatter.noneInt;this.year=g&&0<g?g:Formatter.noneInt;this.length=Formatter.formatTimeMS(this.lengthMS)}static isPathHttp(a){return a.startsWith("http:")||a.startsWith("https:")||a.startsWith("icy:")}static deserialize(a){a.readUint8();const b=new Song(a.readString(),a.readString(),a.readString(),a.readString(),a.readInt16(),a.readInt32(),a.readInt16());a.readInt32();return b}estimateSerializedLength(){return this.url.length+
this.title.length+this.artist.length+this.album.length<<1}serialize(a){return a.writeUint8(0).writeString(this.url).writeString(this.title).writeString(this.artist).writeString(this.album).writeInt16(this.track).writeInt32(this.lengthMS).writeInt16(this.year).writeInt32(0)}info(){return{id:this.id,url:this.url,isHttp:this.isHttp,title:this.title,artist:this.artist,album:this.album,track:this.track,lengthMS:this.lengthMS,year:this.year,length:this.length}}}
class PlaylistAdapter extends ListAdapter{constructor(a){super(a)}get itemHeight(){return AppUI.remToPX(14)}createEmptyElement(){const a=document.createElement("div");a.className="list-item playlist-item";a.appendChild(Icon.create("icon-artist","orange margin"));let b=document.createElement("span");b.textContent=Formatter.none;a.appendChild(b);a.appendChild(document.createElement("br"));a.appendChild(Icon.create("icon-title","pink margin"));a.appendChild(document.createTextNode(Formatter.none));a.appendChild(document.createElement("br"));
b=document.createElement("span");b.className="length";b.textContent=Formatter.none;a.appendChild(b);b=document.createElement("span");b.className="float-right";b.textContent=Formatter.none;a.appendChild(b);return a}prepareElement(a,b,c,d){d.childNodes[1].firstChild.nodeValue=a.artist;d.childNodes[4].nodeValue=a.title;d.childNodes[6].firstChild.nodeValue=a.length;d.childNodes[7].firstChild.nodeValue=`${b+1} / ${c}`}}
class Playlist extends List{constructor(a,b){super(a,b);this.onsonglengthchanged=null}static isTypeSupported(a){const b=a.lastIndexOf(".");if(0>b)return!1;a=a.substr(b);return Playlist.supportedExtensions[a]||Playlist.supportedExtensions[a.toLowerCase()]||!1}static deserialize(a){a.readUint8();const b=a.readInt32(),c=a.readInt32(),d=Array(b);for(let e=0;e<b;e++)d[e]=Song.deserialize(a);return new Playlist(d,c)}estimateSerializedLength(){const a=this.items;let b=0;for(let c=a.length-1;0<=c;c--)b+=
a[c].estimateSerializedLength();return b+128}songLengthChanged(a,b){if(0>=b||isNaN(b)||!isFinite(b)){if(0>a.lengthMS)return;b=-1}else{if(0<=a.lengthMS&&(a.lengthMS/1E3|0)===(b|0))return;b=1E3*b|0}this.modified=!0;a.lengthMS=b;a.length=Formatter.formatTimeMS(b);if(this.onsonglengthchanged)this.onsonglengthchanged(a)}async addSong(a,b){let c,d=0;"string"!==typeof a?(c=a.fileURL,d=a.fileSize):c=a;if(!Playlist.isTypeSupported(c))return!1;a=await App.extractMetadata(c,d);if(!a)return!1;super.addItem(new Song(a),
b);return!0}async addSongWeb(a,b,c,d){if(!Playlist.isTypeSupported(a.name))return!1;a=await MetadataExtractor.extract(a,b,c);if(!a)return!1;super.addItem(new Song(a),d);return!0}}Playlist.supportedExtensions={".aac":!0,".mp3":!0,".wav":!0};Playlist.concatenatedSupportedExtensions=(()=>{let a="";for(let b in Playlist.supportedExtensions)a=a?a+","+b:b;return a})();
class PointerHandler{constructor(a,b=null,c=null,d=null,e=!0,f=null){this.documentTarget=document.documentElement||document.body;this.element=a;this.downCallback=b;this.moveCallback=c;this.upCallback=d;this.boundExtraTouchStart=null;"onpointerdown"in a?(this.documentDownEvent="pointerdown",this.documentMoveEvent="pointermove",this.documentUpEvent="pointerup",this.documentCancelEvent="pointercancel",this.boundDocumentDown=this.pointerDown.bind(this),this.boundDocumentUp=this.pointerUp.bind(this),this.boundDocumentMove=
this.pointerMove.bind(this),"ontouchstart"in a&&(this.boundExtraTouchStart=this.extraTouchStart.bind(this))):"ontouchstart"in a?(this.documentDownEvent="touchstart",this.documentMoveEvent="touchmove",this.documentUpEvent="touchend",this.documentCancelEvent="touchcancel",this.boundDocumentDown=this.touchStart.bind(this),this.boundDocumentUp=this.touchEnd.bind(this),this.boundDocumentMove=this.touchMove.bind(this)):(this.documentDownEvent="mousedown",this.documentMoveEvent="mousemove",this.documentUpEvent=
"mouseup",this.documentCancelEvent=null,this.boundDocumentDown=this.mouseDown.bind(this),this.boundDocumentUp=this.mouseUp.bind(this),this.boundDocumentMove=this.mouseMove.bind(this));this.lazy=e;this.outsidePointerHandler=f;this.boundExtraTouchStart&&a.addEventListener("touchstart",this.boundExtraTouchStart);a.addEventListener(this.documentDownEvent,this.boundDocumentDown);e||this.addSecondaryHandlers();this._captured=!1;this.pointerId=-1}destroy(){this.element&&(this.boundExtraTouchStart&&this.element.removeEventListener("touchstart",
this.boundExtraTouchStart),this.boundDocumentDown&&this.element.removeEventListener(this.documentDownEvent,this.boundDocumentDown));this.removeSecondaryHandlers();this.mouseUp({});zeroObject(this)}get captured(){return this._captured}addSecondaryHandlers(){this.documentTarget&&(this.documentTarget.addEventListener(this.documentMoveEvent,this.boundDocumentMove,{capture:!0,passive:!1}),this.documentTarget.addEventListener(this.documentUpEvent,this.boundDocumentUp,!0),this.documentCancelEvent&&this.documentTarget.addEventListener(this.documentCancelEvent,
this.boundDocumentUp,!0))}removeSecondaryHandlers(){this.documentTarget&&(this.boundDocumentUp&&(this.documentTarget.removeEventListener(this.documentUpEvent,this.boundDocumentUp,!0),this.documentCancelEvent&&this.documentTarget.removeEventListener(this.documentCancelEvent,this.boundDocumentUp,!0)),this.boundDocumentMove&&this.documentTarget.removeEventListener(this.documentMoveEvent,this.boundDocumentMove,!0))}extraTouchStart(a){if(a.target===this.element||this.outsidePointerHandler&&this.outsidePointerHandler(a))return cancelEvent(a)}pointerDown(a){if(0<=
this.pointerId&&"mouse"!==a.pointerType)return cancelEvent(a);const b=this.mouseDown(a);this._captured&&(this.pointerId=a.pointerId);return b}pointerMove(a){if(this._captured&&a.pointerId===this.pointerId)return this.mouseMove(a)}pointerUp(a){if(this._captured&&a.pointerId===this.pointerId)return this.pointerId=-1,this.mouseUp(a)}touchStart(a){if(!(1<a.touches.length))return 0<=this.pointerId&&this.touchEnd(a),this.pointerId=1,a.clientX=a.touches[0].clientX,a.clientY=a.touches[0].clientY,a=this.mouseDown(a),
void 0===a&&(this.pointerId=-1),a}touchMove(a){if(this._captured&&!(1<a.touches.length))return a.clientX=a.touches[0].clientX,a.clientY=a.touches[0].clientY,this.mouseMove(a)}touchEnd(a){if(this._captured&&!(0>this.pointerId))return this.pointerId=-1,this.mouseUp(a)}mouseDown(a){this.mouseUp(a);if(!a.button&&(!a.target||a.target===this.element||this.outsidePointerHandler&&this.outsidePointerHandler(a))){if(this.downCallback&&!this.downCallback(a))return cancelEvent(a);this._captured=!0;this.lazy&&
this.addSecondaryHandlers();return cancelEvent(a)}}mouseMove(a){if(this._captured)return this.moveCallback&&this.moveCallback(a),cancelEvent(a)}mouseUp(a){if(this._captured)return this._captured=!1,this.lazy&&this.removeSecondaryHandlers(),this.upCallback&&this.upCallback(a),cancelEvent(a)}}
class GraphicalFilterEditorStrings{static init(a){a&&0===a.toLowerCase().indexOf("pt")&&(GraphicalFilterEditorStrings.Minus0="-0,00",GraphicalFilterEditorStrings.Curve="Curva: ",GraphicalFilterEditorStrings.Frequency="Frequ\u00eancia: ",GraphicalFilterEditorStrings.SameCurve="Mesma curva para ambos canais",GraphicalFilterEditorStrings.UseLeftCurve="Usar curva da esquerda",GraphicalFilterEditorStrings.UseRightCurve="Usar curva da direita",GraphicalFilterEditorStrings.OneForEach="Uma curva por canal",
GraphicalFilterEditorStrings.ShowLeftCurve="Exibir curva da esquerda",GraphicalFilterEditorStrings.ShowRightCurve="Exibir curva da direita",GraphicalFilterEditorStrings.ResetCurve="Zerar curva",GraphicalFilterEditorStrings.EditMode="Modo de edi\u00e7\u00e3o",GraphicalFilterEditorStrings.Regular="Normal",GraphicalFilterEditorStrings.Zones="Zonas",GraphicalFilterEditorStrings.SmoothNarrow="Suave (estreito)",GraphicalFilterEditorStrings.SmoothWide="Suave (largo)",GraphicalFilterEditorStrings.PeakingEq=
'Filtro "Peaking" de 10 Bandas',GraphicalFilterEditorStrings.ShelfEq='Filtro "Low Shelf" de 7 Bandas',GraphicalFilterEditorStrings.NormalizeCurves="Normalizar curvas",GraphicalFilterEditorStrings.ShowZones="Exibir zonas",GraphicalFilterEditorStrings.ShowActualResponse="Exibir resposta real",GraphicalFilterEditorStrings.toFixed=function(b,c){return b.toFixed(c).replace(".",",")})}}GraphicalFilterEditorStrings.Minus0="-0.00";GraphicalFilterEditorStrings.Cursor="Cursor: ";
GraphicalFilterEditorStrings.Curve="Curve: ";GraphicalFilterEditorStrings.Frequency="Frequency: ";GraphicalFilterEditorStrings.SameCurve="Same curve for both channels";GraphicalFilterEditorStrings.UseLeftCurve="Use left curve";GraphicalFilterEditorStrings.UseRightCurve="Use right curve";GraphicalFilterEditorStrings.OneForEach="One curve for each channel";GraphicalFilterEditorStrings.ShowLeftCurve="Show left curve";GraphicalFilterEditorStrings.ShowRightCurve="Show right curve";
GraphicalFilterEditorStrings.ResetCurve="Reset curve";GraphicalFilterEditorStrings.EditMode="Edit mode";GraphicalFilterEditorStrings.Regular="Regular";GraphicalFilterEditorStrings.Zones="Zones";GraphicalFilterEditorStrings.SmoothNarrow="Smooth (narrow)";GraphicalFilterEditorStrings.SmoothWide="Smooth (wide)";GraphicalFilterEditorStrings.PeakingEq="10-band Peaking Filter";GraphicalFilterEditorStrings.ShelfEq="7-band Low Shelf Filter";GraphicalFilterEditorStrings.NormalizeCurves="Normalize curves";
GraphicalFilterEditorStrings.ShowZones="Show zones";GraphicalFilterEditorStrings.ShowActualResponse="Show actual response";GraphicalFilterEditorStrings.MinusInfinity="-Inf.";GraphicalFilterEditorStrings.toFixed=function(a,b){return a.toFixed(b)};var GraphicalFilterEditorIIRType;(function(a){a[a.None=0]="None";a[a.Peaking=1]="Peaking";a[a.Shelf=2]="Shelf"})(GraphicalFilterEditorIIRType||(GraphicalFilterEditorIIRType={}));
class GraphicalFilterEditor{constructor(a,b,c,d){if(8>a||a&a-1)throw"Sorry, class available only for fft sizes that are a power of 2 >= 8! :(";this.filterLength=a;this._sampleRate=b.sampleRate?b.sampleRate:44100;this._isNormalized=!1;this._iirType=d||GraphicalFilterEditorIIRType.None;this.binCount=(a>>>1)+1;this.filterKernel=b.createBuffer(2,a,this._sampleRate);this.audioContext=b;this.editorPtr=cLib._graphicalFilterEditorAlloc(this.filterLength,this._sampleRate);a=cLib.HEAP8.buffer;this.filterKernelBuffer=
new Float32Array(a,cLib._graphicalFilterEditorGetFilterKernelBuffer(this.editorPtr),GraphicalFilterEditor.maximumFilterLength);this.channelCurves=[new Int32Array(a,cLib._graphicalFilterEditorGetChannelCurve(this.editorPtr,0),GraphicalFilterEditor.visibleBinCount),new Int32Array(a,cLib._graphicalFilterEditorGetChannelCurve(this.editorPtr,1),GraphicalFilterEditor.visibleBinCount)];this.actualChannelCurve=new Int32Array(a,cLib._graphicalFilterEditorGetActualChannelCurve(this.editorPtr),GraphicalFilterEditor.visibleBinCount);
this.visibleFrequencies=new Float64Array(a,cLib._graphicalFilterEditorGetVisibleFrequencies(this.editorPtr),GraphicalFilterEditor.visibleBinCount);this.equivalentZones=new Int32Array(a,cLib._graphicalFilterEditorGetEquivalentZones(this.editorPtr),GraphicalFilterEditor.equivalentZoneCount);this.equivalentZonesFrequencyCount=new Int32Array(a,cLib._graphicalFilterEditorGetEquivalentZonesFrequencyCount(this.editorPtr),GraphicalFilterEditor.equivalentZoneCount+1);this.curveSnapshot=this.biquadFilterActualPhase=
this.biquadFilterActualMag=this.biquadFilterActualAccum=this.biquadFilterActualFrequencies=this.biquadFilterActualGains=this.biquadFilterGains=this.biquadFilterOutput=this.biquadFilterInput=this.biquadFilters=this._convolver=this.source=null;this.updateFilter(0,!0,!0);this.updateActualChannelCurve(0);this.updateBuffer();this.filterChangedCallback=c}static encodeCurve(a){const b=GraphicalFilterEditor.minimumChannelValueY,c=GraphicalFilterEditor.validYRangeHeight,d=a.length,e=Array(d<<1);let f=0;for(let g=
0;g<d;g++){let h=a[g];h=h>b?0:c-h;254>=h?e[f++]=h:(e[f++]=255,e[f++]=h-254)}e.splice(f);return btoa(String.fromCharCode(...e))}static decodeCurve(a){if(!a||a.length<4*GraphicalFilterEditor.visibleBinCount/3)return null;try{a=atob(a)}catch(f){return null}if(a.length<GraphicalFilterEditor.visibleBinCount)return null;const b=GraphicalFilterEditor.validYRangeHeight,c=a.length,d=Array(GraphicalFilterEditor.visibleBinCount);let e=0;for(let f=0;f<c;f++){const g=a.charCodeAt(f);254>=g?d[e++]=b-g:f<c-1&&(f++,
d[e++]=b-(a.charCodeAt(f)+254))}return d}get sampleRate(){return this._sampleRate}get isNormalized(){return this._isNormalized}get iirType(){return this._iirType}get convolver(){return this._convolver}get inputNode(){return this.biquadFilterInput||this._convolver}get outputNode(){return this.biquadFilterOutput||this._convolver}connectSourceAndDestination(a,b){a=this.connectSourceToInput(a);return this.connectOutputToDestination(b)&&a}connectSourceToInput(a){this.source&&this.source.disconnect();if(this.source=
a){a.disconnect();const b=this.inputNode;if(b)return a.connect(b,0,0),!0}return!1}connectOutputToDestination(a){return this.outputNode?(this.outputNode.disconnect(),a&&this.outputNode.connect(a,0,0),!0):!1}disconnectOutputFromDestination(){return this.outputNode?(this.outputNode.disconnect(),!0):!1}destroy(){this.editorPtr&&(this.disconnectOutputFromDestination(),cLib._graphicalFilterEditorFree(this.editorPtr),zeroObject(this))}clampX(a){return 0>=a?0:a>=GraphicalFilterEditor.visibleBinCount?GraphicalFilterEditor.visibleBinCount-
1:a}clampY(a){return a<=GraphicalFilterEditor.maximumChannelValueY?GraphicalFilterEditor.maximumChannelValueY:a>GraphicalFilterEditor.minimumChannelValueY?GraphicalFilterEditor.validYRangeHeight+1:a}dBToMagnitude(a){return Math.pow(10,a/20)}yToDB(a){return a<=GraphicalFilterEditor.maximumChannelValueY?40:a>GraphicalFilterEditor.minimumChannelValueY?-Infinity:lerp(GraphicalFilterEditor.maximumChannelValueY,40,GraphicalFilterEditor.minimumChannelValueY,-40,a)}yToMagnitude(a){return a<=GraphicalFilterEditor.maximumChannelValueY?
100:a>GraphicalFilterEditor.minimumChannelValueY?0:Math.exp(lerp(GraphicalFilterEditor.maximumChannelValueY,2,GraphicalFilterEditor.minimumChannelValueY,-2,a)*Math.LN10)}magnitudeToY(a){return 100<=a?GraphicalFilterEditor.maximumChannelValueY:.009>a?GraphicalFilterEditor.validYRangeHeight+1:Math.round(GraphicalFilterEditor.zeroChannelValueY-GraphicalFilterEditor.zeroChannelValueY*Math.log(a)/Math.LN10*.5-.4)}visibleBinToZoneIndex(a){if(a>=GraphicalFilterEditor.visibleBinCount-1)return this.equivalentZones.length-
1;if(0<a){const b=this.equivalentZonesFrequencyCount;for(let c=b.length-1;0<=c;c--)if(a>=b[c])return c}return 0}visibleBinToFrequency(a,b){const c=this.equivalentZones,d=this.visibleFrequencies;var e=GraphicalFilterEditor.visibleBinCount;if(a>=e-1)return b?[d[e-1],c[c.length-1]]:d[e-1];if(0<a)if(b){e=this.equivalentZonesFrequencyCount;for(let f=e.length-1;0<=f;f--)if(a>=e[f])return[d[a],c[f]]}else return d[a];return b?[d[0],c[0]]:d[0]}changeZoneY(a,b,c){b=this.visibleBinToZoneIndex(b);const d=this.equivalentZonesFrequencyCount[b+
1];c=this.clampY(c);a=this.channelCurves[a];for(b=this.equivalentZonesFrequencyCount[b];b<d;b++)a[b]=c}changeZoneYByIndex(a,b,c){const d=this.equivalentZonesFrequencyCount[b+1];c=this.clampY(c);a=this.channelCurves[a];for(b=this.equivalentZonesFrequencyCount[b];b<d;b++)a[b]=c}startSmoothEdition(a){this.curveSnapshot||(this.curveSnapshot=new Int32Array(GraphicalFilterEditor.visibleBinCount));this.curveSnapshot.set(this.channelCurves[a])}changeSmoothY(a,b,c,d){var e=this.curveSnapshot;if(e){var f=GraphicalFilterEditor.visibleBinCount;
c=this.clampY(c);a=this.channelCurves[a];a.set(e);d>>=1;for(let g=b-d,h=Math.min(b,f),k=Math.max(0,g);k<h;k++)e=512*smoothStep(g,b,k)|0,a[k]=this.clampY(Math.round((c*e+a[k]*(512-e))/512));for(let g=b+d,h=Math.min(g,f),k=Math.max(0,b);k<h;k++)d=512*smoothStep(g,b,k)|0,a[k]=this.clampY(Math.round((c*d+a[k]*(512-d))/512))}}updateBuffer(){const a=this._convolver;this._convolver||(this._convolver=this.audioContext.createConvolver(),this._convolver.normalize=!1);this._convolver.buffer=this.filterKernel;
!a&&this.filterChangedCallback&&this.filterChangedCallback()}copyToChannel(a,b){if(this.filterKernel.copyToChannel)this.filterKernel.copyToChannel(a,b);else{b=this.filterKernel.getChannelData(b);for(let c=this.filterLength-1;0<=c;c--)b[c]=a[c]}}copyFromChannel(a,b){if(this.filterKernel.copyToChannel)this.filterKernel.copyFromChannel(a,b);else{b=this.filterKernel.getChannelData(b);for(let c=this.filterLength-1;0<=c;c--)a[c]=b[c]}}copyFilter(a,b){this.copyToChannel(this.filterKernel.getChannelData(a),
b);this.updateBuffer()}updateFilter(a,b,c){switch(this._iirType){case GraphicalFilterEditorIIRType.Peaking:this.updatePeakingEq(a);return;case GraphicalFilterEditorIIRType.Shelf:this.updateShelfEq(a);return}cLib._graphicalFilterEditorUpdateFilter(this.editorPtr,a,this._isNormalized);this.copyToChannel(this.filterKernelBuffer,a);b?this.copyFilter(a,1-a):c?this.updateFilter(1-a,!1,!1):this.updateBuffer()}updateActualChannelCurve(a){this._iirType?this.updateActualChannelCurveIIR():(this.copyFromChannel(this.filterKernelBuffer,
a),cLib._graphicalFilterEditorUpdateActualChannelCurve(this.editorPtr,a))}updatePeakingEq(a){var b=this.audioContext;const c=this.channelCurves[a],d=this.equivalentZones,e=this.equivalentZonesFrequencyCount;a=GraphicalFilterEditor.equivalentZoneCount;let f=this.biquadFilters,g=this.biquadFilterGains,h=!1;if(!f||!g){h=!0;f=Array(a);g=Array(a);const l=Array(a);var k=.5*Math.log(2),m=this.audioContext.sampleRate;const p=2*Math.PI;for(let n=a-1;0<=n;n--){const q=p*d[n]/m;l[n]=1/(2*Math.sinh(q/Math.sin(q)*
k))}for(k=a-1;0<=k;k--)m=b.createBiquadFilter(),m.type="peaking",m.frequency.value=d[k],m.Q.value=l[k],f[k]=m,k<a-1&&f[k+1].connect(f[k]);this.biquadFilters=f;this.biquadFilterInput=f[a-1];this.biquadFilterOutput=f[0]}for(b=a-1;0<=b;b--)g[b]=Math.max(-40,this.yToDB(c[e[b]]));for(b=a-1;0<=b;b--)f[b].gain.value=g[b]+(b<a-1?-.15*g[b+1]:0)+(0<b?-.15*g[b-1]:0);h&&this.filterChangedCallback&&this.filterChangedCallback()}updateShelfEq(a){var b=this.audioContext,c=this.channelCurves[a],d=this.equivalentZonesFrequencyCount,
e=GraphicalFilterEditor.shelfEquivalentZoneCount,f=GraphicalFilterEditor.shelfEquivalentZones;a=this.biquadFilters;let g=this.biquadFilterGains,h=this.biquadFilterActualGains;a&&g&&h||(a=Array(e),g=Array(e),h=Array(e),this.biquadFilters=a,this.biquadFilterGains=g,this.biquadFilterActualGains=h,a[e-1]=b.createGain(),this.biquadFilterInput=a[e-1]);for(b=e-1;0<=b;b--)g[b]=Math.max(-40,this.yToDB(c[d[f[b]]]));--e;b=0;c=!1;d=a[e];d.gain.value=this.dBToMagnitude(g[e]);for(--e;0<=e;e--)f=b+(g[e]-g[e+1]),
-22>f?(b=f+22,f=-22):22<f?(b=f-22,f=22):b=0,h[e]!==f?(c=!0,h[e]=f,a[e]&&a[e].disconnect(),d.disconnect(),f?(a[e]=this.createIIRFilter(e,f),d.connect(a[e]),d=a[e]):a[e]=null):a[e]&&(c&&(c=!1,d.connect(a[e])),d=a[e]);this.biquadFilterOutput!==d&&(this.biquadFilterOutput=d,this.filterChangedCallback&&this.filterChangedCallback())}createIIRFilter(a,b){const c=this.audioContext;var d=c.sampleRate;switch(a){case 0:a=92.75;break;case 1:a=187.5;break;case 2:a=375;break;case 3:a=1500;break;case 4:a=6E3;break;
default:a=12E3}b=Math.pow(10,b/40);a=6.283185307179586*a/d;d=Math.cos(a);a=1*Math.sqrt(b)*Math.sin(a)*Math.sqrt(-.5*(b+1/b)+2);return c.createIIRFilter([b*(b+1-(b-1)*d+a),2*b*(b-1-(b+1)*d),b*(b+1-(b-1)*d-a)],[b+1+(b-1)*d+a,-2*(b-1+(b+1)*d),b+1+(b-1)*d-a])}updateActualChannelCurveIIR(){var a=this.biquadFilters;if(a){var b=this.biquadFilterActualFrequencies,c=this.biquadFilterActualAccum,d=this.biquadFilterActualMag,e=this.biquadFilterActualPhase;if(!(b&&c&&d&&e)){e=this.visibleFrequencies;b=new Float32Array(e.length);
for(c=e.length-1;0<=c;c--)b[c]=e[c];c=new Float32Array(e.length);d=new Float32Array(e.length);e=new Float32Array(e.length);this.biquadFilterActualFrequencies=b;this.biquadFilterActualAccum=c;this.biquadFilterActualMag=d;this.biquadFilterActualPhase=e}var f=b.length;if(this._iirType===GraphicalFilterEditorIIRType.Shelf)c.fill(a[a.length-1].gain.value);else{a[a.length-1].getFrequencyResponse(b,c,e);for(var g=f-1,h=1;0<=g&&isNaN(h=c[g]);)g--;for(g++;g<f;)c[g++]=h}for(g=a.length-2;0<=g;g--)if(a[g]){a[g].getFrequencyResponse(b,
d,e);for(let k=0,m=0;k<f;k++)h=d[k],isNaN(h)||(m=h),c[k]*=m}a=this.actualChannelCurve;b=this.magnitudeToY;for(d=a.length-1;0<=d;d--)a[d]=b(c[d])}}changeFilterLength(a,b,c){return this.filterLength!==a?(this.filterLength=a,this.binCount=(a>>>1)+1,this.filterKernel=this.audioContext.createBuffer(2,a,this._sampleRate),cLib._graphicalFilterEditorChangeFilterLength(this.editorPtr,a),this.updateFilter(b,c,!0),!0):!1}changeSampleRate(a,b,c){return this._sampleRate!==a?(this._sampleRate=a,this.filterKernel=
this.audioContext.createBuffer(2,this.filterLength,a),this.updateFilter(b,c,!0),!0):!1}changeIsNormalized(a,b,c){return!this._isNormalized!==!a?(this._isNormalized=!!a,this.updateFilter(b,c,!0),!0):!1}changeIIRType(a,b,c){if(this._iirType!==a){this._iirType=a;this.disconnectOutputFromDestination();this._convolver=null;if(a=this.biquadFilters){for(let d=a.length-1;0<=d;d--)a[d]&&a[d].disconnect();a.fill(null);this.biquadFilters=null}this.biquadFilterActualPhase=this.biquadFilterActualMag=this.biquadFilterActualAccum=
this.biquadFilterActualFrequencies=this.biquadFilterGains=this.biquadFilterOutput=this.biquadFilterInput=null;this.updateFilter(b,c,!0);return!0}return!1}changeAudioContext(a,b,c){if(this.audioContext!==a){this.disconnectOutputFromDestination();this._convolver=null;const d=this.biquadFilters;if(d){for(let e=d.length-1;0<=e;e--)d[e]&&d[e].disconnect();d.fill(null);this.biquadFilters=null}this.biquadFilterActualPhase=this.biquadFilterActualMag=this.biquadFilterActualAccum=this.biquadFilterActualFrequencies=
this.biquadFilterGains=this.biquadFilterOutput=this.biquadFilterInput=null;this.audioContext=a;this._sampleRate=a.sampleRate?a.sampleRate:44100;this.filterKernel=a.createBuffer(2,this.filterLength,this._sampleRate);this.updateFilter(b,c,!0);this.updateBuffer();return!0}return!1}}GraphicalFilterEditor.visibleBinCount=500;GraphicalFilterEditor.validYRangeHeight=321;GraphicalFilterEditor.zeroChannelValueY=GraphicalFilterEditor.validYRangeHeight>>>1;GraphicalFilterEditor.maximumChannelValue=GraphicalFilterEditor.zeroChannelValueY;
GraphicalFilterEditor.minimumChannelValue=-GraphicalFilterEditor.zeroChannelValueY;GraphicalFilterEditor.minusInfiniteChannelValue=GraphicalFilterEditor.minimumChannelValue-1;GraphicalFilterEditor.maximumChannelValueY=0;GraphicalFilterEditor.minimumChannelValueY=GraphicalFilterEditor.validYRangeHeight-1;GraphicalFilterEditor.maximumFilterLength=8192;GraphicalFilterEditor.equivalentZoneCount=10;GraphicalFilterEditor.shelfEquivalentZoneCount=7;
GraphicalFilterEditor.shelfEquivalentZones=[0,2,3,4,6,8,9];class GraphicalFilterEditorRenderer{constructor(a,b,c){this.element=a;this.leftMargin=b;this.editor=c}destroy(){zeroObject(this)}}
class GraphicalFilterEditorCanvasRenderer extends GraphicalFilterEditorRenderer{constructor(a){super(document.createElement("canvas"),Math.abs(GraphicalFilterEditorControl.controlWidth-GraphicalFilterEditor.visibleBinCount)>>1,a);this.element.className="GECV";this.pixelRatio=1;this.rangeImage=this.ctx=null;this.scaleChanged()}scaleChanged(){var a=this.element,b=this.editor;if(a&&b){var c=GraphicalFilterEditorControl.controlWidth,d=GraphicalFilterEditorControl.controlHeight,e=1<devicePixelRatio?devicePixelRatio:
1;b=b.scale;var f=b*e;a.width=c*f|0;a.height=d*f|0;a.style.width=(c*b|0)+"px";a.style.height=(d*b|0)+"px";c=this.element.getContext("2d",{alpha:!1});if(!c)throw Error("Null canvas context");a=c.createLinearGradient(0,0,1,a.height);a.addColorStop(0,"#ff0000");a.addColorStop(.1875,"#ffff00");a.addColorStop(.39453125,"#00ff00");a.addColorStop(.60546875,"#00ffff");a.addColorStop(.796875,"#0000ff");a.addColorStop(1,"#ff00ff");this.pixelRatio=e;this.ctx=c;this.rangeImage=a}}drawCurve(a,b,c){const d=this.ctx;
if(d){var e=1<devicePixelRatio?devicePixelRatio:1;e!==this.pixelRatio&&(this.scaleChanged(),e=this.pixelRatio);var f=this.editor,g=f.filter;e*=f.scale;var h=this.element;f=this.leftMargin;var k=h.width,m=h.height,l=Math.round(8*e),p=Math.round(4*e),n=(k/l|0)+1,q=GraphicalFilterEditor.maximumChannelValueY*e|0,t=1>e?e:e|0;h=.5*t;d.fillStyle="#303030";d.fillRect(0,0,k,m);d.lineWidth=t;d.strokeStyle="#5a5a5a";d.beginPath();t=k+(p>>1);var u=(GraphicalFilterEditor.zeroChannelValueY*e|0)+h;d.moveTo(t,u);
for(let r=n-1;0<=r;r--)d.lineTo(t-p,u),t-=l,d.moveTo(t,u);d.stroke();d.beginPath();t=k+(p>>1);u=(GraphicalFilterEditor.validYRangeHeight*e|0)+h;d.moveTo(t,u);for(k=n-1;0<=k;k--)d.lineTo(t-p,u),t-=l,d.moveTo(t,u);d.stroke();if(a)for(a=g.equivalentZonesFrequencyCount.length-2;0<a;a--){t=((g.equivalentZonesFrequencyCount[a]+f)*e|0)+h;u=q;d.beginPath();for(d.moveTo(t,u);u<m;)d.lineTo(t,u+p),u+=l,d.moveTo(t,u);d.stroke()}t=1>e?2*e:2*e|0;h=.5*t;d.lineWidth=t;a=GraphicalFilterEditor.visibleBinCount-1;for(m=
b?1:0;0<=m;m--){l=m||!b?g.channelCurves[c]:g.actualChannelCurve;d.strokeStyle=m?"#707070":this.rangeImage;d.beginPath();d.moveTo(f*e|0,l[0]*e+h);for(t=1;t<a;t++)d.lineTo((f+t)*e|0,l[t]*e+h);d.lineTo((f+t+1)*e|0,l[t]*e+h);d.stroke()}}}}
class GraphicalFilterEditorSVGRenderer extends GraphicalFilterEditorRenderer{constructor(a){super(document.createElement("div"),Math.abs(GraphicalFilterEditorControl.controlWidth-GraphicalFilterEditor.visibleBinCount)>>1,a);this.element.className="GECV";this.element.style.overflow="hidden";this.element.style.backgroundColor="#303030";this.element.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="1" height="1" viewBox="0 0 1 1" version="1.1" style="transform-origin: top left; pointer-events: none;">\n\t\t\t<defs>\n\t\t\t\t<linearGradient id="editorSVGLinearGradient" x1="0" y1="0" x2="0" y2="1" gradientUnits="userSpaceOnUse">\n\t\t\t\t\t<stop offset="0" stop-color="#ff0000" />\n\t\t\t\t\t<stop offset="0.1875" stop-color="#ffff00" />\n\t\t\t\t\t<stop offset="0.39453125" stop-color="#00ff00" />\n\t\t\t\t\t<stop offset="0.60546875" stop-color="#00ffff" />\n\t\t\t\t\t<stop offset="0.796875" stop-color="#0000ff" />\n\t\t\t\t\t<stop offset="1" stop-color="#ff00ff" />\n\t\t\t\t</linearGradient>\n\t\t\t</defs>\n\t\t\t<line x1="0" y1="0" x2="1" y2="0" stroke="#5a5a5a" stroke-width="1px" stroke-dasharray="4" />\n\t\t\t<line x1="0" y1="0" x2="1" y2="0" stroke="#5a5a5a" stroke-width="1px" stroke-dasharray="4" />\n\t\t\t<g style="display:none">\n\t\t\t\t<line x1="0" y1="0" x2="0" y2="1" stroke="#5a5a5a" stroke-width="1px" stroke-dasharray="4" />\n\t\t\t\t<line x1="0" y1="0" x2="0" y2="1" stroke="#5a5a5a" stroke-width="1px" stroke-dasharray="4" />\n\t\t\t\t<line x1="0" y1="0" x2="0" y2="1" stroke="#5a5a5a" stroke-width="1px" stroke-dasharray="4" />\n\t\t\t\t<line x1="0" y1="0" x2="0" y2="1" stroke="#5a5a5a" stroke-width="1px" stroke-dasharray="4" />\n\t\t\t\t<line x1="0" y1="0" x2="0" y2="1" stroke="#5a5a5a" stroke-width="1px" stroke-dasharray="4" />\n\t\t\t\t<line x1="0" y1="0" x2="0" y2="1" stroke="#5a5a5a" stroke-width="1px" stroke-dasharray="4" />\n\t\t\t\t<line x1="0" y1="0" x2="0" y2="1" stroke="#5a5a5a" stroke-width="1px" stroke-dasharray="4" />\n\t\t\t\t<line x1="0" y1="0" x2="0" y2="1" stroke="#5a5a5a" stroke-width="1px" stroke-dasharray="4" />\n\t\t\t\t<line x1="0" y1="0" x2="0" y2="1" stroke="#5a5a5a" stroke-width="1px" stroke-dasharray="4" />\n\t\t\t</g>\n\t\t\t<path style="fill:none;stroke:#707070;stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter" d="M 0,0 1,0" />\n\t\t\t<path style="fill:none;stroke:url(#editorSVGLinearGradient);stroke-width:1px;stroke-linecap:butt;stroke-linejoin:miter" d="M 0,0 1,0" />\n\t\t</svg>';
this.pixelRatio=1;this.showZones=!1;this.isActualChannelCurveNeeded=!0;this.svg=a=this.element.firstChild;this.svgGradient=a.getElementsByTagName("linearGradient")[0];this.svgZones=a.getElementsByTagName("g")[0];var b=a.getElementsByTagName("path");this.svgGrayCurve=b[0];this.svgCurve=b[1];a=a.getElementsByTagName("line");this.svgLines=Array(a.length);for(b=a.length-1;0<=b;b--)this.svgLines[b]=a[b];this.scaleChanged()}scaleChanged(){const a=this.element;var b=this.editor,c=b.filter;const d=this.svg;
if(a&&b&&c&&d){var e=GraphicalFilterEditorControl.controlWidth,f=GraphicalFilterEditorControl.controlHeight,g=1<devicePixelRatio?devicePixelRatio:1,h=b.scale;b=h*g;var k=this.leftMargin,m=this.svgLines,l=1>b?b:b|0,p=.5*l,n=(e*b|0).toString(),q=(f*b|0).toString();d.setAttribute("width",n);d.setAttribute("height",q);d.setAttribute("viewBox",`0 0 ${n} ${q}`);d.style.transform=1===g?"":"scale("+1/g+")";this.svgGradient.setAttribute("y2",q);a.style.width=(e*h|0)+"px";a.style.height=(f*h|0)+"px";m[0].setAttribute("x2",
n);m[1].setAttribute("x2",n);for(n=m.length-1;2<=n;n--)m[n].setAttribute("y2",q);q=((GraphicalFilterEditor.zeroChannelValueY*b|0)+p).toString();m[0].setAttribute("y1",q);m[0].setAttribute("y2",q);q=((GraphicalFilterEditor.validYRangeHeight*b|0)+p).toString();m[1].setAttribute("y1",q);m[1].setAttribute("y2",q);for(q=c.equivalentZonesFrequencyCount.length-2;0<q;q--)n=(((c.equivalentZonesFrequencyCount[q]+k)*b|0)+p).toString(),m[q+1].setAttribute("x1",n),m[q+1].setAttribute("x2",n);n=l.toString()+"px";
q=(4*b|0).toString();for(c=m.length-1;0<=c;c--)m[c].setAttribute("stroke-width",n),m[c].setAttribute("stroke-dasharray",q);n=(1>b?2*b:2*b|0).toString()+"px";this.svgGrayCurve.style.strokeWidth=n;this.svgCurve.style.strokeWidth=n;this.pixelRatio=g}}drawCurve(a,b,c){var d=1<devicePixelRatio?devicePixelRatio:1;d!==this.pixelRatio&&(this.scaleChanged(),d=this.pixelRatio);this.showZones!==a&&(this.showZones=a,this.svgZones.style.display=a?"":"none");var e=this.editor;a=e.filter;d*=e.scale;e=.5*(1>d?2*
d:2*d|0);const f=this.leftMargin,g=GraphicalFilterEditor.visibleBinCount;for(let h=b?1:0;0<=h;h--){const k=h||!b?a.channelCurves[c]:a.actualChannelCurve,m=h?this.svgGrayCurve:this.svgCurve;let l=1,p=0,n=k[0],q="M "+(f*d|0)+","+(n*d+e);for(;l<g;l++)k[l]!==n&&(l>p+1&&1<l&&(q+=" "+((f+l-1)*d|0)+","+(k[l-1]*d+e)),p=l,n=k[l],q+=" "+((f+p)*d|0)+","+(n*d+e));q+=" "+((f+l)*d|0)+","+(k[l-1]*d+e);m.setAttribute("d",q)}this.isActualChannelCurveNeeded!==b&&(this.isActualChannelCurveNeeded=b,this.svgGrayCurve.style.display=
b?"":"none")}}
class GraphicalFilterEditorControl{constructor(a,b,c,d,e,f){this.showZones=!1;this.editMode=GraphicalFilterEditorControl.editModeRegular;this.isActualChannelCurveNeeded=!0;this.currentChannelIndex=0;this.isSameFilterLR=!0;this.drawOffsetY=this.drawOffsetX=this.lastDrawY=this.lastDrawX=this.drawingMode=0;if(8>b||b&b-1)throw"Sorry, class available only for fft sizes that are a power of 2 >= 8! :(";this.filter=new GraphicalFilterEditor(b,c,d);b=()=>{const h=document.createElement("div");h.className=
"GEMNUSEP";return h};c=h=>{const k=document.createElement("div");k.className="GEMNULBL";k.appendChild(document.createTextNode(h));return k};d=(h,k,m,l,p,n)=>{const q=document.createElement("div");q.className=n?"GEMNUIT GECLK "+n:"GEMNUIT GECLK";if(k)if(f&&(l&&f.radioHTML||!l&&f.checkHTML))q.innerHTML=l?f.radioHTML:f.checkHTML,k=q.firstChild,k.style.marginRight=l?f.radioMargin||"2px":f.checkMargin||"2px",m||(k.style.visibility="hidden");else{k=document.createElement("span");n=l?"\u25cf ":"\u25a0 ";
let t=null;if(f){let u=!1;l?f.radioCharacter&&(u=!0,n=f.radioCharacter,t=f.radioMargin||"2px"):f.checkCharacter&&(u=!0,n=f.checkCharacter,t=f.checkMargin||"2px");u&&(f.checkFontFamily&&(k.style.fontFamily=f.checkFontFamily),f.checkFontSize&&(k.style.fontSize=f.checkFontSize))}t&&(k.style.marginRight=t);k.appendChild(document.createTextNode(n));m||(k.style.visibility="hidden");q.appendChild(k)}q.appendChild(document.createTextNode(h));p&&(q.onclick=p);return q};this.element=a;a.className="GE";this.boundMouseMove=
this.mouseMove.bind(this);this._scale=0;this.scale=f&&f.scale&&0<f.scale?f.scale:1;this.renderer=f&&f.svgRenderer?new GraphicalFilterEditorSVGRenderer(this):new GraphicalFilterEditorCanvasRenderer(this);this.renderer.element.addEventListener("mousemove",this.boundMouseMove);this.renderer.element.oncontextmenu=cancelEvent;a.appendChild(this.renderer.element);this.pointerHandler=new PointerHandler(this.renderer.element,this.mouseDown.bind(this),this.mouseMove.bind(this),this.mouseUp.bind(this));a.oncontextmenu=
cancelEvent;var g=document.createElement("div");g.className="GELBL";g.style.width="9em";g.appendChild(document.createTextNode(GraphicalFilterEditorStrings.Cursor));g.appendChild(this.lblCursor=document.createElement("span"));g.appendChild(document.createTextNode(" dB"));this.lblCursor.appendChild(document.createTextNode(GraphicalFilterEditorStrings.Minus0));a.appendChild(g);g=document.createElement("div");g.className="GELBL";g.style.width="9em";g.appendChild(document.createTextNode(GraphicalFilterEditorStrings.Curve));
g.appendChild(this.lblCurve=document.createElement("span"));g.appendChild(document.createTextNode(" dB"));this.lblCurve.appendChild(document.createTextNode(GraphicalFilterEditorStrings.Minus0));a.appendChild(g);g=document.createElement("div");g.className="GELBL";g.appendChild(document.createTextNode(GraphicalFilterEditorStrings.Frequency));g.appendChild(this.lblFrequency=document.createElement("span"));this.lblFrequency.appendChild(document.createTextNode("0 Hz (31 Hz)"));a.appendChild(g);this.btnMnu=
document.createElement("div");this.btnMnu.className="GEBTN GECLK";this.openMenuElement=null;this.openMenuCharacter="\u25b2";this.closeMenuElement=null;this.closeMenuCharacter="\u25bc";f&&(g=!1,f.openMenuHTML&&f.closeMenuHTML?(g=!0,this.btnMnu.innerHTML=f.openMenuHTML+f.closeMenuHTML,this.openMenuElement=this.btnMnu.childNodes[0],this.closeMenuElement=this.btnMnu.childNodes[1],this.closeMenuElement.style.display="none"):f.openMenuCharacter?(g=!0,this.openMenuCharacter=f.openMenuCharacter,this.closeMenuCharacter=
f.closeMenuCharacter||this.openMenuCharacter):f.closeMenuCharacter&&(g=!0,this.closeMenuCharacter=this.openMenuCharacter=f.closeMenuCharacter),g&&(f.menuFontFamily&&(this.btnMnu.style.fontFamily=f.menuFontFamily),f.menuFontSize&&(this.btnMnu.style.fontSize=f.menuFontSize),f.menuWidth&&(this.btnMnu.style.width=f.menuWidth),f.menuPadding&&(this.btnMnu.style.padding=f.menuPadding)));this.openMenuElement||this.btnMnu.appendChild(document.createTextNode(this.openMenuCharacter));this.btnMnu.onclick=this.btnMnu_Click.bind(this);
a.appendChild(this.btnMnu);this.mnu=document.createElement("div");this.mnu.className="GEMNU";this.mnu.style.display="none";g=document.createElement("div");g.className="GEMNUH GEFILTER";g.appendChild(c(GraphicalFilterEditorStrings.SameCurve));g.appendChild(this.mnuChBL=d(GraphicalFilterEditorStrings.UseLeftCurve,!0,!0,!0,this.mnuChB_Click.bind(this,0)));g.appendChild(this.mnuChBR=d(GraphicalFilterEditorStrings.UseRightCurve,!0,!1,!0,this.mnuChB_Click.bind(this,1)));g.appendChild(b());g.appendChild(c(GraphicalFilterEditorStrings.OneForEach));
g.appendChild(this.mnuChL=d(GraphicalFilterEditorStrings.ShowLeftCurve,!0,!1,!0,this.mnuChLR_Click.bind(this,0)));g.appendChild(this.mnuChR=d(GraphicalFilterEditorStrings.ShowRightCurve,!0,!1,!0,this.mnuChLR_Click.bind(this,1)));this.mnu.appendChild(g);g=document.createElement("div");g.className="GEMNUH GEMNUSEPH";g.appendChild(d(GraphicalFilterEditorStrings.ResetCurve,!1,!1,!1,this.mnuResetCurve_Click.bind(this)));g.appendChild(b());g.appendChild(c(GraphicalFilterEditorStrings.EditMode));g.appendChild(this.mnuEditRegular=
d(GraphicalFilterEditorStrings.Regular,!0,!0,!0,this.mnuEditRegular_Click.bind(this)));g.appendChild(this.mnuEditZones=d(GraphicalFilterEditorStrings.Zones,!0,!1,!0,this.mnuEditZones_Click.bind(this)));g.appendChild(this.mnuEditSmoothNarrow=d(GraphicalFilterEditorStrings.SmoothNarrow,!0,!1,!0,this.mnuEditSmoothNarrow_Click.bind(this)));g.appendChild(this.mnuEditSmoothWide=d(GraphicalFilterEditorStrings.SmoothWide,!0,!1,!0,this.mnuEditSmoothWide_Click.bind(this)));g.appendChild(this.mnuEditPeakingEq=
d(GraphicalFilterEditorStrings.PeakingEq,!0,!1,!0,this.mnuEditPeakingEq_Click.bind(this)));f&&f.hideEditModePeakingEq&&(this.mnuEditPeakingEq.style.display="none");g.appendChild(this.mnuEditShelfEq=d(GraphicalFilterEditorStrings.ShelfEq,!0,!1,!0,this.mnuEditShelfEq_Click.bind(this)));f&&f.hideEditModeShelfEq&&(this.mnuEditShelfEq.style.display="none");g.appendChild(b());g.appendChild(this.mnuNormalizeCurves=d(GraphicalFilterEditorStrings.NormalizeCurves,!0,!1,!1,this.mnuNormalizeCurves_Click.bind(this),
"GEFILTER"));g.appendChild(this.mnuShowZones=d(GraphicalFilterEditorStrings.ShowZones,!0,!1,!1,this.mnuShowZones_Click.bind(this)));g.appendChild(this.mnuShowActual=d(GraphicalFilterEditorStrings.ShowActualResponse,!0,!0,!1,this.mnuShowActual_Click.bind(this)));this.mnu.appendChild(g);a.appendChild(this.mnu);e&&this.loadSettings(e);this.drawCurve()}destroy(){this.filter&&this.filter.destroy();this.pointerHandler&&this.pointerHandler.destroy();this.renderer&&this.renderer.destroy();zeroObject(this)}loadSettings(a){if(a){var b=
this.filter;if(!1===a.showZones||!0===a.showZones)this.showZones=a.showZones;a.editMode&&a.editMode>=GraphicalFilterEditorControl.editModeFirst&&a.editMode<=GraphicalFilterEditorControl.editModeLast&&(this.editMode=a.editMode);if(!1===a.isActualChannelCurveNeeded||!0===a.isActualChannelCurveNeeded)this.isActualChannelCurveNeeded=a.isActualChannelCurveNeeded;if(0===a.currentChannelIndex||1===a.currentChannelIndex)this.currentChannelIndex=a.currentChannelIndex;if(!1===a.isSameFilterLR||!0===a.isSameFilterLR)this.isSameFilterLR=
a.isSameFilterLR;var c=GraphicalFilterEditor.decodeCurve(a.leftCurve),d=GraphicalFilterEditor.decodeCurve(a.rightCurve);c&&!d?d=c:d&&!c&&(c=d);if(c){var e=b.channelCurves[0];for(let f=GraphicalFilterEditor.visibleBinCount-1;0<=f;f--)e[f]=b.clampY(c[f])}if(d)for(c=b.channelCurves[1],e=GraphicalFilterEditor.visibleBinCount-1;0<=e;e--)c[e]=b.clampY(d[e]);this.isSameFilterLR?(this.checkMenu(this.mnuChBL,0===this.currentChannelIndex),this.checkMenu(this.mnuChL,!1),this.checkMenu(this.mnuChBR,1===this.currentChannelIndex),
this.checkMenu(this.mnuChR,!1)):(this.checkMenu(this.mnuChBL,!1),this.checkMenu(this.mnuChL,0===this.currentChannelIndex),this.checkMenu(this.mnuChBR,!1),this.checkMenu(this.mnuChR,1===this.currentChannelIndex));a=!1===a.isNormalized||!0===a.isNormalized?a.isNormalized:b.isNormalized;a===b.isNormalized?b.updateFilter(this.currentChannelIndex,this.isSameFilterLR,!0):b.changeIsNormalized(a,this.currentChannelIndex,this.isSameFilterLR);this.isActualChannelCurveNeeded&&this.filter.updateActualChannelCurve(this.currentChannelIndex);
this.checkMenu(this.mnuShowZones,this.showZones);this.changeEditMode(this.editMode);this.checkMenu(this.mnuNormalizeCurves,this.filter.isNormalized);this.checkMenu(this.mnuShowActual,this.isActualChannelCurveNeeded);this.drawCurve()}}saveSettings(){return{showZones:this.showZones,editMode:this.editMode,isActualChannelCurveNeeded:this.isActualChannelCurveNeeded,currentChannelIndex:this.currentChannelIndex,isSameFilterLR:this.isSameFilterLR,isNormalized:this.filter.isNormalized,leftCurve:GraphicalFilterEditor.encodeCurve(this.filter.channelCurves[0]),
rightCurve:GraphicalFilterEditor.encodeCurve(this.filter.channelCurves[1])}}get scale(){return this._scale}set scale(a){0>=a||this._scale===a||!this.element||(this._scale=a,this.element.style.fontSize=12*a+"px",this.element.style.lineHeight=16*a+"px",this.renderer&&(this.renderer.scaleChanged(),this.drawCurve()))}static formatDB(a){return-40>a?GraphicalFilterEditorStrings.MinusInfinity:0>a?GraphicalFilterEditorStrings.toFixed(a,2):0===a?GraphicalFilterEditorStrings.Minus0:"+"+GraphicalFilterEditorStrings.toFixed(a,
2)}static formatFrequency(a){return a[0].toFixed(0)+" Hz ("+(1E3>a[1]?a[1]+" Hz":a[1]/1E3+" kHz")+")"}static setFirstNodeText(a,b){a.firstChild&&(a.firstChild.nodeValue=b)}btnMnu_Click(a){a.button||("none"===this.mnu.style.display?(this.mnu.style.bottom=this.element.clientHeight-this.renderer.element.clientHeight+"px",this.mnu.style.display="inline-block",this.openMenuElement&&this.closeMenuElement?(this.openMenuElement.style.display="none",this.closeMenuElement.style.display=""):GraphicalFilterEditorControl.setFirstNodeText(this.btnMnu,
this.closeMenuCharacter)):(this.mnu.style.display="none",this.openMenuElement&&this.closeMenuElement?(this.closeMenuElement.style.display="none",this.openMenuElement.style.display=""):GraphicalFilterEditorControl.setFirstNodeText(this.btnMnu,this.openMenuCharacter)));return!0}checkMenu(a,b){a.firstChild.style.visibility=b?"visible":"hidden";return b}mnuChB_Click(a,b){b.button||this.isSameFilterLR&&this.currentChannelIndex===a||(this.isSameFilterLR?(this.currentChannelIndex=a,this.filter.updateFilter(a,
!0,!0),this.isActualChannelCurveNeeded&&this.filter.updateActualChannelCurve(a),this.drawCurve()):(this.isSameFilterLR=!0,this.filter.copyFilter(a,1-a),this.currentChannelIndex!==a&&(this.currentChannelIndex=a,this.isActualChannelCurveNeeded&&this.filter.updateActualChannelCurve(a),this.drawCurve())),this.checkMenu(this.mnuChBL,0===a),this.checkMenu(this.mnuChL,!1),this.checkMenu(this.mnuChBR,1===a),this.checkMenu(this.mnuChR,!1));return this.btnMnu_Click(b)}mnuChLR_Click(a,b){b.button||!this.isSameFilterLR&&
this.currentChannelIndex===a||(this.isSameFilterLR&&(this.isSameFilterLR=!1,this.filter.updateFilter(1-this.currentChannelIndex,!1,!1)),this.currentChannelIndex!==a&&(this.currentChannelIndex=a,this.isActualChannelCurveNeeded&&this.filter.updateActualChannelCurve(a),this.drawCurve()),this.checkMenu(this.mnuChBL,!1),this.checkMenu(this.mnuChL,0===a),this.checkMenu(this.mnuChBR,!1),this.checkMenu(this.mnuChR,1===a));return this.btnMnu_Click(b)}mnuResetCurve_Click(a){if(!a.button){const b=this.filter.channelCurves[this.currentChannelIndex];
for(let c=b.length-1;0<=c;c--)b[c]=GraphicalFilterEditor.zeroChannelValueY;this.filter.updateFilter(this.currentChannelIndex,this.isSameFilterLR,!1);this.isActualChannelCurveNeeded&&this.filter.updateActualChannelCurve(this.currentChannelIndex);this.drawCurve()}return this.btnMnu_Click(a)}mnuShowZones_Click(a){a.button||(this.showZones=!this.showZones,this.checkMenu(this.mnuShowZones,this.showZones),this.drawCurve());return this.btnMnu_Click(a)}changeEditMode(a){if(!(a<GraphicalFilterEditorControl.editModeFirst||
a>GraphicalFilterEditorControl.editModeLast)){this.editMode=a;this.checkMenu(this.mnuEditRegular,a===GraphicalFilterEditorControl.editModeRegular);this.checkMenu(this.mnuEditZones,a===GraphicalFilterEditorControl.editModeZones);this.checkMenu(this.mnuEditSmoothNarrow,a===GraphicalFilterEditorControl.editModeSmoothNarrow);this.checkMenu(this.mnuEditSmoothWide,a===GraphicalFilterEditorControl.editModeSmoothWide);this.checkMenu(this.mnuEditPeakingEq,a===GraphicalFilterEditorControl.editModePeakingEq);
this.checkMenu(this.mnuEditShelfEq,a===GraphicalFilterEditorControl.editModeShelfEq);var b=GraphicalFilterEditorIIRType.None;switch(a){case GraphicalFilterEditorControl.editModePeakingEq:b=GraphicalFilterEditorIIRType.Peaking;break;case GraphicalFilterEditorControl.editModeShelfEq:b=GraphicalFilterEditorIIRType.Shelf}this.filter.iirType!==b&&(this.mnu.className=b?"GEMNU GEEQ":"GEMNU",this.filter.changeIIRType(b,this.currentChannelIndex,this.isSameFilterLR),this.isActualChannelCurveNeeded&&(this.filter.updateActualChannelCurve(this.currentChannelIndex),
this.drawCurve()))}}mnuEditRegular_Click(a){a.button||this.changeEditMode(GraphicalFilterEditorControl.editModeRegular);return this.btnMnu_Click(a)}mnuEditZones_Click(a){a.button||this.changeEditMode(GraphicalFilterEditorControl.editModeZones);return this.btnMnu_Click(a)}mnuEditSmoothNarrow_Click(a){a.button||this.changeEditMode(GraphicalFilterEditorControl.editModeSmoothNarrow);return this.btnMnu_Click(a)}mnuEditSmoothWide_Click(a){a.button||this.changeEditMode(GraphicalFilterEditorControl.editModeSmoothWide);
return this.btnMnu_Click(a)}mnuEditPeakingEq_Click(a){a.button||this.changeEditMode(GraphicalFilterEditorControl.editModePeakingEq);return this.btnMnu_Click(a)}mnuEditShelfEq_Click(a){a.button||this.changeEditMode(GraphicalFilterEditorControl.editModeShelfEq);return this.btnMnu_Click(a)}mnuNormalizeCurves_Click(a){a.button||(this.filter.changeIsNormalized(!this.filter.isNormalized,this.currentChannelIndex,this.isSameFilterLR),this.checkMenu(this.mnuNormalizeCurves,this.filter.isNormalized),this.isActualChannelCurveNeeded&&
(this.filter.updateActualChannelCurve(this.currentChannelIndex),this.drawCurve()));return this.btnMnu_Click(a)}mnuShowActual_Click(a){a.button||(this.isActualChannelCurveNeeded=!this.isActualChannelCurveNeeded,this.checkMenu(this.mnuShowActual,this.isActualChannelCurveNeeded),this.isActualChannelCurveNeeded&&this.filter.updateActualChannelCurve(this.currentChannelIndex),this.drawCurve());return this.btnMnu_Click(a)}mouseDown(a){if(!a.button&&!this.drawingMode){const b=this.renderer.element.getBoundingClientRect(),
c=((a.clientX-b.left)/this._scale|0)-this.renderer.leftMargin;a=(a.clientY-b.top)/this._scale|0;this.renderer.element.removeEventListener("mousemove",this.boundMouseMove);this.drawingMode=1;switch(this.editMode){case GraphicalFilterEditorControl.editModeZones:case GraphicalFilterEditorControl.editModePeakingEq:this.filter.changeZoneY(this.currentChannelIndex,c,a);break;case GraphicalFilterEditorControl.editModeShelfEq:this.filter.changeZoneY(this.currentChannelIndex,c,a);switch(this.filter.visibleBinToZoneIndex(c)){case 0:this.filter.changeZoneYByIndex(this.currentChannelIndex,
1,a);break;case 1:this.filter.changeZoneYByIndex(this.currentChannelIndex,0,a);break;case 4:this.filter.changeZoneYByIndex(this.currentChannelIndex,5,a);break;case 5:this.filter.changeZoneYByIndex(this.currentChannelIndex,4,a);break;case 6:this.filter.changeZoneYByIndex(this.currentChannelIndex,7,a);break;case 7:this.filter.changeZoneYByIndex(this.currentChannelIndex,6,a)}break;case GraphicalFilterEditorControl.editModeSmoothNarrow:this.filter.startSmoothEdition(this.currentChannelIndex);this.filter.changeSmoothY(this.currentChannelIndex,
c,a,GraphicalFilterEditor.visibleBinCount>>3);break;case GraphicalFilterEditorControl.editModeSmoothWide:this.filter.startSmoothEdition(this.currentChannelIndex);this.filter.changeSmoothY(this.currentChannelIndex,c,a,GraphicalFilterEditor.visibleBinCount>>1);break;default:this.filter.channelCurves[this.currentChannelIndex][this.filter.clampX(c)]=this.filter.clampY(a),this.lastDrawX=c,this.lastDrawY=a}this.drawCurve();return!0}return!1}mouseMove(a){var b=this.renderer.element.getBoundingClientRect();
let c=((a.clientX-b.left)/this._scale|0)-this.renderer.leftMargin;a=(a.clientY-b.top)/this._scale|0;b=this.filter.channelCurves[this.currentChannelIndex];if(this.drawingMode){switch(this.editMode){case GraphicalFilterEditorControl.editModeZones:case GraphicalFilterEditorControl.editModePeakingEq:this.filter.changeZoneY(this.currentChannelIndex,c,a);break;case GraphicalFilterEditorControl.editModeShelfEq:this.filter.changeZoneY(this.currentChannelIndex,c,a);switch(this.filter.visibleBinToZoneIndex(c)){case 0:this.filter.changeZoneYByIndex(this.currentChannelIndex,
1,a);break;case 1:this.filter.changeZoneYByIndex(this.currentChannelIndex,0,a);break;case 4:this.filter.changeZoneYByIndex(this.currentChannelIndex,5,a);break;case 5:this.filter.changeZoneYByIndex(this.currentChannelIndex,4,a);break;case 6:this.filter.changeZoneYByIndex(this.currentChannelIndex,7,a);break;case 7:this.filter.changeZoneYByIndex(this.currentChannelIndex,6,a)}break;case GraphicalFilterEditorControl.editModeSmoothNarrow:this.filter.changeSmoothY(this.currentChannelIndex,c,a,GraphicalFilterEditor.visibleBinCount>>
3);break;case GraphicalFilterEditorControl.editModeSmoothWide:this.filter.changeSmoothY(this.currentChannelIndex,c,a,GraphicalFilterEditor.visibleBinCount>>1);break;default:if(1<Math.abs(c-this.lastDrawX)){const d=(a-this.lastDrawY)/Math.abs(c-this.lastDrawX),e=c<this.lastDrawX?-1:1;let f=Math.abs(c-this.lastDrawX)-1;a=this.lastDrawY+d;for(c=this.lastDrawX+e;0<f;c+=e,f--)b[this.filter.clampX(c)]=this.filter.clampY(a),a+=d}b[this.filter.clampX(c)]=this.filter.clampY(a);this.lastDrawX=c;this.lastDrawY=
a}this.drawCurve()}else this.isActualChannelCurveNeeded&&(b=this.filter.actualChannelCurve);c=this.filter.clampX(c);GraphicalFilterEditorControl.setFirstNodeText(this.lblCursor,GraphicalFilterEditorControl.formatDB(this.filter.yToDB(a)));GraphicalFilterEditorControl.setFirstNodeText(this.lblCurve,GraphicalFilterEditorControl.formatDB(this.filter.yToDB(b[c])));GraphicalFilterEditorControl.setFirstNodeText(this.lblFrequency,GraphicalFilterEditorControl.formatFrequency(this.filter.visibleBinToFrequency(c,
!0)))}mouseUp(a){this.drawingMode&&(this.renderer.element.addEventListener("mousemove",this.boundMouseMove),this.drawingMode=0,this.filter.updateFilter(this.currentChannelIndex,this.isSameFilterLR,!1),this.isActualChannelCurveNeeded&&this.filter.updateActualChannelCurve(this.currentChannelIndex),this.drawCurve())}changeFilterLength(a){return this.filter.changeFilterLength(a,this.currentChannelIndex,this.isSameFilterLR)?(this.isActualChannelCurveNeeded&&this.filter.updateActualChannelCurve(this.currentChannelIndex),
this.drawCurve(),!0):!1}changeSampleRate(a){return this.filter.changeSampleRate(a,this.currentChannelIndex,this.isSameFilterLR)?(this.isActualChannelCurveNeeded&&this.filter.updateActualChannelCurve(this.currentChannelIndex),this.drawCurve(),!0):!1}changeAudioContext(a){return this.filter.changeAudioContext(a,this.currentChannelIndex,this.isSameFilterLR)}drawCurve(){this.renderer&&this.renderer.drawCurve(this.showZones,this.isActualChannelCurveNeeded&&!this.drawingMode,this.currentChannelIndex)}}
GraphicalFilterEditorControl.controlWidth=Math.max(512,GraphicalFilterEditor.visibleBinCount);GraphicalFilterEditorControl.controlHeight=GraphicalFilterEditor.validYRangeHeight+3;GraphicalFilterEditorControl.editModeRegular=0;GraphicalFilterEditorControl.editModeZones=1;GraphicalFilterEditorControl.editModeSmoothNarrow=2;GraphicalFilterEditorControl.editModeSmoothWide=3;GraphicalFilterEditorControl.editModePeakingEq=4;GraphicalFilterEditorControl.editModeShelfEq=5;
GraphicalFilterEditorControl.editModeFirst=0;GraphicalFilterEditorControl.editModeLast=5;
class Program{constructor(a,b,c){const d=[];var e=[];const f=[];this.gl=a;var g=a.createProgram();if(!g)throw Error("Null program");this.program=g;g=a.createShader(a.VERTEX_SHADER);if(!g)throw Error("Null vertex shader");this.vs=g;g=a.createShader(a.FRAGMENT_SHADER);if(!g)throw Error("Null fragment shader");this.fs=g;a.shaderSource(this.vs,b);a.compileShader(this.vs);if(!a.getShaderParameter(this.vs,a.COMPILE_STATUS))throw e="Vertex shader: "+a.getShaderInfoLog(this.vs),this.destroy(),alert(e),e;
this.getAttribsAndUniforms(b,d,e,f);a.shaderSource(this.fs,c);a.compileShader(this.fs);if(!a.getShaderParameter(this.fs,a.COMPILE_STATUS))throw e="Fragment shader: "+a.getShaderInfoLog(this.fs),this.destroy(),alert(e),e;this.getAttribsAndUniforms(c,d,e,f);a.attachShader(this.program,this.vs);a.attachShader(this.program,this.fs);for(b=0;b<d.length;b++)a.bindAttribLocation(this.program,b,d[b]);a.linkProgram(this.program);for(a=0;a<e.length;a++)this.prepareUniform(e[a],f[a])}static create(a,b,c,d){const e=
["webkit-3d","moz-webgl","webgl","experimental-webgl"];for(let f=0;f<e.length;f++)try{const g=a.getContext(e[f],b);return new Program(g,c,d)}catch(g){}return null}getAttribsAndUniforms(a,b,c,d){a=a.split("\n");for(let m=0;m<a.length;m++){var e=a[m].trim();if("uniform"===e.substr(0,7)){e=e.split(" ");var f=e[1];for(var g=2;g<e.length;g++){var h=e[g];if(";"===h)break;var k=h.charAt(h.length-1);const l=";"===k;if(","===k||l)h=h.substr(0,h.length-1);","!==h&&h.length&&(c.push(h),d.push(f));if(l)break}}else if("attribute"===
e.substr(0,9))for(e=e.split(" "),f=2;f<e.length;f++){g=e[f];if(";"===g)break;h=g.charAt(g.length-1);k=";"===h;if(","===h||k)g=g.substr(0,g.length-1);","!==g&&g.length&&b.push(g);if(k)break}}}prepareUniform(a,b){const c=this.gl,d=c.getUniformLocation(this.program,a);if(!this[a])if("bool"===b||"int"===b||"sampler2D"===b)this[a]=function(e){c.uniform1i(d,e)};else if("float"===b)this[a]=function(e){c.uniform1f(d,e)};else if("vec2"===b)this[a]=function(e,f){c.uniform2f(d,e,f)},this[a+"v"]=function(e){c.uniform2fv(d,
e)};else if("vec3"===b)this[a]=function(e,f,g){c.uniform3f(d,e,f,g)},this[a+"v"]=function(e){c.uniform3fv(d,e)};else if("vec4"===b)this[a]=function(e,f,g,h){c.uniform4f(d,e,f,g,h)},this[a+"v"]=function(e){c.uniform4fv(d,e)};else if("mat4"===b)this[a]=function(e){c.uniformMatrix4fv(d,!1,e)};else return!1;return!0}use(){this.gl.useProgram(this.program)}destroy(){this.gl&&(this.gl.useProgram(null),this.vs&&(this.gl.detachShader(this.program,this.vs),this.gl.deleteShader(this.vs)),this.fs&&(this.gl.detachShader(this.program,
this.fs),this.gl.deleteShader(this.fs)),this.program&&this.gl.deleteProgram(this.program),zeroObject(this))}}
class Analyzer{constructor(a,b,c,d,e,f){this.alive=!1;this.lastRequest=0;this.boundAnalyze=null;this.audioContext=a;this.canvas=document.createElement("canvas");this.canvas.width=!e||0>=e?Analyzer.controlWidth:e;this.canvas.height=!f||0>=f?Analyzer.controlHeight:f;this.canvas.style.position="relative";this.canvas.style.margin="0px";this.canvas.style.padding="0px";this.canvas.style.verticalAlign="top";this.canvas.style.display="inline-block";this.canvas.style.cursor="default";c&&(this.canvas.id=c);
this.ctx=d?null:this.canvas.getContext("2d",{alpha:!1});b.appendChild(this.canvas);this.boundAnalyze=g=>{this.alive?(this.lastRequest=requestAnimationFrame(this.boundAnalyze),this.analyze(g)):this.lastRequest=0}}destroy(){this.stop();this.cleanUp();this.canvas&&this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);zeroObject(this)}start(){if(this.alive)return!1;this.alive=!0;this.lastRequest=requestAnimationFrame(this.boundAnalyze);return!0}stop(){this.alive=!1;this.lastRequest&&
(cancelAnimationFrame(this.lastRequest),this.lastRequest=0)}}Analyzer.controlWidth=GraphicalFilterEditorControl.controlWidth;Analyzer.controlHeight=Analyzer.controlWidth;Analyzer.colors="#000000 #0B00B2 #0C00B1 #0E00AF #0E00AF #0F00AE #1000AD #1200AC #1300AB #1500AB #1600AA #1700A9 #1900A8 #1A00A6 #1B00A6 #1D00A4 #1F00A3 #2000A1 #2200A1 #2300A0 #25009E #27009D #29009C #2B009A #2D0099 #2E0098 #300096 #320095 #340094 #360092 #380090 #39008F #3C008E #3E008C #40008B #420089 #440088 #470086 #480085 #4B0083 #4C0082 #4F0080 #51007F #54007C #56007C #57007A #5A0078 #5C0076 #5F0075 #610073 #640071 #65006F #68006E #6B006C #6D006A #6F0069 #710066 #740065 #760063 #790062 #7B0060 #7D005E #80005C #82005B #850059 #860057 #890056 #8C0054 #8E0052 #910050 #93004F #96004D #97004B #9A0049 #9C0048 #9F0046 #A10045 #A40043 #A60040 #A8003F #AA003E #AD003C #AF003A #B10039 #B30037 #B60035 #B80034 #BA0032 #BC0031 #BE002E #C1002D #C3002C #C5002A #C70028 #CA0027 #CB0025 #CE0024 #CF0023 #D10022 #D30020 #D6001E #D7001D #D9001B #DB001A #DD0019 #DF0017 #E10017 #E20015 #E40014 #E60012 #E70011 #E90010 #EA000F #EC000D #ED000C #EF000B #F1000B #F2000A #F40008 #F50007 #F60006 #F70005 #F90005 #F90003 #FB0003 #FC0002 #FD0001 #FE0001 #FF0000 #FF0100 #FF0200 #FF0300 #FF0500 #FF0600 #FF0600 #FF0800 #FF0900 #FF0B00 #FF0C00 #FF0D00 #FF0F00 #FF1000 #FF1200 #FF1400 #FF1500 #FF1700 #FF1900 #FF1A00 #FF1C00 #FF1D00 #FF2000 #FF2200 #FF2300 #FF2500 #FF2700 #FF2900 #FF2B00 #FF2D00 #FF2F00 #FF3100 #FF3400 #FF3500 #FF3700 #FF3900 #FF3C00 #FF3E00 #FF4000 #FF4200 #FF4400 #FF4700 #FF4900 #FF4B00 #FF4E00 #FF5000 #FF5200 #FF5500 #FF5700 #FF5900 #FF5C00 #FF5E00 #FF6100 #FF6300 #FF6600 #FF6800 #FF6A00 #FF6C00 #FF6F00 #FF7200 #FF7400 #FF7700 #FF7900 #FF7C00 #FF7E00 #FF8000 #FF8300 #FF8500 #FF8700 #FF8A00 #FF8D00 #FF8F00 #FF9200 #FF9500 #FF9700 #FF9900 #FF9B00 #FF9E00 #FFA000 #FFA300 #FFA500 #FFA700 #FFA900 #FFAC00 #FFAE00 #FFB100 #FFB200 #FFB600 #FFB700 #FFBA00 #FFBC00 #FFBE00 #FFC100 #FFC300 #FFC400 #FFC700 #FFC900 #FFCB00 #FFCD00 #FFCF00 #FFD100 #FFD300 #FFD500 #FFD700 #FFD900 #FFDB00 #FFDD00 #FFDE00 #FFE000 #FFE100 #FFE400 #FFE500 #FFE700 #FFE900 #FFEA00 #FFEB00 #FFED00 #FFEF00 #FFF000 #FFF100 #FFF300 #FFF400 #FFF500 #FFF600 #FFF800 #FFF900 #FFFA00 #FFFB00".split(" ");
class PlainAnalyzer extends Analyzer{constructor(a,b,c,d){super(a,b,d);this.sampleRate=c.sampleRate;this.analyzerL=a.createAnalyser();this.analyzerL.fftSize=1024;this.analyzerR=a.createAnalyser();this.analyzerR.fftSize=1024;this.visibleFrequencies=c.visibleFrequencies;a=cLib.HEAP8.buffer;this.dataPtr=this.ptr=b=cLib._allocBuffer(19456+cLib._fftSizeOff(2048));this.data=new Uint8Array(a,b,1024);this.tmpPtr=b+=1024;this.tmp=new Float32Array(a,b,2048);this.windowPtr=b+=8192;this.window=new Float32Array(a,
b,1024);this.multiplierPtr=b+=4096;this.multiplier=new Float32Array(a,b,512);this.prevLPtr=b+=2048;this.prevL=new Float32Array(a,b,512);this.prevRPtr=b+=2048;this.prevR=new Float32Array(a,b,512);this.fft4gfPtr=b+2048;cLib._fftInitf(this.fft4gfPtr,2048);d=this.window;a=this.multiplier;const e=Math.PI;b=Math.exp;const f=Math.cos;c=1/Math.LN10;for(let g=0;1024>g;g++)d[g]=4*(.54-.46*f(2*e*g/1023));for(d=0;512>d;d++)a[d]=145*c*b(2.5*d/511)}analyze(a){a=this.multiplier;const b=this.tmp,c=this.ctx,d=this.sampleRate/
2048,e=this.visibleFrequencies,f=Analyzer.colors;var g;let h,k,m,l;this.analyzerL.getByteTimeDomainData(this.data);cLib._plainAnalyzer(this.fft4gfPtr,this.windowPtr,this.dataPtr,this.tmpPtr);let p=this.prevL;c.lineWidth=1;c.fillStyle="#000000";c.fillRect(0,0,512,512);for(k=h=0;511>k&&1024>h&&d>e[k+1]-e[k];){for(g=d*h;1024>h&&g+d<e[k];)h++,g=d*h;g=(4*p[k]+a[k]*lerp(g,b[h],g+d,b[h+1],e[k]))/2.5>>1;255<g?g=255:0>g&&(g=0);p[k]=g;c.beginPath();c.strokeStyle=f[g];c.moveTo(k-.5,256.5-g);c.lineTo(k-.5,256.5);
c.stroke();k++}for(h++;1024>h&&512>k;){l=m=0;do m+=b[h],l++,h++,g=d*h;while(g<e[k]&&1024>h);g=(4*p[k]+a[k]*m/l)/2.5>>1;255<g?g=255:0>g&&(g=0);p[k]=g;c.beginPath();c.strokeStyle=f[g];c.moveTo(k-.5,256.5-g);c.lineTo(k-.5,256.5);c.stroke();k++}this.analyzerR.getByteTimeDomainData(this.data);cLib._plainAnalyzer(this.fft4gfPtr,this.windowPtr,this.dataPtr,this.tmpPtr);p=this.prevR;for(k=h=0;511>k&&1024>h&&d>e[k+1]-e[k];){for(g=d*h;1024>h&&g+d<e[k];)h++,g=d*h;g=(4*p[k]+a[k]*lerp(g,b[h],g+d,b[h+1],e[k]))/
2.5>>1;255<g?g=255:0>g&&(g=0);p[k]=g;c.beginPath();c.strokeStyle=f[g];c.moveTo(k-.5,256.5);c.lineTo(k-.5,256.5+g);c.stroke();k++}for(h++;1024>h&&512>k;){l=m=0;do m+=b[h],l++,h++,g=d*h;while(g<e[k]&&1024>h);g=(4*p[k]+a[k]*m/l)/2.5>>1;255<g?g=255:0>g&&(g=0);p[k]=g;c.beginPath();c.strokeStyle=f[g];c.moveTo(k-.5,256.5);c.lineTo(k-.5,256.5+g);c.stroke();k++}}cleanUp(){this.ptr&&cLib._freeBuffer(this.ptr)}}
class SoundParticlesAnalyzer extends Analyzer{constructor(a,b,c,d){super(a,b,d,!0,Analyzer.controlWidth,320);this.BG_COLUMNS=31;this.BG_PARTICLES_BY_COLUMN=16;this.BG_COUNT=this.BG_COLUMNS*this.BG_PARTICLES_BY_COLUMN;this.lastTime=0;this.analyzerL=a.createAnalyser();this.analyzerL.fftSize=1024;this.analyzerL.maxDecibels=-12;this.analyzerL.minDecibels=-45;this.analyzerL.smoothingTimeConstant=0;this.analyzerR=a.createAnalyser();this.analyzerR.fftSize=1024;this.analyzerR.maxDecibels=-12;this.analyzerR.minDecibels=
-45;this.analyzerR.smoothingTimeConstant=0;a=(f,g)=>{this.COLORS[3*f]=g};b=(f,g)=>{this.COLORS[3*f+1]=g};c=(f,g)=>{this.COLORS[3*f+2]=g};this.processedDataPtr=this.ptr=d=cLib._allocBuffer(2240+8*this.BG_COUNT+8*this.BG_COUNT+this.BG_COUNT);this.processedData=new Uint8Array(512);this.processedDataRPtr=d+=512;this.processedDataR=new Uint8Array(512);this.fftPtr=d+=512;this.fft=new Float32Array(256);this.COLORSPtr=d+=1024;this.COLORS=new Float32Array(48);this.bgPosPtr=d+=192;this.bgPos=new Float32Array(2*
this.BG_COUNT);this.bgSpeedYPtr=d+=8*this.BG_COUNT;this.bgSpeedY=new Float32Array(this.BG_COUNT);this.bgThetaPtr=d+=4*this.BG_COUNT;this.bgTheta=new Float32Array(this.BG_COUNT);this.bgColorPtr=d+=4*this.BG_COUNT;this.bgColor=new Uint8Array(this.BG_COUNT);a(0,.75);b(0,0);c(0,0);a(1,0);b(1,.75);c(1,0);a(2,0);b(2,0);c(2,.75);a(3,.75);b(3,0);c(3,.75);a(4,.75);b(4,.75);c(4,0);a(5,0);b(5,.75);c(5,.75);a(6,.75);b(6,.75);c(6,.75);a(7,.75);b(7,.325);c(7,0);a(8,.75);b(8,0);c(8,.325);a(9,.325);b(9,.75);c(9,
0);a(10,0);b(10,.75);c(10,.325);a(11,0);b(11,.325);c(11,.75);a(12,.325);b(12,0);c(12,.75);a(13,0);b(13,0);c(13,.75);a(14,.75);b(14,.325);c(14,0);a(15,0);b(15,.325);c(15,.75);for(let f=0,g=0;f<this.BG_COLUMNS;f++)for(a=0;a<this.BG_PARTICLES_BY_COLUMN;a++,g++)this.fillBgParticle(g,-1.2+.01953125*(SoundParticlesAnalyzer.rand()&127));a=Program.create(this.canvas,{alpha:!1,depth:!1,stencil:!1,antialias:!1,premultipliedAlpha:!0},SoundParticlesAnalyzer.vertexShaderSource,SoundParticlesAnalyzer.fragmentShaderSource);
if(!a)throw this.err("Apparently your browser does not support WebGL"),Error();this.program=a;this.program.use();this.program.texColor(0);this.program.aspect(.625,1);a=this.program.gl;d=new Float32Array([-1,-1,0,1,1,-1,0,1,-1,1,0,1,1,1,0,1]);const e=new Float32Array([0,1,1,1,0,0,1,0]);b=a.createBuffer();c=a.createBuffer();!a.getError()&&b&&c||this.err(-1);a.bindBuffer(a.ARRAY_BUFFER,b);a.bufferData(a.ARRAY_BUFFER,d,a.STATIC_DRAW);a.bindBuffer(a.ARRAY_BUFFER,c);a.bufferData(a.ARRAY_BUFFER,e,a.STATIC_DRAW);
a.clearColor(0,0,0,1);a.pixelStorei(a.UNPACK_ALIGNMENT,2);a.disable(a.DEPTH_TEST);a.disable(a.CULL_FACE);a.disable(a.DITHER);a.disable(a.SCISSOR_TEST);a.disable(a.STENCIL_TEST);a.enable(a.BLEND);a.blendFunc(a.ONE,a.ONE);a.blendEquation(a.FUNC_ADD);a.getError();d=a.createTexture();!a.getError()&&d||this.err(-2);a.activeTexture(a.TEXTURE0);a.bindTexture(a.TEXTURE_2D,d);a.getError()&&this.err(-3);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,
a.LINEAR);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE);a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);this.fillTexture();a.getError()&&this.err(-4);a.enableVertexAttribArray(0);a.bindBuffer(a.ARRAY_BUFFER,b);a.vertexAttribPointer(0,4,a.FLOAT,!1,0,0);a.enableVertexAttribArray(1);a.bindBuffer(a.ARRAY_BUFFER,c);a.vertexAttribPointer(1,2,a.FLOAT,!1,0,0)}static rand(){return 65536*Math.random()|0}err(a){this.destroy();alert("Sorry! WebGL error :(\n"+a);throw a;}fillBgParticle(a,
b){this.bgPos[a<<1]=.0078125*((SoundParticlesAnalyzer.rand()&7)-4);this.bgPos[(a<<1)+1]=b;this.bgTheta[a]=.03125*(SoundParticlesAnalyzer.rand()&63);this.bgSpeedY[a]=.125+.00390625*(SoundParticlesAnalyzer.rand()&15);this.bgColor[a]=SoundParticlesAnalyzer.rand()&15}fillTexture(){const a=this.program.gl,b=Math.sqrt,c=new Uint8Array(4096);for(let e=0;64>e;e++){let f=e-32;f*=f;for(let g=0;64>g;g++){var d=g-32;d=b(d*d+f)/30;1<d&&(d=1);let h=d;d=1-d;d*=d;d+=.5*d;.55>d?d=0:1>d&&(d=smoothStep(.55,1,d));h=
1-h;h=smoothStep(0,1,h);h*=h;h+=h;1<h&&(h=1);d+=.5*h;d=255*d|0;c[64*e+g]=255<=d?255:d}}a.texImage2D(a.TEXTURE_2D,0,a.ALPHA,64,64,0,a.ALPHA,a.UNSIGNED_BYTE,c)}analyze(a){let b=a-this.lastTime;33<b&&(b=33);this.lastTime=a;a=this.program.gl;var c=.00390625*b,d=1-c;const e=this.processedData,f=this.processedDataR,g=this.fft,h=this.BG_COLUMNS,k=this.BG_PARTICLES_BY_COLUMN,m=this.COLORS,l=this.program,p=this.bgPos,n=this.bgSpeedY,q=this.bgColor,t=this.bgTheta,u=Math.max;let r,y=44,x=116;b*=.001;this.analyzerL.getByteFrequencyData(e);
this.analyzerR.getByteFrequencyData(f);for(r=0;256>r;r++){let v=u(e[r],f[r]);8>v&&(v=0);const w=g[r];v<w&&(v=c*v+d*w);g[r]=v;e[r]=255<=v?255:v}a.clear(a.COLOR_BUFFER_BIT);r=2;for(let v=0,w=0;v<h;v++){if(6>r)c=.00390625*e[r],r++;else if(20>r)c=.005859375*u(e[r],e[r+1]),r+=2;else if(36>r)c=.005859375*u(e[r],e[r+1],e[r+2],e[r+3]),r+=4;else if(100>r){for(c=0;r<y;r++)c=u(c,e[r]);c*=.0078125;y+=8}else{for(c=0;r<x;r++)c=u(c,e[r]);c*=.009765625;x+=16}l.amplitude(1<=c?1:c);l.baseX(-.9+.06206897*v);for(c=0;c<
k;c++,w++)1.2<p[(w<<1)+1]?this.fillBgParticle(w,-1.2):p[(w<<1)+1]+=n[w]*b,d=3*q[w],l.color(m[d],m[d+1],m[d+2]),d=w<<1,l.pos(p[d],p[d+1]),l.theta(t[w]),a.drawArrays(a.TRIANGLE_STRIP,0,4)}}cleanUp(){this.ptr&&cLib._freeBuffer(this.ptr);this.program&&this.program.destroy()}}SoundParticlesAnalyzer.vertexShaderSource="precision mediump float;\nattribute vec4 inPosition;\nattribute vec2 inTexCoord;\nuniform float amplitude;\nuniform float baseX;\nuniform vec2 pos;\nuniform vec2 aspect;\nuniform vec3 color;\nuniform float theta;\nvarying vec2 vTexCoord;\nvarying vec3 vColor;\n\nvoid main() {\n\tfloat a = mix(0.0625, 0.34375, amplitude);\n\tfloat bottom = 1.0 - clamp(pos.y, -1.0, 1.0);\n\tbottom = bottom * bottom * bottom * 0.125;\n\ta = (0.75 * a) + (0.25 * bottom);\n\tgl_Position = vec4(baseX + pos.x + (5.0 * (pos.y + 1.0) * pos.x * sin((2.0 * pos.y) + theta)) + (inPosition.x * aspect.x * a), pos.y + (inPosition.y * aspect.y * a), 0.0, 1.0);\n\tvTexCoord = inTexCoord;\n\tvColor = color + bottom + (0.25 * amplitude);\n}";
SoundParticlesAnalyzer.fragmentShaderSource="precision lowp float;\nuniform sampler2D texColor;\nvarying vec2 vTexCoord;\nvarying vec3 vColor;\n\nvoid main() {\n\tfloat a = texture2D(texColor, vTexCoord).a;\n\tgl_FragColor = vec4(vColor.rgb * a, 1.0);\n}";
class WaveletAnalyzer extends Analyzer{constructor(a,b,c,d){super(a,b,d);this.analyzerL=a.createAnalyser();this.analyzerL.fftSize=128;this.analyzerR=a.createAnalyser();this.analyzerR.fftSize=128;a=cLib.HEAP8.buffer;this.dataLPtr=this.ptr=b=cLib._allocBuffer(1536);this.dataL=new Uint8Array(a,b,128);this.dataRPtr=b+=128;this.dataR=new Uint8Array(a,b,128);this.tmpPtr=b+=128;this.tmp=new Float32Array(a,b,64);this.oL1Ptr=b+=256;this.oL1=new Float32Array(a,b,128);this.oR1Ptr=b+=512;this.oR1=new Float32Array(a,
b,128)}analyze(a){a=this.ctx;const b=Analyzer.colors,c=this.oL1,d=this.oR1;this.analyzerL.getByteTimeDomainData(this.dataL);this.analyzerR.getByteTimeDomainData(this.dataR);cLib._waveletAnalyzer(this.dataLPtr,this.dataRPtr,this.tmpPtr,this.oL1Ptr,this.oR1Ptr);let e,f,g=64,h=Analyzer.controlWidth/64,k,m=0,l=Analyzer.controlHeight-32;for(;;){e=g;for(k=0;512>k;)f=c[e],0>f&&(f=-f),f=127<=f?508:f<<2,a.fillStyle=b[f>>>1],a.fillRect(k,m,h,32),f=d[e],0>f&&(f=-f),f=127<=f?508:f<<2,a.fillStyle=b[f>>>1],a.fillRect(k,
l,h,32),e++,k+=h;h<<=1;m+=32;l-=32;if(!g)break;(g>>>=1)||(h=512)}}cleanUp(){this.ptr&&cLib._freeBuffer(this.ptr)}}
class ButtonControl{static init(){const a=document.getElementsByTagName("button");if(a)for(let b=a.length-1;0<=b;b--)ButtonControl.prepare(a[b])}static create(a,b){const c=document.createElement("button");c.setAttribute("type","button");a.id&&c.setAttribute("id",a.id);var d="btn";a.color&&(d+=" "+a.color);a.square&&(d+=" square");a.opaque||(d+=" transparent");a.className&&(d+=" "+a.className);c.className=d;const e=ButtonControl.prepare(c);if(a.icon){d="large icon-"+a.icon;!a.opaque&&a.color&&(d+=
" "+a.color);const f=document.createElement("i");f.className=d;e.appendChild(f)}d=a.text||(a.stringKey?Strings.translate(a.stringKey):"");a.square?(c.setAttribute("aria-label",d),c.setAttribute("title",d)):e.appendChild(document.createTextNode(d));b||(a.onclick&&(c.onclick=a.onclick),a.parent&&a.parent.appendChild(c));return c}static prepare(a){const b=document.createElement("span");for(b.setAttribute("tabindex","-1");a.firstChild;){const c=a.firstChild;a.removeChild(c);b.appendChild(c)}a.appendChild(b);
return b}}
class CheckboxControl{static init(){const a=document.querySelectorAll("input[type=checkbox]");if(a)for(let b=a.length-1;0<=b;b--)CheckboxControl.prepare(a[b])}static create(a){var b=document.createElement("input");b.setAttribute("type","checkbox");b.setAttribute("value",a.stringKey);a.id&&b.setAttribute("id",a.id);a.className&&(b.className=a.className);b=CheckboxControl.prepare(b);a.parent&&a.parent.appendChild(b);return b}static prepare(a){const b=document.createElement("button"),c=document.createElement("span"),d=
a.parentNode,e=a.getAttribute("title")||Strings.translate(a.value);b.setAttribute("type","button");b.setAttribute("role","checkbox");b.setAttribute("aria-label",e);c.setAttribute("tabindex","-1");a.setAttribute("tabindex","-1");a.setAttribute("aria-label",e);b.className=a.className;a.className="";d&&(d.insertBefore(b,a),d.removeChild(a));b.appendChild(c);c.appendChild(a);c.appendChild(Icon.createLarge("icon-checkbox-0"));c.appendChild(Icon.createLarge("icon-checkbox-1"));c.appendChild(document.createTextNode(e));
a.removeAttribute("value");a.removeAttribute("title");b.onclick=CheckboxControl.click;return b}static click(a){(a=(a.target||this).getElementsByTagName("input"))&&a[0]&&a[0].click()}}
class GraphicalFilterControl{constructor(a,b,c){this.filterChangedCallback=null;this._enabled=!!c;this.editor=new GraphicalFilterEditorControl(a,2048,b,this.filterChanged.bind(this),InternalStorage.loadGraphicalFilterEditorSettings(),{svgRenderer:!0,radioHTML:Icon.createHTML("icon-radio",!1,"menu-icon"),checkHTML:Icon.createHTML("icon-check",!1,"menu-icon"),menuWidth:Icon.outerSizeREM+"rem",menuPadding:"0",openMenuHTML:Icon.createHTML("icon-expand-less",!0),closeMenuHTML:Icon.createHTML("icon-expand-more",
!0)})}filterChanged(){this.filterChangedCallback&&this.filterChangedCallback()}get enabled(){return this._enabled}set enabled(a){this._enabled!==a&&(this._enabled=a,this.filterChangedCallback&&this.editor&&this.editor.filter&&this.filterChangedCallback())}saveSettings(){this.editor&&InternalStorage.saveGraphicalFilterEditorSettings(this.editor.saveSettings())}}GraphicalFilterControl.defaultPresets={Powerful:"oaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGhoaGgoKCgoKCgoKCfn5+fn5+enp6enp2dnZ2cnJybm5qampqZmZmYmJiXl5eWlpWVlZSUlJOTkpKSkZGRkZCQkI+Pj46Ojo6NjY2NjYyMjIyLi4uLi4uKioqKioqKioqKiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmJiYmKioqKioqKioqKioqKiouLi4uLjIyMjIyNjY2Njo6Ojo+Pj4+QkJCRkpKSk5OTk5SUlJWVlZWWlpaXl5eXmJiYmZmZmZqampqbm5ubnJycnJ2dnZ2enp6enp+fn5+fn6CgoKCgoKCgoKGhoaGhoaGhoaGhoaGhoaE="};
class ListControlItem{constructor(a){this.index=-1;this.current=this.selected=!1;this.item=null;this.element=a}reset(){this.index=-1;this.current=this.selected=!1;this.item=null;this.element&&this.element.classList.remove("current","selected")}}
class ListControl{constructor(a){this.element="string"===typeof a?document.getElementById(a):a;this.element.classList.add("list","scrollable");this.element.getAttribute("tabindex")||this.element.setAttribute("tabindex","0");a=document.createElement("div");a.className="list-container";this.container=a;this.element.appendChild(a);this._adapter=null;this.boundZoomChanged=this.zoomChanged.bind(this);this.boundRefreshItems=this.refreshVisibleItemsInternal.bind(this);this.element.addEventListener("scroll",
this.scroll.bind(this),{passive:!0});this.resizeObserver=new ResizeObserver(this.resize.bind(this));this.resizeObserver.observe(this.element);this.itemMargin=this.itemHeight=1;this.itemHeightAndMargin=2;this.lastIndex=this.firstIndex=0;this.currentItem=null;this.clientHeight=1;this.containerHeight=0;this.visibleCount=1;this.items=[];this.refreshItemsEnqueued=!1;this.onitemcontextmenu=this.onitemclicked=null;a.onclick=this.containerClick.bind(this);a.oncontextmenu=this.containerContextMenu.bind(this);
this.resize();AppUI.addZoomHandler(this.boundZoomChanged)}destroy(){this._adapter&&(this._adapter.control=null);this.resizeObserver&&this.resizeObserver.unobserve(this.element);this.items&&this.items.fill(null);this.boundZoomChanged&&AppUI.removeZoomHandler(this.boundZoomChanged);zeroObject(this)}get adapter(){return this._adapter}set adapter(a){this._adapter!==a&&(this._adapter&&(this._adapter.control=null),this._adapter=a,this.clear(),a&&(a.control=this,this.prepareAdapter()))}prepareAdapter(){const a=
this._adapter;a&&(this.itemHeight=a.itemHeight,this.itemMargin=AppUI.thickBorderPX,this.itemHeightAndMargin=this.itemHeight+this.itemMargin,this.currentItem=a.list.currentItem,this.adjustContainerHeight(),this.resize())}zoomChanged(){if(this._adapter){this.prepareAdapter();var a=this.items;for(let b=a.length-1;0<=b;b--)a[b].index=-1;this.scroll()}}adjustContainerHeight(){var a=this._adapter;const b=this.container;a&&b&&(a=(a=a.list.length)?a*this.itemHeightAndMargin-this.itemMargin:0,this.containerHeight!==
a&&(this.containerHeight=a,b.style.height=a+"px"))}clear(){var a=this.container;if(a){for(;a.firstChild;)a.removeChild(a.firstChild);a=this.items;for(let b=a.length-1;0<=b;b--)a[b].reset();this.lastIndex=this.firstIndex=0;this.currentItem=null;this.containerHeight=this.element.scrollTop=0;this.container.style.height="0"}}scroll(){var a=this._adapter,b=this.element;if(a&&b){var c=this.items,d=this.itemHeightAndMargin,e=this.firstIndex-2;b=b.scrollTop/d|0;0>e&&(e=0);this.firstIndex=b;var f=this.visibleCount+
(0===b?2:1===b?3:4);0>(b-=2)&&(b=0);if(b>e){if((e=b-e)&&e<f)for(let l=e,p=0;l<f;l++,p++)e=c[p],c[p]=c[l],c[l]=e}else if((e-=b)&&e<f)for(let l=f-1,p=l-e;0<=p;p--,l--)e=c[l],c[l]=c[p],c[p]=e;var g=a.list,h=g.length,k=a.list.currentItem;e=this.container;var m=0;for(let l=b*d;m<f&&b<h;m++,b++,l+=d){const p=g.item(b),n=c[m];if(n.item!==p){const q=k===p;n.current!==q&&((n.current=q)?n.element.classList.add("current"):n.element.classList.remove("current"));console.log("prepare "+b);a.prepareElement(p,b,
h,n.element);n.item||e.appendChild(n.element);n.item=p}n.index!==b&&(n.index=b,n.element.style.top=l+"px")}for(a=c.length;m<a;m++)d=c[m],d.item&&(d.item=null,e.removeChild(d.element));this.lastIndex=b-1;this.lastIndex<this.firstIndex&&(this.lastIndex=this.firstIndex)}}refreshVisibleItemsInternal(){this.refreshItemsEnqueued=!1;var a=this._adapter,b=this.element;if(a&&b){this.adjustContainerHeight();b=this.items;var c=this.itemHeightAndMargin,d=a.list,e=d.length,f=a.list.currentItem,g=this.container;
this.currentItem=f;var h=0,k=this.firstIndex,m=this.visibleCount+(0===k?2:1===k?3:4);0>(k-=2)&&(k=0);for(let l=k*c;h<m&&k<e;h++,k++,l+=c){const p=d.item(k),n=b[h],q=f===p;n.current!==q&&((n.current=q)?n.element.classList.add("current"):n.element.classList.remove("current"));a.prepareElement(p,k,e,n.element);n.item||g.appendChild(n.element);n.item=p;n.index!==k&&(n.index=k,n.element.style.top=l+"px")}for(a=b.length;h<a;h++)c=b[h],c.item&&(c.item=null,g.removeChild(c.element))}}resize(){const a=this._adapter;
var b=this.element;if(a&&b){var c=this.clientHeight;b=b.clientHeight;0>b&&(b=0);var d=Math.ceil(b/this.itemHeightAndMargin)+1;if(this.visibleCount!==d){this.visibleCount=d;const e=this.items;for(;d+4>e.length;)e.push(new ListControlItem(a.createEmptyElement()))}c!==b&&(this.clientHeight=b,this.scroll())}}containerClick(a){if(this.element&&this.adapter&&a.target&&a.target.classList.contains("list-item")&&this.onitemclicked){var b=this.element.getBoundingClientRect();a=this.indexFromY(a.clientY-b.top);
if(0<=a&&(b=this.adapter.list.item(a)))this.onitemclicked(b,a)}}containerContextMenu(a){if(this.element&&this.adapter&&a.target&&a.target.classList.contains("list-item")&&this.onitemcontextmenu){var b=this.element.getBoundingClientRect();a=this.indexFromY(a.clientY-b.top);if(0<=a&&(b=this.adapter.list.item(a)))this.onitemcontextmenu(b,a)}}yFromIndex(a){return this.element?a*this.itemHeightAndMargin-this.element.scrollTop:0}indexFromY(a){if(!this.element||!this.adapter)return-1;a=(a+this.element.scrollTop)/
this.itemHeightAndMargin|0;return 0>a||a>=this.adapter.list.length?-1:a}isItemVisible(a){a=this.yFromIndex(a);return 0<=a&&a<=this.clientHeight-this.itemHeight}bringItemIntoView(a,b){const c=this.yFromIndex(a);0>c?b?this.centerItemIntoView(a):this.element.scrollTop+=c:c>this.clientHeight-this.itemHeight&&(b?this.centerItemIntoView(a):this.element.scrollTop+=c-(this.clientHeight-this.itemHeight))}centerItemIntoView(a){this.element.scrollTop=a*this.itemHeightAndMargin-(this.clientHeight-this.itemHeight>>
1)}refreshVisibleItems(){this.refreshItemsEnqueued||(this.refreshItemsEnqueued=!0,queueMicrotask(this.boundRefreshItems))}notifyCleared(){this.clear()}notifyItemsAdded(a,b){this.refreshVisibleItems()}notifyItemsRemoved(a,b){this.refreshVisibleItems()}notifyCurrentItemChanged(){this.refreshVisibleItems()}}
class SliderControl{constructor(a,b,c,d,e,f,g){this._element="string"===typeof a?document.getElementById(a):a;this._element.classList.add("slider-control");this._element.setAttribute("role","slider");b?this._element.setAttribute("tabindex","0"):this._element.setAttribute("aria-hidden","true");this.keyboardFocusable=b;a=document.createElement("span");a.className="slider-control-focus-container";a.setAttribute("tabindex","-1");this.focusContainer=a;this.ondragended=this.onvaluechanged=null;const h=
document.createElement("span");h.className="slider-control-container";a.appendChild(h);this.container=h;const k=document.createElement("span");k.className="slider-control-inner-container";h.appendChild(k);this.innerContainer=k;var m=document.createElement("span");m.className="slider-control-ruler";k.appendChild(m);this.ruler=m;m=document.createElement("span");m.className="slider-control-color slider-control-filled-ruler";k.appendChild(m);this.filledRuler=m;m=document.createElement("span");m.className=
"slider-control-color slider-control-thumb";k.appendChild(m);this.thumb=m;this._element.appendChild(a);c>d?(this._min=d|0,this._max=c|0):(this._min=c|0,this._max=d|0);this.delta=this._max-this._min;this.delta||(this.delta=1);this._disabled=!1;this._value=c-1;this.percent=0;this.value=void 0===e?c:e;this.pointerHandler=new PointerHandler(h,this.mouseDown.bind(this),this.mouseMove.bind(this),this.mouseUp.bind(this));b&&(this._element.setAttribute("aria-valuemin",c.toString()),this._element.setAttribute("aria-valuemax",
d.toString()),this._element.addEventListener("keydown",this.keyDown.bind(this)),this._element.addEventListener("focus",this.focus.bind(this)),this._element.addEventListener("blur",this.blur.bind(this)));this._rightChild=this._leftChild=null;f&&(this.leftChild=f);g&&(this.rightChild=g)}get element(){return this._element}get leftChild(){return this._leftChild}set leftChild(a){this.focusContainer&&(a?this._leftChild?this.focusContainer.replaceChild(a,this._leftChild):this.focusContainer.insertBefore(a,
this.focusContainer.firstChild):this._leftChild&&this.focusContainer.removeChild(this._leftChild),this._leftChild=a)}get rightChild(){return this._rightChild}set rightChild(a){this.focusContainer&&(a?this._rightChild?this.focusContainer.replaceChild(a,this._rightChild):this.focusContainer.appendChild(a):this._rightChild&&this.focusContainer.removeChild(this._rightChild),this._rightChild=a)}get dragging(){return this.pointerHandler?this.pointerHandler.captured:!1}get disabled(){return this._disabled}set disabled(a){this._disabled!==
a&&(this._disabled=a,this._element&&(this.keyboardFocusable&&this._element.setAttribute("tabindex",a?"-1":"0"),this._element.style.pointerEvents=a?"none":""))}get min(){return this._min}set min(a){this._min=a|=0;a>this._max&&(this._max=a,this.keyboardFocusable&&this._element.setAttribute("aria-valuemax",a.toString()));this.delta=this._max-a;this.delta||(this.delta=1);this.keyboardFocusable&&this._element.setAttribute("aria-valuemin",a.toString());this.value=this._value}get max(){return this._max}set max(a){this._max=
a|=0;a<this._min&&(this._min=a,this.keyboardFocusable&&this._element.setAttribute("aria-valuemin",a.toString()));this.delta=a-this._min;this.delta||(this.delta=1);this.keyboardFocusable&&this._element.setAttribute("aria-valuemax",a.toString());this.value=this._value}get value(){return this._value}set value(a){a|=0;a<this._min?a=this._min:a>this._max&&(a=this._max);const b=this._value;this._value=a;this.percent=100*(a-this._min)/this.delta;const c=this.percent+"%";this.filledRuler&&(this.filledRuler.style.right=
100-this.percent+"%");this.ruler&&(this.ruler.style.left=c);this.thumb&&(this.thumb.style.left=c);if(a!==b&&(this.keyboardFocusable&&this._element.setAttribute("aria-valuenow",a.toString()),this.onvaluechanged))this.onvaluechanged(a)}mouseDown(a){if(a.button||this._disabled||!this._element)return!1;this.focusContainer.focus();this.container.classList.add("active");this.mouseMove(a);return!0}mouseMove(a){const b=this.innerContainer.getBoundingClientRect(),c=b.right-b.left;a=a.clientX-(b.left+4);this.value=
0>=c?this._min:this._min+this.delta*a/c}mouseUp(a){this.mouseMove(a);this.container.classList.remove("active");if(this.ondragended)this.ondragended(this._value)}keyDown(a){switch(a.key){case "ArrowDown":case "ArrowLeft":this.value=this._value-1;break;case "ArrowUp":case "ArrowRight":this.value=this._value+1;break;case "PageDown":this.value=this._value-.1*this.delta;break;case "PageUp":this.value=this._value+.1*this.delta}}focus(){this.container.classList.add("active")}blur(){this.container.classList.remove("active")}}
class Player{constructor(a,b,c){this.audioContextTimeout=0;this.audioContextSuspended=!0;this.audioContext=window.AudioContext?new window.AudioContext:new window.webkitAudioContext;this.audioContext.suspend();this.audioContext.onstatechange=this.audioContextStateChanged.bind(this);this.graphicalFilterControl=new GraphicalFilterControl(a,this.audioContext,c);this.graphicalFilterControl.filterChangedCallback=this.filterChanged.bind(this);this.onerror=this.oncurrenttimeschanged=this.onpausedchanged=
this.onloadingchanged=this.onsongchanged=null;this.boundPlaybackError=this.playbackError.bind(this);this.boundNotifySongChanged=this.notifySongChanged.bind(this);this.boundCheckAudioContext=this.checkAudioContext.bind(this);this.audio=new Audio;this.audio.loop=!1;this.audio.controls=!1;this.audio.volume=1;a=this.playbackLoadStarted.bind(this);this.audio.onwaiting=a;this.audio.onloadstart=a;this.audio.oncanplay=this.playbackLoadEnded.bind(this);this.audio.onended=this.playbackEnded.bind(this);this.audio.onerror=
this.boundPlaybackError;this.audio.onpause=this.playbackPaused.bind(this);a=this.playbackStarted.bind(this);this.audio.onplay=a;this.audio.onplaying=a;a=this.playbackAborted.bind(this);this.audio.onabort=a;this.audio.onemptied=a;this.audio.ondurationchange=this.playbackLengthChanged.bind(this);this.audio.ontimeupdate=this.currentTimeChanged.bind(this);this.source=this.audioContext.createMediaElementSource(this.audio);this._alive=!0;this._loading=!1;this._paused=!0;this._currentSong=this._playlist=
null;this._volume=100;this.lastObjectURL=null;this.volume=void 0===b?100:b;this.filterChanged();(this.mediaSession=b="mediaSession"in navigator&&"MediaMetadata"in window?navigator.mediaSession:null)&&"setActionHandler"in b&&(a=this.playPause.bind(this),b.setActionHandler("previoustrack",this.previous.bind(this)),b.setActionHandler("seekbackward",this.seekBackward.bind(this)),b.setActionHandler("pause",a),b.setActionHandler("play",a),b.setActionHandler("seekforward",this.seekForward.bind(this)),b.setActionHandler("nexttrack",
this.next.bind(this)))}destroy(a){this.stop();a?(this._alive=!1,this.graphicalFilterControl&&this.graphicalFilterControl.saveSettings()):(this._playlist&&this._playlist.destroy(),(a=this.mediaSession)&&"setActionHandler"in a&&(a.setActionHandler("previoustrack",null),a.setActionHandler("seekbackward",null),a.setActionHandler("pause",null),a.setActionHandler("play",null),a.setActionHandler("seekforward",null),a.setActionHandler("nexttrack",null)),zeroObject(this))}filterChanged(){!this._alive||this.graphicalFilterControl.enabled&&
this.graphicalFilterControl.editor.filter.connectSourceAndDestination(this.source,this.audioContext.destination)||(this.source.disconnect(),this.graphicalFilterControl.editor.filter.disconnectOutputFromDestination(),this.source.connect(this.audioContext.destination,0,0))}get alive(){return this._alive}get loading(){return this._loading}get paused(){return this._paused}get volume(){return this._volume}set volume(a){a|=0;this._volume=0>=a?0:100<=a?100:a;this.audio&&(this.audio.volume=a/100)}get playlist(){return this._playlist}set playlist(a){this._alive&&
(this.stop(),this._playlist=a)}get currentSong(){return this._currentSong}get currentTimeMS(){return this._currentSong?1E3*this.audio.currentTime|0:-1}audioContextStateChanged(){this._alive&&"running"!==this.audioContext.state&&!this.audioContextSuspended&&(this.audioContextSuspended=!0,this.playbackPaused())}playbackLoadStarted(){if(this._alive&&!this._loading&&(this._loading=!0,this.onloadingchanged))this.onloadingchanged(!0)}playbackLoadEnded(){if(this._alive&&this._loading&&(this._loading=!1,
this.onloadingchanged))this.onloadingchanged(!1)}playbackEnded(){this._alive&&this.next()}playbackError(a,b,c,d,e){if(this._alive&&(this.stop(),this.onerror))this.onerror(e?e.message?e.message:"string"===typeof a?a:e.toString():"string"===typeof a?a:Strings.UnknownError)}suspendAudioContext(a){this.audioContextTimeout&&(clearTimeout(this.audioContextTimeout),this.audioContextTimeout=0);this.audioContextSuspended||(a?this.audioContextTimeout=window.setTimeout(this.boundCheckAudioContext,5E3):(this.audioContextSuspended=
!0,this.audioContext.suspend()))}resumeAudioContext(){this.audioContextTimeout&&(clearTimeout(this.audioContextTimeout),this.audioContextTimeout=0);if(this.audioContextSuspended||"running"!==this.audioContext.state)this.audioContextSuspended=!1,this.audioContext.resume()}checkAudioContext(){this.audioContextTimeout=0;this._paused?this.audioContextSuspended||(this.audioContextSuspended=!0,this.audioContext.suspend()):this.audioContextSuspended&&(this.audioContextSuspended=!1,this.audioContext.resume())}playbackPaused(){if(this._alive&&
!this._paused&&(this._paused=!0,this.suspendAudioContext(!0),this.onpausedchanged))this.onpausedchanged(!0)}playbackStarted(){if(this._alive&&this._paused&&(this._paused=!1,this.resumeAudioContext(),this.onpausedchanged))this.onpausedchanged(!1)}playbackAborted(){if(this._alive){if(this._loading&&(this._loading=!1,this.onloadingchanged))this.onloadingchanged(!1);if(!this._paused&&(this._paused=!0,this.suspendAudioContext(!0),this.onpausedchanged))this.onpausedchanged(!0)}}playbackLengthChanged(){this._alive&&
this.audio&&this._playlist&&this._currentSong&&(this._playlist.songLengthChanged(this._currentSong,this.audio.duration),this.mediaSession&&0<this.audio.duration&&"setPositionState"in this.mediaSession&&this.mediaSession.setPositionState({duration:this.audio.duration}))}currentTimeChanged(){if(this._alive&&this.audio&&this._currentSong&&this.oncurrenttimeschanged)this.oncurrenttimeschanged(this.audio.currentTime)}notifySongChanged(){if(this._alive){const a=this._currentSong,b=this.mediaSession;b&&
(a?(b.metadata=new window.MediaMetadata({title:a.title,artist:a.artist,album:a.album,artwork:[{src:"assets/images/albumArts/64x64.png",sizes:"64x64",type:"image/png"},{src:"assets/images/albumArts/96x96.png",sizes:"96x96",type:"image/png"},{src:"assets/images/albumArts/192x192.png",sizes:"192x192",type:"image/png"},{src:"assets/images/albumArts/256x256.png",sizes:"256x256",type:"image/png"},{src:"assets/images/albumArts/512x512.png",sizes:"512x512",type:"image/png"}]}),0<a.lengthMS&&"setPositionState"in
b&&b.setPositionState({duration:a.lengthMS/1E3})):b.playbackState="none");if(this.onsongchanged)this.onsongchanged(a)}}previous(){this._alive&&this._playlist&&(this._playlist.moveCurrentToPrevious(),this.play(-1))}seekBackward(){this._alive&&this.seekTo(-1E4,!0)}pause(){this._alive&&this._currentSong&&this.audio.pause()}play(a){if(this._alive){if(this._currentSong&&void 0===a){this.resumeAudioContext();var b=this.audio.play()}else if(this._playlist){void 0!==a&&0<=a&&(this._playlist.currentIndex=
a);a=this._playlist.currentItem;!a&&this._playlist.length&&(this._playlist.moveCurrentToNext(),a=this._playlist.currentItem);if(!a){this.stop();return}this._currentSong=a;queueMicrotask(this.boundNotifySongChanged);for(this.resumeAudioContext();this.audio.firstChild;)this.audio.removeChild(this.audio.firstChild);b=document.createElement("source");a.url?b.src=a.url:a.file&&(this.lastObjectURL&&URL.revokeObjectURL(this.lastObjectURL),this.lastObjectURL=URL.createObjectURL(a.file),b.src=this.lastObjectURL);
b.onerror=this.boundPlaybackError;this.audio.appendChild(b);this.audio.load();b=this.audio.play()}b&&b.catch(Player.nop)}}playPause(){this._alive&&(!this._currentSong||this.audio.paused?this.play():this.pause())}stop(){if(this._alive){if(this._currentSong){for(;this.audio.firstChild;)this.audio.removeChild(this.audio.firstChild);this.audio.load();this.lastObjectURL&&(URL.revokeObjectURL(this.lastObjectURL),this.lastObjectURL=null);if(this._loading&&(this._loading=!1,this.onloadingchanged))this.onloadingchanged(!1);
if(!this._paused&&(this._paused=!0,this.onpausedchanged))this.onpausedchanged(!0);this._currentSong=null;this.notifySongChanged()}this.suspendAudioContext(!1)}}seekForward(){this._alive&&this.seekTo(1E4,!0)}next(){this._alive&&this._playlist&&(this._playlist.moveCurrentToNext(),this.play(-1))}seekTo(a,b){this._alive&&this._currentSong&&!(0>=this._currentSong.lengthMS)&&this.audio.seekable&&this.audio.seekable.length&&(a=a/1E3+(b?this.audio.currentTime:0),this.audio.currentTime=a>this.audio.duration?
this.audio.duration:0>=a?0:a)}}Player.nop=function(){};
class InternalStorage{static async cacheGet(a,b){a=await caches.open(a);b=b?InternalStorage.cachePrefix+b:InternalStorage.cachePrefix;return(b=await a.match(b))?b.arrayBuffer():null}static async cachePut(a,b,c){a=await caches.open(a);b=b?InternalStorage.cachePrefix+b:InternalStorage.cachePrefix;return a.put(b,c)}static loadAppSettings(){try{const a=localStorage.getItem("appSettings");if(a){const b=JSON.parse(a);if(b)return b}}catch(a){}return{playerVolume:100,graphicalFilterControlEnabled:!1}}static saveAppSettings(a){a?
localStorage.setItem("appSettings",JSON.stringify(a)):localStorage.removeItem("appSettings")}static loadGraphicalFilterEditorSettings(){try{const a=localStorage.getItem("graphicalFilterEditorSettings");if(a){const b=JSON.parse(a);if(b)return b}}catch(a){}return{currentChannelIndex:0,editMode:GraphicalFilterEditorControl.editModeZones,isActualChannelCurveNeeded:!0,isNormalized:!1,isSameFilterLR:!0,showZones:!0}}static saveGraphicalFilterEditorSettings(a){a?localStorage.setItem("graphicalFilterEditorSettings",
JSON.stringify(a)):localStorage.removeItem("graphicalFilterEditorSettings")}static async loadPlaylist(a){a=await InternalStorage.cacheGet(InternalStorage.cacheNamePlaylists,a);if(!a)return null;try{return Playlist.deserialize(new DataReader(a))}catch(b){return null}}static async savePlaylist(a,b){return InternalStorage.cachePut(InternalStorage.cacheNamePlaylists,b,new Response(a.serialize().trimmedArrayBuffer))}}InternalStorage.cachePrefix="https://fplay.com.br/";
InternalStorage.cacheNamePlaylists="playlists";
class Modal{constructor(a){this.options=a;var b=document.querySelectorAll("button,input,select,textarea"),c=Array(b.length);for(let d=b.length-1;0<=d;d--){const e=b[d],f=e.getAttribute("tabindex");e.setAttribute("tabindex","-1");c[d]={element:e,tabindex:f}}this.changedElements=c;this.oldBodyOverflow=document.body.style.overflow;document.body.style.overflow="hidden";this.containerElement=document.createElement("div");this.containerElement.className=a.background?"modal-container background":"modal-container";
this.modalElement=document.createElement("form");this.modalElement.className="modal slide";this.modalElement.onsubmit=this.submit.bind(this);this.modalHeaderElement=document.createElement("div");this.modalHeaderElement.className="modal-decoration";this.modalHeaderElement.innerHTML=a.title||(a.titleStringKey?Strings.translate(a.titleStringKey):Strings.Oops);this.modalBodyElement=document.createElement("div");this.modalBodyElement.className="modal-body";"string"===typeof a.html?this.modalBodyElement.innerHTML=
a.html:this.modalBodyElement.appendChild(a.html);if((b=this.modalBodyElement.getElementsByTagName("button"))&&b.length)for(c=b.length-1;0<=c;c--){const d=b[c];ButtonControl.prepare(d);d.onclick=()=>{if(!this.fading&&this.options.onbuttonclick)this.options.onbuttonclick(d.id,d)}}this.modalFooterElement=document.createElement("div");this.modalFooterElement.className=a.buttons&&1===a.buttons.length?"modal-decoration right":"modal-decoration";this.defaultSubmitButton=this.defaultCancelButton=null;if(a.buttons)for(b=
0;b<a.buttons.length;b++){const d=a.buttons[b],e=ButtonControl.create(d,!0);d.defaultCancel&&(this.defaultCancelButton=e);d.defaultSubmit&&(this.defaultSubmitButton=e);b&&(e.style.float="right");e.onclick=()=>{if(!this.fading){if(d.onclick)d.onclick(d.id,e);if(this.options.onbuttonclick)this.options.onbuttonclick(d.id,e)}};this.modalFooterElement.appendChild(e)}this.modalElement.appendChild(this.modalHeaderElement);this.modalElement.appendChild(this.modalBodyElement);this.modalElement.appendChild(this.modalFooterElement);
this.containerElement.appendChild(this.modalElement);document.body.appendChild(this.containerElement);this.boundDocumentKeyDown=this.documentKeyDown.bind(this);document.addEventListener("keydown",this.boundDocumentKeyDown,!0);this.fading=!0;setTimeout(()=>{if(a.onshowing)a.onshowing();this.containerElement.classList.add("in");this.modalElement.classList.add("in");setTimeout(()=>{this.fading=!1;if(this.options.onshown)this.options.onshown()},320)},20)}static get visible(){return!!Modal.modal}static get currentModalElement(){return Modal.modal?
Modal.modal.modalElement:null}static get currentModalHeaderElement(){return Modal.modal?Modal.modal.modalHeaderElement:null}static get currentModalBodyElement(){return Modal.modal?Modal.modal.modalBodyElement:null}static get currentModalFooterElement(){return Modal.modal?Modal.modal.modalFooterElement:null}static show(a){if(Modal.modal)return!1;a.okcancel?a.buttons=[{id:"cancel",defaultCancel:!0,icon:"clear",stringKey:Strings.Cancel,className:"transparent",onclick:a.oncancel||Modal.hide},{id:"ok",
defaultSubmit:a.okcancelsubmit,icon:"check",stringKey:Strings.OK,onclick:a.onok||Modal.hide}]:a.buttons&&a.buttons.length||(a.buttons=[{id:"cancel",defaultCancel:!0,icon:"clear",stringKey:Strings.Close,onclick:Modal.hide}]);Modal.modal=new Modal(a);return!0}static hide(){Modal.modal&&Modal.modal.hideInternal()}static defaultCancelAction(){Modal.modal&&Modal.modal.defaultCancelActionInternal()}hideInternal(){if(!(Modal.modal!==this||this.fading||this.options.onhiding&&!1===this.options.onhiding())){document.removeEventListener("keydown",
this.boundDocumentKeyDown,!0);var a=this.changedElements;for(let b=a.length-1;0<=b;b--){const c=a[b].element,d=a[b].tabindex;d?c.setAttribute("tabindex",d):c.removeAttribute("tabindex")}document.body.style.overflow=this.oldBodyOverflow;this.fading=!0;this.containerElement.classList.remove("in");this.modalElement.classList.remove("in");setTimeout(()=>{Modal.modal=null;if(this.options.onhidden)this.options.onhidden();document.body.removeChild(this.containerElement);if(this.options.buttons)for(let b=
this.options.buttons.length-1;0<=b;b--)zeroObject(this.options.buttons[b]);zeroObject(this.options);zeroObject(this)},320)}}documentKeyDown(a){"Escape"===a.key&&this.defaultCancelActionInternal()}defaultCancelActionInternal(){this.defaultCancelButton&&this.defaultCancelButton.click()}submit(a){cancelEvent(a);this.defaultSubmitButton&&this.defaultSubmitButton.click();return!1}}Modal.modal=null;
class AppUI{static preparePlaylist(){if(App.player&&AppUI.playlistControl){var a=App.player.playlist;a?(a.onsonglengthchanged=AppUI.playlistSongLengthChanged,AppUI.playlistControl.adapter=new PlaylistAdapter(a)):AppUI.playlistControl.adapter=null}}static adjustWindow(){if(AppUI.devicePixelRatio!==devicePixelRatio&&AppUI.rootVariables){AppUI.devicePixelRatio=devicePixelRatio;var a=AppUI.factorToZoom(devicePixelRatio);const b=/[,\.]$/,c=/0+$/;AppUI._smallIconSizePX=Icon.baseSizePX*((a+1>>2)+1)/devicePixelRatio;
AppUI._largeIconSizePX=Icon.baseSizePX*(AppUI.zoomToFactor(a)<<1)/devicePixelRatio;AppUI._thinBorderPX=(AppUI.baseThinBorderPX*devicePixelRatio|0)/devicePixelRatio;AppUI._thickBorderPX=(AppUI.baseThickBorderPX*devicePixelRatio|0)/devicePixelRatio;AppUI.rootVariables.textContent=`:root {
				--icon-size: ${AppUI._smallIconSizePX}px;
				--icon-padding: ${(.5*(AppUI.remToPX(Icon.outerSizeREM)-AppUI._smallIconSizePX)).toFixed(6).replace(c,"").replace(b,"")}px;
				--large-icon-size: ${AppUI._largeIconSizePX}px;
				--large-icon-padding: ${(.5*(AppUI.remToPX(Icon.outerSizeREM)-AppUI._largeIconSizePX)).toFixed(6).replace(c,"").replace(b,"")}px;
				--thin-border: ${AppUI._thinBorderPX}px;
				--thick-border: ${AppUI._thickBorderPX}px;
			}`;for(a=AppUI.zoomHandlers.length-1;0<=a;a--)AppUI.zoomHandlers[a]()}}static changeText(a,b){if(a){null===b&&(b="");var c=a.lastChild;c?c.nodeValue=b:a.appendChild(document.createTextNode(b))}}static changeZoom(a){if(AppUI.webFrame)if(a=(1<=devicePixelRatio?1+Math.ceil(4*devicePixelRatio):.51>=devicePixelRatio?0:.67>=devicePixelRatio?1:.76>=devicePixelRatio?2:.81>=devicePixelRatio?3:4)+a,0>=a)AppUI.webFrame.setZoomFactor(.5);else if(21<=a)AppUI.webFrame.setZoomFactor(5);else switch(a){case 1:AppUI.webFrame.setZoomFactor(2/
3);break;case 2:AppUI.webFrame.setZoomFactor(.75);break;case 3:AppUI.webFrame.setZoomFactor(.8);break;case 4:AppUI.webFrame.setZoomFactor(.9);break;default:AppUI.webFrame.setZoomFactor((a-1)/4)}}static globalKeyHandler(a){if(a.ctrlKey||a.metaKey){if(AppUI.webFrame)switch(a.key){case "-":return a.repeat||AppUI.changeZoom(-1),cancelEvent(a);case "+":case "=":return a.repeat||AppUI.changeZoom(1),cancelEvent(a);case "0":return cancelEvent(a)}}else switch(a.key){case "Escape":return a.repeat||(Modal.visible?
Modal.hide():App.player&&App.player.playPause()),cancelEvent(a);case "F1":return!a.repeat&&App.player&&App.player.previous(),cancelEvent(a);case "F2":return!a.repeat&&App.player&&App.player.playPause(),cancelEvent(a);case "F3":return!a.repeat&&App.player&&App.player.stop(),cancelEvent(a);case "F4":return!a.repeat&&App.player&&App.player.next(),cancelEvent(a)}}static preInit(a,b){AppUI.webFrame=a;window.addEventListener("keydown",AppUI.globalKeyHandler,!0);a&&b.devicePixelRatio&&b.devicePixelRatio!==
devicePixelRatio&&a.setZoomFactor(b.devicePixelRatio);ButtonControl.init();CheckboxControl.init();AppUI.seekSlider=new SliderControl("seek-slider",!1,0,1);AppUI.seekSlider.disabled=!0;AppUI.seekSlider.onvaluechanged=AppUI.seekSliderValueChanged;AppUI.seekSlider.ondragended=AppUI.seekSliderDragEnded;AppUI.currentTimeLabel=document.createElement("span");AppUI.currentTimeLabel.className="seek-label";AppUI.currentTimeS=0;AppUI.changeText(AppUI.currentTimeLabel,Formatter.none);AppUI.seekSlider.leftChild=
AppUI.currentTimeLabel;AppUI.songLengthLabel=document.createElement("span");AppUI.songLengthLabel.className="seek-label";AppUI.changeText(AppUI.songLengthLabel,Formatter.none);AppUI.seekSlider.rightChild=AppUI.songLengthLabel;AppUI.volumeSlider=new SliderControl("volume-slider",!0,0,100,b.playerVolume);AppUI.volumeSlider.leftChild=Icon.createLarge("icon-volume","green small-right-margin");AppUI.volumeLabel=document.createElement("span");AppUI.volumeLabel.className="volume-label small-left-margin";
AppUI.changeText(AppUI.volumeLabel,AppUI.volumeSlider.value.toString());AppUI.volumeSlider.rightChild=AppUI.volumeLabel;AppUI.volumeSlider.onvaluechanged=AppUI.volumeSliderValueChanged;AppUI.playlistControl=new ListControl("playlist-control");AppUI.playlistControl.onitemclicked=AppUI.playlistControlItemClicked;AppUI.playlistControl.onitemcontextmenu=AppUI.playlistControlItemContextMenu;AppUI.graphicalFilterControlEnabled=document.getElementById("graphical-filter-control-enabled");AppUI.graphicalFilterControlEnabled.checked=
b.graphicalFilterControlEnabled||!1;AppUI.graphicalFilterControlEnabled.onclick=AppUI.graphicalFilterControlEnabledClicked;App.frameless||AppUI.panelContainer.classList.add("web");window.addEventListener("resize",AppUI.adjustWindow,{passive:!0});AppUI.adjustWindow()}static init(a){App.player&&(AppUI.volumeSlider.value=App.player.volume,App.player.onsongchanged=AppUI.playerSongChanged,App.player.onloadingchanged=AppUI.playerLoadingChanged,App.player.onpausedchanged=AppUI.playerPausedChanged,App.player.oncurrenttimeschanged=
AppUI.playerCurrentTimeSChanged,App.player.onerror=AppUI.playerError,AppUI.preparePlaylist(),AppUI.playerSongChanged(App.player.currentSong),App.player.playlist&&0<=App.player.playlist.currentIndex&&AppUI.playlistControl.centerItemIntoView(App.player.playlist.currentIndex))}static destroy(){zeroObject(AppUI)}static get loading(){return AppUI._loading}static get thinBorderPX(){return AppUI._thinBorderPX}static get thickBorderPX(){return AppUI._thickBorderPX}static addZoomHandler(a){a&&AppUI.zoomHandlers.push(a)}static removeZoomHandler(a){if(a)for(let b=
AppUI.zoomHandlers.length-1;0<=b;b--)if(AppUI.zoomHandlers[b]===a){AppUI.zoomHandlers.splice(b,1);break}}static factorToZoom(a){return 1>=a?0:Math.round(4*a)-4}static zoomToFactor(a){return 0>=a?1:.25*(a+4)}static remToPX(a){return a*AppUI.rem}static pxToREM(a){return a/AppUI.rem}static playerSongChanged(a){App.player&&AppUI.playlistControl&&(AppUI.changeText(AppUI.artistLabel,a&&a.artist||Formatter.none),AppUI.changeText(AppUI.titleLabel,a&&a.title||Formatter.none),App.player.playlist&&0<=App.player.playlist.currentIndex&&
AppUI.playlistControl.bringItemIntoView(App.player.playlist.currentIndex),AppUI.currentTimeS=0,a?(AppUI.changeText(AppUI.currentTimeLabel,Formatter.zero),AppUI.changeText(AppUI.songLengthLabel,a.length),AppUI.seekSlider&&(AppUI.seekSlider.value=0,0<a.lengthMS?(AppUI.seekSlider.disabled=!1,AppUI.seekSlider.max=a.lengthMS):AppUI.seekSlider.disabled=!0)):(AppUI.changeText(AppUI.currentTimeLabel,Formatter.none),AppUI.changeText(AppUI.songLengthLabel,Formatter.none),AppUI.seekSlider&&(AppUI.seekSlider.disabled=
!0,AppUI.seekSlider.value=0)))}static playerLoadingChanged(a){App.updateLoadingIcon()}static playerPausedChanged(a){AppUI.iconPlay&&AppUI.iconPause&&(a?(AppUI.iconPause.classList.add("hidden"),AppUI.iconPlay.classList.remove("hidden")):(AppUI.iconPlay.classList.add("hidden"),AppUI.iconPause.classList.remove("hidden")))}static playerCurrentTimeSChanged(a){if(AppUI.seekSlider&&!AppUI.seekSlider.dragging){var b=a|0;AppUI.currentTimeS!==b&&(AppUI.currentTimeS=b,AppUI.changeText(AppUI.currentTimeLabel,
Formatter.formatTimeS(b)));AppUI.seekSlider.value=1E3*a}}static playerError(a){alert(a)}static playlistSongLengthChanged(a){App.player&&(a===App.player.currentSong&&(AppUI.changeText(AppUI.songLengthLabel,a.length),AppUI.seekSlider&&(0<a.lengthMS?(AppUI.seekSlider.disabled=!1,AppUI.seekSlider.max=a.lengthMS):(AppUI.seekSlider.value=0,AppUI.seekSlider.disabled=!0))),AppUI.playlistControl&&AppUI.playlistControl.refreshVisibleItems())}static seekSliderValueChanged(a){AppUI.seekSlider&&AppUI.seekSlider.dragging&&
(a=a/1E3|0,AppUI.currentTimeS!==a&&(AppUI.currentTimeS=a,AppUI.changeText(AppUI.currentTimeLabel,Formatter.formatTimeS(a))))}static seekSliderDragEnded(a){App.player&&App.player.currentSong&&App.player.seekTo(a)}static volumeSliderValueChanged(a){App.player&&(App.player.volume=a);AppUI.volumeLabel&&AppUI.changeText(AppUI.volumeLabel,a.toString())}static playlistControlItemClicked(a,b){App.player&&App.player.play(b)}static playlistControlItemContextMenu(a,b){App.player&&App.player.play(b)}static graphicalFilterControlEnabledClicked(){App.player&&
(App.player.graphicalFilterControl.enabled=AppUI.graphicalFilterControlEnabled.checked)}static async addFiles(a){if(App.player&&!AppUI._loading&&(a=App.electron?await App.showOpenFileDialog():await App.showOpenDialogWeb(a))&&App.player)try{AppUI._loading=!0;App.updateLoadingIcon();App.player.playlist||(App.player.playlist=new Playlist,AppUI.preparePlaylist());const b=App.electron?null:new Uint8Array(BufferedFileHandle.minBufferLength<<1),c=App.electron?null:[new Uint8Array(256)];for(let d=0;d<a.length&&
App.player&&App.player.playlist;d++)App.electron?await App.player.playlist.addSong(a[d]):await App.player.playlist.addSongWeb(a[d],b,c)}catch(b){alert("addFiles error: "+(b.message||b.toString()))}finally{AppUI._loading=!1,App.updateLoadingIcon()}}static async addDirectory(a){a=await App.listDirectory(a);if(!App.player||!App.player.playlist||AppUI.directoryCancelled)return!1;if(!a)return!0;for(let b=0;b<a.length;b++)if(a[b].isDirectory){if(!await AppUI.addDirectory(a[b].fileURL))return!1}else{if(!App.player||
!App.player.playlist||AppUI.directoryCancelled)return!1;await App.player.playlist.addSong(a[b])}return!0}static async addDirectories(){if(App.player&&!AppUI._loading){if(!App.electron)return AppUI.addFiles(!0);var a=await App.showOpenDirectoryDialog();if(a&&App.player)try{AppUI._loading=!0;AppUI.directoryCancelled=!1;App.updateLoadingIcon();App.player.playlist||(App.player.playlist=new Playlist,AppUI.preparePlaylist());for(let b=0;b<a.length&&await AppUI.addDirectory(a[b]);b++);}catch(b){alert("addDirectories error: "+
(b.message||b.toString()))}finally{AppUI._loading=!1,AppUI.directoryCancelled=!1,App.updateLoadingIcon()}}}static switchView(){AppUI.panelContainer&&AppUI.panelContainer.classList.toggle("toggled")}}AppUI.rem=4;AppUI.optionalPanelClientWidthREM=128;AppUI.optionalPanelClientWidthPX=AppUI.remToPX(AppUI.optionalPanelClientWidthREM);AppUI.minWidthREM=216;AppUI.minWidthPX=AppUI.remToPX(AppUI.minWidthREM);AppUI.baseThinBorderPX=1;AppUI.baseThickBorderPX=2;AppUI.zoomHandlers=[];AppUI.rootVariables=document.getElementById("root-variables");
AppUI.panelContainer=document.getElementById("panel-container");AppUI.fixedPanel=document.getElementById("fixed-panel");AppUI.optionalPanel=document.getElementById("optional-panel");AppUI.iconPlay=document.getElementById("icon-play");AppUI.iconPause=document.getElementById("icon-pause");AppUI.artistLabel=document.getElementById("artist-label");AppUI.titleLabel=document.getElementById("title-label");AppUI._loading=!1;AppUI.devicePixelRatio=-1;AppUI._smallIconSizePX=Icon.baseSizePX;
AppUI._largeIconSizePX=Icon.baseSizePX<<1;AppUI._thinBorderPX=AppUI.baseThinBorderPX;AppUI._thickBorderPX=AppUI.baseThickBorderPX;AppUI.directoryCancelled=!1;
class App{static mainWindowStateChanged(a,b,c){if(App.isMinimized!==b||App.isMaximized!==c)App.isMinimized=b,App.isMaximized=c,b||(App.titleBar&&(App.titleBar.className=c?"maximized":""),App.iconRestore&&(App.iconRestore.className=c?"":"hidden"),App.iconMaximize&&(App.iconMaximize.className=c?"hidden":""))}static mainWindowClosing(){if(App.player&&App.player.alive){const a=App.closeHandlers,b=[],c=App.player.playlist;InternalStorage.saveAppSettings({devicePixelRatio,playerVolume:App.player.volume,
graphicalFilterControlEnabled:App.player.graphicalFilterControl.enabled});App.player.destroy(!0);if(a&&a.length)for(let d=a.length-1;0<=d;d--)if(a[d]){const e=a[d]();e&&b.push(e)}App.electron&&(c&&b.push(InternalStorage.savePlaylist(c)),b.length?Promise.all(b).then(App.destroy,App.destroy):App.destroy())}}static destroy(){App.player&&App.player.destroy();AppUI.destroy();const a=App.ipcRenderer;zeroObject(App);a&&a.invoke("mainWindowFinalClose")}static updateLoadingIcon(){App.iconLoading&&(App.iconLoading.style.display=
App.loading?"":"none")}static get loading(){return(App.player?App.player.loading:!1)||AppUI.loading||App._loading}static set loading(a){App._loading!==a&&(App._loading=a,App.updateLoadingIcon())}static get installPromptReady(){return!!App.installPrompt}static showInstallPrompt(){const a=App.installPrompt;if(a&&a.prompt)try{App.installPrompt=null,a.prompt()}catch(b){}}static beforeInstallPrompt(a){"preventDefault"in a&&a.preventDefault();App.installPrompt=a}static adjustCover(){const a=document.getElementById("cover");
if(a){const b=document.body.getBoundingClientRect();a.style.transform=`scale(${Math.ceil(.5*b.right)}, ${Math.ceil(.5*b.bottom)})`}}static sortFiles(a){a.length&&(a[0].webkitRelativePath?a.sort(function(b,c){return b.webkitRelativePath.localeCompare(c.webkitRelativePath)}):a.sort(function(b,c){return b.name.localeCompare(c.name)}));return a}static preInit(){Strings.init();Icon.init();GraphicalFilterEditorStrings.init(Strings.language);const a=InternalStorage.loadAppSettings(),b=window.electronWebFrame;
delete window.electronIpcRenderer;delete window.electronWebFrame;if("serviceWorker"in navigator){window.addEventListener("beforeinstallprompt",App.beforeInstallPrompt);var c=navigator.serviceWorker.register("sw.js");c&&"then"in c&&c.then(function(d){d&&"onupdatefound"in d&&d.active&&(d.onupdatefound=function(){Modal.show({html:Strings.PleaseRefresh,title:Strings.UpdateAvailable})})})}window.addEventListener("resize",App.adjustCover);App.adjustCover();App.ipcRenderer?(App.ipcRenderer.on("mainWindowStateChanged",
App.mainWindowStateChanged),App.ipcRenderer.on("mainWindowClosing",App.mainWindowClosing),App.triggerMainWindowStateChanged()):window.addEventListener("beforeunload",App.mainWindowClosing);App.frameless&&(App.titleBar=document.createElement("h1"),App.titleBar.innerHTML=`
				<div></div>
				<i id="icon-main"></i>
				FPlay
				<span><span role="button" onclick="App.mainWindowMinimize()">${Icon.createHTML("icon-minimize",!1)}</span><span role="button" onclick="App.mainWindowRestoreOrMaximize()">${Icon.createHTML("icon-restore",!1,"hidden","icon-restore")}${Icon.createHTML("icon-maximize",!1,null,"icon-maximize")}</span><span role="button" class="close" onclick="App.mainWindowClose()">${Icon.createHTML("icon-close",!1)}</span></span>
			`,document.body.insertBefore(App.titleBar,document.body.firstChild),App.iconRestore=document.getElementById("icon-restore"),App.iconMaximize=document.getElementById("icon-maximize"),document.body.removeChild(App.iconLoading),App.iconLoading.className="",App.titleBar.insertBefore(App.iconLoading,document.getElementById("icon-main").nextSibling));App.electron||(c=document.createElement("div"),c.style.display="none",App.fileInput=document.createElement("input"),App.fileInput.setAttribute("type","file"),
App.fileInput.setAttribute("multiple","multiple"),App.fileInput.setAttribute("aria-label",Strings.AddFiles),App.fileInput.onchange=function(){if(App.fileInput&&App.fileInputPromiseResolve&&parseInt(App.fileInput.getAttribute("data-version"))===App.fileInputVersion){App.fileInputVersion++;var d=App.fileInputPromiseResolve;App.fileInputPromiseResolve=null;if(App.fileInput.files&&App.fileInput.files.length){var e=Array(App.fileInput.files.length);for(let f=e.length-1;0<=f;f--)e[f]=App.fileInput.files[f];
App.fileInput.value="";d(App.sortFiles(e))}else d(null)}},c.appendChild(App.fileInput),document.getElementById("top-panel").appendChild(c));AppUI.preInit(b,a)}static async init(){if(!App.player){var a=InternalStorage.loadAppSettings();App.player=new Player(document.getElementById("graphical-filter-control"),a.playerVolume,a.graphicalFilterControlEnabled);try{const b=await InternalStorage.loadPlaylist();if(!App.player||!App.player.alive)return;b&&(App.player.playlist=b)}catch(b){}App.player&&App.player.alive&&
(AppUI.init(a),(a=document.getElementById("cover"))&&a.classList.remove("in"),setTimeout(function(){window.removeEventListener("resize",App.adjustCover);const b=document.getElementById("cover");b&&document.body.removeChild(b)},320),App.loading=!1)}}static triggerMainWindowStateChanged(){App.ipcRenderer&&App.ipcRenderer.invoke("triggerMainWindowStateChanged")}static mainWindowMinimize(){App.ipcRenderer&&App.ipcRenderer.invoke("mainWindowMinimize")}static mainWindowRestoreOrMaximize(){App.ipcRenderer&&
App.ipcRenderer.invoke(App.isMaximized?"mainWindowRestore":"mainWindowMaximize")}static mainWindowClose(){App.ipcRenderer&&App.ipcRenderer.invoke("mainWindowClose")}static async showOpenFileDialog(){if(App.fileInput||App._showingDialog)return null;try{return App._showingDialog=!0,await App.ipcRenderer.invoke("showOpenFileDialog")}finally{App._showingDialog=!1}}static convertFilePathsToAppFiles(a){return App.ipcRenderer.invoke("convertFilePathsToAppFiles",a)}static async showOpenDirectoryDialog(){if(App._showingDialog)return null;
try{return App._showingDialog=!0,await App.ipcRenderer.invoke("showOpenDirectoryDialog")}finally{App._showingDialog=!1}}static listDirectory(a){return App.ipcRenderer.invoke("listDirectory",a)}static extractMetadata(a,b){return App.ipcRenderer.invoke("extractMetadata",a,b)}static async showOpenDialogWeb(a){if(!App.fileInput)return null;App.fileInputPromiseResolve&&(App.fileInputPromiseResolve(null),App.fileInputPromiseResolve=null);App.fileInput.setAttribute("data-version",(++App.fileInputVersion).toString());
a?(App.fileInput.setAttribute("webkitdirectory","webkitdirectory"),App.fileInput.setAttribute("directory","directory"),App.fileInput.removeAttribute("accept")):(App.fileInput.removeAttribute("webkitdirectory"),App.fileInput.removeAttribute("directory"),App.fileInput.setAttribute("accept",Playlist.concatenatedSupportedExtensions));return new Promise(b=>{App.fileInputPromiseResolve=b;App.fileInput.click()})}}App.electron=!!window.electronIpcRenderer;App.frameless=App.electron;App.ipcRenderer=window.electronIpcRenderer;
App.closeHandlers=[];App.iconLoading=document.getElementById("icon-loading");App.titleBar=null;App.iconRestore=null;App.iconMaximize=null;App.installPrompt=null;App.fileInputVersion=0;App._loading=!0;App._showingDialog=!1;App.isMinimized=!1;App.isMaximized=!1;function main(){App.init()}App.preInit();let cLib;function cancelEvent(a){a&&("isCancelled"in a&&(a.isCancelled=!0),"preventDefault"in a&&a.preventDefault(),"stopPropagation"in a&&a.stopPropagation());return!1}
function lerp(a,b,c,d,e){return(e-a)*(d-b)/(c-a)+b}function smoothStep(a,b,c){a=(c-a)/(b-a);return 0>=a?0:1<=a?1:a*a*(3-2*a)}function zeroObject(a){for(let b in a)switch(typeof a[b]){case "function":break;case "boolean":a[b]=!1;break;case "number":a[b]=0;break;default:const c=a[b];Array.isArray(c)&&c.fill(null);a[b]=null}}
function setup(){function a(c){window.CLib(c).then(d=>{cLib=d;window.main&&window.main()},d=>{alert(d);throw d;})}Array.prototype.fill||(Array.prototype.fill=function(c,d,e){var f=this.length|0;d|=0;e=void 0===e?f:e|0;e=0>e?Math.max(f+e,0):Math.min(e,f);for(d=0>d?Math.max(f+d,0):Math.min(d,f);d<e;)this[d++]=c;return this});const b=window.CLibWasmBinaryReader;b?Promise.resolve(b()).then(c=>{a({wasmBinary:c})},()=>{a()}):a()}setup();
